<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="generator" content="rustdoc"><meta name="description" content="Source to the Rust file `demo_src\src\main.rs`."><meta name="keywords" content="rust, rustlang, rust-lang"><title>main.rs.html -- source</title><link rel="stylesheet" type="text/css" href="../../normalize.css"><link rel="stylesheet" type="text/css" href="../../rustdoc.css" id="mainThemeStyle"><link rel="stylesheet" type="text/css" href="../../dark.css"><link rel="stylesheet" type="text/css" href="../../light.css" id="themeStyle"><script src="../../storage.js"></script><noscript><link rel="stylesheet" href="../../noscript.css"></noscript><link rel="shortcut icon" href="../../favicon.ico"><style type="text/css">#crate-search{background-image:url("../../down-arrow.svg");}</style></head><body class="rustdoc source"><!--[if lte IE 8]><div class="warning">This old browser is unsupported and will most likely display funky things.</div><![endif]--><nav class="sidebar"><div class="sidebar-menu">&#9776;</div><a href='../../demo_src/index.html'><div class='logo-container'><img src='../../rust-logo.png' alt='logo'></div></a></nav><div class="theme-picker"><button id="theme-picker" aria-label="Pick another theme!"><img src="../../brush.svg" width="18" alt="Pick another theme!"></button><div id="theme-choices"></div></div><script src="../../theme.js"></script><nav class="sub"><form class="search-form js-only"><div class="search-container"><div><select id="crate-search"><option value="All crates">All crates</option></select><input class="search-input" name="search" autocomplete="off" spellcheck="false" placeholder="Click or press ‘S’ to search, ‘?’ for more options…" type="search"></div><a id="settings-menu" href="../../settings.html"><img src="../../wheel.svg" width="18" alt="Change settings"></a></div></form></nav><section id="main" class="content"><pre class="line-numbers"><span id="1">  1</span>
<span id="2">  2</span>
<span id="3">  3</span>
<span id="4">  4</span>
<span id="5">  5</span>
<span id="6">  6</span>
<span id="7">  7</span>
<span id="8">  8</span>
<span id="9">  9</span>
<span id="10"> 10</span>
<span id="11"> 11</span>
<span id="12"> 12</span>
<span id="13"> 13</span>
<span id="14"> 14</span>
<span id="15"> 15</span>
<span id="16"> 16</span>
<span id="17"> 17</span>
<span id="18"> 18</span>
<span id="19"> 19</span>
<span id="20"> 20</span>
<span id="21"> 21</span>
<span id="22"> 22</span>
<span id="23"> 23</span>
<span id="24"> 24</span>
<span id="25"> 25</span>
<span id="26"> 26</span>
<span id="27"> 27</span>
<span id="28"> 28</span>
<span id="29"> 29</span>
<span id="30"> 30</span>
<span id="31"> 31</span>
<span id="32"> 32</span>
<span id="33"> 33</span>
<span id="34"> 34</span>
<span id="35"> 35</span>
<span id="36"> 36</span>
<span id="37"> 37</span>
<span id="38"> 38</span>
<span id="39"> 39</span>
<span id="40"> 40</span>
<span id="41"> 41</span>
<span id="42"> 42</span>
<span id="43"> 43</span>
<span id="44"> 44</span>
<span id="45"> 45</span>
<span id="46"> 46</span>
<span id="47"> 47</span>
<span id="48"> 48</span>
<span id="49"> 49</span>
<span id="50"> 50</span>
<span id="51"> 51</span>
<span id="52"> 52</span>
<span id="53"> 53</span>
<span id="54"> 54</span>
<span id="55"> 55</span>
<span id="56"> 56</span>
<span id="57"> 57</span>
<span id="58"> 58</span>
<span id="59"> 59</span>
<span id="60"> 60</span>
<span id="61"> 61</span>
<span id="62"> 62</span>
<span id="63"> 63</span>
<span id="64"> 64</span>
<span id="65"> 65</span>
<span id="66"> 66</span>
<span id="67"> 67</span>
<span id="68"> 68</span>
<span id="69"> 69</span>
<span id="70"> 70</span>
<span id="71"> 71</span>
<span id="72"> 72</span>
<span id="73"> 73</span>
<span id="74"> 74</span>
<span id="75"> 75</span>
<span id="76"> 76</span>
<span id="77"> 77</span>
<span id="78"> 78</span>
<span id="79"> 79</span>
<span id="80"> 80</span>
<span id="81"> 81</span>
<span id="82"> 82</span>
<span id="83"> 83</span>
<span id="84"> 84</span>
<span id="85"> 85</span>
<span id="86"> 86</span>
<span id="87"> 87</span>
<span id="88"> 88</span>
<span id="89"> 89</span>
<span id="90"> 90</span>
<span id="91"> 91</span>
<span id="92"> 92</span>
<span id="93"> 93</span>
<span id="94"> 94</span>
<span id="95"> 95</span>
<span id="96"> 96</span>
<span id="97"> 97</span>
<span id="98"> 98</span>
<span id="99"> 99</span>
<span id="100">100</span>
<span id="101">101</span>
<span id="102">102</span>
<span id="103">103</span>
<span id="104">104</span>
<span id="105">105</span>
<span id="106">106</span>
<span id="107">107</span>
<span id="108">108</span>
<span id="109">109</span>
<span id="110">110</span>
<span id="111">111</span>
<span id="112">112</span>
<span id="113">113</span>
<span id="114">114</span>
<span id="115">115</span>
<span id="116">116</span>
<span id="117">117</span>
<span id="118">118</span>
<span id="119">119</span>
<span id="120">120</span>
<span id="121">121</span>
<span id="122">122</span>
<span id="123">123</span>
<span id="124">124</span>
<span id="125">125</span>
<span id="126">126</span>
<span id="127">127</span>
<span id="128">128</span>
<span id="129">129</span>
<span id="130">130</span>
<span id="131">131</span>
<span id="132">132</span>
<span id="133">133</span>
<span id="134">134</span>
<span id="135">135</span>
<span id="136">136</span>
<span id="137">137</span>
<span id="138">138</span>
<span id="139">139</span>
<span id="140">140</span>
<span id="141">141</span>
<span id="142">142</span>
<span id="143">143</span>
<span id="144">144</span>
<span id="145">145</span>
<span id="146">146</span>
<span id="147">147</span>
<span id="148">148</span>
<span id="149">149</span>
<span id="150">150</span>
<span id="151">151</span>
<span id="152">152</span>
<span id="153">153</span>
<span id="154">154</span>
<span id="155">155</span>
<span id="156">156</span>
<span id="157">157</span>
<span id="158">158</span>
<span id="159">159</span>
<span id="160">160</span>
<span id="161">161</span>
<span id="162">162</span>
<span id="163">163</span>
<span id="164">164</span>
<span id="165">165</span>
<span id="166">166</span>
<span id="167">167</span>
<span id="168">168</span>
<span id="169">169</span>
<span id="170">170</span>
<span id="171">171</span>
<span id="172">172</span>
<span id="173">173</span>
<span id="174">174</span>
<span id="175">175</span>
<span id="176">176</span>
<span id="177">177</span>
<span id="178">178</span>
<span id="179">179</span>
<span id="180">180</span>
<span id="181">181</span>
<span id="182">182</span>
<span id="183">183</span>
<span id="184">184</span>
<span id="185">185</span>
<span id="186">186</span>
<span id="187">187</span>
<span id="188">188</span>
<span id="189">189</span>
<span id="190">190</span>
<span id="191">191</span>
<span id="192">192</span>
<span id="193">193</span>
<span id="194">194</span>
<span id="195">195</span>
<span id="196">196</span>
<span id="197">197</span>
<span id="198">198</span>
<span id="199">199</span>
<span id="200">200</span>
<span id="201">201</span>
<span id="202">202</span>
<span id="203">203</span>
<span id="204">204</span>
<span id="205">205</span>
<span id="206">206</span>
<span id="207">207</span>
<span id="208">208</span>
<span id="209">209</span>
<span id="210">210</span>
<span id="211">211</span>
<span id="212">212</span>
<span id="213">213</span>
<span id="214">214</span>
<span id="215">215</span>
<span id="216">216</span>
<span id="217">217</span>
<span id="218">218</span>
<span id="219">219</span>
<span id="220">220</span>
<span id="221">221</span>
<span id="222">222</span>
<span id="223">223</span>
<span id="224">224</span>
<span id="225">225</span>
<span id="226">226</span>
<span id="227">227</span>
<span id="228">228</span>
<span id="229">229</span>
<span id="230">230</span>
<span id="231">231</span>
<span id="232">232</span>
<span id="233">233</span>
<span id="234">234</span>
<span id="235">235</span>
<span id="236">236</span>
<span id="237">237</span>
<span id="238">238</span>
<span id="239">239</span>
<span id="240">240</span>
<span id="241">241</span>
<span id="242">242</span>
<span id="243">243</span>
<span id="244">244</span>
<span id="245">245</span>
<span id="246">246</span>
<span id="247">247</span>
<span id="248">248</span>
<span id="249">249</span>
<span id="250">250</span>
<span id="251">251</span>
<span id="252">252</span>
<span id="253">253</span>
<span id="254">254</span>
<span id="255">255</span>
<span id="256">256</span>
<span id="257">257</span>
<span id="258">258</span>
<span id="259">259</span>
<span id="260">260</span>
<span id="261">261</span>
<span id="262">262</span>
<span id="263">263</span>
<span id="264">264</span>
<span id="265">265</span>
<span id="266">266</span>
<span id="267">267</span>
<span id="268">268</span>
<span id="269">269</span>
<span id="270">270</span>
<span id="271">271</span>
<span id="272">272</span>
<span id="273">273</span>
<span id="274">274</span>
<span id="275">275</span>
<span id="276">276</span>
<span id="277">277</span>
<span id="278">278</span>
<span id="279">279</span>
<span id="280">280</span>
<span id="281">281</span>
<span id="282">282</span>
<span id="283">283</span>
<span id="284">284</span>
<span id="285">285</span>
<span id="286">286</span>
<span id="287">287</span>
<span id="288">288</span>
<span id="289">289</span>
<span id="290">290</span>
<span id="291">291</span>
<span id="292">292</span>
<span id="293">293</span>
<span id="294">294</span>
<span id="295">295</span>
<span id="296">296</span>
<span id="297">297</span>
<span id="298">298</span>
<span id="299">299</span>
<span id="300">300</span>
<span id="301">301</span>
<span id="302">302</span>
<span id="303">303</span>
<span id="304">304</span>
<span id="305">305</span>
<span id="306">306</span>
<span id="307">307</span>
<span id="308">308</span>
<span id="309">309</span>
<span id="310">310</span>
<span id="311">311</span>
<span id="312">312</span>
<span id="313">313</span>
<span id="314">314</span>
<span id="315">315</span>
<span id="316">316</span>
<span id="317">317</span>
<span id="318">318</span>
<span id="319">319</span>
<span id="320">320</span>
<span id="321">321</span>
<span id="322">322</span>
<span id="323">323</span>
<span id="324">324</span>
<span id="325">325</span>
<span id="326">326</span>
<span id="327">327</span>
<span id="328">328</span>
<span id="329">329</span>
<span id="330">330</span>
<span id="331">331</span>
<span id="332">332</span>
<span id="333">333</span>
<span id="334">334</span>
<span id="335">335</span>
<span id="336">336</span>
<span id="337">337</span>
<span id="338">338</span>
<span id="339">339</span>
<span id="340">340</span>
<span id="341">341</span>
<span id="342">342</span>
<span id="343">343</span>
<span id="344">344</span>
<span id="345">345</span>
<span id="346">346</span>
<span id="347">347</span>
<span id="348">348</span>
<span id="349">349</span>
<span id="350">350</span>
<span id="351">351</span>
<span id="352">352</span>
<span id="353">353</span>
<span id="354">354</span>
<span id="355">355</span>
<span id="356">356</span>
<span id="357">357</span>
<span id="358">358</span>
<span id="359">359</span>
<span id="360">360</span>
<span id="361">361</span>
<span id="362">362</span>
<span id="363">363</span>
<span id="364">364</span>
<span id="365">365</span>
<span id="366">366</span>
<span id="367">367</span>
<span id="368">368</span>
<span id="369">369</span>
<span id="370">370</span>
<span id="371">371</span>
<span id="372">372</span>
<span id="373">373</span>
<span id="374">374</span>
<span id="375">375</span>
<span id="376">376</span>
<span id="377">377</span>
<span id="378">378</span>
<span id="379">379</span>
<span id="380">380</span>
<span id="381">381</span>
<span id="382">382</span>
<span id="383">383</span>
<span id="384">384</span>
<span id="385">385</span>
<span id="386">386</span>
<span id="387">387</span>
<span id="388">388</span>
<span id="389">389</span>
<span id="390">390</span>
<span id="391">391</span>
<span id="392">392</span>
<span id="393">393</span>
<span id="394">394</span>
<span id="395">395</span>
<span id="396">396</span>
<span id="397">397</span>
<span id="398">398</span>
<span id="399">399</span>
<span id="400">400</span>
<span id="401">401</span>
<span id="402">402</span>
<span id="403">403</span>
<span id="404">404</span>
<span id="405">405</span>
<span id="406">406</span>
<span id="407">407</span>
<span id="408">408</span>
<span id="409">409</span>
<span id="410">410</span>
<span id="411">411</span>
<span id="412">412</span>
<span id="413">413</span>
<span id="414">414</span>
<span id="415">415</span>
<span id="416">416</span>
<span id="417">417</span>
<span id="418">418</span>
<span id="419">419</span>
<span id="420">420</span>
<span id="421">421</span>
<span id="422">422</span>
<span id="423">423</span>
<span id="424">424</span>
<span id="425">425</span>
<span id="426">426</span>
<span id="427">427</span>
<span id="428">428</span>
<span id="429">429</span>
<span id="430">430</span>
<span id="431">431</span>
<span id="432">432</span>
<span id="433">433</span>
<span id="434">434</span>
<span id="435">435</span>
<span id="436">436</span>
<span id="437">437</span>
<span id="438">438</span>
<span id="439">439</span>
<span id="440">440</span>
<span id="441">441</span>
<span id="442">442</span>
<span id="443">443</span>
<span id="444">444</span>
<span id="445">445</span>
<span id="446">446</span>
<span id="447">447</span>
<span id="448">448</span>
<span id="449">449</span>
<span id="450">450</span>
<span id="451">451</span>
<span id="452">452</span>
<span id="453">453</span>
<span id="454">454</span>
<span id="455">455</span>
<span id="456">456</span>
<span id="457">457</span>
<span id="458">458</span>
<span id="459">459</span>
<span id="460">460</span>
<span id="461">461</span>
<span id="462">462</span>
<span id="463">463</span>
<span id="464">464</span>
<span id="465">465</span>
<span id="466">466</span>
<span id="467">467</span>
<span id="468">468</span>
<span id="469">469</span>
<span id="470">470</span>
<span id="471">471</span>
<span id="472">472</span>
<span id="473">473</span>
<span id="474">474</span>
<span id="475">475</span>
<span id="476">476</span>
<span id="477">477</span>
<span id="478">478</span>
<span id="479">479</span>
<span id="480">480</span>
<span id="481">481</span>
<span id="482">482</span>
<span id="483">483</span>
<span id="484">484</span>
<span id="485">485</span>
<span id="486">486</span>
<span id="487">487</span>
<span id="488">488</span>
<span id="489">489</span>
<span id="490">490</span>
<span id="491">491</span>
<span id="492">492</span>
<span id="493">493</span>
<span id="494">494</span>
<span id="495">495</span>
<span id="496">496</span>
<span id="497">497</span>
<span id="498">498</span>
<span id="499">499</span>
<span id="500">500</span>
<span id="501">501</span>
<span id="502">502</span>
<span id="503">503</span>
<span id="504">504</span>
<span id="505">505</span>
<span id="506">506</span>
<span id="507">507</span>
<span id="508">508</span>
<span id="509">509</span>
<span id="510">510</span>
<span id="511">511</span>
<span id="512">512</span>
<span id="513">513</span>
<span id="514">514</span>
<span id="515">515</span>
<span id="516">516</span>
<span id="517">517</span>
<span id="518">518</span>
<span id="519">519</span>
<span id="520">520</span>
<span id="521">521</span>
<span id="522">522</span>
<span id="523">523</span>
<span id="524">524</span>
<span id="525">525</span>
<span id="526">526</span>
<span id="527">527</span>
<span id="528">528</span>
<span id="529">529</span>
<span id="530">530</span>
<span id="531">531</span>
<span id="532">532</span>
<span id="533">533</span>
<span id="534">534</span>
<span id="535">535</span>
<span id="536">536</span>
<span id="537">537</span>
<span id="538">538</span>
<span id="539">539</span>
<span id="540">540</span>
<span id="541">541</span>
<span id="542">542</span>
<span id="543">543</span>
<span id="544">544</span>
<span id="545">545</span>
<span id="546">546</span>
<span id="547">547</span>
<span id="548">548</span>
<span id="549">549</span>
<span id="550">550</span>
<span id="551">551</span>
<span id="552">552</span>
<span id="553">553</span>
<span id="554">554</span>
<span id="555">555</span>
<span id="556">556</span>
<span id="557">557</span>
<span id="558">558</span>
<span id="559">559</span>
<span id="560">560</span>
<span id="561">561</span>
<span id="562">562</span>
<span id="563">563</span>
<span id="564">564</span>
<span id="565">565</span>
<span id="566">566</span>
<span id="567">567</span>
<span id="568">568</span>
<span id="569">569</span>
<span id="570">570</span>
<span id="571">571</span>
<span id="572">572</span>
<span id="573">573</span>
<span id="574">574</span>
<span id="575">575</span>
<span id="576">576</span>
<span id="577">577</span>
<span id="578">578</span>
<span id="579">579</span>
<span id="580">580</span>
<span id="581">581</span>
<span id="582">582</span>
<span id="583">583</span>
<span id="584">584</span>
<span id="585">585</span>
<span id="586">586</span>
<span id="587">587</span>
<span id="588">588</span>
<span id="589">589</span>
<span id="590">590</span>
<span id="591">591</span>
<span id="592">592</span>
<span id="593">593</span>
<span id="594">594</span>
<span id="595">595</span>
<span id="596">596</span>
<span id="597">597</span>
<span id="598">598</span>
<span id="599">599</span>
<span id="600">600</span>
<span id="601">601</span>
<span id="602">602</span>
<span id="603">603</span>
<span id="604">604</span>
<span id="605">605</span>
<span id="606">606</span>
<span id="607">607</span>
<span id="608">608</span>
<span id="609">609</span>
<span id="610">610</span>
<span id="611">611</span>
<span id="612">612</span>
<span id="613">613</span>
<span id="614">614</span>
<span id="615">615</span>
<span id="616">616</span>
<span id="617">617</span>
<span id="618">618</span>
<span id="619">619</span>
<span id="620">620</span>
<span id="621">621</span>
<span id="622">622</span>
<span id="623">623</span>
<span id="624">624</span>
<span id="625">625</span>
<span id="626">626</span>
<span id="627">627</span>
<span id="628">628</span>
<span id="629">629</span>
<span id="630">630</span>
<span id="631">631</span>
<span id="632">632</span>
<span id="633">633</span>
<span id="634">634</span>
<span id="635">635</span>
<span id="636">636</span>
<span id="637">637</span>
<span id="638">638</span>
<span id="639">639</span>
<span id="640">640</span>
<span id="641">641</span>
<span id="642">642</span>
<span id="643">643</span>
<span id="644">644</span>
<span id="645">645</span>
<span id="646">646</span>
<span id="647">647</span>
<span id="648">648</span>
<span id="649">649</span>
<span id="650">650</span>
<span id="651">651</span>
<span id="652">652</span>
<span id="653">653</span>
<span id="654">654</span>
<span id="655">655</span>
<span id="656">656</span>
<span id="657">657</span>
<span id="658">658</span>
<span id="659">659</span>
<span id="660">660</span>
<span id="661">661</span>
<span id="662">662</span>
<span id="663">663</span>
<span id="664">664</span>
<span id="665">665</span>
<span id="666">666</span>
<span id="667">667</span>
<span id="668">668</span>
<span id="669">669</span>
<span id="670">670</span>
<span id="671">671</span>
<span id="672">672</span>
<span id="673">673</span>
<span id="674">674</span>
<span id="675">675</span>
<span id="676">676</span>
<span id="677">677</span>
<span id="678">678</span>
<span id="679">679</span>
<span id="680">680</span>
<span id="681">681</span>
<span id="682">682</span>
<span id="683">683</span>
<span id="684">684</span>
<span id="685">685</span>
<span id="686">686</span>
<span id="687">687</span>
<span id="688">688</span>
<span id="689">689</span>
<span id="690">690</span>
<span id="691">691</span>
<span id="692">692</span>
<span id="693">693</span>
<span id="694">694</span>
<span id="695">695</span>
<span id="696">696</span>
<span id="697">697</span>
<span id="698">698</span>
<span id="699">699</span>
<span id="700">700</span>
<span id="701">701</span>
<span id="702">702</span>
<span id="703">703</span>
<span id="704">704</span>
<span id="705">705</span>
<span id="706">706</span>
<span id="707">707</span>
<span id="708">708</span>
<span id="709">709</span>
<span id="710">710</span>
<span id="711">711</span>
<span id="712">712</span>
<span id="713">713</span>
<span id="714">714</span>
<span id="715">715</span>
<span id="716">716</span>
<span id="717">717</span>
<span id="718">718</span>
<span id="719">719</span>
<span id="720">720</span>
<span id="721">721</span>
<span id="722">722</span>
<span id="723">723</span>
<span id="724">724</span>
<span id="725">725</span>
<span id="726">726</span>
<span id="727">727</span>
<span id="728">728</span>
<span id="729">729</span>
<span id="730">730</span>
<span id="731">731</span>
<span id="732">732</span>
<span id="733">733</span>
<span id="734">734</span>
<span id="735">735</span>
<span id="736">736</span>
<span id="737">737</span>
<span id="738">738</span>
<span id="739">739</span>
<span id="740">740</span>
<span id="741">741</span>
<span id="742">742</span>
<span id="743">743</span>
<span id="744">744</span>
<span id="745">745</span>
<span id="746">746</span>
<span id="747">747</span>
<span id="748">748</span>
<span id="749">749</span>
<span id="750">750</span>
<span id="751">751</span>
<span id="752">752</span>
<span id="753">753</span>
<span id="754">754</span>
<span id="755">755</span>
<span id="756">756</span>
<span id="757">757</span>
<span id="758">758</span>
<span id="759">759</span>
<span id="760">760</span>
<span id="761">761</span>
<span id="762">762</span>
<span id="763">763</span>
<span id="764">764</span>
<span id="765">765</span>
<span id="766">766</span>
<span id="767">767</span>
<span id="768">768</span>
<span id="769">769</span>
<span id="770">770</span>
<span id="771">771</span>
<span id="772">772</span>
<span id="773">773</span>
<span id="774">774</span>
<span id="775">775</span>
<span id="776">776</span>
<span id="777">777</span>
<span id="778">778</span>
<span id="779">779</span>
<span id="780">780</span>
<span id="781">781</span>
<span id="782">782</span>
<span id="783">783</span>
<span id="784">784</span>
<span id="785">785</span>
<span id="786">786</span>
<span id="787">787</span>
<span id="788">788</span>
<span id="789">789</span>
<span id="790">790</span>
<span id="791">791</span>
<span id="792">792</span>
<span id="793">793</span>
<span id="794">794</span>
<span id="795">795</span>
<span id="796">796</span>
<span id="797">797</span>
<span id="798">798</span>
<span id="799">799</span>
<span id="800">800</span>
<span id="801">801</span>
<span id="802">802</span>
<span id="803">803</span>
<span id="804">804</span>
<span id="805">805</span>
</pre><div class="example-wrap"><pre class="rust ">
<span class="comment">// #![warn(missing_docs)]</span>
<span class="attribute">#![<span class="ident">recursion_limit</span><span class="op">=</span><span class="string">&quot;1024&quot;</span>]</span> <span class="comment">// Recursion limit for error-chain.</span>

<span class="comment">// Copyright 2020 sacn Developers</span>
<span class="comment">//</span>
<span class="comment">// Licensed under the Apache License, Version 2.0, &lt;LICENSE-APACHE or</span>
<span class="comment">// http://apache.org/licenses/LICENSE-2.0&gt; or the MIT license &lt;LICENSE-MIT or</span>
<span class="comment">// http://opensource.org/licenses/MIT&gt;, at your option. This file may not be</span>
<span class="comment">// copied, modified, or distributed except according to those terms.</span>
<span class="comment">//</span>
<span class="comment">// This file was created as part of a University of St Andrews Computer Science BSC Senior Honours Dissertation Project.</span>

<span class="doccomment">//! An example demo sACN source which utilises the sACN library.</span>
<span class="doccomment">//! </span>
<span class="doccomment">//! Primarily used for testing the library including real-world conformance, compliance, integration and acceptance tests.</span>
<span class="doccomment">//! </span>
<span class="doccomment">//! As this program is used for testing the library and isn&#39;t part of the actual library it doesn&#39;t follow the same standards of error handling and as not user</span>
<span class="doccomment">//! facing it was more helpful to have errors flagged up immediately and explicitly at the source to help development rather than trying to handle the errors.</span>
<span class="doccomment">//! </span>
<span class="doccomment">//! Usage instructions are described below.</span>
<span class="doccomment">//! </span>

<span class="attribute">#[<span class="ident">macro_use</span>]</span>
<span class="kw">extern</span> <span class="kw">crate</span> <span class="ident">error_chain</span>;

<span class="doccomment">/// Import the error-chain handling into the module.</span>
<span class="kw">pub</span> <span class="kw">mod</span> <span class="ident">error</span>;
<span class="kw">use</span> <span class="ident">error</span>::<span class="ident">errors</span>::<span class="kw-2">*</span>;

<span class="kw">extern</span> <span class="kw">crate</span> <span class="ident">sacn</span>;

<span class="kw">use</span> <span class="ident">sacn</span>::<span class="ident">source</span>::<span class="ident">SacnSource</span>;
<span class="kw">use</span> <span class="ident">sacn</span>::<span class="ident">packet</span>::{<span class="ident">ACN_SDT_MULTICAST_PORT</span>, <span class="ident">UNIVERSE_CHANNEL_CAPACITY</span>};

<span class="kw">use</span> <span class="ident">std</span>::<span class="ident">time</span>::{<span class="ident">Duration</span>, <span class="ident">Instant</span>};
<span class="kw">use</span> <span class="ident">std</span>::<span class="ident">io</span>;
<span class="kw">use</span> <span class="ident">std</span>::<span class="ident">net</span>::{<span class="ident">IpAddr</span>, <span class="ident">SocketAddr</span>};
<span class="kw">use</span> <span class="ident">std</span>::<span class="ident">env</span>;
<span class="kw">use</span> <span class="ident">std</span>::<span class="ident">thread</span>::<span class="ident">sleep</span>;
<span class="kw">use</span> <span class="ident">std</span>::<span class="ident">str</span>::<span class="ident">FromStr</span>;

<span class="doccomment">/// The start code used in termination packets.</span>
<span class="kw">const</span> <span class="ident">TERMINATE_START_CODE</span>: <span class="ident">u8</span> <span class="op">=</span> <span class="number">0</span>;

<span class="doccomment">/// The period between updates to the values send during the shape generation command.</span>
<span class="doccomment">/// Default value is approximately 30 updates per second choosen fairly arbitarily to be less than the DMX refresh rate (44 fps).</span>
<span class="kw">const</span> <span class="ident">SHAPE_DATA_SEND_PERIOD</span>: <span class="ident">Duration</span> <span class="op">=</span> <span class="ident">Duration</span>::<span class="ident">from_millis</span>(<span class="number">33</span>);

<span class="doccomment">/// The string given by the user to perform each of the various options as described in get_usage_str below.</span>
<span class="kw">const</span> <span class="ident">ACTION_PREVIEW_OPTION</span>:        <span class="kw-2">&amp;</span><span class="ident">str</span> <span class="op">=</span> <span class="string">&quot;p&quot;</span>;
<span class="kw">const</span> <span class="ident">ACTION_DATA_OPTION</span>:           <span class="kw-2">&amp;</span><span class="ident">str</span> <span class="op">=</span> <span class="string">&quot;d&quot;</span>;
<span class="kw">const</span> <span class="ident">ACTION_FULL_DATA_OPTION</span>:      <span class="kw-2">&amp;</span><span class="ident">str</span> <span class="op">=</span> <span class="string">&quot;f&quot;</span>;
<span class="kw">const</span> <span class="ident">ACTION_UNICAST_OPTION</span>:        <span class="kw-2">&amp;</span><span class="ident">str</span> <span class="op">=</span> <span class="string">&quot;u&quot;</span>; 
<span class="kw">const</span> <span class="ident">ACTION_REGISTER_OPTION</span>:       <span class="kw-2">&amp;</span><span class="ident">str</span> <span class="op">=</span> <span class="string">&quot;r&quot;</span>; 
<span class="kw">const</span> <span class="ident">ACTION_TERMINATE_OPTION</span>:      <span class="kw-2">&amp;</span><span class="ident">str</span> <span class="op">=</span> <span class="string">&quot;q&quot;</span>;
<span class="kw">const</span> <span class="ident">ACTION_SLEEP_OPTION</span>:          <span class="kw-2">&amp;</span><span class="ident">str</span> <span class="op">=</span> <span class="string">&quot;w&quot;</span>; 
<span class="kw">const</span> <span class="ident">ACTION_SYNC_OPTION</span>:           <span class="kw-2">&amp;</span><span class="ident">str</span> <span class="op">=</span> <span class="string">&quot;s&quot;</span>;
<span class="kw">const</span> <span class="ident">ACTION_UNICAST_SYNC_OPTION</span>:   <span class="kw-2">&amp;</span><span class="ident">str</span> <span class="op">=</span> <span class="string">&quot;us&quot;</span>; 
<span class="kw">const</span> <span class="ident">ACTION_DATA_OVER_TIME_OPTION</span>: <span class="kw-2">&amp;</span><span class="ident">str</span> <span class="op">=</span> <span class="string">&quot;x&quot;</span>;
<span class="kw">const</span> <span class="ident">ACTION_TEST_PRESENT_OPTION</span>:   <span class="kw-2">&amp;</span><span class="ident">str</span> <span class="op">=</span> <span class="string">&quot;t&quot;</span>;
<span class="kw">const</span> <span class="ident">ACTION_IGNORE</span>:                <span class="kw-2">&amp;</span><span class="ident">str</span> <span class="op">=</span> <span class="string">&quot;#&quot;</span>;
<span class="kw">const</span> <span class="ident">ACTION_ALL_DATA_OPTION</span>:       <span class="kw-2">&amp;</span><span class="ident">str</span> <span class="op">=</span> <span class="string">&quot;a&quot;</span>;

<span class="doccomment">/// The test preset numbers which correspond to the various preset tests described in the sender-interoperability testing document.</span>
<span class="kw">const</span> <span class="ident">TEST_PRESET_TWO_UNIVERSE</span>:         <span class="ident">usize</span> <span class="op">=</span> <span class="number">3</span>;
<span class="kw">const</span> <span class="ident">TEST_PRESET_TWO_UNIVERSE_UNICAST</span>: <span class="ident">usize</span> <span class="op">=</span> <span class="number">4</span>;
<span class="kw">const</span> <span class="ident">TEST_PRESET_MOVING_CHANNELS</span>:      <span class="ident">usize</span> <span class="op">=</span> <span class="number">7</span>;
<span class="kw">const</span> <span class="ident">TEST_PRESET_RAPID_CHANGES</span>:        <span class="ident">usize</span> <span class="op">=</span> <span class="number">8</span>;
<span class="kw">const</span> <span class="ident">TEST_PRESET_HIGH_DATA_RATE</span>:       <span class="ident">usize</span> <span class="op">=</span> <span class="number">9</span>;

<span class="doccomment">/// Test preset number for acceptance test 100. </span>
<span class="kw">const</span> <span class="ident">TEST_PRESET_ACCEPTANCE_TEST</span>:      <span class="ident">usize</span> <span class="op">=</span> <span class="number">100</span>;

<span class="doccomment">/// The duration of one of the preset tests. </span>
<span class="doccomment">/// Each preset test run for 20 seconds.</span>
<span class="kw">const</span> <span class="ident">TEST_PRESET_DURATION</span>:         <span class="ident">Duration</span> <span class="op">=</span> <span class="ident">Duration</span>::<span class="ident">from_secs</span>(<span class="number">20</span>);

<span class="doccomment">/// The number of universes to send on during the high data rate test preset.</span>
<span class="kw">const</span> <span class="ident">TEST_PRESET_HIGH_DATA_RATE_UNI_COUNT</span>: <span class="ident">u16</span> <span class="op">=</span> <span class="number">16</span>;

<span class="doccomment">/// The period of the wave used in the test moving channel preset.</span>
<span class="doccomment">/// In milliseconds.</span>
<span class="kw">const</span> <span class="ident">MOVING_CHANNEL_TEST_WAVE_PERIOD</span>: <span class="ident">f64</span> <span class="op">=</span> <span class="number">4000.0</span>;

<span class="doccomment">/// The offset between each channel in the wave used in the test moving channel preset.</span>
<span class="doccomment">/// The value is dimensionless and corresponds to the scale factor used on the position of the channel in the universe.</span>
<span class="doccomment">/// E.g. 1 is the first channel after the startcode and with a scale factor of 10 it becomes 1 * 10 = 10. This is then added</span>
<span class="doccomment">/// onto x value used for the sine wave. This allows each channel to move slightly seperately. </span>
<span class="kw">const</span> <span class="ident">MOVING_CHANNEL_TEST_WAVE_OFFSET</span>: <span class="ident">f64</span> <span class="op">=</span> <span class="number">10.0</span>;

<span class="doccomment">/// The minimum length of time to wait between sending data packets during the test preset tests.</span>
<span class="kw">const</span> <span class="ident">TEST_PRESET_UPDATE_PERIOD</span>: <span class="ident">Duration</span> <span class="op">=</span> <span class="ident">Duration</span>::<span class="ident">from_millis</span>(<span class="number">33</span>);

<span class="doccomment">/// The period of the square wave generated as part of this test.</span>
<span class="doccomment">/// Measured in packets. </span>
<span class="kw">const</span> <span class="ident">TEST_PRESET_RAPID_CHANGE_PERIOD</span>: <span class="ident">usize</span> <span class="op">=</span> <span class="number">10</span>;

<span class="doccomment">/// The range of values for each universe within the high data rate test preset.</span>
<span class="kw">const</span> <span class="ident">TEST_PRESET_HIGH_DATA_RATE_VARIATION_RANGE</span>: <span class="ident">f64</span> <span class="op">=</span> <span class="number">10.0</span>;

<span class="doccomment">/// The 2 universes used for the acceptance test.</span>
<span class="doccomment">/// UNI_1 contains the backlight fixtures and UNI_2 the frontlight fixtures.</span>
<span class="kw">const</span> <span class="ident">ACCEPT_TEST_UNI_1</span>: <span class="ident">u16</span> <span class="op">=</span> <span class="number">1</span>;
<span class="kw">const</span> <span class="ident">ACCEPT_TEST_UNI_2</span>: <span class="ident">u16</span> <span class="op">=</span> <span class="number">2</span>;

<span class="doccomment">/// The start addresses for each of the fixtures in the acceptance test (universe 1).</span>
<span class="doccomment">/// These are the backlights which are the colour changing lights far from the camera.</span>
<span class="kw">const</span> <span class="ident">ACCEPT_TEST_BACKLIGHT_ADDR_1</span>: <span class="ident">usize</span> <span class="op">=</span> <span class="number">1</span>;
<span class="kw">const</span> <span class="ident">ACCEPT_TEST_BACKLIGHT_ADDR_2</span>: <span class="ident">usize</span> <span class="op">=</span> <span class="number">50</span>;
<span class="kw">const</span> <span class="ident">ACCEPT_TEST_BACKLIGHT_ADDR_3</span>: <span class="ident">usize</span> <span class="op">=</span> <span class="number">100</span>;
<span class="kw">const</span> <span class="ident">ACCEPT_TEST_BACKLIGHT_ADDR_4</span>: <span class="ident">usize</span> <span class="op">=</span> <span class="number">150</span>;
<span class="kw">const</span> <span class="ident">ACCEPT_TEST_BACKLIGHT_ADDR_5</span>: <span class="ident">usize</span> <span class="op">=</span> <span class="number">200</span>;
<span class="kw">const</span> <span class="ident">ACCEPT_TEST_BACKLIGHT_ADDR_6</span>: <span class="ident">usize</span> <span class="op">=</span> <span class="number">250</span>;
<span class="kw">const</span> <span class="ident">ACCEPT_TEST_BACKLIGHT_ADDR_7</span>: <span class="ident">usize</span> <span class="op">=</span> <span class="number">300</span>;
<span class="kw">const</span> <span class="ident">ACCEPT_TEST_BACKLIGHT_ADDR_8</span>: <span class="ident">usize</span> <span class="op">=</span> <span class="number">350</span>;

<span class="doccomment">/// The start addresses for each of the fixtures in the acceptance test.</span>
<span class="doccomment">/// Offset by the universe channel capacity as they are universe 2. </span>
<span class="doccomment">/// These are the frontlights which are near the camera.</span>
<span class="kw">const</span> <span class="ident">ACCEPT_TEST_FRONTLIGHT_ADDR_1</span>: <span class="ident">usize</span> <span class="op">=</span> <span class="ident">UNIVERSE_CHANNEL_CAPACITY</span> <span class="op">+</span> <span class="number">1</span>;
<span class="kw">const</span> <span class="ident">ACCEPT_TEST_FRONTLIGHT_ADDR_2</span>: <span class="ident">usize</span> <span class="op">=</span> <span class="ident">UNIVERSE_CHANNEL_CAPACITY</span> <span class="op">+</span> <span class="number">2</span>;
<span class="kw">const</span> <span class="ident">ACCEPT_TEST_FRONTLIGHT_ADDR_3</span>: <span class="ident">usize</span> <span class="op">=</span> <span class="ident">UNIVERSE_CHANNEL_CAPACITY</span> <span class="op">+</span> <span class="number">3</span>;

<span class="doccomment">/// The number of addresses taken up by the backlights in the acceptance test.</span>
<span class="kw">const</span> <span class="ident">ACCEPT_TEST_BACKLIGHT_CH_COUNT</span>: <span class="ident">usize</span> <span class="op">=</span> <span class="number">16</span>;

<span class="doccomment">/// The number of addresses taken up by the frontlights in the acceptance test.</span>
<span class="kw">const</span> <span class="ident">ACCEPT_TEST_FRONTLIGHT_CH_COUNT</span>: <span class="ident">usize</span> <span class="op">=</span> <span class="number">1</span>;

<span class="doccomment">/// The time the acceptance test sequence should keep cycling for.</span>
<span class="kw">const</span> <span class="ident">ACCEPT_TEST_DURATION</span>: <span class="ident">Duration</span> <span class="op">=</span> <span class="ident">Duration</span>::<span class="ident">from_secs</span>(<span class="number">30</span>);

<span class="doccomment">/// Describes the various commands / command-line arguments avaliable and what they do.</span>
<span class="doccomment">/// Displayed to the user if they ask for help or enter an unrecognised input.</span>
<span class="doccomment">/// Not a const as const with format! not supported in rust.</span>
<span class="kw">fn</span> <span class="ident">get_usage_str</span>() <span class="op">-</span><span class="op">&gt;</span> <span class="ident">String</span>{
    <span class="macro">format</span><span class="macro">!</span>(<span class="string">&quot;Usage ./main &lt;interface_ip&gt; &lt;source_name&gt;\n
    
    Reads data from stdin and sends it using the protocol. \n
    Data must be formatted as, a sync_universe of 0 means no synchronisation, this uses multicast: \n
    {} &lt;universe&gt; &lt;sync_uni&gt; &lt;priority&gt; &lt;data_as_u8_space_seperated&gt; \n
    
    Sends a full universe of data (512 channels + 0 startcode) with the first bytes of the data as specified 
    below (remainder is 0&#39;s) \n
    {} &lt;universe&gt; &lt;sync_uni&gt; &lt;priority&gt; &lt;data_as_u8_space_seperate&gt; \n
    
    To send data unicast use: \n
    {} &lt;universe&gt; &lt;sync_uni&gt; &lt;priority&gt; &lt;dst_addr&gt; &lt;data_as_u8_space_seperated&gt; \n
    
    Register a sending universe as: \n
    {} &lt;universe&gt; \n
    
    Terminate a universe, if universe is 0 then will terminate entirely: \n
    {} &lt;universe&gt; \n
    
    Sleep for x milliseconds \n
    {} &lt;milliseconds&gt; \n
    
    Send a synchronisation packet for the given universe \n
    {} &lt;universe&gt; \n
    
    Send a synchronisation packet for the given universe to the given address \n
    {} &lt;universe&gt; &lt;dst_addr&gt; \n
    
    Start a demo shape which continuously sends data to the given universe for the given number of milliseconds \n
    {} &lt;universe&gt; &lt;duration_millis&gt; &lt;priority&gt;\n

    Set the preview data option flag to the given value, this is reflected in packets sent using the other actions\n
    {} &lt;&#39;true&#39;/&#39;false&#39;&gt;\n

    Sends a full universe of data to the given universe with all values (except the startcode which is set to 0) set to the
    given value. This uses the default priority and no synchronisation.\n
    {} &lt;universe&gt; &lt;value&gt;\n

    Generates output based on the scenario described in the corresponding sender interoperability test.\n
    Preset 3: Two Universes Distinct Values, Arguments: &lt;Universe 1&gt; &lt;Universe 2&gt;\n
    Preset 4: Two Universes Distinct Values Unicast, Arguments: &lt;Universe 1&gt; &lt;Universe 2&gt; &lt;dst_ip&gt;\n
    Preset 7: Independent moving channels (sine wave through universe)\n
    Preset 8: Rapid Changes (Quick moves to 255 to 0 to 255 on repeat)\n
    Preset 9: High data rate (Uses given universe as start universe + the next 15 universes (16 universes total)). Raw value, r, for each universe x, r = [(x - 1) * 10, x * 10). \n
            E.g. for universe 2 the range is [20, 30). \n
    Preset 100: Acceptance Test, Union Demo Sequence, Parameters are ignored as making this work in the general case with any lights patched anywhere would involve writing
                an entire lighting board patch system which is significantly beyond the scope of a single developers year work. \n
                \n
    {} &lt;preset&gt; &lt;universe&gt; &lt;... optionally more arguments&gt;\n

    All input is ignored on lines starting with &#39;{} &#39;. 
    &quot;</span>, <span class="ident">ACTION_DATA_OPTION</span>, <span class="ident">ACTION_FULL_DATA_OPTION</span>, <span class="ident">ACTION_UNICAST_OPTION</span>, <span class="ident">ACTION_REGISTER_OPTION</span>, <span class="ident">ACTION_TERMINATE_OPTION</span>, 
    <span class="ident">ACTION_SLEEP_OPTION</span>, <span class="ident">ACTION_SYNC_OPTION</span>, <span class="ident">ACTION_UNICAST_SYNC_OPTION</span>, <span class="ident">ACTION_DATA_OVER_TIME_OPTION</span>, <span class="ident">ACTION_PREVIEW_OPTION</span>, 
    <span class="ident">ACTION_ALL_DATA_OPTION</span>, <span class="ident">ACTION_TEST_PRESENT_OPTION</span>, <span class="ident">ACTION_IGNORE</span>)
}

<span class="kw">fn</span> <span class="ident">main</span>(){
    <span class="kw">let</span> <span class="ident">cmd_args</span>: <span class="ident">Vec</span><span class="op">&lt;</span><span class="ident">String</span><span class="op">&gt;</span> <span class="op">=</span> <span class="ident">env</span>::<span class="ident">args</span>().<span class="ident">collect</span>();

    <span class="kw">if</span> <span class="ident">cmd_args</span>.<span class="ident">len</span>() <span class="op">&lt;</span> <span class="number">3</span> {
        <span class="kw">return</span> <span class="ident">display_help</span>();
    }

    <span class="kw">let</span> <span class="ident">interface_ip</span> <span class="op">=</span> <span class="kw-2">&amp;</span><span class="ident">cmd_args</span>[<span class="number">1</span>];

    <span class="kw">let</span> <span class="ident">source_name</span> <span class="op">=</span> <span class="kw-2">&amp;</span><span class="ident">cmd_args</span>[<span class="number">2</span>];

    <span class="comment">// Uses the next along port to allow usage on the same machine as a receiver which is using the ACN_SDT port.</span>
    <span class="kw">let</span> <span class="kw-2">mut</span> <span class="ident">src</span> <span class="op">=</span> <span class="ident">SacnSource</span>::<span class="ident">with_ip</span>(<span class="ident">source_name</span>, <span class="ident">SocketAddr</span>::<span class="ident">new</span>(<span class="ident">interface_ip</span>.<span class="ident">parse</span>().<span class="ident">unwrap</span>(), <span class="ident">ACN_SDT_MULTICAST_PORT</span> <span class="op">+</span> <span class="number">1</span>)).<span class="ident">unwrap</span>();

    <span class="macro">println</span><span class="macro">!</span>(<span class="string">&quot;Started&quot;</span>);

    <span class="kw">loop</span> {
        <span class="comment">// https://doc.rust-lang.org/std/io/struct.Stdin.html#method.read_line (03/02/2020)</span>
        <span class="kw">match</span> <span class="ident">handle_input</span>(<span class="kw-2">&amp;</span><span class="kw-2">mut</span> <span class="ident">src</span>) {
            <span class="prelude-val">Ok</span>(<span class="ident">should_continue</span>) <span class="op">=</span><span class="op">&gt;</span> {
                <span class="kw">if</span> <span class="op">!</span><span class="ident">should_continue</span> {
                    <span class="kw">break</span>;
                }
            }
            <span class="prelude-val">Err</span>(<span class="ident">e</span>) <span class="op">=</span><span class="op">&gt;</span> {
                <span class="macro">println</span><span class="macro">!</span>(<span class="string">&quot;Error: Input line unusable: {}&quot;</span>, <span class="ident">e</span>);
            }
        }
    } 
}

<span class="kw">fn</span> <span class="ident">display_help</span>(){
    <span class="macro">println</span><span class="macro">!</span>(<span class="string">&quot;{}&quot;</span>, <span class="ident">get_usage_str</span>());
}

<span class="kw">fn</span> <span class="ident">handle_full_data_option</span>(<span class="ident">src</span>: <span class="kw-2">&amp;</span><span class="kw-2">mut</span> <span class="ident">SacnSource</span>, <span class="ident">split_input</span>: <span class="ident">Vec</span><span class="op">&lt;</span><span class="kw-2">&amp;</span><span class="ident">str</span><span class="op">&gt;</span>) <span class="op">-</span><span class="op">&gt;</span> <span class="prelude-ty">Result</span><span class="op">&lt;</span><span class="ident">bool</span><span class="op">&gt;</span> {
    <span class="kw">if</span> <span class="ident">split_input</span>.<span class="ident">len</span>() <span class="op">&lt;</span> <span class="number">4</span> {
        <span class="macro">bail</span><span class="macro">!</span>(<span class="ident">std</span>::<span class="ident">io</span>::<span class="ident">Error</span>::<span class="ident">new</span>(<span class="ident">std</span>::<span class="ident">io</span>::<span class="ident">ErrorKind</span>::<span class="ident">InvalidInput</span>, <span class="string">&quot;Insufficient parts for data line ( &lt; 4 )&quot;</span>));
    }

    <span class="kw">let</span> <span class="ident">universe</span>: <span class="ident">u16</span> <span class="op">=</span> <span class="ident">split_input</span>[<span class="number">1</span>].<span class="ident">parse</span>().<span class="ident">unwrap</span>();

    <span class="kw">let</span> <span class="ident">sync_uni</span>: <span class="ident">u16</span> <span class="op">=</span> <span class="ident">split_input</span>[<span class="number">2</span>].<span class="ident">parse</span>().<span class="ident">unwrap</span>();

    <span class="kw">let</span> <span class="ident">priority</span>: <span class="ident">u8</span> <span class="op">=</span> <span class="ident">split_input</span>[<span class="number">3</span>].<span class="ident">parse</span>().<span class="ident">unwrap</span>();

    <span class="kw">let</span> <span class="kw-2">mut</span> <span class="ident">data</span>: [<span class="ident">u8</span>; <span class="number">513</span>] <span class="op">=</span> [<span class="number">0</span>; <span class="number">513</span>];

    <span class="kw">for</span> <span class="ident">i</span> <span class="kw">in</span> <span class="number">4</span> .. <span class="ident">split_input</span>.<span class="ident">len</span>() {
        <span class="ident">data</span>[<span class="ident">i</span> <span class="op">-</span> <span class="number">4</span>] <span class="op">=</span> <span class="ident">split_input</span>[<span class="ident">i</span>].<span class="ident">parse</span>().<span class="ident">unwrap</span>();
    }

    <span class="kw">if</span> <span class="ident">sync_uni</span> <span class="op">=</span><span class="op">=</span> <span class="number">0</span> {
        <span class="ident">src</span>.<span class="ident">send</span>(<span class="kw-2">&amp;</span>[<span class="ident">universe</span>], <span class="kw-2">&amp;</span><span class="ident">data</span>, <span class="prelude-val">Some</span>(<span class="ident">priority</span>), <span class="prelude-val">None</span>, <span class="prelude-val">None</span>)<span class="question-mark">?</span>;
    } <span class="kw">else</span> {
        <span class="ident">src</span>.<span class="ident">send</span>(<span class="kw-2">&amp;</span>[<span class="ident">universe</span>], <span class="kw-2">&amp;</span><span class="ident">data</span>, <span class="prelude-val">Some</span>(<span class="ident">priority</span>), <span class="prelude-val">None</span>, <span class="prelude-val">Some</span>(<span class="ident">sync_uni</span>))<span class="question-mark">?</span>;
    }

    <span class="prelude-val">Ok</span>(<span class="bool-val">true</span>)
}

<span class="kw">fn</span> <span class="ident">handle_all_data_option</span>(<span class="ident">src</span>: <span class="kw-2">&amp;</span><span class="kw-2">mut</span> <span class="ident">SacnSource</span>, <span class="ident">split_input</span>: <span class="ident">Vec</span><span class="op">&lt;</span><span class="kw-2">&amp;</span><span class="ident">str</span><span class="op">&gt;</span>) <span class="op">-</span><span class="op">&gt;</span> <span class="prelude-ty">Result</span><span class="op">&lt;</span><span class="ident">bool</span><span class="op">&gt;</span> {
    <span class="kw">if</span> <span class="ident">split_input</span>.<span class="ident">len</span>() <span class="op">&lt;</span> <span class="number">3</span> {
        <span class="macro">bail</span><span class="macro">!</span>(<span class="ident">std</span>::<span class="ident">io</span>::<span class="ident">Error</span>::<span class="ident">new</span>(<span class="ident">std</span>::<span class="ident">io</span>::<span class="ident">ErrorKind</span>::<span class="ident">InvalidInput</span>, <span class="string">&quot;Insufficient parts for data line ( &lt; 3 )&quot;</span>));
    }
    
    <span class="kw">let</span> <span class="ident">universe</span>: <span class="ident">u16</span> <span class="op">=</span> <span class="ident">split_input</span>[<span class="number">1</span>].<span class="ident">parse</span>().<span class="ident">unwrap</span>();

    <span class="kw">let</span> <span class="ident">value</span>: <span class="ident">u8</span> <span class="op">=</span> <span class="ident">split_input</span>[<span class="number">2</span>].<span class="ident">parse</span>().<span class="ident">unwrap</span>();

    <span class="kw">let</span> <span class="kw-2">mut</span> <span class="ident">data</span>: [<span class="ident">u8</span>; <span class="number">513</span>] <span class="op">=</span> [<span class="ident">value</span>; <span class="number">513</span>];

    <span class="ident">data</span>[<span class="number">0</span>] <span class="op">=</span> <span class="number">0</span>; <span class="comment">// Zero startcode used.</span>

    <span class="ident">src</span>.<span class="ident">send</span>(<span class="kw-2">&amp;</span>[<span class="ident">universe</span>], <span class="kw-2">&amp;</span><span class="ident">data</span>, <span class="prelude-val">None</span>, <span class="prelude-val">None</span>, <span class="prelude-val">None</span>)<span class="question-mark">?</span>;

    <span class="prelude-val">Ok</span>(<span class="bool-val">true</span>)
}

<span class="kw">fn</span> <span class="ident">handle_data_option</span>(<span class="ident">src</span>: <span class="kw-2">&amp;</span><span class="kw-2">mut</span> <span class="ident">SacnSource</span>, <span class="ident">split_input</span>: <span class="ident">Vec</span><span class="op">&lt;</span><span class="kw-2">&amp;</span><span class="ident">str</span><span class="op">&gt;</span>) <span class="op">-</span><span class="op">&gt;</span> <span class="prelude-ty">Result</span><span class="op">&lt;</span><span class="ident">bool</span><span class="op">&gt;</span> {
    <span class="kw">let</span> <span class="ident">universe</span>: <span class="ident">u16</span> <span class="op">=</span> <span class="ident">split_input</span>[<span class="number">1</span>].<span class="ident">parse</span>().<span class="ident">unwrap</span>();

    <span class="kw">if</span> <span class="ident">split_input</span>.<span class="ident">len</span>() <span class="op">&lt;</span> <span class="number">4</span> {
        <span class="macro">bail</span><span class="macro">!</span>(<span class="ident">std</span>::<span class="ident">io</span>::<span class="ident">Error</span>::<span class="ident">new</span>(<span class="ident">std</span>::<span class="ident">io</span>::<span class="ident">ErrorKind</span>::<span class="ident">InvalidInput</span>, <span class="string">&quot;Insufficient parts for data line ( &lt; 3 )&quot;</span>));
    }

    <span class="kw">let</span> <span class="ident">sync_uni</span>: <span class="ident">u16</span> <span class="op">=</span> <span class="ident">split_input</span>[<span class="number">2</span>].<span class="ident">parse</span>().<span class="ident">unwrap</span>();

    <span class="kw">let</span> <span class="ident">priority</span>: <span class="ident">u8</span> <span class="op">=</span> <span class="ident">split_input</span>[<span class="number">3</span>].<span class="ident">parse</span>().<span class="ident">unwrap</span>();

    <span class="kw">let</span> <span class="kw-2">mut</span> <span class="ident">data</span>: <span class="ident">Vec</span><span class="op">&lt;</span><span class="ident">u8</span><span class="op">&gt;</span> <span class="op">=</span> <span class="ident">Vec</span>::<span class="ident">new</span>();

    <span class="kw">for</span> <span class="ident">i</span> <span class="kw">in</span> <span class="number">4</span> .. <span class="ident">split_input</span>.<span class="ident">len</span>() {
        <span class="ident">data</span>.<span class="ident">push</span>(<span class="ident">split_input</span>[<span class="ident">i</span>].<span class="ident">parse</span>().<span class="ident">unwrap</span>());
    }

    <span class="kw">if</span> <span class="ident">sync_uni</span> <span class="op">=</span><span class="op">=</span> <span class="number">0</span> {
        <span class="ident">src</span>.<span class="ident">send</span>(<span class="kw-2">&amp;</span>[<span class="ident">universe</span>], <span class="kw-2">&amp;</span><span class="ident">data</span>, <span class="prelude-val">Some</span>(<span class="ident">priority</span>), <span class="prelude-val">None</span>, <span class="prelude-val">None</span>)<span class="question-mark">?</span>;
    } <span class="kw">else</span> {
        <span class="ident">src</span>.<span class="ident">send</span>(<span class="kw-2">&amp;</span>[<span class="ident">universe</span>], <span class="kw-2">&amp;</span><span class="ident">data</span>, <span class="prelude-val">Some</span>(<span class="ident">priority</span>), <span class="prelude-val">None</span>, <span class="prelude-val">Some</span>(<span class="ident">sync_uni</span>))<span class="question-mark">?</span>;
    }

    <span class="prelude-val">Ok</span>(<span class="bool-val">true</span>)
}

<span class="kw">fn</span> <span class="ident">handle_unicast_option</span>(<span class="ident">src</span>: <span class="kw-2">&amp;</span><span class="kw-2">mut</span> <span class="ident">SacnSource</span>, <span class="ident">split_input</span>: <span class="ident">Vec</span><span class="op">&lt;</span><span class="kw-2">&amp;</span><span class="ident">str</span><span class="op">&gt;</span>) <span class="op">-</span><span class="op">&gt;</span> <span class="prelude-ty">Result</span><span class="op">&lt;</span><span class="ident">bool</span><span class="op">&gt;</span> {
    <span class="kw">let</span> <span class="ident">universe</span>: <span class="ident">u16</span> <span class="op">=</span> <span class="ident">split_input</span>[<span class="number">1</span>].<span class="ident">parse</span>().<span class="ident">unwrap</span>();

    <span class="kw">if</span> <span class="ident">split_input</span>.<span class="ident">len</span>() <span class="op">&lt;</span> <span class="number">5</span> {
        <span class="macro">bail</span><span class="macro">!</span>(<span class="ident">std</span>::<span class="ident">io</span>::<span class="ident">Error</span>::<span class="ident">new</span>(<span class="ident">std</span>::<span class="ident">io</span>::<span class="ident">ErrorKind</span>::<span class="ident">InvalidInput</span>, <span class="string">&quot;Insufficient parts for data line ( &lt; 5 )&quot;</span>));
    }

    <span class="kw">let</span> <span class="ident">sync_uni</span>: <span class="ident">u16</span> <span class="op">=</span> <span class="ident">split_input</span>[<span class="number">2</span>].<span class="ident">parse</span>().<span class="ident">unwrap</span>();

    <span class="kw">let</span> <span class="ident">priority</span>: <span class="ident">u8</span> <span class="op">=</span> <span class="ident">split_input</span>[<span class="number">3</span>].<span class="ident">parse</span>().<span class="ident">unwrap</span>();

    <span class="kw">let</span> <span class="ident">dst_ip</span> <span class="op">=</span> <span class="ident">split_input</span>[<span class="number">4</span>];

    <span class="kw">let</span> <span class="kw-2">mut</span> <span class="ident">data</span>: <span class="ident">Vec</span><span class="op">&lt;</span><span class="ident">u8</span><span class="op">&gt;</span> <span class="op">=</span> <span class="ident">Vec</span>::<span class="ident">new</span>();

    <span class="kw">for</span> <span class="ident">i</span> <span class="kw">in</span> <span class="number">5</span> .. <span class="ident">split_input</span>.<span class="ident">len</span>() {
        <span class="ident">data</span>.<span class="ident">push</span>(<span class="ident">split_input</span>[<span class="ident">i</span>].<span class="ident">parse</span>().<span class="ident">unwrap</span>());
    }

    <span class="kw">if</span> <span class="ident">sync_uni</span> <span class="op">=</span><span class="op">=</span> <span class="number">0</span> {
        <span class="ident">src</span>.<span class="ident">send</span>(<span class="kw-2">&amp;</span>[<span class="ident">universe</span>], <span class="kw-2">&amp;</span><span class="ident">data</span>, <span class="prelude-val">Some</span>(<span class="ident">priority</span>), <span class="prelude-val">Some</span>(<span class="ident">SocketAddr</span>::<span class="ident">new</span>(<span class="ident">IpAddr</span>::<span class="ident">V4</span>(<span class="ident">dst_ip</span>.<span class="ident">parse</span>().<span class="ident">unwrap</span>()), <span class="ident">ACN_SDT_MULTICAST_PORT</span>).<span class="ident">into</span>()), <span class="prelude-val">None</span>)<span class="question-mark">?</span>;
    } <span class="kw">else</span> {
        <span class="ident">src</span>.<span class="ident">send</span>(<span class="kw-2">&amp;</span>[<span class="ident">universe</span>], <span class="kw-2">&amp;</span><span class="ident">data</span>, <span class="prelude-val">Some</span>(<span class="ident">priority</span>), <span class="prelude-val">Some</span>(<span class="ident">SocketAddr</span>::<span class="ident">new</span>(<span class="ident">IpAddr</span>::<span class="ident">V4</span>(<span class="ident">dst_ip</span>.<span class="ident">parse</span>().<span class="ident">unwrap</span>()), <span class="ident">ACN_SDT_MULTICAST_PORT</span>).<span class="ident">into</span>()), <span class="prelude-val">Some</span>(<span class="ident">sync_uni</span>))<span class="question-mark">?</span>;
    }

    <span class="prelude-val">Ok</span>(<span class="bool-val">true</span>)
}

<span class="kw">fn</span> <span class="ident">handle_data_over_time_option</span>(<span class="ident">src</span>: <span class="kw-2">&amp;</span><span class="kw-2">mut</span> <span class="ident">SacnSource</span>, <span class="ident">split_input</span>: <span class="ident">Vec</span><span class="op">&lt;</span><span class="kw-2">&amp;</span><span class="ident">str</span><span class="op">&gt;</span>) <span class="op">-</span><span class="op">&gt;</span> <span class="prelude-ty">Result</span><span class="op">&lt;</span><span class="ident">bool</span><span class="op">&gt;</span> {
    <span class="kw">if</span> <span class="ident">split_input</span>.<span class="ident">len</span>() <span class="op">&lt;</span> <span class="number">4</span> {
        <span class="macro">bail</span><span class="macro">!</span>(<span class="ident">std</span>::<span class="ident">io</span>::<span class="ident">Error</span>::<span class="ident">new</span>(<span class="ident">std</span>::<span class="ident">io</span>::<span class="ident">ErrorKind</span>::<span class="ident">InvalidInput</span>, <span class="string">&quot;Insufficient parts for data line ( &lt; 4 )&quot;</span>));
    }

    <span class="kw">let</span> <span class="ident">universe</span>: <span class="ident">u16</span> <span class="op">=</span> <span class="ident">split_input</span>[<span class="number">1</span>].<span class="ident">parse</span>().<span class="ident">unwrap</span>();
    <span class="kw">let</span> <span class="ident">duration_millis</span>: <span class="ident">u64</span> <span class="op">=</span> <span class="ident">split_input</span>[<span class="number">2</span>].<span class="ident">parse</span>().<span class="ident">unwrap</span>();
    <span class="kw">let</span> <span class="ident">priority</span>: <span class="ident">u8</span> <span class="op">=</span> <span class="ident">split_input</span>[<span class="number">3</span>].<span class="ident">parse</span>().<span class="ident">unwrap</span>();

    <span class="kw">let</span> <span class="ident">duration</span>: <span class="ident">Duration</span> <span class="op">=</span> <span class="ident">Duration</span>::<span class="ident">from_millis</span>(<span class="ident">duration_millis</span>);

    <span class="kw">let</span> <span class="ident">start_time</span> <span class="op">=</span> <span class="ident">Instant</span>::<span class="ident">now</span>();

    <span class="kw">while</span> <span class="ident">start_time</span>.<span class="ident">elapsed</span>() <span class="op">&lt;</span> <span class="ident">duration</span> {
        <span class="kw">let</span> <span class="ident">x</span>: <span class="ident">f64</span> <span class="op">=</span> (<span class="ident">start_time</span>.<span class="ident">elapsed</span>().<span class="ident">as_millis</span>() <span class="kw">as</span> <span class="ident">f64</span>) <span class="op">/</span> (<span class="number">1000</span> <span class="kw">as</span> <span class="ident">f64</span>);
        <span class="kw">let</span> <span class="ident">d</span>: <span class="ident">u8</span> <span class="op">=</span> (<span class="number">255.0</span> <span class="op">*</span> <span class="ident">x</span>.<span class="ident">sin</span>()) <span class="kw">as</span> <span class="ident">u8</span>;

        <span class="kw">let</span> <span class="kw-2">mut</span> <span class="ident">data</span>: [<span class="ident">u8</span>; <span class="number">513</span>] <span class="op">=</span> [<span class="ident">d</span>; <span class="number">513</span>];
        <span class="ident">data</span>[<span class="number">0</span>] <span class="op">=</span> <span class="number">0</span>; <span class="comment">// Use 0 startcode</span>

        <span class="ident">src</span>.<span class="ident">send</span>(<span class="kw-2">&amp;</span>[<span class="ident">universe</span>], <span class="kw-2">&amp;</span><span class="ident">data</span>, <span class="prelude-val">Some</span>(<span class="ident">priority</span>), <span class="prelude-val">None</span>, <span class="prelude-val">None</span>)<span class="question-mark">?</span>;

        <span class="ident">sleep</span>(<span class="ident">SHAPE_DATA_SEND_PERIOD</span>);
    }

    <span class="prelude-val">Ok</span>(<span class="bool-val">true</span>)
}

<span class="kw">fn</span> <span class="ident">handle_test_preset_option</span>(<span class="ident">src</span>: <span class="kw-2">&amp;</span><span class="kw-2">mut</span> <span class="ident">SacnSource</span>, <span class="ident">split_input</span>: <span class="ident">Vec</span><span class="op">&lt;</span><span class="kw-2">&amp;</span><span class="ident">str</span><span class="op">&gt;</span>) <span class="op">-</span><span class="op">&gt;</span> <span class="prelude-ty">Result</span><span class="op">&lt;</span><span class="ident">bool</span><span class="op">&gt;</span> {
    <span class="kw">if</span> <span class="ident">split_input</span>.<span class="ident">len</span>() <span class="op">&lt;</span> <span class="number">3</span> {
        <span class="macro">bail</span><span class="macro">!</span>(<span class="ident">std</span>::<span class="ident">io</span>::<span class="ident">Error</span>::<span class="ident">new</span>(<span class="ident">std</span>::<span class="ident">io</span>::<span class="ident">ErrorKind</span>::<span class="ident">InvalidInput</span>, <span class="string">&quot;Insufficient parts for test preset option ( &lt; 3 )&quot;</span>));
    }

    <span class="kw">let</span> <span class="ident">preset</span>: <span class="ident">usize</span> <span class="op">=</span> <span class="ident">split_input</span>[<span class="number">1</span>].<span class="ident">parse</span>().<span class="ident">unwrap</span>();
    <span class="kw">let</span> <span class="ident">universe</span>: <span class="ident">u16</span> <span class="op">=</span> <span class="ident">split_input</span>[<span class="number">2</span>].<span class="ident">parse</span>().<span class="ident">unwrap</span>();

    <span class="kw">match</span> <span class="ident">preset</span> {
        <span class="ident">TEST_PRESET_MOVING_CHANNELS</span> <span class="op">=</span><span class="op">&gt;</span> {
            <span class="ident">run_test_moving_channel_preset</span>(<span class="ident">src</span>, <span class="ident">universe</span>)<span class="question-mark">?</span>;
        },
        <span class="ident">TEST_PRESET_RAPID_CHANGES</span> <span class="op">=</span><span class="op">&gt;</span> {
            <span class="ident">run_test_rapid_changes_preset</span>(<span class="ident">src</span>, <span class="ident">universe</span>)<span class="question-mark">?</span>;
        },
        <span class="ident">TEST_PRESET_HIGH_DATA_RATE</span> <span class="op">=</span><span class="op">&gt;</span> {
            <span class="ident">run_test_high_data_rate</span>(<span class="ident">src</span>, <span class="ident">universe</span>, <span class="ident">TEST_PRESET_HIGH_DATA_RATE_UNI_COUNT</span>)<span class="question-mark">?</span>;
        },
        <span class="ident">TEST_PRESET_TWO_UNIVERSE</span> <span class="op">=</span><span class="op">&gt;</span> {
            <span class="kw">if</span> <span class="ident">split_input</span>.<span class="ident">len</span>() <span class="op">&lt;</span> <span class="number">4</span> {
                <span class="macro">bail</span><span class="macro">!</span>(<span class="ident">std</span>::<span class="ident">io</span>::<span class="ident">Error</span>::<span class="ident">new</span>(<span class="ident">std</span>::<span class="ident">io</span>::<span class="ident">ErrorKind</span>::<span class="ident">InvalidInput</span>, <span class="string">&quot;Insufficient parts for test preset 2 universes option ( &lt; 4 )&quot;</span>));
            }

            <span class="kw">let</span> <span class="ident">universe_2</span>: <span class="ident">u16</span> <span class="op">=</span> <span class="ident">split_input</span>[<span class="number">3</span>].<span class="ident">parse</span>().<span class="ident">unwrap</span>();

            <span class="ident">run_test_2_universes_distinct_values</span>(<span class="ident">src</span>, <span class="ident">universe</span>, <span class="ident">universe_2</span>, <span class="ident">std</span>::<span class="ident">u8</span>::<span class="ident">MAX</span> <span class="op">/</span> <span class="number">2</span>, <span class="ident">std</span>::<span class="ident">u8</span>::<span class="ident">MAX</span>, <span class="prelude-val">None</span>)<span class="question-mark">?</span>;
        },
        <span class="ident">TEST_PRESET_TWO_UNIVERSE_UNICAST</span> <span class="op">=</span><span class="op">&gt;</span> {
            <span class="kw">if</span> <span class="ident">split_input</span>.<span class="ident">len</span>() <span class="op">&lt;</span> <span class="number">5</span> {
                <span class="macro">bail</span><span class="macro">!</span>(<span class="ident">std</span>::<span class="ident">io</span>::<span class="ident">Error</span>::<span class="ident">new</span>(<span class="ident">std</span>::<span class="ident">io</span>::<span class="ident">ErrorKind</span>::<span class="ident">InvalidInput</span>, <span class="string">&quot;Insufficient parts for test preset 2 universes option ( &lt; 4 )&quot;</span>));
            }

            <span class="kw">let</span> <span class="ident">universe_2</span>: <span class="ident">u16</span> <span class="op">=</span> <span class="ident">split_input</span>[<span class="number">3</span>].<span class="ident">parse</span>().<span class="ident">unwrap</span>();
            <span class="kw">let</span> <span class="ident">addr</span> <span class="op">=</span> <span class="ident">SocketAddr</span>::<span class="ident">new</span>(<span class="ident">split_input</span>[<span class="number">4</span>].<span class="ident">parse</span>().<span class="ident">unwrap</span>(), <span class="ident">ACN_SDT_MULTICAST_PORT</span>);

            <span class="ident">run_test_2_universes_distinct_values</span>(<span class="ident">src</span>, <span class="ident">universe</span>, <span class="ident">universe_2</span>, <span class="ident">std</span>::<span class="ident">u8</span>::<span class="ident">MAX</span> <span class="op">/</span> <span class="number">2</span>, <span class="ident">std</span>::<span class="ident">u8</span>::<span class="ident">MAX</span>, <span class="prelude-val">Some</span>(<span class="ident">addr</span>))<span class="question-mark">?</span>;
        },
        <span class="ident">TEST_PRESET_ACCEPTANCE_TEST</span> <span class="op">=</span><span class="op">&gt;</span> {
            <span class="ident">run_acceptance_test_demo</span>(<span class="ident">src</span>)<span class="question-mark">?</span>;
        }
        <span class="kw">_</span> <span class="op">=</span><span class="op">&gt;</span> {
            <span class="macro">bail</span><span class="macro">!</span>(<span class="ident">std</span>::<span class="ident">io</span>::<span class="ident">Error</span>::<span class="ident">new</span>(<span class="ident">std</span>::<span class="ident">io</span>::<span class="ident">ErrorKind</span>::<span class="ident">InvalidInput</span>, <span class="string">&quot;Unrecognised test preset option&quot;</span>));
        }
    }

    <span class="prelude-val">Ok</span>(<span class="bool-val">true</span>)
}

<span class="doccomment">/// Runs a test where the 2 given universes are constantly sent data packets with the given values.</span>
<span class="doccomment">/// Takes a dst_ip argument which can be None to use multicast or Some(addr) to use unicast.</span>
<span class="kw">fn</span> <span class="ident">run_test_2_universes_distinct_values</span>(<span class="ident">src</span>: <span class="kw-2">&amp;</span><span class="kw-2">mut</span> <span class="ident">SacnSource</span>, <span class="ident">uni_1</span>: <span class="ident">u16</span>, <span class="ident">uni_2</span>: <span class="ident">u16</span>, <span class="ident">uni1_val</span>: <span class="ident">u8</span>, <span class="ident">uni2_val</span>: <span class="ident">u8</span>, <span class="ident">dst_ip</span>: <span class="prelude-ty">Option</span><span class="op">&lt;</span><span class="ident">SocketAddr</span><span class="op">&gt;</span>) <span class="op">-</span><span class="op">&gt;</span> <span class="prelude-ty">Result</span><span class="op">&lt;</span>()<span class="op">&gt;</span> {
    <span class="kw">let</span> <span class="ident">start_time</span> <span class="op">=</span> <span class="ident">Instant</span>::<span class="ident">now</span>();

    <span class="kw">let</span> <span class="kw-2">mut</span> <span class="ident">data_1</span>: [<span class="ident">u8</span>; <span class="ident">UNIVERSE_CHANNEL_CAPACITY</span>] <span class="op">=</span> [<span class="ident">uni1_val</span>; <span class="ident">UNIVERSE_CHANNEL_CAPACITY</span>];
    <span class="kw">let</span> <span class="kw-2">mut</span> <span class="ident">data_2</span>: [<span class="ident">u8</span>; <span class="ident">UNIVERSE_CHANNEL_CAPACITY</span>] <span class="op">=</span> [<span class="ident">uni2_val</span>; <span class="ident">UNIVERSE_CHANNEL_CAPACITY</span>];
    <span class="ident">data_1</span>[<span class="number">0</span>] <span class="op">=</span> <span class="number">0</span>; <span class="comment">// Uses 0 zero-start code for both universes.</span>
    <span class="ident">data_2</span>[<span class="number">0</span>] <span class="op">=</span> <span class="number">0</span>; 
    
    <span class="kw">while</span> <span class="ident">start_time</span>.<span class="ident">elapsed</span>() <span class="op">&lt;</span> <span class="ident">TEST_PRESET_DURATION</span> {
        <span class="ident">src</span>.<span class="ident">send</span>(<span class="kw-2">&amp;</span>[<span class="ident">uni_1</span>], <span class="kw-2">&amp;</span><span class="ident">data_1</span>, <span class="prelude-val">None</span>, <span class="ident">dst_ip</span>, <span class="prelude-val">None</span>)<span class="question-mark">?</span>;
        <span class="ident">src</span>.<span class="ident">send</span>(<span class="kw-2">&amp;</span>[<span class="ident">uni_2</span>], <span class="kw-2">&amp;</span><span class="ident">data_2</span>, <span class="prelude-val">None</span>, <span class="ident">dst_ip</span>, <span class="prelude-val">None</span>)<span class="question-mark">?</span>;

        <span class="ident">sleep</span>(<span class="ident">TEST_PRESET_UPDATE_PERIOD</span>);
    }

    <span class="prelude-val">Ok</span>(())
}

<span class="kw">fn</span> <span class="ident">run_test_moving_channel_preset</span>(<span class="ident">src</span>: <span class="kw-2">&amp;</span><span class="kw-2">mut</span> <span class="ident">SacnSource</span>, <span class="ident">universe</span>: <span class="ident">u16</span>) <span class="op">-</span><span class="op">&gt;</span> <span class="prelude-ty">Result</span><span class="op">&lt;</span>()<span class="op">&gt;</span> {
    <span class="kw">let</span> <span class="ident">start_time</span> <span class="op">=</span> <span class="ident">Instant</span>::<span class="ident">now</span>();

    <span class="kw">let</span> <span class="kw-2">mut</span> <span class="ident">data</span>: [<span class="ident">u8</span>; <span class="ident">UNIVERSE_CHANNEL_CAPACITY</span>] <span class="op">=</span> [<span class="number">0</span>; <span class="ident">UNIVERSE_CHANNEL_CAPACITY</span>];

    <span class="kw">while</span> <span class="ident">start_time</span>.<span class="ident">elapsed</span>() <span class="op">&lt;</span> <span class="ident">TEST_PRESET_DURATION</span> {

        <span class="comment">// Use a 0 startcode so skip first value.</span>
        <span class="kw">for</span> <span class="ident">i</span> <span class="kw">in</span> <span class="number">1</span> .. <span class="ident">data</span>.<span class="ident">len</span>() {
            <span class="kw">let</span> <span class="ident">x</span>: <span class="ident">f64</span> <span class="op">=</span> ((<span class="ident">start_time</span>.<span class="ident">elapsed</span>().<span class="ident">as_millis</span>() <span class="kw">as</span> <span class="ident">f64</span>) <span class="op">+</span> (<span class="ident">i</span> <span class="kw">as</span> <span class="ident">f64</span>) <span class="op">*</span> <span class="ident">MOVING_CHANNEL_TEST_WAVE_OFFSET</span>) <span class="op">/</span> <span class="ident">MOVING_CHANNEL_TEST_WAVE_PERIOD</span>;
            <span class="kw">let</span> <span class="ident">d</span>: <span class="ident">u8</span> <span class="op">=</span> ((<span class="ident">std</span>::<span class="ident">u8</span>::<span class="ident">MAX</span> <span class="kw">as</span> <span class="ident">f64</span>) <span class="op">*</span> <span class="ident">x</span>.<span class="ident">sin</span>()) <span class="kw">as</span> <span class="ident">u8</span>;
            <span class="ident">data</span>[<span class="ident">i</span>] <span class="op">=</span> <span class="ident">d</span>;
        }

        <span class="ident">src</span>.<span class="ident">send</span>(<span class="kw-2">&amp;</span>[<span class="ident">universe</span>], <span class="kw-2">&amp;</span><span class="ident">data</span>, <span class="prelude-val">None</span>, <span class="prelude-val">None</span>, <span class="prelude-val">None</span>)<span class="question-mark">?</span>;

        <span class="ident">sleep</span>(<span class="ident">TEST_PRESET_UPDATE_PERIOD</span>);
    }

    <span class="prelude-val">Ok</span>(())
}

<span class="kw">fn</span> <span class="ident">run_test_rapid_changes_preset</span>(<span class="ident">src</span>: <span class="kw-2">&amp;</span><span class="kw-2">mut</span> <span class="ident">SacnSource</span>, <span class="ident">universe</span>: <span class="ident">u16</span>) <span class="op">-</span><span class="op">&gt;</span> <span class="prelude-ty">Result</span><span class="op">&lt;</span>()<span class="op">&gt;</span> {
    <span class="kw">let</span> <span class="ident">start_time</span> <span class="op">=</span> <span class="ident">Instant</span>::<span class="ident">now</span>();

    <span class="kw">let</span> <span class="kw-2">mut</span> <span class="ident">counter</span> <span class="op">=</span> <span class="number">0</span>;

    <span class="kw">while</span> <span class="ident">start_time</span>.<span class="ident">elapsed</span>() <span class="op">&lt;</span> <span class="ident">TEST_PRESET_DURATION</span> {
        <span class="kw">let</span> <span class="kw-2">mut</span> <span class="ident">data</span> <span class="op">=</span> <span class="kw">if</span> <span class="ident">counter</span> <span class="op">&lt;</span> (<span class="ident">TEST_PRESET_RAPID_CHANGE_PERIOD</span> <span class="op">/</span> <span class="number">2</span>) {
            [<span class="number">0</span>; <span class="ident">UNIVERSE_CHANNEL_CAPACITY</span>]
        } <span class="kw">else</span> {
            [<span class="ident">std</span>::<span class="ident">u8</span>::<span class="ident">MAX</span>; <span class="ident">UNIVERSE_CHANNEL_CAPACITY</span>]
        };

        <span class="comment">// Use a zero startcode.</span>
        <span class="ident">data</span>[<span class="number">0</span>] <span class="op">=</span> <span class="number">0</span>;

        <span class="ident">src</span>.<span class="ident">send</span>(<span class="kw-2">&amp;</span>[<span class="ident">universe</span>], <span class="kw-2">&amp;</span><span class="ident">data</span>, <span class="prelude-val">None</span>, <span class="prelude-val">None</span>, <span class="prelude-val">None</span>)<span class="question-mark">?</span>;

        <span class="ident">counter</span> <span class="op">=</span> (<span class="ident">counter</span> <span class="op">+</span> <span class="number">1</span>) <span class="op">%</span> <span class="ident">TEST_PRESET_RAPID_CHANGE_PERIOD</span>;
        <span class="ident">sleep</span>(<span class="ident">TEST_PRESET_UPDATE_PERIOD</span>);
    }

    <span class="prelude-val">Ok</span>(())
}

<span class="kw">fn</span> <span class="ident">run_test_high_data_rate</span>(<span class="ident">src</span>: <span class="kw-2">&amp;</span><span class="kw-2">mut</span> <span class="ident">SacnSource</span>, <span class="ident">start_universe</span>: <span class="ident">u16</span>, <span class="ident">universe_count</span>: <span class="ident">u16</span>) <span class="op">-</span><span class="op">&gt;</span> <span class="prelude-ty">Result</span><span class="op">&lt;</span>()<span class="op">&gt;</span> {
    <span class="kw">let</span> <span class="ident">start_time</span> <span class="op">=</span> <span class="ident">Instant</span>::<span class="ident">now</span>();

    <span class="kw">let</span> <span class="kw-2">mut</span> <span class="ident">counter</span>: <span class="ident">f64</span> <span class="op">=</span> <span class="number">0.0</span>;

    <span class="kw">while</span> <span class="ident">start_time</span>.<span class="ident">elapsed</span>() <span class="op">&lt;</span> <span class="ident">TEST_PRESET_DURATION</span> {
        <span class="kw">for</span> <span class="ident">universe</span> <span class="kw">in</span> <span class="ident">start_universe</span> .. <span class="ident">start_universe</span> <span class="op">+</span> <span class="ident">universe_count</span> {
            <span class="kw">let</span> <span class="ident">d</span> <span class="op">=</span> ((<span class="ident">universe</span> <span class="op">-</span> <span class="ident">start_universe</span>) <span class="kw">as</span> <span class="ident">f64</span>) <span class="op">*</span> (<span class="ident">TEST_PRESET_HIGH_DATA_RATE_VARIATION_RANGE</span> <span class="op">*</span> <span class="ident">counter</span>.<span class="ident">sin</span>());
            <span class="kw">let</span> <span class="kw-2">mut</span> <span class="ident">data</span>: [<span class="ident">u8</span>; <span class="ident">UNIVERSE_CHANNEL_CAPACITY</span>] <span class="op">=</span> [<span class="ident">d</span> <span class="kw">as</span> <span class="ident">u8</span>; <span class="ident">UNIVERSE_CHANNEL_CAPACITY</span>];
            <span class="comment">// Use a zero startcode.</span>
            <span class="ident">data</span>[<span class="number">0</span>] <span class="op">=</span> <span class="number">0</span>;
            <span class="ident">src</span>.<span class="ident">send</span>(<span class="kw-2">&amp;</span>[<span class="ident">universe</span>], <span class="kw-2">&amp;</span><span class="ident">data</span>, <span class="prelude-val">None</span>, <span class="prelude-val">None</span>, <span class="prelude-val">None</span>)<span class="question-mark">?</span>;
        }
        

        <span class="ident">counter</span> <span class="op">=</span> <span class="ident">counter</span> <span class="op">+</span> <span class="number">0.05</span>;
        <span class="ident">sleep</span>(<span class="ident">TEST_PRESET_UPDATE_PERIOD</span>);
    }

    <span class="prelude-val">Ok</span>(())
}

<span class="doccomment">/// Runs the acceptance test sender to vision visualiser demo.</span>
<span class="doccomment">/// </span>
<span class="doccomment">/// Made to work with the corresponding vision visualiser &quot;Student-Union-Model.v3s&quot; file with patch as follows:</span>
<span class="doccomment">/// Format:</span>
<span class="doccomment">/// &lt;fixture_name&gt; &lt;channel_count&gt;ch: &lt;sACN_universe&gt;-&lt;address&gt;, ....</span>
<span class="doccomment">/// </span>
<span class="doccomment">/// Patch:</span>
<span class="doccomment">/// Robe Robin LedBeam 150 16ch: 1-1, 1-50, 1-100, 1-150, 1-200, 1-250, 1-300, 1-350.</span>
<span class="doccomment">/// Fresnel-Front-Light 1ch: 2-1, 2-2, 2-3</span>
<span class="doccomment">/// </span>
<span class="doccomment">/// Step 1, 150 + Front On at full.</span>
<span class="doccomment">/// Step 2, Red</span>
<span class="doccomment">/// Step 3, Blue</span>
<span class="doccomment">/// Step 4, All off</span>
<span class="doccomment">/// </span>
<span class="kw">fn</span> <span class="ident">run_acceptance_test_demo</span>(<span class="ident">src</span>: <span class="kw-2">&amp;</span><span class="kw-2">mut</span> <span class="ident">SacnSource</span>) <span class="op">-</span><span class="op">&gt;</span> <span class="prelude-ty">Result</span><span class="op">&lt;</span>()<span class="op">&gt;</span> {
    <span class="comment">// The number of steps and the length (in packets) of each step.</span>
    <span class="kw">const</span> <span class="ident">STEP_COUNT</span>: <span class="ident">usize</span> <span class="op">=</span> <span class="number">4</span>;
    <span class="kw">const</span> <span class="ident">STEP_LENGTH</span>: <span class="ident">usize</span> <span class="op">=</span> <span class="number">100</span>;

    <span class="kw">let</span> <span class="ident">start_time</span> <span class="op">=</span> <span class="ident">Instant</span>::<span class="ident">now</span>();

    <span class="kw">let</span> <span class="kw-2">mut</span> <span class="ident">step_counter</span>: <span class="ident">usize</span> <span class="op">=</span> <span class="number">0</span>; <span class="comment">// Used as an animation / key-frame timeline to allow different actions to happen in sequence.</span>

    <span class="comment">// </span>
    <span class="kw">let</span> <span class="kw-2">mut</span> <span class="ident">step1_data</span>: [<span class="ident">u8</span>; <span class="ident">UNIVERSE_CHANNEL_CAPACITY</span> <span class="op">*</span> <span class="number">2</span>] <span class="op">=</span> [<span class="number">0</span>; <span class="ident">UNIVERSE_CHANNEL_CAPACITY</span> <span class="op">*</span> <span class="number">2</span>];
    <span class="kw">let</span> <span class="kw-2">mut</span> <span class="ident">step2_data</span>: [<span class="ident">u8</span>; <span class="ident">UNIVERSE_CHANNEL_CAPACITY</span> <span class="op">*</span> <span class="number">2</span>] <span class="op">=</span> [<span class="number">0</span>; <span class="ident">UNIVERSE_CHANNEL_CAPACITY</span> <span class="op">*</span> <span class="number">2</span>];
    <span class="kw">let</span> <span class="kw-2">mut</span> <span class="ident">step3_data</span>: [<span class="ident">u8</span>; <span class="ident">UNIVERSE_CHANNEL_CAPACITY</span> <span class="op">*</span> <span class="number">2</span>] <span class="op">=</span> [<span class="number">0</span>; <span class="ident">UNIVERSE_CHANNEL_CAPACITY</span> <span class="op">*</span> <span class="number">2</span>];
    <span class="kw">let</span> <span class="kw-2">mut</span> <span class="ident">step4_data</span>: [<span class="ident">u8</span>; <span class="ident">UNIVERSE_CHANNEL_CAPACITY</span> <span class="op">*</span> <span class="number">2</span>] <span class="op">=</span> [<span class="number">0</span>; <span class="ident">UNIVERSE_CHANNEL_CAPACITY</span> <span class="op">*</span> <span class="number">2</span>];

    <span class="ident">gen_acceptance_test_step_1</span>(<span class="kw-2">&amp;</span><span class="kw-2">mut</span> <span class="ident">step1_data</span>);
    <span class="ident">gen_acceptance_test_step_2</span>(<span class="kw-2">&amp;</span><span class="kw-2">mut</span> <span class="ident">step2_data</span>);
    <span class="ident">gen_acceptance_test_step_3</span>(<span class="kw-2">&amp;</span><span class="kw-2">mut</span> <span class="ident">step3_data</span>);
    <span class="ident">gen_acceptance_test_step_4</span>(<span class="kw-2">&amp;</span><span class="kw-2">mut</span> <span class="ident">step4_data</span>);

    <span class="comment">// Put each step into a data structure to cycle through.</span>
    <span class="kw">let</span> <span class="ident">data</span> <span class="op">=</span> [<span class="ident">step1_data</span>, <span class="ident">step2_data</span>, <span class="ident">step3_data</span>, <span class="ident">step4_data</span>];

    <span class="kw">while</span> <span class="ident">start_time</span>.<span class="ident">elapsed</span>() <span class="op">&lt;</span> <span class="ident">ACCEPT_TEST_DURATION</span> {
        <span class="comment">// Cycle through each step.</span>
        <span class="kw">let</span> <span class="ident">pos</span>: <span class="ident">usize</span> <span class="op">=</span> <span class="ident">step_counter</span> <span class="op">/</span> <span class="ident">STEP_LENGTH</span>;

        <span class="ident">src</span>.<span class="ident">send</span>(<span class="kw-2">&amp;</span>[<span class="ident">ACCEPT_TEST_UNI_1</span>, <span class="ident">ACCEPT_TEST_UNI_2</span>], <span class="kw-2">&amp;</span><span class="ident">data</span>[<span class="ident">pos</span>], <span class="prelude-val">None</span>, <span class="prelude-val">None</span>, <span class="prelude-val">None</span>)<span class="question-mark">?</span>;

        <span class="ident">step_counter</span> <span class="op">=</span> (<span class="ident">step_counter</span> <span class="op">+</span> <span class="number">1</span>) <span class="op">%</span> (<span class="ident">STEP_LENGTH</span> <span class="op">*</span> <span class="ident">STEP_COUNT</span>); <span class="comment">// Loop back around at the end.</span>
        <span class="ident">sleep</span>(<span class="ident">TEST_PRESET_UPDATE_PERIOD</span>);
    }

    <span class="prelude-val">Ok</span>(())
}

<span class="doccomment">/// Step 1, Backlight + Front On at full.</span>
<span class="kw">fn</span> <span class="ident">gen_acceptance_test_step_1</span>(<span class="ident">buf</span>: <span class="kw-2">&amp;</span><span class="kw-2">mut</span> [<span class="ident">u8</span>; <span class="ident">UNIVERSE_CHANNEL_CAPACITY</span> <span class="op">*</span> <span class="number">2</span>]) {
    <span class="comment">// Backlights.</span>
    <span class="ident">gen_acceptance_test_step_1_backlight_state</span>(<span class="kw-2">&amp;</span><span class="kw-2">mut</span> <span class="ident">buf</span>[<span class="ident">ACCEPT_TEST_BACKLIGHT_ADDR_1</span> .. <span class="ident">ACCEPT_TEST_BACKLIGHT_ADDR_1</span> <span class="op">+</span> <span class="ident">ACCEPT_TEST_BACKLIGHT_CH_COUNT</span>]);
    <span class="ident">gen_acceptance_test_step_1_backlight_state</span>(<span class="kw-2">&amp;</span><span class="kw-2">mut</span> <span class="ident">buf</span>[<span class="ident">ACCEPT_TEST_BACKLIGHT_ADDR_2</span> .. <span class="ident">ACCEPT_TEST_BACKLIGHT_ADDR_2</span> <span class="op">+</span> <span class="ident">ACCEPT_TEST_BACKLIGHT_CH_COUNT</span>]);
    <span class="ident">gen_acceptance_test_step_1_backlight_state</span>(<span class="kw-2">&amp;</span><span class="kw-2">mut</span> <span class="ident">buf</span>[<span class="ident">ACCEPT_TEST_BACKLIGHT_ADDR_3</span> .. <span class="ident">ACCEPT_TEST_BACKLIGHT_ADDR_3</span> <span class="op">+</span> <span class="ident">ACCEPT_TEST_BACKLIGHT_CH_COUNT</span>]);
    <span class="ident">gen_acceptance_test_step_1_backlight_state</span>(<span class="kw-2">&amp;</span><span class="kw-2">mut</span> <span class="ident">buf</span>[<span class="ident">ACCEPT_TEST_BACKLIGHT_ADDR_4</span> .. <span class="ident">ACCEPT_TEST_BACKLIGHT_ADDR_4</span> <span class="op">+</span> <span class="ident">ACCEPT_TEST_BACKLIGHT_CH_COUNT</span>]);
    <span class="ident">gen_acceptance_test_step_1_backlight_state</span>(<span class="kw-2">&amp;</span><span class="kw-2">mut</span> <span class="ident">buf</span>[<span class="ident">ACCEPT_TEST_BACKLIGHT_ADDR_5</span> .. <span class="ident">ACCEPT_TEST_BACKLIGHT_ADDR_5</span> <span class="op">+</span> <span class="ident">ACCEPT_TEST_BACKLIGHT_CH_COUNT</span>]);
    <span class="ident">gen_acceptance_test_step_1_backlight_state</span>(<span class="kw-2">&amp;</span><span class="kw-2">mut</span> <span class="ident">buf</span>[<span class="ident">ACCEPT_TEST_BACKLIGHT_ADDR_6</span> .. <span class="ident">ACCEPT_TEST_BACKLIGHT_ADDR_6</span> <span class="op">+</span> <span class="ident">ACCEPT_TEST_BACKLIGHT_CH_COUNT</span>]);
    <span class="ident">gen_acceptance_test_step_1_backlight_state</span>(<span class="kw-2">&amp;</span><span class="kw-2">mut</span> <span class="ident">buf</span>[<span class="ident">ACCEPT_TEST_BACKLIGHT_ADDR_7</span> .. <span class="ident">ACCEPT_TEST_BACKLIGHT_ADDR_7</span> <span class="op">+</span> <span class="ident">ACCEPT_TEST_BACKLIGHT_CH_COUNT</span>]);
    <span class="ident">gen_acceptance_test_step_1_backlight_state</span>(<span class="kw-2">&amp;</span><span class="kw-2">mut</span> <span class="ident">buf</span>[<span class="ident">ACCEPT_TEST_BACKLIGHT_ADDR_8</span> .. <span class="ident">ACCEPT_TEST_BACKLIGHT_ADDR_8</span> <span class="op">+</span> <span class="ident">ACCEPT_TEST_BACKLIGHT_CH_COUNT</span>]);

    <span class="comment">// Frontlights.</span>
    <span class="ident">gen_acceptance_test_step_1_frontlight_state</span>(<span class="kw-2">&amp;</span><span class="kw-2">mut</span> <span class="ident">buf</span>[<span class="ident">ACCEPT_TEST_FRONTLIGHT_ADDR_1</span> .. <span class="ident">ACCEPT_TEST_FRONTLIGHT_ADDR_1</span> <span class="op">+</span> <span class="ident">ACCEPT_TEST_FRONTLIGHT_CH_COUNT</span>]);
    <span class="ident">gen_acceptance_test_step_1_frontlight_state</span>(<span class="kw-2">&amp;</span><span class="kw-2">mut</span> <span class="ident">buf</span>[<span class="ident">ACCEPT_TEST_FRONTLIGHT_ADDR_2</span> .. <span class="ident">ACCEPT_TEST_FRONTLIGHT_ADDR_2</span> <span class="op">+</span> <span class="ident">ACCEPT_TEST_FRONTLIGHT_CH_COUNT</span>]);
    <span class="ident">gen_acceptance_test_step_1_frontlight_state</span>(<span class="kw-2">&amp;</span><span class="kw-2">mut</span> <span class="ident">buf</span>[<span class="ident">ACCEPT_TEST_FRONTLIGHT_ADDR_3</span> .. <span class="ident">ACCEPT_TEST_FRONTLIGHT_ADDR_3</span> <span class="op">+</span> <span class="ident">ACCEPT_TEST_FRONTLIGHT_CH_COUNT</span>]);
}

<span class="doccomment">/// The backlights use 16 dmx channels each. The usage of each channel is as described by the DMX chart found at the manufacture website:</span>
<span class="doccomment">/// https://www.robe.cz/ledbeam-150/download/#dmx-charts (12/04/2020).</span>
<span class="doccomment">/// The backlights are in 16 channel mode (mode 2).</span>
<span class="doccomment">/// Channel : Usage (explaination)</span>
<span class="doccomment">/// 1: Pan (positioning)</span>
<span class="doccomment">/// 2: Pan Fine (positioning)</span>
<span class="doccomment">/// 3: Tilt (positioning)</span>
<span class="doccomment">/// 4: Tilt Fine (positioning)</span>
<span class="doccomment">/// 5: Pan/Tilt Speed (positioning)</span>
<span class="doccomment">/// 6: Power/Special Functions (Control channel)</span>
<span class="doccomment">/// 7: Virtual Colour Wheel (colour)</span>
<span class="doccomment">/// 8: Red</span>
<span class="doccomment">/// 9: Green</span>
<span class="doccomment">/// 10:Blue</span>
<span class="doccomment">/// 11:White</span>
<span class="doccomment">/// 12: CTC (colour temperature)</span>
<span class="doccomment">/// 13: Colour-Mix-Control </span>
<span class="doccomment">/// 14: Zoom (beam wideness)</span>
<span class="doccomment">/// 15: Shutter/Strobe (should the fixture rapidly flash)</span>
<span class="doccomment">/// 16: Dimmer Intensity (brightness)</span>
<span class="doccomment">/// </span>
<span class="doccomment">/// This is why this demo is locked to this specific lighting fixture and mode. There is no standard to these channel orderings and so any different</span>
<span class="doccomment">/// fixture or mode wouldn&#39;t behave as expected.</span>
<span class="doccomment">/// </span>
<span class="kw">fn</span> <span class="ident">gen_acceptance_test_step_1_backlight_state</span>(<span class="ident">buf</span>: <span class="kw-2">&amp;</span><span class="kw-2">mut</span> [<span class="ident">u8</span>]) {
    <span class="comment">// Position the fixtures pointing at the stage.</span>
    <span class="ident">buf</span>[<span class="number">0</span>] <span class="op">=</span> <span class="number">128</span>;  <span class="comment">// Pan</span>
    <span class="ident">buf</span>[<span class="number">1</span>] <span class="op">=</span> <span class="number">0</span>;    <span class="comment">// Pan Fine</span>
    <span class="ident">buf</span>[<span class="number">2</span>] <span class="op">=</span> <span class="number">148</span>;  <span class="comment">// Tilt</span>
    <span class="ident">buf</span>[<span class="number">3</span>] <span class="op">=</span> <span class="number">114</span>;  <span class="comment">// Tilt Fine</span>
    <span class="ident">buf</span>[<span class="number">4</span>] <span class="op">=</span> <span class="number">0</span>;    <span class="comment">// Pan/Tilt Speed</span>

    <span class="comment">// Leave the fixtures in their default options state.</span>
    <span class="ident">buf</span>[<span class="number">5</span>] <span class="op">=</span> <span class="number">0</span>;    <span class="comment">// Power/Special Functions (Control channel)</span>

    <span class="comment">// Set the fixture to white.</span>
    <span class="ident">buf</span>[<span class="number">6</span>] <span class="op">=</span> <span class="number">0</span>;    <span class="comment">// Using Red-Green-Blue-White mixing so don&#39;t use the virtual colour wheel.</span>
    <span class="ident">buf</span>[<span class="number">7</span>] <span class="op">=</span> <span class="number">0</span>;    <span class="comment">// Red at 0.</span>
    <span class="ident">buf</span>[<span class="number">8</span>] <span class="op">=</span> <span class="number">0</span>;    <span class="comment">// Green at 0.</span>
    <span class="ident">buf</span>[<span class="number">9</span>] <span class="op">=</span> <span class="number">0</span>;    <span class="comment">// Blue at 0.</span>
    <span class="ident">buf</span>[<span class="number">10</span>] <span class="op">=</span> <span class="number">255</span>; <span class="comment">// White at full.</span>
    <span class="ident">buf</span>[<span class="number">11</span>] <span class="op">=</span> <span class="number">0</span>;   <span class="comment">// Colour temperature at 0 (meaning default colour temperature of around 6500k).</span>
    <span class="ident">buf</span>[<span class="number">12</span>] <span class="op">=</span> <span class="number">45</span>;  <span class="comment">// Use additive colour mixing. 45 is the default value.</span>

    <span class="comment">// Set the fixture so it covers the stage.</span>
    <span class="ident">buf</span>[<span class="number">13</span>] <span class="op">=</span> <span class="number">91</span>;  <span class="comment">// Zoom the fixture so it is wide enough to get reasonable coverage.</span>

    <span class="comment">// Set the fixture to full.</span>
    <span class="ident">buf</span>[<span class="number">14</span>] <span class="op">=</span> <span class="number">255</span>; <span class="comment">// The shutter is set to 255 to indicate it is fully open meaning all light can pass.</span>
    <span class="ident">buf</span>[<span class="number">15</span>] <span class="op">=</span> <span class="number">255</span>; <span class="comment">// The brightness is set to 255 to indicate it should be at full.</span>
}

<span class="doccomment">/// The front-lights only use a single channel which is brightness.</span>
<span class="doccomment">///  For step 1 this is set to full (255).</span>
<span class="kw">fn</span> <span class="ident">gen_acceptance_test_step_1_frontlight_state</span>(<span class="ident">buf</span>: <span class="kw-2">&amp;</span><span class="kw-2">mut</span> [<span class="ident">u8</span>]) {
    <span class="ident">buf</span>[<span class="number">0</span>] <span class="op">=</span> <span class="number">255</span>;
}

<span class="doccomment">/// Step 2, Red</span>
<span class="kw">fn</span> <span class="ident">gen_acceptance_test_step_2</span>(<span class="ident">buf</span>: <span class="kw-2">&amp;</span><span class="kw-2">mut</span> [<span class="ident">u8</span>; <span class="ident">UNIVERSE_CHANNEL_CAPACITY</span> <span class="op">*</span> <span class="number">2</span>]) {
    <span class="comment">// Many of the channels will stay the same, therefore can just layer the changes on top.</span>
    <span class="comment">// This is refered to as &#39;tracking&#39; within the lighting industry and internally is key to how modern lighting control systems deal with having so</span>
    <span class="comment">// many parameters in real-time (by only changing the ones necessary).</span>
    <span class="ident">gen_acceptance_test_step_1</span>(<span class="ident">buf</span>);

    <span class="comment">// The backlight fixtures change colour so therefore the colour channels within them need changing.</span>
    <span class="ident">gen_acceptance_test_step_2_backlight_state</span>(<span class="kw-2">&amp;</span><span class="kw-2">mut</span> <span class="ident">buf</span>[<span class="ident">ACCEPT_TEST_BACKLIGHT_ADDR_1</span> .. <span class="ident">ACCEPT_TEST_BACKLIGHT_ADDR_1</span> <span class="op">+</span> <span class="ident">ACCEPT_TEST_BACKLIGHT_CH_COUNT</span>]);
    <span class="ident">gen_acceptance_test_step_2_backlight_state</span>(<span class="kw-2">&amp;</span><span class="kw-2">mut</span> <span class="ident">buf</span>[<span class="ident">ACCEPT_TEST_BACKLIGHT_ADDR_2</span> .. <span class="ident">ACCEPT_TEST_BACKLIGHT_ADDR_2</span> <span class="op">+</span> <span class="ident">ACCEPT_TEST_BACKLIGHT_CH_COUNT</span>]);
    <span class="ident">gen_acceptance_test_step_2_backlight_state</span>(<span class="kw-2">&amp;</span><span class="kw-2">mut</span> <span class="ident">buf</span>[<span class="ident">ACCEPT_TEST_BACKLIGHT_ADDR_3</span> .. <span class="ident">ACCEPT_TEST_BACKLIGHT_ADDR_3</span> <span class="op">+</span> <span class="ident">ACCEPT_TEST_BACKLIGHT_CH_COUNT</span>]);
    <span class="ident">gen_acceptance_test_step_2_backlight_state</span>(<span class="kw-2">&amp;</span><span class="kw-2">mut</span> <span class="ident">buf</span>[<span class="ident">ACCEPT_TEST_BACKLIGHT_ADDR_4</span> .. <span class="ident">ACCEPT_TEST_BACKLIGHT_ADDR_4</span> <span class="op">+</span> <span class="ident">ACCEPT_TEST_BACKLIGHT_CH_COUNT</span>]);
    <span class="ident">gen_acceptance_test_step_2_backlight_state</span>(<span class="kw-2">&amp;</span><span class="kw-2">mut</span> <span class="ident">buf</span>[<span class="ident">ACCEPT_TEST_BACKLIGHT_ADDR_5</span> .. <span class="ident">ACCEPT_TEST_BACKLIGHT_ADDR_5</span> <span class="op">+</span> <span class="ident">ACCEPT_TEST_BACKLIGHT_CH_COUNT</span>]);
    <span class="ident">gen_acceptance_test_step_2_backlight_state</span>(<span class="kw-2">&amp;</span><span class="kw-2">mut</span> <span class="ident">buf</span>[<span class="ident">ACCEPT_TEST_BACKLIGHT_ADDR_6</span> .. <span class="ident">ACCEPT_TEST_BACKLIGHT_ADDR_6</span> <span class="op">+</span> <span class="ident">ACCEPT_TEST_BACKLIGHT_CH_COUNT</span>]);
    <span class="ident">gen_acceptance_test_step_2_backlight_state</span>(<span class="kw-2">&amp;</span><span class="kw-2">mut</span> <span class="ident">buf</span>[<span class="ident">ACCEPT_TEST_BACKLIGHT_ADDR_7</span> .. <span class="ident">ACCEPT_TEST_BACKLIGHT_ADDR_7</span> <span class="op">+</span> <span class="ident">ACCEPT_TEST_BACKLIGHT_CH_COUNT</span>]);
    <span class="ident">gen_acceptance_test_step_2_backlight_state</span>(<span class="kw-2">&amp;</span><span class="kw-2">mut</span> <span class="ident">buf</span>[<span class="ident">ACCEPT_TEST_BACKLIGHT_ADDR_8</span> .. <span class="ident">ACCEPT_TEST_BACKLIGHT_ADDR_8</span> <span class="op">+</span> <span class="ident">ACCEPT_TEST_BACKLIGHT_CH_COUNT</span>]);

    <span class="comment">// Note that because the front light is not changing in this step it doesn&#39;t have to be modified.</span>
}

<span class="doccomment">/// Apply the changes to the backlight fixtures for step 2 (set to red). Note that only the color changes so only colour channels are affected.</span>
<span class="doccomment">/// This relies on the buffer containing the values from step 1 already.</span>
<span class="kw">fn</span> <span class="ident">gen_acceptance_test_step_2_backlight_state</span>(<span class="ident">buf</span>: <span class="kw-2">&amp;</span><span class="kw-2">mut</span> [<span class="ident">u8</span>]) {
    <span class="comment">// Set the fixture to red.</span>
    <span class="ident">buf</span>[<span class="number">7</span>] <span class="op">=</span> <span class="number">255</span>;  <span class="comment">// Red at full.</span>
    <span class="ident">buf</span>[<span class="number">10</span>] <span class="op">=</span> <span class="number">0</span>;   <span class="comment">// White at 0.</span>
}

<span class="doccomment">/// Step 3, Blue</span>
<span class="kw">fn</span> <span class="ident">gen_acceptance_test_step_3</span>(<span class="ident">buf</span>: <span class="kw-2">&amp;</span><span class="kw-2">mut</span> [<span class="ident">u8</span>; <span class="ident">UNIVERSE_CHANNEL_CAPACITY</span> <span class="op">*</span> <span class="number">2</span>]) {
    <span class="ident">gen_acceptance_test_step_2</span>(<span class="ident">buf</span>);

    <span class="comment">// The backlight fixtures change colour so therefore the colour channels within them need changing.</span>
    <span class="ident">gen_acceptance_test_step_3_backlight_state</span>(<span class="kw-2">&amp;</span><span class="kw-2">mut</span> <span class="ident">buf</span>[<span class="ident">ACCEPT_TEST_BACKLIGHT_ADDR_1</span> .. <span class="ident">ACCEPT_TEST_BACKLIGHT_ADDR_1</span> <span class="op">+</span> <span class="ident">ACCEPT_TEST_BACKLIGHT_CH_COUNT</span>]);
    <span class="ident">gen_acceptance_test_step_3_backlight_state</span>(<span class="kw-2">&amp;</span><span class="kw-2">mut</span> <span class="ident">buf</span>[<span class="ident">ACCEPT_TEST_BACKLIGHT_ADDR_2</span> .. <span class="ident">ACCEPT_TEST_BACKLIGHT_ADDR_2</span> <span class="op">+</span> <span class="ident">ACCEPT_TEST_BACKLIGHT_CH_COUNT</span>]);
    <span class="ident">gen_acceptance_test_step_3_backlight_state</span>(<span class="kw-2">&amp;</span><span class="kw-2">mut</span> <span class="ident">buf</span>[<span class="ident">ACCEPT_TEST_BACKLIGHT_ADDR_3</span> .. <span class="ident">ACCEPT_TEST_BACKLIGHT_ADDR_3</span> <span class="op">+</span> <span class="ident">ACCEPT_TEST_BACKLIGHT_CH_COUNT</span>]);
    <span class="ident">gen_acceptance_test_step_3_backlight_state</span>(<span class="kw-2">&amp;</span><span class="kw-2">mut</span> <span class="ident">buf</span>[<span class="ident">ACCEPT_TEST_BACKLIGHT_ADDR_4</span> .. <span class="ident">ACCEPT_TEST_BACKLIGHT_ADDR_4</span> <span class="op">+</span> <span class="ident">ACCEPT_TEST_BACKLIGHT_CH_COUNT</span>]);
    <span class="ident">gen_acceptance_test_step_3_backlight_state</span>(<span class="kw-2">&amp;</span><span class="kw-2">mut</span> <span class="ident">buf</span>[<span class="ident">ACCEPT_TEST_BACKLIGHT_ADDR_5</span> .. <span class="ident">ACCEPT_TEST_BACKLIGHT_ADDR_5</span> <span class="op">+</span> <span class="ident">ACCEPT_TEST_BACKLIGHT_CH_COUNT</span>]);
    <span class="ident">gen_acceptance_test_step_3_backlight_state</span>(<span class="kw-2">&amp;</span><span class="kw-2">mut</span> <span class="ident">buf</span>[<span class="ident">ACCEPT_TEST_BACKLIGHT_ADDR_6</span> .. <span class="ident">ACCEPT_TEST_BACKLIGHT_ADDR_6</span> <span class="op">+</span> <span class="ident">ACCEPT_TEST_BACKLIGHT_CH_COUNT</span>]);
    <span class="ident">gen_acceptance_test_step_3_backlight_state</span>(<span class="kw-2">&amp;</span><span class="kw-2">mut</span> <span class="ident">buf</span>[<span class="ident">ACCEPT_TEST_BACKLIGHT_ADDR_7</span> .. <span class="ident">ACCEPT_TEST_BACKLIGHT_ADDR_7</span> <span class="op">+</span> <span class="ident">ACCEPT_TEST_BACKLIGHT_CH_COUNT</span>]);
    <span class="ident">gen_acceptance_test_step_3_backlight_state</span>(<span class="kw-2">&amp;</span><span class="kw-2">mut</span> <span class="ident">buf</span>[<span class="ident">ACCEPT_TEST_BACKLIGHT_ADDR_8</span> .. <span class="ident">ACCEPT_TEST_BACKLIGHT_ADDR_8</span> <span class="op">+</span> <span class="ident">ACCEPT_TEST_BACKLIGHT_CH_COUNT</span>]);
}

<span class="doccomment">/// Apply the changes to the backlight fixtures for step 3 (set to blue). Note that only the color changes so only colour channels are affected.</span>
<span class="doccomment">/// This relies on the buffer containing the values from step 2 already.</span>
<span class="kw">fn</span> <span class="ident">gen_acceptance_test_step_3_backlight_state</span>(<span class="ident">buf</span>: <span class="kw-2">&amp;</span><span class="kw-2">mut</span> [<span class="ident">u8</span>]) {
    <span class="comment">// Set the fixture to blue.</span>
    <span class="ident">buf</span>[<span class="number">7</span>] <span class="op">=</span> <span class="number">0</span>;     <span class="comment">// Red at 0.</span>
    <span class="ident">buf</span>[<span class="number">9</span>] <span class="op">=</span> <span class="number">255</span>;   <span class="comment">// Blue at full.</span>
}

<span class="doccomment">/// Step 4, All Off</span>
<span class="kw">fn</span> <span class="ident">gen_acceptance_test_step_4</span>(<span class="ident">buf</span>: <span class="kw-2">&amp;</span><span class="kw-2">mut</span> [<span class="ident">u8</span>; <span class="ident">UNIVERSE_CHANNEL_CAPACITY</span> <span class="op">*</span> <span class="number">2</span>]) {
    <span class="ident">gen_acceptance_test_step_3</span>(<span class="ident">buf</span>);

    <span class="comment">// All fixtures need to change in this state to off so need to update them all.</span>

    <span class="comment">// Backlights.</span>
    <span class="ident">gen_acceptance_test_step_4_backlight_state</span>(<span class="kw-2">&amp;</span><span class="kw-2">mut</span> <span class="ident">buf</span>[<span class="ident">ACCEPT_TEST_BACKLIGHT_ADDR_1</span> .. <span class="ident">ACCEPT_TEST_BACKLIGHT_ADDR_1</span> <span class="op">+</span> <span class="ident">ACCEPT_TEST_BACKLIGHT_CH_COUNT</span>]);
    <span class="ident">gen_acceptance_test_step_4_backlight_state</span>(<span class="kw-2">&amp;</span><span class="kw-2">mut</span> <span class="ident">buf</span>[<span class="ident">ACCEPT_TEST_BACKLIGHT_ADDR_2</span> .. <span class="ident">ACCEPT_TEST_BACKLIGHT_ADDR_2</span> <span class="op">+</span> <span class="ident">ACCEPT_TEST_BACKLIGHT_CH_COUNT</span>]);
    <span class="ident">gen_acceptance_test_step_4_backlight_state</span>(<span class="kw-2">&amp;</span><span class="kw-2">mut</span> <span class="ident">buf</span>[<span class="ident">ACCEPT_TEST_BACKLIGHT_ADDR_3</span> .. <span class="ident">ACCEPT_TEST_BACKLIGHT_ADDR_3</span> <span class="op">+</span> <span class="ident">ACCEPT_TEST_BACKLIGHT_CH_COUNT</span>]);
    <span class="ident">gen_acceptance_test_step_4_backlight_state</span>(<span class="kw-2">&amp;</span><span class="kw-2">mut</span> <span class="ident">buf</span>[<span class="ident">ACCEPT_TEST_BACKLIGHT_ADDR_4</span> .. <span class="ident">ACCEPT_TEST_BACKLIGHT_ADDR_4</span> <span class="op">+</span> <span class="ident">ACCEPT_TEST_BACKLIGHT_CH_COUNT</span>]);
    <span class="ident">gen_acceptance_test_step_4_backlight_state</span>(<span class="kw-2">&amp;</span><span class="kw-2">mut</span> <span class="ident">buf</span>[<span class="ident">ACCEPT_TEST_BACKLIGHT_ADDR_5</span> .. <span class="ident">ACCEPT_TEST_BACKLIGHT_ADDR_5</span> <span class="op">+</span> <span class="ident">ACCEPT_TEST_BACKLIGHT_CH_COUNT</span>]);
    <span class="ident">gen_acceptance_test_step_4_backlight_state</span>(<span class="kw-2">&amp;</span><span class="kw-2">mut</span> <span class="ident">buf</span>[<span class="ident">ACCEPT_TEST_BACKLIGHT_ADDR_6</span> .. <span class="ident">ACCEPT_TEST_BACKLIGHT_ADDR_6</span> <span class="op">+</span> <span class="ident">ACCEPT_TEST_BACKLIGHT_CH_COUNT</span>]);
    <span class="ident">gen_acceptance_test_step_4_backlight_state</span>(<span class="kw-2">&amp;</span><span class="kw-2">mut</span> <span class="ident">buf</span>[<span class="ident">ACCEPT_TEST_BACKLIGHT_ADDR_7</span> .. <span class="ident">ACCEPT_TEST_BACKLIGHT_ADDR_7</span> <span class="op">+</span> <span class="ident">ACCEPT_TEST_BACKLIGHT_CH_COUNT</span>]);
    <span class="ident">gen_acceptance_test_step_4_backlight_state</span>(<span class="kw-2">&amp;</span><span class="kw-2">mut</span> <span class="ident">buf</span>[<span class="ident">ACCEPT_TEST_BACKLIGHT_ADDR_8</span> .. <span class="ident">ACCEPT_TEST_BACKLIGHT_ADDR_8</span> <span class="op">+</span> <span class="ident">ACCEPT_TEST_BACKLIGHT_CH_COUNT</span>]);

    <span class="comment">// Frontlights.</span>
    <span class="ident">gen_acceptance_test_step_4_frontlight_state</span>(<span class="kw-2">&amp;</span><span class="kw-2">mut</span> <span class="ident">buf</span>[<span class="ident">ACCEPT_TEST_FRONTLIGHT_ADDR_1</span> .. <span class="ident">ACCEPT_TEST_FRONTLIGHT_ADDR_1</span> <span class="op">+</span> <span class="ident">ACCEPT_TEST_FRONTLIGHT_CH_COUNT</span>]);
    <span class="ident">gen_acceptance_test_step_4_frontlight_state</span>(<span class="kw-2">&amp;</span><span class="kw-2">mut</span> <span class="ident">buf</span>[<span class="ident">ACCEPT_TEST_FRONTLIGHT_ADDR_2</span> .. <span class="ident">ACCEPT_TEST_FRONTLIGHT_ADDR_2</span> <span class="op">+</span> <span class="ident">ACCEPT_TEST_FRONTLIGHT_CH_COUNT</span>]);
    <span class="ident">gen_acceptance_test_step_4_frontlight_state</span>(<span class="kw-2">&amp;</span><span class="kw-2">mut</span> <span class="ident">buf</span>[<span class="ident">ACCEPT_TEST_FRONTLIGHT_ADDR_3</span> .. <span class="ident">ACCEPT_TEST_FRONTLIGHT_ADDR_3</span> <span class="op">+</span> <span class="ident">ACCEPT_TEST_FRONTLIGHT_CH_COUNT</span>]);
}

<span class="doccomment">/// Apply the changes to the backlight fixtures for step 4 (turn off). Note that only the brightness changes so only the brightness channel is changed.</span>
<span class="doccomment">/// This relies on the buffer containing the values from step 3 already.</span>
<span class="kw">fn</span> <span class="ident">gen_acceptance_test_step_4_backlight_state</span>(<span class="ident">buf</span>: <span class="kw-2">&amp;</span><span class="kw-2">mut</span> [<span class="ident">u8</span>]) {
    <span class="comment">// Set the fixture brightness to 0.</span>
    <span class="ident">buf</span>[<span class="number">15</span>] <span class="op">=</span> <span class="number">0</span>;
}

<span class="doccomment">/// Apply the changes to the frontlight fixtures for step 4 (turn off). Note that only the brightness changes so only the brightness channel is changed.</span>
<span class="doccomment">/// This relies on the buffer containing the values from step 3 already.</span>
<span class="kw">fn</span> <span class="ident">gen_acceptance_test_step_4_frontlight_state</span>(<span class="ident">buf</span>: <span class="kw-2">&amp;</span><span class="kw-2">mut</span> [<span class="ident">u8</span>]) {
    <span class="comment">// Set the fixture brightness to 0.</span>
    <span class="ident">buf</span>[<span class="number">0</span>] <span class="op">=</span> <span class="number">0</span>;
}

<span class="doccomment">/// Returns Ok(true) to continue or Ok(false) if no more input.</span>
<span class="kw">fn</span> <span class="ident">handle_input</span>(<span class="ident">src</span>: <span class="kw-2">&amp;</span><span class="kw-2">mut</span> <span class="ident">SacnSource</span>) <span class="op">-</span><span class="op">&gt;</span> <span class="prelude-ty">Result</span> <span class="op">&lt;</span><span class="ident">bool</span><span class="op">&gt;</span>{
    <span class="kw">let</span> <span class="kw-2">mut</span> <span class="ident">input</span> <span class="op">=</span> <span class="ident">String</span>::<span class="ident">new</span>();
    
    <span class="kw">match</span> <span class="ident">io</span>::<span class="ident">stdin</span>().<span class="ident">read_line</span>(<span class="kw-2">&amp;</span><span class="kw-2">mut</span> <span class="ident">input</span>) {
        <span class="prelude-val">Ok</span>(<span class="ident">n</span>) <span class="op">=</span><span class="op">&gt;</span> {
            <span class="kw">if</span> <span class="ident">n</span> <span class="op">=</span><span class="op">=</span> <span class="number">0</span> {
                <span class="comment">// Means EOF is reached so terminate</span>
                <span class="kw">return</span> <span class="prelude-val">Ok</span>(<span class="bool-val">false</span>)
            }

            <span class="comment">// https://www.tutorialspoint.com/rust/rust_string.htm (03/02/2020)</span>
            <span class="kw">let</span> <span class="ident">split_input</span>: <span class="ident">Vec</span><span class="op">&lt;</span><span class="kw-2">&amp;</span><span class="ident">str</span><span class="op">&gt;</span> <span class="op">=</span> <span class="ident">input</span>.<span class="ident">split_whitespace</span>().<span class="ident">collect</span>();
            <span class="kw">if</span> <span class="ident">split_input</span>.<span class="ident">len</span>() <span class="op">&lt;</span> <span class="number">2</span> {
                <span class="ident">display_help</span>();
                <span class="macro">bail</span><span class="macro">!</span>(<span class="ident">std</span>::<span class="ident">io</span>::<span class="ident">Error</span>::<span class="ident">new</span>(<span class="ident">std</span>::<span class="ident">io</span>::<span class="ident">ErrorKind</span>::<span class="ident">InvalidInput</span>, <span class="string">&quot;Insufficient parts ( &lt; 2 )&quot;</span>));
            }

            <span class="kw">match</span> <span class="ident">split_input</span>[<span class="number">0</span>] {
                <span class="ident">ACTION_IGNORE</span> <span class="op">=</span><span class="op">&gt;</span> {
                    <span class="comment">// Ignore Input</span>
                    <span class="prelude-val">Ok</span>(<span class="bool-val">true</span>)
                }
                <span class="ident">ACTION_DATA_OPTION</span> <span class="op">=</span><span class="op">&gt;</span> {
                    <span class="ident">handle_data_option</span>(<span class="ident">src</span>, <span class="ident">split_input</span>)
                }
                <span class="ident">ACTION_FULL_DATA_OPTION</span> <span class="op">=</span><span class="op">&gt;</span> {
                    <span class="ident">handle_full_data_option</span>(<span class="ident">src</span>, <span class="ident">split_input</span>)
                }
                <span class="ident">ACTION_UNICAST_OPTION</span> <span class="op">=</span><span class="op">&gt;</span> {
                    <span class="ident">handle_unicast_option</span>(<span class="ident">src</span>, <span class="ident">split_input</span>)
                }
                <span class="ident">ACTION_DATA_OVER_TIME_OPTION</span> <span class="op">=</span><span class="op">&gt;</span> {
                    <span class="ident">handle_data_over_time_option</span>(<span class="ident">src</span>, <span class="ident">split_input</span>)
                }
                <span class="ident">ACTION_SYNC_OPTION</span> <span class="op">=</span><span class="op">&gt;</span> {
                    <span class="kw">let</span> <span class="ident">universe</span>: <span class="ident">u16</span> <span class="op">=</span> <span class="ident">split_input</span>[<span class="number">1</span>].<span class="ident">parse</span>().<span class="ident">unwrap</span>();
                    <span class="ident">src</span>.<span class="ident">send_sync_packet</span>(<span class="ident">universe</span>, <span class="prelude-val">None</span>)<span class="question-mark">?</span>;
                    <span class="prelude-val">Ok</span>(<span class="bool-val">true</span>)
                }
                <span class="ident">ACTION_UNICAST_SYNC_OPTION</span> <span class="op">=</span><span class="op">&gt;</span> {
                    <span class="kw">if</span> <span class="ident">split_input</span>.<span class="ident">len</span>() <span class="op">&lt;</span> <span class="number">3</span> {
                        <span class="macro">bail</span><span class="macro">!</span>(<span class="ident">std</span>::<span class="ident">io</span>::<span class="ident">Error</span>::<span class="ident">new</span>(<span class="ident">std</span>::<span class="ident">io</span>::<span class="ident">ErrorKind</span>::<span class="ident">InvalidInput</span>, <span class="string">&quot;Insufficient parts for data line ( &lt; 3 )&quot;</span>));
                    }

                    <span class="kw">let</span> <span class="ident">universe</span>: <span class="ident">u16</span> <span class="op">=</span> <span class="ident">split_input</span>[<span class="number">1</span>].<span class="ident">parse</span>().<span class="ident">unwrap</span>();
                    <span class="kw">let</span> <span class="ident">dst_ip</span> <span class="op">=</span> <span class="ident">split_input</span>[<span class="number">2</span>];
                    <span class="ident">src</span>.<span class="ident">send_sync_packet</span>(<span class="ident">universe</span>, <span class="prelude-val">Some</span>(<span class="ident">SocketAddr</span>::<span class="ident">from_str</span>(<span class="ident">dst_ip</span>).<span class="ident">unwrap</span>().<span class="ident">into</span>()))<span class="question-mark">?</span>;
                    <span class="prelude-val">Ok</span>(<span class="bool-val">true</span>)
                }
                <span class="ident">ACTION_REGISTER_OPTION</span> <span class="op">=</span><span class="op">&gt;</span> {
                    <span class="kw">let</span> <span class="ident">universe</span>: <span class="ident">u16</span> <span class="op">=</span> <span class="ident">split_input</span>[<span class="number">1</span>].<span class="ident">parse</span>().<span class="ident">unwrap</span>();
                    <span class="ident">src</span>.<span class="ident">register_universe</span>(<span class="ident">universe</span>)<span class="question-mark">?</span>;
                    <span class="prelude-val">Ok</span>(<span class="bool-val">true</span>)
                }
                <span class="ident">ACTION_PREVIEW_OPTION</span> <span class="op">=</span><span class="op">&gt;</span> {
                    <span class="kw">let</span> <span class="ident">val</span> <span class="op">=</span> <span class="ident">split_input</span>[<span class="number">1</span>].<span class="ident">parse</span>();

                    <span class="kw">match</span> <span class="ident">val</span> {
                        <span class="prelude-val">Ok</span>(<span class="ident">v</span>) <span class="op">=</span><span class="op">&gt;</span> {
                            <span class="ident">src</span>.<span class="ident">set_preview_mode</span>(<span class="ident">v</span>)<span class="question-mark">?</span>;
                        },
                        <span class="prelude-val">Err</span>(<span class="ident">_e</span>) <span class="op">=</span><span class="op">&gt;</span> {
                            <span class="macro">bail</span><span class="macro">!</span>(<span class="ident">std</span>::<span class="ident">io</span>::<span class="ident">Error</span>::<span class="ident">new</span>(<span class="ident">std</span>::<span class="ident">io</span>::<span class="ident">ErrorKind</span>::<span class="ident">InvalidInput</span>, <span class="string">&quot;Preview flag option not &#39;true&#39;/&#39;false&#39; or otherwise parsable as boolean&quot;</span>));
                        }
                    }
                    <span class="prelude-val">Ok</span>(<span class="bool-val">true</span>)
                }
                <span class="ident">ACTION_TERMINATE_OPTION</span> <span class="op">=</span><span class="op">&gt;</span> {
                    <span class="kw">let</span> <span class="ident">universe</span>: <span class="ident">u16</span> <span class="op">=</span> <span class="ident">split_input</span>[<span class="number">1</span>].<span class="ident">parse</span>().<span class="ident">unwrap</span>();
                    <span class="kw">if</span> <span class="ident">universe</span> <span class="op">=</span><span class="op">=</span> <span class="number">0</span> {
                        <span class="kw">return</span> <span class="prelude-val">Ok</span>(<span class="bool-val">false</span>)
                    } <span class="kw">else</span> {
                        <span class="ident">src</span>.<span class="ident">terminate_stream</span>(<span class="ident">universe</span>, <span class="ident">TERMINATE_START_CODE</span>)<span class="question-mark">?</span>;
                    }
                    <span class="prelude-val">Ok</span>(<span class="bool-val">true</span>)
                }
                <span class="ident">ACTION_SLEEP_OPTION</span> <span class="op">=</span><span class="op">&gt;</span> {
                    <span class="kw">if</span> <span class="ident">split_input</span>.<span class="ident">len</span>() <span class="op">&lt;</span> <span class="number">2</span> {
                        <span class="ident">display_help</span>();
                        <span class="macro">bail</span><span class="macro">!</span>(<span class="ident">std</span>::<span class="ident">io</span>::<span class="ident">Error</span>::<span class="ident">new</span>(<span class="ident">std</span>::<span class="ident">io</span>::<span class="ident">ErrorKind</span>::<span class="ident">InvalidInput</span>, <span class="string">&quot;Insufficient parts ( &lt; 2 )&quot;</span>));
                    }
                    <span class="kw">let</span> <span class="ident">millis</span>: <span class="ident">u64</span> <span class="op">=</span> <span class="ident">split_input</span>[<span class="number">1</span>].<span class="ident">parse</span>().<span class="ident">unwrap</span>();
                    <span class="ident">sleep</span>(<span class="ident">Duration</span>::<span class="ident">from_millis</span>(<span class="ident">millis</span>));
                    <span class="prelude-val">Ok</span>(<span class="bool-val">true</span>)
                }
                <span class="ident">ACTION_ALL_DATA_OPTION</span> <span class="op">=</span><span class="op">&gt;</span> {
                    <span class="ident">handle_all_data_option</span>(<span class="ident">src</span>, <span class="ident">split_input</span>)
                }
                <span class="ident">ACTION_TEST_PRESENT_OPTION</span> <span class="op">=</span><span class="op">&gt;</span> {
                    <span class="ident">handle_test_preset_option</span>(<span class="ident">src</span>, <span class="ident">split_input</span>)
                }
                <span class="ident">x</span> <span class="op">=</span><span class="op">&gt;</span> {
                    <span class="macro">bail</span><span class="macro">!</span>(<span class="ident">std</span>::<span class="ident">io</span>::<span class="ident">Error</span>::<span class="ident">new</span>(<span class="ident">std</span>::<span class="ident">io</span>::<span class="ident">ErrorKind</span>::<span class="ident">InvalidInput</span>, <span class="macro">format</span><span class="macro">!</span>(<span class="string">&quot;Unknown input type: {}&quot;</span>, <span class="ident">x</span>)));
                }
            }
        }
        <span class="prelude-val">Err</span>(<span class="ident">e</span>) <span class="op">=</span><span class="op">&gt;</span> {
            <span class="macro">bail</span><span class="macro">!</span>(<span class="ident">e</span>);
        }
    }
}</pre></div>
</section><section id="search" class="content hidden"></section><section class="footer"></section><script>window.rootPath = "../../";window.currentCrate = "demo_src";</script><script src="../../aliases.js"></script><script src="../../main.js"></script><script src="../../source-script.js"></script><script src="../../source-files.js"></script><script defer src="../../search-index.js"></script></body></html>