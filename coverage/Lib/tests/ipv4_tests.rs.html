<!DOCTYPE html>
<html lang="en-us">
<head>
<title>Grcov report &mdash;ipv4_tests.rs</title>
<link rel="stylesheet" href="../../grcov.css">
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
</head>
<body>
<div class="header">
<div class="view">
<div class="viewRow"><span class="viewItem">Current view:</span><span class="viewValue"><a href="../../index.html">top level</a> - <a href="index.html">Lib/tests</a> - ipv4_tests.rs</span></div>
<div class="viewRow"><span class="viewItem">Date:</span><span class="viewValue">2020-04-06 11:41:56</span></div>
</div>
<div class="stats">
<div class="statsRow"><span></span><span class="statsHit">Hit</span><span class="statsTotal">Total</span><span class="statsCoverage">Coverage</span></div>
<div class="statsRow"><span class="statsLine">Lines</span><span class="linesHit">1616</span><span class="linesTotal">1699</span><span class="linesPercentage lineHi">95.1 %</span></div>
<div class="statsRow"><span class="statsFun">Functions</span><span class="funsHit">272</span><span class="funsTotal">272</span><span class="funsPercentage funHi">100.0 %</span></div>
</div>
</div>
<div class="sourceCode">
<div class="line"><span id="1" class="lineNum"><a href="#1">1</a></span><span class="counterUnCov"></span><span class="lineUnCov">// Copyright 2020 sacn Developers</span></div>
<div class="line"><span id="2" class="lineNum"><a href="#2">2</a></span><span class="counterUnCov"></span><span class="lineUnCov">//</span></div>
<div class="line"><span id="3" class="lineNum"><a href="#3">3</a></span><span class="counterUnCov"></span><span class="lineUnCov">// Licensed under the Apache License, Version 2.0, &lt;LICENSE-APACHE or</span></div>
<div class="line"><span id="4" class="lineNum"><a href="#4">4</a></span><span class="counterUnCov"></span><span class="lineUnCov">// http://apache.org/licenses/LICENSE-2.0&gt; or the MIT license &lt;LICENSE-MIT or</span></div>
<div class="line"><span id="5" class="lineNum"><a href="#5">5</a></span><span class="counterUnCov"></span><span class="lineUnCov">// http://opensource.org/licenses/MIT&gt;, at your option. This file may not be</span></div>
<div class="line"><span id="6" class="lineNum"><a href="#6">6</a></span><span class="counterUnCov"></span><span class="lineUnCov">// copied, modified, or distributed except according to those terms.</span></div>
<div class="line"><span id="7" class="lineNum"><a href="#7">7</a></span><span class="counterUnCov"></span><span class="lineUnCov">//</span></div>
<div class="line"><span id="8" class="lineNum"><a href="#8">8</a></span><span class="counterUnCov"></span><span class="lineUnCov">// This file was created as part of a University of St Andrews Computer Science BSC Senior Honours Dissertation Project.</span></div>
<div class="line"><span id="9" class="lineNum"><a href="#9">9</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="10" class="lineNum"><a href="#10">10</a></span><span class="counterUnCov"></span><span class="lineUnCov">extern crate sacn;</span></div>
<div class="line"><span id="11" class="lineNum"><a href="#11">11</a></span><span class="counterUnCov"></span><span class="lineUnCov">extern crate uuid;</span></div>
<div class="line"><span id="12" class="lineNum"><a href="#12">12</a></span><span class="counterUnCov"></span><span class="lineUnCov">extern crate socket2;</span></div>
<div class="line"><span id="13" class="lineNum"><a href="#13">13</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="14" class="lineNum"><a href="#14">14</a></span><span class="counterUnCov"></span><span class="lineUnCov">use std::{thread};</span></div>
<div class="line"><span id="15" class="lineNum"><a href="#15">15</a></span><span class="counterUnCov"></span><span class="lineUnCov">use std::thread::sleep;</span></div>
<div class="line"><span id="16" class="lineNum"><a href="#16">16</a></span><span class="counterUnCov"></span><span class="lineUnCov">use std::sync::mpsc;</span></div>
<div class="line"><span id="17" class="lineNum"><a href="#17">17</a></span><span class="counterUnCov"></span><span class="lineUnCov">use std::sync::mpsc::{Sender, SyncSender, Receiver, RecvTimeoutError};</span></div>
<div class="line"><span id="18" class="lineNum"><a href="#18">18</a></span><span class="counterUnCov"></span><span class="lineUnCov">use std::time::{Duration, Instant};</span></div>
<div class="line"><span id="19" class="lineNum"><a href="#19">19</a></span><span class="counterUnCov"></span><span class="lineUnCov">use std::net::{IpAddr, Ipv4Addr, SocketAddr};</span></div>
<div class="line"><span id="20" class="lineNum"><a href="#20">20</a></span><span class="counterUnCov"></span><span class="lineUnCov">use std::iter;</span></div>
<div class="line"><span id="21" class="lineNum"><a href="#21">21</a></span><span class="counterUnCov"></span><span class="lineUnCov">use std::convert::TryInto; // Used for converting between u8 and u16 representations. </span></div>
<div class="line"><span id="22" class="lineNum"><a href="#22">22</a></span><span class="counterUnCov"></span><span class="lineUnCov">use std::str; // Used for converting between bytes and strings.</span></div>
<div class="line"><span id="23" class="lineNum"><a href="#23">23</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="24" class="lineNum"><a href="#24">24</a></span><span class="counterUnCov"></span><span class="lineUnCov">use sacn::source::SacnSource;</span></div>
<div class="line"><span id="25" class="lineNum"><a href="#25">25</a></span><span class="counterUnCov"></span><span class="lineUnCov">use sacn::receive::{SacnReceiver, DMXData, htp_dmx_merge};</span></div>
<div class="line"><span id="26" class="lineNum"><a href="#26">26</a></span><span class="counterUnCov"></span><span class="lineUnCov">use sacn::packet::*;</span></div>
<div class="line"><span id="27" class="lineNum"><a href="#27">27</a></span><span class="counterUnCov"></span><span class="lineUnCov">use sacn::error::errors::*;</span></div>
<div class="line"><span id="28" class="lineNum"><a href="#28">28</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="29" class="lineNum"><a href="#29">29</a></span><span class="counterUnCov"></span><span class="lineUnCov">/// UUID library used to handle the UUID&#39;s used in the CID fields.</span></div>
<div class="line"><span id="30" class="lineNum"><a href="#30">30</a></span><span class="counterUnCov"></span><span class="lineUnCov">use uuid::Uuid;</span></div>
<div class="line"><span id="31" class="lineNum"><a href="#31">31</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="32" class="lineNum"><a href="#32">32</a></span><span class="counterUnCov"></span><span class="lineUnCov">/// Socket2 used to create sockets for testing.</span></div>
<div class="line"><span id="33" class="lineNum"><a href="#33">33</a></span><span class="counterUnCov"></span><span class="lineUnCov">use socket2::{Socket, Domain, Type};</span></div>
<div class="line"><span id="34" class="lineNum"><a href="#34">34</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="35" class="lineNum"><a href="#35">35</a></span><span class="counterUnCov"></span><span class="lineUnCov">/// For some tests to work multiple instances of the protocol must be on the same network with the same port for example to test multiple simultaneous receivers, this means multiple IP&#39;s are needed.</span></div>
<div class="line"><span id="36" class="lineNum"><a href="#36">36</a></span><span class="counterUnCov"></span><span class="lineUnCov">/// This is achieved by assigning multiple static IP&#39;s to the test machine and theses IP&#39;s are specified below.</span></div>
<div class="line"><span id="37" class="lineNum"><a href="#37">37</a></span><span class="counterUnCov"></span><span class="lineUnCov">/// Theses must be changed depending on the network that the test machine is on.</span></div>
<div class="line"><span id="38" class="lineNum"><a href="#38">38</a></span><span class="counterUnCov"></span><span class="lineUnCov">pub const TEST_NETWORK_INTERFACE_IPV4: [&amp;&#39;static str; 3] = [&quot;192.168.0.6&quot;, &quot;192.168.0.7&quot;, &quot;192.168.0.8&quot;];</span></div>
<div class="line"><span id="39" class="lineNum"><a href="#39">39</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="40" class="lineNum"><a href="#40">40</a></span><span class="counterUnCov"></span><span class="lineUnCov">pub const TEST_DATA_PARTIAL_CAPACITY_UNIVERSE: [u8; 313] = [0,</span></div>
<div class="line"><span id="41" class="lineNum"><a href="#41">41</a></span><span class="counterUnCov"></span><span class="lineUnCov">        1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20,</span></div>
<div class="line"><span id="42" class="lineNum"><a href="#42">42</a></span><span class="counterUnCov"></span><span class="lineUnCov">        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,</span></div>
<div class="line"><span id="43" class="lineNum"><a href="#43">43</a></span><span class="counterUnCov"></span><span class="lineUnCov">        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,</span></div>
<div class="line"><span id="44" class="lineNum"><a href="#44">44</a></span><span class="counterUnCov"></span><span class="lineUnCov">        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,</span></div>
<div class="line"><span id="45" class="lineNum"><a href="#45">45</a></span><span class="counterUnCov"></span><span class="lineUnCov">        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 100,</span></div>
<div class="line"><span id="46" class="lineNum"><a href="#46">46</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="47" class="lineNum"><a href="#47">47</a></span><span class="counterUnCov"></span><span class="lineUnCov">        1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20,</span></div>
<div class="line"><span id="48" class="lineNum"><a href="#48">48</a></span><span class="counterUnCov"></span><span class="lineUnCov">        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,</span></div>
<div class="line"><span id="49" class="lineNum"><a href="#49">49</a></span><span class="counterUnCov"></span><span class="lineUnCov">        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,</span></div>
<div class="line"><span id="50" class="lineNum"><a href="#50">50</a></span><span class="counterUnCov"></span><span class="lineUnCov">        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,</span></div>
<div class="line"><span id="51" class="lineNum"><a href="#51">51</a></span><span class="counterUnCov"></span><span class="lineUnCov">        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 100,</span></div>
<div class="line"><span id="52" class="lineNum"><a href="#52">52</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="53" class="lineNum"><a href="#53">53</a></span><span class="counterUnCov"></span><span class="lineUnCov">        1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20,</span></div>
<div class="line"><span id="54" class="lineNum"><a href="#54">54</a></span><span class="counterUnCov"></span><span class="lineUnCov">        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,</span></div>
<div class="line"><span id="55" class="lineNum"><a href="#55">55</a></span><span class="counterUnCov"></span><span class="lineUnCov">        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,</span></div>
<div class="line"><span id="56" class="lineNum"><a href="#56">56</a></span><span class="counterUnCov"></span><span class="lineUnCov">        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,</span></div>
<div class="line"><span id="57" class="lineNum"><a href="#57">57</a></span><span class="counterUnCov"></span><span class="lineUnCov">        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 100,</span></div>
<div class="line"><span id="58" class="lineNum"><a href="#58">58</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="59" class="lineNum"><a href="#59">59</a></span><span class="counterUnCov"></span><span class="lineUnCov">        1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12</span></div>
<div class="line"><span id="60" class="lineNum"><a href="#60">60</a></span><span class="counterUnCov"></span><span class="lineUnCov">    ];</span></div>
<div class="line"><span id="61" class="lineNum"><a href="#61">61</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="62" class="lineNum"><a href="#62">62</a></span><span class="counterUnCov"></span><span class="lineUnCov">pub const TEST_DATA_SINGLE_ALTERNATIVE_STARTCODE_UNIVERSE: [u8; 513] = [1,</span></div>
<div class="line"><span id="63" class="lineNum"><a href="#63">63</a></span><span class="counterUnCov"></span><span class="lineUnCov">        1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20,</span></div>
<div class="line"><span id="64" class="lineNum"><a href="#64">64</a></span><span class="counterUnCov"></span><span class="lineUnCov">        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,</span></div>
<div class="line"><span id="65" class="lineNum"><a href="#65">65</a></span><span class="counterUnCov"></span><span class="lineUnCov">        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,</span></div>
<div class="line"><span id="66" class="lineNum"><a href="#66">66</a></span><span class="counterUnCov"></span><span class="lineUnCov">        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,</span></div>
<div class="line"><span id="67" class="lineNum"><a href="#67">67</a></span><span class="counterUnCov"></span><span class="lineUnCov">        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 100,</span></div>
<div class="line"><span id="68" class="lineNum"><a href="#68">68</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="69" class="lineNum"><a href="#69">69</a></span><span class="counterUnCov"></span><span class="lineUnCov">        1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20,</span></div>
<div class="line"><span id="70" class="lineNum"><a href="#70">70</a></span><span class="counterUnCov"></span><span class="lineUnCov">        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,</span></div>
<div class="line"><span id="71" class="lineNum"><a href="#71">71</a></span><span class="counterUnCov"></span><span class="lineUnCov">        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,</span></div>
<div class="line"><span id="72" class="lineNum"><a href="#72">72</a></span><span class="counterUnCov"></span><span class="lineUnCov">        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,</span></div>
<div class="line"><span id="73" class="lineNum"><a href="#73">73</a></span><span class="counterUnCov"></span><span class="lineUnCov">        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 100,</span></div>
<div class="line"><span id="74" class="lineNum"><a href="#74">74</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="75" class="lineNum"><a href="#75">75</a></span><span class="counterUnCov"></span><span class="lineUnCov">        1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20,</span></div>
<div class="line"><span id="76" class="lineNum"><a href="#76">76</a></span><span class="counterUnCov"></span><span class="lineUnCov">        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,</span></div>
<div class="line"><span id="77" class="lineNum"><a href="#77">77</a></span><span class="counterUnCov"></span><span class="lineUnCov">        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,</span></div>
<div class="line"><span id="78" class="lineNum"><a href="#78">78</a></span><span class="counterUnCov"></span><span class="lineUnCov">        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,</span></div>
<div class="line"><span id="79" class="lineNum"><a href="#79">79</a></span><span class="counterUnCov"></span><span class="lineUnCov">        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 100,</span></div>
<div class="line"><span id="80" class="lineNum"><a href="#80">80</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="81" class="lineNum"><a href="#81">81</a></span><span class="counterUnCov"></span><span class="lineUnCov">        1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20,</span></div>
<div class="line"><span id="82" class="lineNum"><a href="#82">82</a></span><span class="counterUnCov"></span><span class="lineUnCov">        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,</span></div>
<div class="line"><span id="83" class="lineNum"><a href="#83">83</a></span><span class="counterUnCov"></span><span class="lineUnCov">        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,</span></div>
<div class="line"><span id="84" class="lineNum"><a href="#84">84</a></span><span class="counterUnCov"></span><span class="lineUnCov">        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,</span></div>
<div class="line"><span id="85" class="lineNum"><a href="#85">85</a></span><span class="counterUnCov"></span><span class="lineUnCov">        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 100,</span></div>
<div class="line"><span id="86" class="lineNum"><a href="#86">86</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="87" class="lineNum"><a href="#87">87</a></span><span class="counterUnCov"></span><span class="lineUnCov">        1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20,</span></div>
<div class="line"><span id="88" class="lineNum"><a href="#88">88</a></span><span class="counterUnCov"></span><span class="lineUnCov">        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,</span></div>
<div class="line"><span id="89" class="lineNum"><a href="#89">89</a></span><span class="counterUnCov"></span><span class="lineUnCov">        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,</span></div>
<div class="line"><span id="90" class="lineNum"><a href="#90">90</a></span><span class="counterUnCov"></span><span class="lineUnCov">        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,</span></div>
<div class="line"><span id="91" class="lineNum"><a href="#91">91</a></span><span class="counterUnCov"></span><span class="lineUnCov">        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 100,</span></div>
<div class="line"><span id="92" class="lineNum"><a href="#92">92</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="93" class="lineNum"><a href="#93">93</a></span><span class="counterUnCov"></span><span class="lineUnCov">        1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12</span></div>
<div class="line"><span id="94" class="lineNum"><a href="#94">94</a></span><span class="counterUnCov"></span><span class="lineUnCov">    ];</span></div>
<div class="line"><span id="95" class="lineNum"><a href="#95">95</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="96" class="lineNum"><a href="#96">96</a></span><span class="counterUnCov"></span><span class="lineUnCov">pub const TEST_DATA_SINGLE_UNIVERSE: [u8; 513] = [0,</span></div>
<div class="line"><span id="97" class="lineNum"><a href="#97">97</a></span><span class="counterUnCov"></span><span class="lineUnCov">        1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20,</span></div>
<div class="line"><span id="98" class="lineNum"><a href="#98">98</a></span><span class="counterUnCov"></span><span class="lineUnCov">        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,</span></div>
<div class="line"><span id="99" class="lineNum"><a href="#99">99</a></span><span class="counterUnCov"></span><span class="lineUnCov">        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,</span></div>
<div class="line"><span id="100" class="lineNum"><a href="#100">100</a></span><span class="counterUnCov"></span><span class="lineUnCov">        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,</span></div>
<div class="line"><span id="101" class="lineNum"><a href="#101">101</a></span><span class="counterUnCov"></span><span class="lineUnCov">        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 100,</span></div>
<div class="line"><span id="102" class="lineNum"><a href="#102">102</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="103" class="lineNum"><a href="#103">103</a></span><span class="counterUnCov"></span><span class="lineUnCov">        1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20,</span></div>
<div class="line"><span id="104" class="lineNum"><a href="#104">104</a></span><span class="counterUnCov"></span><span class="lineUnCov">        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,</span></div>
<div class="line"><span id="105" class="lineNum"><a href="#105">105</a></span><span class="counterUnCov"></span><span class="lineUnCov">        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,</span></div>
<div class="line"><span id="106" class="lineNum"><a href="#106">106</a></span><span class="counterUnCov"></span><span class="lineUnCov">        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,</span></div>
<div class="line"><span id="107" class="lineNum"><a href="#107">107</a></span><span class="counterUnCov"></span><span class="lineUnCov">        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 100,</span></div>
<div class="line"><span id="108" class="lineNum"><a href="#108">108</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="109" class="lineNum"><a href="#109">109</a></span><span class="counterUnCov"></span><span class="lineUnCov">        1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20,</span></div>
<div class="line"><span id="110" class="lineNum"><a href="#110">110</a></span><span class="counterUnCov"></span><span class="lineUnCov">        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,</span></div>
<div class="line"><span id="111" class="lineNum"><a href="#111">111</a></span><span class="counterUnCov"></span><span class="lineUnCov">        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,</span></div>
<div class="line"><span id="112" class="lineNum"><a href="#112">112</a></span><span class="counterUnCov"></span><span class="lineUnCov">        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,</span></div>
<div class="line"><span id="113" class="lineNum"><a href="#113">113</a></span><span class="counterUnCov"></span><span class="lineUnCov">        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 100,</span></div>
<div class="line"><span id="114" class="lineNum"><a href="#114">114</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="115" class="lineNum"><a href="#115">115</a></span><span class="counterUnCov"></span><span class="lineUnCov">        1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20,</span></div>
<div class="line"><span id="116" class="lineNum"><a href="#116">116</a></span><span class="counterUnCov"></span><span class="lineUnCov">        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,</span></div>
<div class="line"><span id="117" class="lineNum"><a href="#117">117</a></span><span class="counterUnCov"></span><span class="lineUnCov">        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,</span></div>
<div class="line"><span id="118" class="lineNum"><a href="#118">118</a></span><span class="counterUnCov"></span><span class="lineUnCov">        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,</span></div>
<div class="line"><span id="119" class="lineNum"><a href="#119">119</a></span><span class="counterUnCov"></span><span class="lineUnCov">        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 100,</span></div>
<div class="line"><span id="120" class="lineNum"><a href="#120">120</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="121" class="lineNum"><a href="#121">121</a></span><span class="counterUnCov"></span><span class="lineUnCov">        1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20,</span></div>
<div class="line"><span id="122" class="lineNum"><a href="#122">122</a></span><span class="counterUnCov"></span><span class="lineUnCov">        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,</span></div>
<div class="line"><span id="123" class="lineNum"><a href="#123">123</a></span><span class="counterUnCov"></span><span class="lineUnCov">        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,</span></div>
<div class="line"><span id="124" class="lineNum"><a href="#124">124</a></span><span class="counterUnCov"></span><span class="lineUnCov">        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,</span></div>
<div class="line"><span id="125" class="lineNum"><a href="#125">125</a></span><span class="counterUnCov"></span><span class="lineUnCov">        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 100,</span></div>
<div class="line"><span id="126" class="lineNum"><a href="#126">126</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="127" class="lineNum"><a href="#127">127</a></span><span class="counterUnCov"></span><span class="lineUnCov">        1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12</span></div>
<div class="line"><span id="128" class="lineNum"><a href="#128">128</a></span><span class="counterUnCov"></span><span class="lineUnCov">    ];</span></div>
<div class="line"><span id="129" class="lineNum"><a href="#129">129</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="130" class="lineNum"><a href="#130">130</a></span><span class="counterUnCov"></span><span class="lineUnCov">pub const TEST_DATA_MULTIPLE_ALTERNATIVE_STARTCODE_UNIVERSE: [u8; 714] = [1,</span></div>
<div class="line"><span id="131" class="lineNum"><a href="#131">131</a></span><span class="counterUnCov"></span><span class="lineUnCov">        1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20,</span></div>
<div class="line"><span id="132" class="lineNum"><a href="#132">132</a></span><span class="counterUnCov"></span><span class="lineUnCov">        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,</span></div>
<div class="line"><span id="133" class="lineNum"><a href="#133">133</a></span><span class="counterUnCov"></span><span class="lineUnCov">        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,</span></div>
<div class="line"><span id="134" class="lineNum"><a href="#134">134</a></span><span class="counterUnCov"></span><span class="lineUnCov">        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,</span></div>
<div class="line"><span id="135" class="lineNum"><a href="#135">135</a></span><span class="counterUnCov"></span><span class="lineUnCov">        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 100,</span></div>
<div class="line"><span id="136" class="lineNum"><a href="#136">136</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="137" class="lineNum"><a href="#137">137</a></span><span class="counterUnCov"></span><span class="lineUnCov">        1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20,</span></div>
<div class="line"><span id="138" class="lineNum"><a href="#138">138</a></span><span class="counterUnCov"></span><span class="lineUnCov">        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,</span></div>
<div class="line"><span id="139" class="lineNum"><a href="#139">139</a></span><span class="counterUnCov"></span><span class="lineUnCov">        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,</span></div>
<div class="line"><span id="140" class="lineNum"><a href="#140">140</a></span><span class="counterUnCov"></span><span class="lineUnCov">        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,</span></div>
<div class="line"><span id="141" class="lineNum"><a href="#141">141</a></span><span class="counterUnCov"></span><span class="lineUnCov">        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 100,</span></div>
<div class="line"><span id="142" class="lineNum"><a href="#142">142</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="143" class="lineNum"><a href="#143">143</a></span><span class="counterUnCov"></span><span class="lineUnCov">        1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20,</span></div>
<div class="line"><span id="144" class="lineNum"><a href="#144">144</a></span><span class="counterUnCov"></span><span class="lineUnCov">        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,</span></div>
<div class="line"><span id="145" class="lineNum"><a href="#145">145</a></span><span class="counterUnCov"></span><span class="lineUnCov">        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,</span></div>
<div class="line"><span id="146" class="lineNum"><a href="#146">146</a></span><span class="counterUnCov"></span><span class="lineUnCov">        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,</span></div>
<div class="line"><span id="147" class="lineNum"><a href="#147">147</a></span><span class="counterUnCov"></span><span class="lineUnCov">        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 100,</span></div>
<div class="line"><span id="148" class="lineNum"><a href="#148">148</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="149" class="lineNum"><a href="#149">149</a></span><span class="counterUnCov"></span><span class="lineUnCov">        1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20,</span></div>
<div class="line"><span id="150" class="lineNum"><a href="#150">150</a></span><span class="counterUnCov"></span><span class="lineUnCov">        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,</span></div>
<div class="line"><span id="151" class="lineNum"><a href="#151">151</a></span><span class="counterUnCov"></span><span class="lineUnCov">        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,</span></div>
<div class="line"><span id="152" class="lineNum"><a href="#152">152</a></span><span class="counterUnCov"></span><span class="lineUnCov">        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,</span></div>
<div class="line"><span id="153" class="lineNum"><a href="#153">153</a></span><span class="counterUnCov"></span><span class="lineUnCov">        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 100,</span></div>
<div class="line"><span id="154" class="lineNum"><a href="#154">154</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="155" class="lineNum"><a href="#155">155</a></span><span class="counterUnCov"></span><span class="lineUnCov">        1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20,</span></div>
<div class="line"><span id="156" class="lineNum"><a href="#156">156</a></span><span class="counterUnCov"></span><span class="lineUnCov">        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,</span></div>
<div class="line"><span id="157" class="lineNum"><a href="#157">157</a></span><span class="counterUnCov"></span><span class="lineUnCov">        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,</span></div>
<div class="line"><span id="158" class="lineNum"><a href="#158">158</a></span><span class="counterUnCov"></span><span class="lineUnCov">        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,</span></div>
<div class="line"><span id="159" class="lineNum"><a href="#159">159</a></span><span class="counterUnCov"></span><span class="lineUnCov">        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 100,</span></div>
<div class="line"><span id="160" class="lineNum"><a href="#160">160</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="161" class="lineNum"><a href="#161">161</a></span><span class="counterUnCov"></span><span class="lineUnCov">        1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12,</span></div>
<div class="line"><span id="162" class="lineNum"><a href="#162">162</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="163" class="lineNum"><a href="#163">163</a></span><span class="counterUnCov"></span><span class="lineUnCov">        3,</span></div>
<div class="line"><span id="164" class="lineNum"><a href="#164">164</a></span><span class="counterUnCov"></span><span class="lineUnCov">        1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20,</span></div>
<div class="line"><span id="165" class="lineNum"><a href="#165">165</a></span><span class="counterUnCov"></span><span class="lineUnCov">        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,</span></div>
<div class="line"><span id="166" class="lineNum"><a href="#166">166</a></span><span class="counterUnCov"></span><span class="lineUnCov">        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,</span></div>
<div class="line"><span id="167" class="lineNum"><a href="#167">167</a></span><span class="counterUnCov"></span><span class="lineUnCov">        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,</span></div>
<div class="line"><span id="168" class="lineNum"><a href="#168">168</a></span><span class="counterUnCov"></span><span class="lineUnCov">        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 100,</span></div>
<div class="line"><span id="169" class="lineNum"><a href="#169">169</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="170" class="lineNum"><a href="#170">170</a></span><span class="counterUnCov"></span><span class="lineUnCov">        1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20,</span></div>
<div class="line"><span id="171" class="lineNum"><a href="#171">171</a></span><span class="counterUnCov"></span><span class="lineUnCov">        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,</span></div>
<div class="line"><span id="172" class="lineNum"><a href="#172">172</a></span><span class="counterUnCov"></span><span class="lineUnCov">        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,</span></div>
<div class="line"><span id="173" class="lineNum"><a href="#173">173</a></span><span class="counterUnCov"></span><span class="lineUnCov">        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,</span></div>
<div class="line"><span id="174" class="lineNum"><a href="#174">174</a></span><span class="counterUnCov"></span><span class="lineUnCov">        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 100,</span></div>
<div class="line"><span id="175" class="lineNum"><a href="#175">175</a></span><span class="counterUnCov"></span><span class="lineUnCov">    ];</span></div>
<div class="line"><span id="176" class="lineNum"><a href="#176">176</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="177" class="lineNum"><a href="#177">177</a></span><span class="counterUnCov"></span><span class="lineUnCov">pub const TEST_DATA_MULTIPLE_UNIVERSE: [u8; 714] = [0,</span></div>
<div class="line"><span id="178" class="lineNum"><a href="#178">178</a></span><span class="counterUnCov"></span><span class="lineUnCov">        1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20,</span></div>
<div class="line"><span id="179" class="lineNum"><a href="#179">179</a></span><span class="counterUnCov"></span><span class="lineUnCov">        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,</span></div>
<div class="line"><span id="180" class="lineNum"><a href="#180">180</a></span><span class="counterUnCov"></span><span class="lineUnCov">        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,</span></div>
<div class="line"><span id="181" class="lineNum"><a href="#181">181</a></span><span class="counterUnCov"></span><span class="lineUnCov">        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,</span></div>
<div class="line"><span id="182" class="lineNum"><a href="#182">182</a></span><span class="counterUnCov"></span><span class="lineUnCov">        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 100,</span></div>
<div class="line"><span id="183" class="lineNum"><a href="#183">183</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="184" class="lineNum"><a href="#184">184</a></span><span class="counterUnCov"></span><span class="lineUnCov">        1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20,</span></div>
<div class="line"><span id="185" class="lineNum"><a href="#185">185</a></span><span class="counterUnCov"></span><span class="lineUnCov">        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,</span></div>
<div class="line"><span id="186" class="lineNum"><a href="#186">186</a></span><span class="counterUnCov"></span><span class="lineUnCov">        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,</span></div>
<div class="line"><span id="187" class="lineNum"><a href="#187">187</a></span><span class="counterUnCov"></span><span class="lineUnCov">        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,</span></div>
<div class="line"><span id="188" class="lineNum"><a href="#188">188</a></span><span class="counterUnCov"></span><span class="lineUnCov">        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 100,</span></div>
<div class="line"><span id="189" class="lineNum"><a href="#189">189</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="190" class="lineNum"><a href="#190">190</a></span><span class="counterUnCov"></span><span class="lineUnCov">        1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20,</span></div>
<div class="line"><span id="191" class="lineNum"><a href="#191">191</a></span><span class="counterUnCov"></span><span class="lineUnCov">        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,</span></div>
<div class="line"><span id="192" class="lineNum"><a href="#192">192</a></span><span class="counterUnCov"></span><span class="lineUnCov">        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,</span></div>
<div class="line"><span id="193" class="lineNum"><a href="#193">193</a></span><span class="counterUnCov"></span><span class="lineUnCov">        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,</span></div>
<div class="line"><span id="194" class="lineNum"><a href="#194">194</a></span><span class="counterUnCov"></span><span class="lineUnCov">        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 100,</span></div>
<div class="line"><span id="195" class="lineNum"><a href="#195">195</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="196" class="lineNum"><a href="#196">196</a></span><span class="counterUnCov"></span><span class="lineUnCov">        1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20,</span></div>
<div class="line"><span id="197" class="lineNum"><a href="#197">197</a></span><span class="counterUnCov"></span><span class="lineUnCov">        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,</span></div>
<div class="line"><span id="198" class="lineNum"><a href="#198">198</a></span><span class="counterUnCov"></span><span class="lineUnCov">        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,</span></div>
<div class="line"><span id="199" class="lineNum"><a href="#199">199</a></span><span class="counterUnCov"></span><span class="lineUnCov">        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,</span></div>
<div class="line"><span id="200" class="lineNum"><a href="#200">200</a></span><span class="counterUnCov"></span><span class="lineUnCov">        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 100,</span></div>
<div class="line"><span id="201" class="lineNum"><a href="#201">201</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="202" class="lineNum"><a href="#202">202</a></span><span class="counterUnCov"></span><span class="lineUnCov">        1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20,</span></div>
<div class="line"><span id="203" class="lineNum"><a href="#203">203</a></span><span class="counterUnCov"></span><span class="lineUnCov">        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,</span></div>
<div class="line"><span id="204" class="lineNum"><a href="#204">204</a></span><span class="counterUnCov"></span><span class="lineUnCov">        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,</span></div>
<div class="line"><span id="205" class="lineNum"><a href="#205">205</a></span><span class="counterUnCov"></span><span class="lineUnCov">        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,</span></div>
<div class="line"><span id="206" class="lineNum"><a href="#206">206</a></span><span class="counterUnCov"></span><span class="lineUnCov">        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 100,</span></div>
<div class="line"><span id="207" class="lineNum"><a href="#207">207</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="208" class="lineNum"><a href="#208">208</a></span><span class="counterUnCov"></span><span class="lineUnCov">        1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12,</span></div>
<div class="line"><span id="209" class="lineNum"><a href="#209">209</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="210" class="lineNum"><a href="#210">210</a></span><span class="counterUnCov"></span><span class="lineUnCov">        0,</span></div>
<div class="line"><span id="211" class="lineNum"><a href="#211">211</a></span><span class="counterUnCov"></span><span class="lineUnCov">        1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20,</span></div>
<div class="line"><span id="212" class="lineNum"><a href="#212">212</a></span><span class="counterUnCov"></span><span class="lineUnCov">        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,</span></div>
<div class="line"><span id="213" class="lineNum"><a href="#213">213</a></span><span class="counterUnCov"></span><span class="lineUnCov">        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,</span></div>
<div class="line"><span id="214" class="lineNum"><a href="#214">214</a></span><span class="counterUnCov"></span><span class="lineUnCov">        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,</span></div>
<div class="line"><span id="215" class="lineNum"><a href="#215">215</a></span><span class="counterUnCov"></span><span class="lineUnCov">        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 100,</span></div>
<div class="line"><span id="216" class="lineNum"><a href="#216">216</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="217" class="lineNum"><a href="#217">217</a></span><span class="counterUnCov"></span><span class="lineUnCov">        1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20,</span></div>
<div class="line"><span id="218" class="lineNum"><a href="#218">218</a></span><span class="counterUnCov"></span><span class="lineUnCov">        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,</span></div>
<div class="line"><span id="219" class="lineNum"><a href="#219">219</a></span><span class="counterUnCov"></span><span class="lineUnCov">        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,</span></div>
<div class="line"><span id="220" class="lineNum"><a href="#220">220</a></span><span class="counterUnCov"></span><span class="lineUnCov">        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,</span></div>
<div class="line"><span id="221" class="lineNum"><a href="#221">221</a></span><span class="counterUnCov"></span><span class="lineUnCov">        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 100,</span></div>
<div class="line"><span id="222" class="lineNum"><a href="#222">222</a></span><span class="counterUnCov"></span><span class="lineUnCov">    ];</span></div>
<div class="line"><span id="223" class="lineNum"><a href="#223">223</a></span><span class="counterUnCov"></span><span class="lineUnCov">pub const TEST_DATA_FULL_CAPACITY_MULTIPLE_UNIVERSE: [u8; 1026] = [0,</span></div>
<div class="line"><span id="224" class="lineNum"><a href="#224">224</a></span><span class="counterUnCov"></span><span class="lineUnCov">        1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20,</span></div>
<div class="line"><span id="225" class="lineNum"><a href="#225">225</a></span><span class="counterUnCov"></span><span class="lineUnCov">        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,</span></div>
<div class="line"><span id="226" class="lineNum"><a href="#226">226</a></span><span class="counterUnCov"></span><span class="lineUnCov">        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,</span></div>
<div class="line"><span id="227" class="lineNum"><a href="#227">227</a></span><span class="counterUnCov"></span><span class="lineUnCov">        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,</span></div>
<div class="line"><span id="228" class="lineNum"><a href="#228">228</a></span><span class="counterUnCov"></span><span class="lineUnCov">        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 100,</span></div>
<div class="line"><span id="229" class="lineNum"><a href="#229">229</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="230" class="lineNum"><a href="#230">230</a></span><span class="counterUnCov"></span><span class="lineUnCov">        1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20,</span></div>
<div class="line"><span id="231" class="lineNum"><a href="#231">231</a></span><span class="counterUnCov"></span><span class="lineUnCov">        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,</span></div>
<div class="line"><span id="232" class="lineNum"><a href="#232">232</a></span><span class="counterUnCov"></span><span class="lineUnCov">        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,</span></div>
<div class="line"><span id="233" class="lineNum"><a href="#233">233</a></span><span class="counterUnCov"></span><span class="lineUnCov">        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,</span></div>
<div class="line"><span id="234" class="lineNum"><a href="#234">234</a></span><span class="counterUnCov"></span><span class="lineUnCov">        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 100,</span></div>
<div class="line"><span id="235" class="lineNum"><a href="#235">235</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="236" class="lineNum"><a href="#236">236</a></span><span class="counterUnCov"></span><span class="lineUnCov">        1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20,</span></div>
<div class="line"><span id="237" class="lineNum"><a href="#237">237</a></span><span class="counterUnCov"></span><span class="lineUnCov">        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,</span></div>
<div class="line"><span id="238" class="lineNum"><a href="#238">238</a></span><span class="counterUnCov"></span><span class="lineUnCov">        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,</span></div>
<div class="line"><span id="239" class="lineNum"><a href="#239">239</a></span><span class="counterUnCov"></span><span class="lineUnCov">        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,</span></div>
<div class="line"><span id="240" class="lineNum"><a href="#240">240</a></span><span class="counterUnCov"></span><span class="lineUnCov">        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 100,</span></div>
<div class="line"><span id="241" class="lineNum"><a href="#241">241</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="242" class="lineNum"><a href="#242">242</a></span><span class="counterUnCov"></span><span class="lineUnCov">        1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20,</span></div>
<div class="line"><span id="243" class="lineNum"><a href="#243">243</a></span><span class="counterUnCov"></span><span class="lineUnCov">        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,</span></div>
<div class="line"><span id="244" class="lineNum"><a href="#244">244</a></span><span class="counterUnCov"></span><span class="lineUnCov">        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,</span></div>
<div class="line"><span id="245" class="lineNum"><a href="#245">245</a></span><span class="counterUnCov"></span><span class="lineUnCov">        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,</span></div>
<div class="line"><span id="246" class="lineNum"><a href="#246">246</a></span><span class="counterUnCov"></span><span class="lineUnCov">        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 100,</span></div>
<div class="line"><span id="247" class="lineNum"><a href="#247">247</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="248" class="lineNum"><a href="#248">248</a></span><span class="counterUnCov"></span><span class="lineUnCov">        1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20,</span></div>
<div class="line"><span id="249" class="lineNum"><a href="#249">249</a></span><span class="counterUnCov"></span><span class="lineUnCov">        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,</span></div>
<div class="line"><span id="250" class="lineNum"><a href="#250">250</a></span><span class="counterUnCov"></span><span class="lineUnCov">        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,</span></div>
<div class="line"><span id="251" class="lineNum"><a href="#251">251</a></span><span class="counterUnCov"></span><span class="lineUnCov">        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,</span></div>
<div class="line"><span id="252" class="lineNum"><a href="#252">252</a></span><span class="counterUnCov"></span><span class="lineUnCov">        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 100,</span></div>
<div class="line"><span id="253" class="lineNum"><a href="#253">253</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="254" class="lineNum"><a href="#254">254</a></span><span class="counterUnCov"></span><span class="lineUnCov">        1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12,</span></div>
<div class="line"><span id="255" class="lineNum"><a href="#255">255</a></span><span class="counterUnCov"></span><span class="lineUnCov">        0,</span></div>
<div class="line"><span id="256" class="lineNum"><a href="#256">256</a></span><span class="counterUnCov"></span><span class="lineUnCov">        1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20,</span></div>
<div class="line"><span id="257" class="lineNum"><a href="#257">257</a></span><span class="counterUnCov"></span><span class="lineUnCov">        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,</span></div>
<div class="line"><span id="258" class="lineNum"><a href="#258">258</a></span><span class="counterUnCov"></span><span class="lineUnCov">        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,</span></div>
<div class="line"><span id="259" class="lineNum"><a href="#259">259</a></span><span class="counterUnCov"></span><span class="lineUnCov">        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,</span></div>
<div class="line"><span id="260" class="lineNum"><a href="#260">260</a></span><span class="counterUnCov"></span><span class="lineUnCov">        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 100,</span></div>
<div class="line"><span id="261" class="lineNum"><a href="#261">261</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="262" class="lineNum"><a href="#262">262</a></span><span class="counterUnCov"></span><span class="lineUnCov">        1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20,</span></div>
<div class="line"><span id="263" class="lineNum"><a href="#263">263</a></span><span class="counterUnCov"></span><span class="lineUnCov">        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,</span></div>
<div class="line"><span id="264" class="lineNum"><a href="#264">264</a></span><span class="counterUnCov"></span><span class="lineUnCov">        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,</span></div>
<div class="line"><span id="265" class="lineNum"><a href="#265">265</a></span><span class="counterUnCov"></span><span class="lineUnCov">        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,</span></div>
<div class="line"><span id="266" class="lineNum"><a href="#266">266</a></span><span class="counterUnCov"></span><span class="lineUnCov">        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 100,</span></div>
<div class="line"><span id="267" class="lineNum"><a href="#267">267</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="268" class="lineNum"><a href="#268">268</a></span><span class="counterUnCov"></span><span class="lineUnCov">        1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20,</span></div>
<div class="line"><span id="269" class="lineNum"><a href="#269">269</a></span><span class="counterUnCov"></span><span class="lineUnCov">        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,</span></div>
<div class="line"><span id="270" class="lineNum"><a href="#270">270</a></span><span class="counterUnCov"></span><span class="lineUnCov">        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,</span></div>
<div class="line"><span id="271" class="lineNum"><a href="#271">271</a></span><span class="counterUnCov"></span><span class="lineUnCov">        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,</span></div>
<div class="line"><span id="272" class="lineNum"><a href="#272">272</a></span><span class="counterUnCov"></span><span class="lineUnCov">        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 100,</span></div>
<div class="line"><span id="273" class="lineNum"><a href="#273">273</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="274" class="lineNum"><a href="#274">274</a></span><span class="counterUnCov"></span><span class="lineUnCov">        1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20,</span></div>
<div class="line"><span id="275" class="lineNum"><a href="#275">275</a></span><span class="counterUnCov"></span><span class="lineUnCov">        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,</span></div>
<div class="line"><span id="276" class="lineNum"><a href="#276">276</a></span><span class="counterUnCov"></span><span class="lineUnCov">        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,</span></div>
<div class="line"><span id="277" class="lineNum"><a href="#277">277</a></span><span class="counterUnCov"></span><span class="lineUnCov">        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,</span></div>
<div class="line"><span id="278" class="lineNum"><a href="#278">278</a></span><span class="counterUnCov"></span><span class="lineUnCov">        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 100,</span></div>
<div class="line"><span id="279" class="lineNum"><a href="#279">279</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="280" class="lineNum"><a href="#280">280</a></span><span class="counterUnCov"></span><span class="lineUnCov">        1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20,</span></div>
<div class="line"><span id="281" class="lineNum"><a href="#281">281</a></span><span class="counterUnCov"></span><span class="lineUnCov">        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,</span></div>
<div class="line"><span id="282" class="lineNum"><a href="#282">282</a></span><span class="counterUnCov"></span><span class="lineUnCov">        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,</span></div>
<div class="line"><span id="283" class="lineNum"><a href="#283">283</a></span><span class="counterUnCov"></span><span class="lineUnCov">        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,</span></div>
<div class="line"><span id="284" class="lineNum"><a href="#284">284</a></span><span class="counterUnCov"></span><span class="lineUnCov">        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 100,</span></div>
<div class="line"><span id="285" class="lineNum"><a href="#285">285</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="286" class="lineNum"><a href="#286">286</a></span><span class="counterUnCov"></span><span class="lineUnCov">        1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12</span></div>
<div class="line"><span id="287" class="lineNum"><a href="#287">287</a></span><span class="counterUnCov"></span><span class="lineUnCov">    ];</span></div>
<div class="line"><span id="288" class="lineNum"><a href="#288">288</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="289" class="lineNum"><a href="#289">289</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="290" class="lineNum"><a href="#290">290</a></span><span class="counterUnCov"></span><span class="lineUnCov">// Note: For this test to work the PC must be capable of connecting to the network on 2 IP&#39;s, this was done in windows by adding another static IP so the PC was connecting through</span></div>
<div class="line"><span id="291" class="lineNum"><a href="#291">291</a></span><span class="counterUnCov"></span><span class="lineUnCov">// 2 different IP&#39;s to the network. Theses IPs are manually specified in the TEST_NETWORK_INTERFACE_IPV4 constant and so to run it must be changed</span></div>
<div class="line"><span id="292" class="lineNum"><a href="#292">292</a></span><span class="counterUnCov"></span><span class="lineUnCov">// depending on the environment.</span></div>
<div class="line"><span id="293" class="lineNum"><a href="#293">293</a></span><span class="counterUnCov"></span><span class="lineUnCov">#[test]</span></div>
<div class="line"><span id="294" class="lineNum"><a href="#294">294</a></span><span class="counterCov">4</span><span class="lineCov">fn test_send_single_universe_multiple_receivers_multicast_ipv4(){</span></div>
<div class="line"><span id="295" class="lineNum"><a href="#295">295</a></span><span class="counterCov">2</span><span class="lineCov">    let (tx, rx): (Sender&lt;Result&lt;Vec&lt;DMXData&gt;&gt;&gt;, Receiver&lt;Result&lt;Vec&lt;DMXData&gt;&gt;&gt;) = mpsc::channel();</span></div>
<div class="line"><span id="296" class="lineNum"><a href="#296">296</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="297" class="lineNum"><a href="#297">297</a></span><span class="counterCov">2</span><span class="lineCov">    let thread1_tx = tx.clone();</span></div>
<div class="line"><span id="298" class="lineNum"><a href="#298">298</a></span><span class="counterCov">2</span><span class="lineCov">    let thread2_tx = tx.clone();</span></div>
<div class="line"><span id="299" class="lineNum"><a href="#299">299</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="300" class="lineNum"><a href="#300">300</a></span><span class="counterCov">2</span><span class="lineCov">    let universe = 1;</span></div>
<div class="line"><span id="301" class="lineNum"><a href="#301">301</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="302" class="lineNum"><a href="#302">302</a></span><span class="counterCov">4</span><span class="lineCov">    let rcv_thread1 = thread::spawn(move || {</span></div>
<div class="line"><span id="303" class="lineNum"><a href="#303">303</a></span><span class="counterCov">2</span><span class="lineCov">        let mut dmx_recv = SacnReceiver::with_ip(SocketAddr::new(IpAddr::V4(TEST_NETWORK_INTERFACE_IPV4[0].parse().unwrap()), ACN_SDT_MULTICAST_PORT), None).unwrap();</span></div>
<div class="line"><span id="304" class="lineNum"><a href="#304">304</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="305" class="lineNum"><a href="#305">305</a></span><span class="counterCov">2</span><span class="lineCov">        dmx_recv.listen_universes(&amp;[universe]).unwrap();</span></div>
<div class="line"><span id="306" class="lineNum"><a href="#306">306</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="307" class="lineNum"><a href="#307">307</a></span><span class="counterCov">2</span><span class="lineCov">        thread1_tx.send(Ok(Vec::new())).unwrap();</span></div>
<div class="line"><span id="308" class="lineNum"><a href="#308">308</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="309" class="lineNum"><a href="#309">309</a></span><span class="counterCov">2</span><span class="lineCov">        thread1_tx.send(dmx_recv.recv(None)).unwrap();</span></div>
<div class="line"><span id="310" class="lineNum"><a href="#310">310</a></span><span class="counterCov">2</span><span class="lineCov">    });</span></div>
<div class="line"><span id="311" class="lineNum"><a href="#311">311</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="312" class="lineNum"><a href="#312">312</a></span><span class="counterCov">4</span><span class="lineCov">    let rcv_thread2 = thread::spawn(move || {</span></div>
<div class="line"><span id="313" class="lineNum"><a href="#313">313</a></span><span class="counterCov">2</span><span class="lineCov">        let mut dmx_recv = SacnReceiver::with_ip(SocketAddr::new(IpAddr::V4(TEST_NETWORK_INTERFACE_IPV4[1].parse().unwrap()), ACN_SDT_MULTICAST_PORT), None).unwrap();</span></div>
<div class="line"><span id="314" class="lineNum"><a href="#314">314</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="315" class="lineNum"><a href="#315">315</a></span><span class="counterCov">2</span><span class="lineCov">        dmx_recv.listen_universes(&amp;[universe]).unwrap();</span></div>
<div class="line"><span id="316" class="lineNum"><a href="#316">316</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="317" class="lineNum"><a href="#317">317</a></span><span class="counterCov">2</span><span class="lineCov">        thread2_tx.send(Ok(Vec::new())).unwrap();</span></div>
<div class="line"><span id="318" class="lineNum"><a href="#318">318</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="319" class="lineNum"><a href="#319">319</a></span><span class="counterCov">2</span><span class="lineCov">        thread2_tx.send(dmx_recv.recv(None)).unwrap();</span></div>
<div class="line"><span id="320" class="lineNum"><a href="#320">320</a></span><span class="counterCov">2</span><span class="lineCov">    });</span></div>
<div class="line"><span id="321" class="lineNum"><a href="#321">321</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="322" class="lineNum"><a href="#322">322</a></span><span class="counterCov">2</span><span class="lineCov">    rx.recv().unwrap().unwrap(); // Blocks until both receivers say they are ready.</span></div>
<div class="line"><span id="323" class="lineNum"><a href="#323">323</a></span><span class="counterCov">2</span><span class="lineCov">    rx.recv().unwrap().unwrap();</span></div>
<div class="line"><span id="324" class="lineNum"><a href="#324">324</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="325" class="lineNum"><a href="#325">325</a></span><span class="counterCov">2</span><span class="lineCov">    let ip: SocketAddr = SocketAddr::new(IpAddr::V4(TEST_NETWORK_INTERFACE_IPV4[0].parse().unwrap()), ACN_SDT_MULTICAST_PORT + 1);</span></div>
<div class="line"><span id="326" class="lineNum"><a href="#326">326</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="327" class="lineNum"><a href="#327">327</a></span><span class="counterCov">2</span><span class="lineCov">    let mut src = SacnSource::with_ip(&quot;Source&quot;, ip).unwrap();</span></div>
<div class="line"><span id="328" class="lineNum"><a href="#328">328</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="329" class="lineNum"><a href="#329">329</a></span><span class="counterCov">2</span><span class="lineCov">    let priority = 100;</span></div>
<div class="line"><span id="330" class="lineNum"><a href="#330">330</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="331" class="lineNum"><a href="#331">331</a></span><span class="counterCov">2</span><span class="lineCov">    src.register_universe(universe).unwrap();</span></div>
<div class="line"><span id="332" class="lineNum"><a href="#332">332</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="333" class="lineNum"><a href="#333">333</a></span><span class="counterCov">2</span><span class="lineCov">    src.send(&amp;[universe], &amp;TEST_DATA_SINGLE_UNIVERSE, Some(priority), None, None).unwrap();</span></div>
<div class="line"><span id="334" class="lineNum"><a href="#334">334</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="335" class="lineNum"><a href="#335">335</a></span><span class="counterCov">2</span><span class="lineCov">    let received_result1: Result&lt;Vec&lt;DMXData&gt;&gt; = rx.recv().unwrap();</span></div>
<div class="line"><span id="336" class="lineNum"><a href="#336">336</a></span><span class="counterCov">2</span><span class="lineCov">    let received_result2: Result&lt;Vec&lt;DMXData&gt;&gt; = rx.recv().unwrap();</span></div>
<div class="line"><span id="337" class="lineNum"><a href="#337">337</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="338" class="lineNum"><a href="#338">338</a></span><span class="counterCov">2</span><span class="lineCov">    rcv_thread1.join().unwrap();</span></div>
<div class="line"><span id="339" class="lineNum"><a href="#339">339</a></span><span class="counterCov">2</span><span class="lineCov">    rcv_thread2.join().unwrap();</span></div>
<div class="line"><span id="340" class="lineNum"><a href="#340">340</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="341" class="lineNum"><a href="#341">341</a></span><span class="counterCov">2</span><span class="lineCov">    assert!(!received_result1.is_err(), &quot;Failed: Error when receiving data&quot;);</span></div>
<div class="line"><span id="342" class="lineNum"><a href="#342">342</a></span><span class="counterCov">2</span><span class="lineCov">    let received_data1: Vec&lt;DMXData&gt; = received_result1.unwrap();</span></div>
<div class="line"><span id="343" class="lineNum"><a href="#343">343</a></span><span class="counterCov">2</span><span class="lineCov">    assert_eq!(received_data1.len(), 1); // Check only 1 universe received as expected.</span></div>
<div class="line"><span id="344" class="lineNum"><a href="#344">344</a></span><span class="counterCov">2</span><span class="lineCov">    let received_universe1: DMXData = received_data1[0].clone();</span></div>
<div class="line"><span id="345" class="lineNum"><a href="#345">345</a></span><span class="counterCov">2</span><span class="lineCov">    assert_eq!(received_universe1.universe, universe); // Check that the universe received is as expected.</span></div>
<div class="line"><span id="346" class="lineNum"><a href="#346">346</a></span><span class="counterCov">2</span><span class="lineCov">    assert_eq!(received_universe1.values, TEST_DATA_SINGLE_UNIVERSE.to_vec(), &quot;Received payload values don&#39;t match sent!&quot;);</span></div>
<div class="line"><span id="347" class="lineNum"><a href="#347">347</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="348" class="lineNum"><a href="#348">348</a></span><span class="counterCov">2</span><span class="lineCov">    assert!(!received_result2.is_err(), &quot;Failed: Error when receiving data&quot;);</span></div>
<div class="line"><span id="349" class="lineNum"><a href="#349">349</a></span><span class="counterCov">2</span><span class="lineCov">    let received_data2: Vec&lt;DMXData&gt; = received_result2.unwrap();</span></div>
<div class="line"><span id="350" class="lineNum"><a href="#350">350</a></span><span class="counterCov">2</span><span class="lineCov">    assert_eq!(received_data2.len(), 1); // Check only 1 universe received as expected.</span></div>
<div class="line"><span id="351" class="lineNum"><a href="#351">351</a></span><span class="counterCov">2</span><span class="lineCov">    let received_universe2: DMXData = received_data2[0].clone();</span></div>
<div class="line"><span id="352" class="lineNum"><a href="#352">352</a></span><span class="counterCov">2</span><span class="lineCov">    assert_eq!(received_universe2.universe, universe); // Check that the universe received is as expected.</span></div>
<div class="line"><span id="353" class="lineNum"><a href="#353">353</a></span><span class="counterCov">2</span><span class="lineCov">    assert_eq!(received_universe2.values, TEST_DATA_SINGLE_UNIVERSE.to_vec(), &quot;Received payload values don&#39;t match sent!&quot;);</span></div>
<div class="line"><span id="354" class="lineNum"><a href="#354">354</a></span><span class="counterCov">4</span><span class="lineCov">}</span></div>
<div class="line"><span id="355" class="lineNum"><a href="#355">355</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="356" class="lineNum"><a href="#356">356</a></span><span class="counterUnCov"></span><span class="lineUnCov">#[test]</span></div>
<div class="line"><span id="357" class="lineNum"><a href="#357">357</a></span><span class="counterCov">4</span><span class="lineCov">fn test_send_across_universe_multiple_receivers_sync_multicast_ipv4(){</span></div>
<div class="line"><span id="358" class="lineNum"><a href="#358">358</a></span><span class="counterCov">2</span><span class="lineCov">    let (tx, rx): (Sender&lt;Result&lt;Vec&lt;DMXData&gt;&gt;&gt;, Receiver&lt;Result&lt;Vec&lt;DMXData&gt;&gt;&gt;) = mpsc::channel();</span></div>
<div class="line"><span id="359" class="lineNum"><a href="#359">359</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="360" class="lineNum"><a href="#360">360</a></span><span class="counterCov">2</span><span class="lineCov">    let thread1_tx = tx.clone();</span></div>
<div class="line"><span id="361" class="lineNum"><a href="#361">361</a></span><span class="counterCov">2</span><span class="lineCov">    let thread2_tx = tx.clone();</span></div>
<div class="line"><span id="362" class="lineNum"><a href="#362">362</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="363" class="lineNum"><a href="#363">363</a></span><span class="counterCov">2</span><span class="lineCov">    let universe1 = 1;</span></div>
<div class="line"><span id="364" class="lineNum"><a href="#364">364</a></span><span class="counterCov">2</span><span class="lineCov">    let universe2 = 2;</span></div>
<div class="line"><span id="365" class="lineNum"><a href="#365">365</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="366" class="lineNum"><a href="#366">366</a></span><span class="counterCov">2</span><span class="lineCov">    let sync_uni = 3;</span></div>
<div class="line"><span id="367" class="lineNum"><a href="#367">367</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="368" class="lineNum"><a href="#368">368</a></span><span class="counterCov">4</span><span class="lineCov">    let rcv_thread1 = thread::spawn(move || {</span></div>
<div class="line"><span id="369" class="lineNum"><a href="#369">369</a></span><span class="counterCov">2</span><span class="lineCov">        let mut dmx_recv = SacnReceiver::with_ip(SocketAddr::new(IpAddr::V4(TEST_NETWORK_INTERFACE_IPV4[0].parse().unwrap()), ACN_SDT_MULTICAST_PORT), None).unwrap();</span></div>
<div class="line"><span id="370" class="lineNum"><a href="#370">370</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="371" class="lineNum"><a href="#371">371</a></span><span class="counterCov">2</span><span class="lineCov">        dmx_recv.listen_universes(&amp;[universe1]).unwrap();</span></div>
<div class="line"><span id="372" class="lineNum"><a href="#372">372</a></span><span class="counterCov">2</span><span class="lineCov">        dmx_recv.listen_universes(&amp;[sync_uni]).unwrap();</span></div>
<div class="line"><span id="373" class="lineNum"><a href="#373">373</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="374" class="lineNum"><a href="#374">374</a></span><span class="counterCov">2</span><span class="lineCov">        thread1_tx.send(Ok(Vec::new())).unwrap();</span></div>
<div class="line"><span id="375" class="lineNum"><a href="#375">375</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="376" class="lineNum"><a href="#376">376</a></span><span class="counterCov">2</span><span class="lineCov">        thread1_tx.send(dmx_recv.recv(None)).unwrap();</span></div>
<div class="line"><span id="377" class="lineNum"><a href="#377">377</a></span><span class="counterCov">2</span><span class="lineCov">    });</span></div>
<div class="line"><span id="378" class="lineNum"><a href="#378">378</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="379" class="lineNum"><a href="#379">379</a></span><span class="counterCov">4</span><span class="lineCov">    let rcv_thread2 = thread::spawn(move || {</span></div>
<div class="line"><span id="380" class="lineNum"><a href="#380">380</a></span><span class="counterCov">2</span><span class="lineCov">        let mut dmx_recv = SacnReceiver::with_ip(SocketAddr::new(IpAddr::V4(TEST_NETWORK_INTERFACE_IPV4[1].parse().unwrap()), ACN_SDT_MULTICAST_PORT), None).unwrap();</span></div>
<div class="line"><span id="381" class="lineNum"><a href="#381">381</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="382" class="lineNum"><a href="#382">382</a></span><span class="counterCov">2</span><span class="lineCov">        dmx_recv.listen_universes(&amp;[universe2]).unwrap();</span></div>
<div class="line"><span id="383" class="lineNum"><a href="#383">383</a></span><span class="counterCov">2</span><span class="lineCov">        dmx_recv.listen_universes(&amp;[sync_uni]).unwrap();</span></div>
<div class="line"><span id="384" class="lineNum"><a href="#384">384</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="385" class="lineNum"><a href="#385">385</a></span><span class="counterCov">2</span><span class="lineCov">        thread2_tx.send(Ok(Vec::new())).unwrap();</span></div>
<div class="line"><span id="386" class="lineNum"><a href="#386">386</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="387" class="lineNum"><a href="#387">387</a></span><span class="counterCov">2</span><span class="lineCov">        thread2_tx.send(dmx_recv.recv(None)).unwrap();</span></div>
<div class="line"><span id="388" class="lineNum"><a href="#388">388</a></span><span class="counterCov">2</span><span class="lineCov">    });</span></div>
<div class="line"><span id="389" class="lineNum"><a href="#389">389</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="390" class="lineNum"><a href="#390">390</a></span><span class="counterCov">2</span><span class="lineCov">    rx.recv().unwrap().unwrap(); // Blocks until both receivers say they are ready.</span></div>
<div class="line"><span id="391" class="lineNum"><a href="#391">391</a></span><span class="counterCov">2</span><span class="lineCov">    rx.recv().unwrap().unwrap();</span></div>
<div class="line"><span id="392" class="lineNum"><a href="#392">392</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="393" class="lineNum"><a href="#393">393</a></span><span class="counterCov">2</span><span class="lineCov">    let ip: SocketAddr = SocketAddr::new(IpAddr::V4(TEST_NETWORK_INTERFACE_IPV4[0].parse().unwrap()), ACN_SDT_MULTICAST_PORT + 1);</span></div>
<div class="line"><span id="394" class="lineNum"><a href="#394">394</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="395" class="lineNum"><a href="#395">395</a></span><span class="counterCov">2</span><span class="lineCov">    let mut src = SacnSource::with_ip(&quot;Source&quot;, ip).unwrap();</span></div>
<div class="line"><span id="396" class="lineNum"><a href="#396">396</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="397" class="lineNum"><a href="#397">397</a></span><span class="counterCov">2</span><span class="lineCov">    let priority = 100;</span></div>
<div class="line"><span id="398" class="lineNum"><a href="#398">398</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="399" class="lineNum"><a href="#399">399</a></span><span class="counterCov">2</span><span class="lineCov">    src.register_universe(universe1).unwrap();</span></div>
<div class="line"><span id="400" class="lineNum"><a href="#400">400</a></span><span class="counterCov">2</span><span class="lineCov">    src.register_universe(universe2).unwrap();</span></div>
<div class="line"><span id="401" class="lineNum"><a href="#401">401</a></span><span class="counterCov">2</span><span class="lineCov">    src.register_universe(sync_uni).unwrap();</span></div>
<div class="line"><span id="402" class="lineNum"><a href="#402">402</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="403" class="lineNum"><a href="#403">403</a></span><span class="counterCov">2</span><span class="lineCov">    src.send(&amp;[universe1], &amp;TEST_DATA_MULTIPLE_UNIVERSE[..513], Some(priority), None, Some(sync_uni)).unwrap();</span></div>
<div class="line"><span id="404" class="lineNum"><a href="#404">404</a></span><span class="counterCov">2</span><span class="lineCov">    src.send(&amp;[universe2], &amp;TEST_DATA_MULTIPLE_UNIVERSE[513..], Some(priority), None, Some(sync_uni)).unwrap();</span></div>
<div class="line"><span id="405" class="lineNum"><a href="#405">405</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="406" class="lineNum"><a href="#406">406</a></span><span class="counterUnCov"></span><span class="lineUnCov">    // Waiting to receive, if anything is received it indicates one of the receivers progressed without waiting for synchronisation.</span></div>
<div class="line"><span id="407" class="lineNum"><a href="#407">407</a></span><span class="counterUnCov"></span><span class="lineUnCov">    // This has the issue that is is possible that even though they could have progressed the receive threads may not have leading them to pass this part </span></div>
<div class="line"><span id="408" class="lineNum"><a href="#408">408</a></span><span class="counterUnCov"></span><span class="lineUnCov">    // when they shouldn&#39;t. This is difficult to avoid using this method of testing. It is also possible for the delay on the network to be so high that it </span></div>
<div class="line"><span id="409" class="lineNum"><a href="#409">409</a></span><span class="counterUnCov"></span><span class="lineUnCov">    // causes the timeout, this is also difficult to avoid. Both of these reasons should be considered if this test passes occasionally but not consistently. </span></div>
<div class="line"><span id="410" class="lineNum"><a href="#410">410</a></span><span class="counterUnCov"></span><span class="lineUnCov">    // The timeout should be large enough to make this unlikely although must be lower than the protocol&#39;s in-built timeout.</span></div>
<div class="line"><span id="411" class="lineNum"><a href="#411">411</a></span><span class="counterUnCov"></span><span class="lineUnCov">    const WAIT_RECV_TIMEOUT: u64 = 2;</span></div>
<div class="line"><span id="412" class="lineNum"><a href="#412">412</a></span><span class="counterCov">2</span><span class="lineCov">    let attempt_recv = rx.recv_timeout(Duration::from_secs(WAIT_RECV_TIMEOUT));</span></div>
<div class="line"><span id="413" class="lineNum"><a href="#413">413</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="414" class="lineNum"><a href="#414">414</a></span><span class="counterNoCov">0</span><span class="lineNoCov">    match attempt_recv {</span></div>
<div class="line"><span id="415" class="lineNum"><a href="#415">415</a></span><span class="counterCov">2</span><span class="lineCov">        Ok(_) =&gt; {</span></div>
<div class="line"><span id="416" class="lineNum"><a href="#416">416</a></span><span class="counterNoCov">0</span><span class="lineNoCov">            assert!(false, &quot;Receivers received without waiting for sync&quot;);</span></div>
<div class="line"><span id="417" class="lineNum"><a href="#417">417</a></span><span class="counterUnCov"></span><span class="lineUnCov">        },</span></div>
<div class="line"><span id="418" class="lineNum"><a href="#418">418</a></span><span class="counterCov">2</span><span class="lineCov">        Err(e) =&gt; assert_eq!(e, RecvTimeoutError::Timeout)</span></div>
<div class="line"><span id="419" class="lineNum"><a href="#419">419</a></span><span class="counterUnCov"></span><span class="lineUnCov">    }</span></div>
<div class="line"><span id="420" class="lineNum"><a href="#420">420</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="421" class="lineNum"><a href="#421">421</a></span><span class="counterCov">2</span><span class="lineCov">    src.send_sync_packet(sync_uni, None).unwrap();</span></div>
<div class="line"><span id="422" class="lineNum"><a href="#422">422</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="423" class="lineNum"><a href="#423">423</a></span><span class="counterCov">2</span><span class="lineCov">    let received_result1: Vec&lt;DMXData&gt; = rx.recv().unwrap().unwrap();</span></div>
<div class="line"><span id="424" class="lineNum"><a href="#424">424</a></span><span class="counterCov">2</span><span class="lineCov">    let received_result2: Vec&lt;DMXData&gt; = rx.recv().unwrap().unwrap();</span></div>
<div class="line"><span id="425" class="lineNum"><a href="#425">425</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="426" class="lineNum"><a href="#426">426</a></span><span class="counterCov">2</span><span class="lineCov">    rcv_thread1.join().unwrap();</span></div>
<div class="line"><span id="427" class="lineNum"><a href="#427">427</a></span><span class="counterCov">2</span><span class="lineCov">    rcv_thread2.join().unwrap();</span></div>
<div class="line"><span id="428" class="lineNum"><a href="#428">428</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="429" class="lineNum"><a href="#429">429</a></span><span class="counterCov">2</span><span class="lineCov">    assert_eq!(received_result1.len(), 1); // Check only 1 universe received as expected.</span></div>
<div class="line"><span id="430" class="lineNum"><a href="#430">430</a></span><span class="counterCov">2</span><span class="lineCov">    assert_eq!(received_result2.len(), 1); // Check only 1 universe received as expected.</span></div>
<div class="line"><span id="431" class="lineNum"><a href="#431">431</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="432" class="lineNum"><a href="#432">432</a></span><span class="counterCov">2</span><span class="lineCov">    let mut results = vec![received_result1[0].clone(), received_result2[0].clone()];</span></div>
<div class="line"><span id="433" class="lineNum"><a href="#433">433</a></span><span class="counterCov">2</span><span class="lineCov">    results.sort_unstable(); // Ordering of received data is undefined, to make it easier to check sort first.</span></div>
<div class="line"><span id="434" class="lineNum"><a href="#434">434</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="435" class="lineNum"><a href="#435">435</a></span><span class="counterCov">2</span><span class="lineCov">    assert_eq!(results[0].universe, universe1); // Check that the universe 1 received is as expected.</span></div>
<div class="line"><span id="436" class="lineNum"><a href="#436">436</a></span><span class="counterCov">2</span><span class="lineCov">    assert_eq!(results[1].universe, universe2); // Check that the universe 2 received is as expected.</span></div>
<div class="line"><span id="437" class="lineNum"><a href="#437">437</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="438" class="lineNum"><a href="#438">438</a></span><span class="counterCov">2</span><span class="lineCov">    assert_eq!(results[0].values, TEST_DATA_MULTIPLE_UNIVERSE[..513].to_vec());</span></div>
<div class="line"><span id="439" class="lineNum"><a href="#439">439</a></span><span class="counterCov">2</span><span class="lineCov">    assert_eq!(results[1].values, TEST_DATA_MULTIPLE_UNIVERSE[513..].to_vec());</span></div>
<div class="line"><span id="440" class="lineNum"><a href="#440">440</a></span><span class="counterCov">4</span><span class="lineCov">}</span></div>
<div class="line"><span id="441" class="lineNum"><a href="#441">441</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="442" class="lineNum"><a href="#442">442</a></span><span class="counterUnCov"></span><span class="lineUnCov">#[test]</span></div>
<div class="line"><span id="443" class="lineNum"><a href="#443">443</a></span><span class="counterCov">4</span><span class="lineCov">fn test_send_recv_single_universe_unicast_ipv4(){</span></div>
<div class="line"><span id="444" class="lineNum"><a href="#444">444</a></span><span class="counterCov">2</span><span class="lineCov">    let (tx, rx): (Sender&lt;Result&lt;Vec&lt;DMXData&gt;&gt;&gt;, Receiver&lt;Result&lt;Vec&lt;DMXData&gt;&gt;&gt;) = mpsc::channel();</span></div>
<div class="line"><span id="445" class="lineNum"><a href="#445">445</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="446" class="lineNum"><a href="#446">446</a></span><span class="counterCov">2</span><span class="lineCov">    let thread_tx = tx.clone();</span></div>
<div class="line"><span id="447" class="lineNum"><a href="#447">447</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="448" class="lineNum"><a href="#448">448</a></span><span class="counterCov">2</span><span class="lineCov">    let universe = 1;</span></div>
<div class="line"><span id="449" class="lineNum"><a href="#449">449</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="450" class="lineNum"><a href="#450">450</a></span><span class="counterCov">4</span><span class="lineCov">    let rcv_thread = thread::spawn(move || {</span></div>
<div class="line"><span id="451" class="lineNum"><a href="#451">451</a></span><span class="counterCov">2</span><span class="lineCov">        let mut dmx_recv = SacnReceiver::with_ip(SocketAddr::new(Ipv4Addr::LOCALHOST.into(), ACN_SDT_MULTICAST_PORT), None).unwrap();</span></div>
<div class="line"><span id="452" class="lineNum"><a href="#452">452</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="453" class="lineNum"><a href="#453">453</a></span><span class="counterCov">2</span><span class="lineCov">        dmx_recv.listen_universes(&amp;[universe]).unwrap();</span></div>
<div class="line"><span id="454" class="lineNum"><a href="#454">454</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="455" class="lineNum"><a href="#455">455</a></span><span class="counterCov">2</span><span class="lineCov">        thread_tx.send(Ok(Vec::new())).unwrap();</span></div>
<div class="line"><span id="456" class="lineNum"><a href="#456">456</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="457" class="lineNum"><a href="#457">457</a></span><span class="counterCov">2</span><span class="lineCov">        thread_tx.send(dmx_recv.recv(None)).unwrap();</span></div>
<div class="line"><span id="458" class="lineNum"><a href="#458">458</a></span><span class="counterCov">2</span><span class="lineCov">    });</span></div>
<div class="line"><span id="459" class="lineNum"><a href="#459">459</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="460" class="lineNum"><a href="#460">460</a></span><span class="counterCov">2</span><span class="lineCov">    let _ = rx.recv().unwrap(); // Blocks until the receiver says it is ready. </span></div>
<div class="line"><span id="461" class="lineNum"><a href="#461">461</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="462" class="lineNum"><a href="#462">462</a></span><span class="counterCov">2</span><span class="lineCov">    let ip: SocketAddr = SocketAddr::new(Ipv4Addr::LOCALHOST.into(), ACN_SDT_MULTICAST_PORT + 1);</span></div>
<div class="line"><span id="463" class="lineNum"><a href="#463">463</a></span><span class="counterCov">2</span><span class="lineCov">    let mut src = SacnSource::with_ip(&quot;Source&quot;, ip).unwrap();</span></div>
<div class="line"><span id="464" class="lineNum"><a href="#464">464</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="465" class="lineNum"><a href="#465">465</a></span><span class="counterCov">2</span><span class="lineCov">    let priority = 100;</span></div>
<div class="line"><span id="466" class="lineNum"><a href="#466">466</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="467" class="lineNum"><a href="#467">467</a></span><span class="counterCov">2</span><span class="lineCov">    src.register_universe(universe).unwrap();</span></div>
<div class="line"><span id="468" class="lineNum"><a href="#468">468</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="469" class="lineNum"><a href="#469">469</a></span><span class="counterCov">2</span><span class="lineCov">    let dst_ip: SocketAddr = SocketAddr::new(Ipv4Addr::LOCALHOST.into(), ACN_SDT_MULTICAST_PORT);</span></div>
<div class="line"><span id="470" class="lineNum"><a href="#470">470</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="471" class="lineNum"><a href="#471">471</a></span><span class="counterCov">2</span><span class="lineCov">    let _ = src.send(&amp;[universe], &amp;TEST_DATA_SINGLE_UNIVERSE, Some(priority), Some(dst_ip), None).unwrap();</span></div>
<div class="line"><span id="472" class="lineNum"><a href="#472">472</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="473" class="lineNum"><a href="#473">473</a></span><span class="counterCov">2</span><span class="lineCov">    let received_result: Result&lt;Vec&lt;DMXData&gt;&gt; = rx.recv().unwrap();</span></div>
<div class="line"><span id="474" class="lineNum"><a href="#474">474</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="475" class="lineNum"><a href="#475">475</a></span><span class="counterCov">2</span><span class="lineCov">    rcv_thread.join().unwrap();</span></div>
<div class="line"><span id="476" class="lineNum"><a href="#476">476</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="477" class="lineNum"><a href="#477">477</a></span><span class="counterCov">2</span><span class="lineCov">    assert!(!received_result.is_err(), &quot;Failed: Error when receiving data&quot;);</span></div>
<div class="line"><span id="478" class="lineNum"><a href="#478">478</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="479" class="lineNum"><a href="#479">479</a></span><span class="counterCov">2</span><span class="lineCov">    let received_data: Vec&lt;DMXData&gt; = received_result.unwrap();</span></div>
<div class="line"><span id="480" class="lineNum"><a href="#480">480</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="481" class="lineNum"><a href="#481">481</a></span><span class="counterCov">2</span><span class="lineCov">    assert_eq!(received_data.len(), 1); // Check only 1 universe received as expected.</span></div>
<div class="line"><span id="482" class="lineNum"><a href="#482">482</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="483" class="lineNum"><a href="#483">483</a></span><span class="counterCov">2</span><span class="lineCov">    let received_universe: DMXData = received_data[0].clone();</span></div>
<div class="line"><span id="484" class="lineNum"><a href="#484">484</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="485" class="lineNum"><a href="#485">485</a></span><span class="counterCov">2</span><span class="lineCov">    assert_eq!(received_universe.universe, universe); // Check that the universe received is as expected.</span></div>
<div class="line"><span id="486" class="lineNum"><a href="#486">486</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="487" class="lineNum"><a href="#487">487</a></span><span class="counterCov">2</span><span class="lineCov">    assert_eq!(received_universe.values, TEST_DATA_SINGLE_UNIVERSE.to_vec(), &quot;Received payload values don&#39;t match sent!&quot;);</span></div>
<div class="line"><span id="488" class="lineNum"><a href="#488">488</a></span><span class="counterCov">4</span><span class="lineCov">}</span></div>
<div class="line"><span id="489" class="lineNum"><a href="#489">489</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="490" class="lineNum"><a href="#490">490</a></span><span class="counterUnCov"></span><span class="lineUnCov">#[test]</span></div>
<div class="line"><span id="491" class="lineNum"><a href="#491">491</a></span><span class="counterCov">4</span><span class="lineCov">fn test_send_recv_single_universe_multicast_ipv4(){</span></div>
<div class="line"><span id="492" class="lineNum"><a href="#492">492</a></span><span class="counterCov">2</span><span class="lineCov">    let (tx, rx): (Sender&lt;Result&lt;Vec&lt;DMXData&gt;&gt;&gt;, Receiver&lt;Result&lt;Vec&lt;DMXData&gt;&gt;&gt;) = mpsc::channel();</span></div>
<div class="line"><span id="493" class="lineNum"><a href="#493">493</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="494" class="lineNum"><a href="#494">494</a></span><span class="counterCov">2</span><span class="lineCov">    let thread_tx = tx.clone();</span></div>
<div class="line"><span id="495" class="lineNum"><a href="#495">495</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="496" class="lineNum"><a href="#496">496</a></span><span class="counterCov">2</span><span class="lineCov">    let universe = 1;</span></div>
<div class="line"><span id="497" class="lineNum"><a href="#497">497</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="498" class="lineNum"><a href="#498">498</a></span><span class="counterCov">4</span><span class="lineCov">    let rcv_thread = thread::spawn(move || {</span></div>
<div class="line"><span id="499" class="lineNum"><a href="#499">499</a></span><span class="counterCov">2</span><span class="lineCov">        let mut dmx_recv = SacnReceiver::with_ip(SocketAddr::new(IpAddr::V4(TEST_NETWORK_INTERFACE_IPV4[0].parse().unwrap()), ACN_SDT_MULTICAST_PORT), None).unwrap();</span></div>
<div class="line"><span id="500" class="lineNum"><a href="#500">500</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="501" class="lineNum"><a href="#501">501</a></span><span class="counterCov">2</span><span class="lineCov">        dmx_recv.listen_universes(&amp;[universe]).unwrap();</span></div>
<div class="line"><span id="502" class="lineNum"><a href="#502">502</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="503" class="lineNum"><a href="#503">503</a></span><span class="counterCov">2</span><span class="lineCov">        thread_tx.send(Ok(Vec::new())).unwrap();</span></div>
<div class="line"><span id="504" class="lineNum"><a href="#504">504</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="505" class="lineNum"><a href="#505">505</a></span><span class="counterCov">2</span><span class="lineCov">        thread_tx.send(dmx_recv.recv(None)).unwrap();</span></div>
<div class="line"><span id="506" class="lineNum"><a href="#506">506</a></span><span class="counterCov">2</span><span class="lineCov">    });</span></div>
<div class="line"><span id="507" class="lineNum"><a href="#507">507</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="508" class="lineNum"><a href="#508">508</a></span><span class="counterCov">2</span><span class="lineCov">    rx.recv().unwrap().unwrap(); // Blocks until the receiver says it is ready. </span></div>
<div class="line"><span id="509" class="lineNum"><a href="#509">509</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="510" class="lineNum"><a href="#510">510</a></span><span class="counterCov">2</span><span class="lineCov">    let ip: SocketAddr = SocketAddr::new(IpAddr::V4(TEST_NETWORK_INTERFACE_IPV4[0].parse().unwrap()), ACN_SDT_MULTICAST_PORT + 1);</span></div>
<div class="line"><span id="511" class="lineNum"><a href="#511">511</a></span><span class="counterCov">2</span><span class="lineCov">    let mut src = SacnSource::with_ip(&quot;Source&quot;, ip).unwrap();</span></div>
<div class="line"><span id="512" class="lineNum"><a href="#512">512</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="513" class="lineNum"><a href="#513">513</a></span><span class="counterCov">2</span><span class="lineCov">    let priority = 100;</span></div>
<div class="line"><span id="514" class="lineNum"><a href="#514">514</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="515" class="lineNum"><a href="#515">515</a></span><span class="counterCov">2</span><span class="lineCov">    src.register_universe(universe).unwrap();</span></div>
<div class="line"><span id="516" class="lineNum"><a href="#516">516</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="517" class="lineNum"><a href="#517">517</a></span><span class="counterCov">2</span><span class="lineCov">    src.send(&amp;[universe], &amp;TEST_DATA_SINGLE_UNIVERSE, Some(priority), None, None).unwrap();</span></div>
<div class="line"><span id="518" class="lineNum"><a href="#518">518</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="519" class="lineNum"><a href="#519">519</a></span><span class="counterCov">2</span><span class="lineCov">    let received_result: Result&lt;Vec&lt;DMXData&gt;&gt; = rx.recv().unwrap();</span></div>
<div class="line"><span id="520" class="lineNum"><a href="#520">520</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="521" class="lineNum"><a href="#521">521</a></span><span class="counterCov">2</span><span class="lineCov">    rcv_thread.join().unwrap();</span></div>
<div class="line"><span id="522" class="lineNum"><a href="#522">522</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="523" class="lineNum"><a href="#523">523</a></span><span class="counterCov">2</span><span class="lineCov">    assert!(!received_result.is_err(), &quot;Failed: Error when receiving data&quot;);</span></div>
<div class="line"><span id="524" class="lineNum"><a href="#524">524</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="525" class="lineNum"><a href="#525">525</a></span><span class="counterCov">2</span><span class="lineCov">    let received_data: Vec&lt;DMXData&gt; = received_result.unwrap();</span></div>
<div class="line"><span id="526" class="lineNum"><a href="#526">526</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="527" class="lineNum"><a href="#527">527</a></span><span class="counterCov">2</span><span class="lineCov">    assert_eq!(received_data.len(), 1); // Check only 1 universe received as expected.</span></div>
<div class="line"><span id="528" class="lineNum"><a href="#528">528</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="529" class="lineNum"><a href="#529">529</a></span><span class="counterCov">2</span><span class="lineCov">    let received_universe: DMXData = received_data[0].clone();</span></div>
<div class="line"><span id="530" class="lineNum"><a href="#530">530</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="531" class="lineNum"><a href="#531">531</a></span><span class="counterCov">2</span><span class="lineCov">    assert_eq!(received_universe.universe, universe); // Check that the universe received is as expected.</span></div>
<div class="line"><span id="532" class="lineNum"><a href="#532">532</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="533" class="lineNum"><a href="#533">533</a></span><span class="counterCov">2</span><span class="lineCov">    assert_eq!(received_universe.values, TEST_DATA_SINGLE_UNIVERSE.to_vec(), &quot;Received payload values don&#39;t match sent!&quot;);</span></div>
<div class="line"><span id="534" class="lineNum"><a href="#534">534</a></span><span class="counterCov">4</span><span class="lineCov">}</span></div>
<div class="line"><span id="535" class="lineNum"><a href="#535">535</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="536" class="lineNum"><a href="#536">536</a></span><span class="counterUnCov"></span><span class="lineUnCov">/// A single sender transfers 260 data packets to a single receiver.</span></div>
<div class="line"><span id="537" class="lineNum"><a href="#537">537</a></span><span class="counterUnCov"></span><span class="lineUnCov">/// Since the sequence number field is a single unsigned byte (highest value 255) this should over flow the sequence number and so therefore this </span></div>
<div class="line"><span id="538" class="lineNum"><a href="#538">538</a></span><span class="counterUnCov"></span><span class="lineUnCov">/// test checks that the implementations handle this as expected by continuing as normal.</span></div>
<div class="line"><span id="539" class="lineNum"><a href="#539">539</a></span><span class="counterUnCov"></span><span class="lineUnCov">/// </span></div>
<div class="line"><span id="540" class="lineNum"><a href="#540">540</a></span><span class="counterUnCov"></span><span class="lineUnCov">#[test]</span></div>
<div class="line"><span id="541" class="lineNum"><a href="#541">541</a></span><span class="counterCov">4</span><span class="lineCov">fn test_send_recv_single_universe_overflow_sequence_number_multicast_ipv4(){</span></div>
<div class="line"><span id="542" class="lineNum"><a href="#542">542</a></span><span class="counterUnCov"></span><span class="lineUnCov">    const DATA_PACKETS_TO_SEND: usize = 260;</span></div>
<div class="line"><span id="543" class="lineNum"><a href="#543">543</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="544" class="lineNum"><a href="#544">544</a></span><span class="counterCov">2</span><span class="lineCov">    let (tx, rx): (Sender&lt;Result&lt;Vec&lt;DMXData&gt;&gt;&gt;, Receiver&lt;Result&lt;Vec&lt;DMXData&gt;&gt;&gt;) = mpsc::channel();</span></div>
<div class="line"><span id="545" class="lineNum"><a href="#545">545</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="546" class="lineNum"><a href="#546">546</a></span><span class="counterCov">2</span><span class="lineCov">    let thread_tx = tx.clone();</span></div>
<div class="line"><span id="547" class="lineNum"><a href="#547">547</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="548" class="lineNum"><a href="#548">548</a></span><span class="counterCov">2</span><span class="lineCov">    let universe = 1;</span></div>
<div class="line"><span id="549" class="lineNum"><a href="#549">549</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="550" class="lineNum"><a href="#550">550</a></span><span class="counterUnCov"></span><span class="lineUnCov">    // By having the receiver be &#39;remote&#39; and then send back to the sender it means the sender can check the data it has sent is correct.</span></div>
<div class="line"><span id="551" class="lineNum"><a href="#551">551</a></span><span class="counterCov">4</span><span class="lineCov">    let rcv_thread = thread::spawn(move || {</span></div>
<div class="line"><span id="552" class="lineNum"><a href="#552">552</a></span><span class="counterCov">2</span><span class="lineCov">        let mut dmx_recv = SacnReceiver::with_ip(SocketAddr::new(IpAddr::V4(TEST_NETWORK_INTERFACE_IPV4[0].parse().unwrap()), ACN_SDT_MULTICAST_PORT), None).unwrap();</span></div>
<div class="line"><span id="553" class="lineNum"><a href="#553">553</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="554" class="lineNum"><a href="#554">554</a></span><span class="counterCov">2</span><span class="lineCov">        dmx_recv.listen_universes(&amp;[universe]).unwrap();</span></div>
<div class="line"><span id="555" class="lineNum"><a href="#555">555</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="556" class="lineNum"><a href="#556">556</a></span><span class="counterCov">2</span><span class="lineCov">        thread_tx.send(Ok(Vec::new())).unwrap();</span></div>
<div class="line"><span id="557" class="lineNum"><a href="#557">557</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="558" class="lineNum"><a href="#558">558</a></span><span class="counterCov">522</span><span class="lineCov">        for _ in 0 .. DATA_PACKETS_TO_SEND {</span></div>
<div class="line"><span id="559" class="lineNum"><a href="#559">559</a></span><span class="counterCov">520</span><span class="lineCov">            thread_tx.send(dmx_recv.recv(None)).unwrap();</span></div>
<div class="line"><span id="560" class="lineNum"><a href="#560">560</a></span><span class="counterUnCov"></span><span class="lineUnCov">        }</span></div>
<div class="line"><span id="561" class="lineNum"><a href="#561">561</a></span><span class="counterCov">2</span><span class="lineCov">    });</span></div>
<div class="line"><span id="562" class="lineNum"><a href="#562">562</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="563" class="lineNum"><a href="#563">563</a></span><span class="counterCov">2</span><span class="lineCov">    rx.recv().unwrap().unwrap(); // Blocks until the receiver says it is ready. </span></div>
<div class="line"><span id="564" class="lineNum"><a href="#564">564</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="565" class="lineNum"><a href="#565">565</a></span><span class="counterCov">2</span><span class="lineCov">    let ip: SocketAddr = SocketAddr::new(IpAddr::V4(TEST_NETWORK_INTERFACE_IPV4[0].parse().unwrap()), ACN_SDT_MULTICAST_PORT + 1);</span></div>
<div class="line"><span id="566" class="lineNum"><a href="#566">566</a></span><span class="counterCov">2</span><span class="lineCov">    let mut src = SacnSource::with_ip(&quot;Source&quot;, ip).unwrap();</span></div>
<div class="line"><span id="567" class="lineNum"><a href="#567">567</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="568" class="lineNum"><a href="#568">568</a></span><span class="counterCov">2</span><span class="lineCov">    src.register_universe(universe).unwrap();</span></div>
<div class="line"><span id="569" class="lineNum"><a href="#569">569</a></span><span class="counterUnCov"></span><span class="lineUnCov">    </span></div>
<div class="line"><span id="570" class="lineNum"><a href="#570">570</a></span><span class="counterCov">522</span><span class="lineCov">    for i in 0 .. DATA_PACKETS_TO_SEND {</span></div>
<div class="line"><span id="571" class="lineNum"><a href="#571">571</a></span><span class="counterCov">520</span><span class="lineCov">        src.send(&amp;[universe], &amp;TEST_DATA_SINGLE_UNIVERSE[0 .. i + 1], None, None, None).unwrap(); // Vary the data each packet.</span></div>
<div class="line"><span id="572" class="lineNum"><a href="#572">572</a></span><span class="counterCov">520</span><span class="lineCov">        let received_data: Vec&lt;DMXData&gt; = rx.recv().unwrap().unwrap(); // Asserts that the data was received successfully without error.</span></div>
<div class="line"><span id="573" class="lineNum"><a href="#573">573</a></span><span class="counterCov">520</span><span class="lineCov">        assert_eq!(received_data.len(), 1); // Check only 1 universe received at a time as expected.</span></div>
<div class="line"><span id="574" class="lineNum"><a href="#574">574</a></span><span class="counterCov">520</span><span class="lineCov">        let received_universe: DMXData = received_data[0].clone();</span></div>
<div class="line"><span id="575" class="lineNum"><a href="#575">575</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="576" class="lineNum"><a href="#576">576</a></span><span class="counterCov">520</span><span class="lineCov">        assert_eq!(received_universe.universe, universe); // Check that the universe received is as expected.</span></div>
<div class="line"><span id="577" class="lineNum"><a href="#577">577</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="578" class="lineNum"><a href="#578">578</a></span><span class="counterCov">520</span><span class="lineCov">        assert_eq!(received_universe.values, TEST_DATA_SINGLE_UNIVERSE[0 .. i + 1].to_vec(), &quot;Received payload values don&#39;t match sent!&quot;);</span></div>
<div class="line"><span id="579" class="lineNum"><a href="#579">579</a></span><span class="counterCov">520</span><span class="lineCov">    }</span></div>
<div class="line"><span id="580" class="lineNum"><a href="#580">580</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="581" class="lineNum"><a href="#581">581</a></span><span class="counterUnCov"></span><span class="lineUnCov">    // Finished with the receiver.</span></div>
<div class="line"><span id="582" class="lineNum"><a href="#582">582</a></span><span class="counterCov">2</span><span class="lineCov">    rcv_thread.join().unwrap();</span></div>
<div class="line"><span id="583" class="lineNum"><a href="#583">583</a></span><span class="counterCov">4</span><span class="lineCov">}</span></div>
<div class="line"><span id="584" class="lineNum"><a href="#584">584</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="585" class="lineNum"><a href="#585">585</a></span><span class="counterUnCov"></span><span class="lineUnCov">/// Sends 2 packets with the same universe and synchronisation address from a sender to a receiver, the first packet has a priority of 110 </span></div>
<div class="line"><span id="586" class="lineNum"><a href="#586">586</a></span><span class="counterUnCov"></span><span class="lineUnCov">/// and the second a priority of 109. The receiver should discard the second packet when received due to its higher priority as per ANSI E1.31-2018 Section 6.2.3.</span></div>
<div class="line"><span id="587" class="lineNum"><a href="#587">587</a></span><span class="counterUnCov"></span><span class="lineUnCov">/// A sync packet is then sent and the receiver output checked that the right packet was kept.</span></div>
<div class="line"><span id="588" class="lineNum"><a href="#588">588</a></span><span class="counterUnCov"></span><span class="lineUnCov">/// Tests that lower priority packets are correctly discarded.</span></div>
<div class="line"><span id="589" class="lineNum"><a href="#589">589</a></span><span class="counterUnCov"></span><span class="lineUnCov">#[test]</span></div>
<div class="line"><span id="590" class="lineNum"><a href="#590">590</a></span><span class="counterCov">4</span><span class="lineCov">fn test_send_recv_diff_priority_same_universe_multicast_ipv4(){</span></div>
<div class="line"><span id="591" class="lineNum"><a href="#591">591</a></span><span class="counterCov">2</span><span class="lineCov">    let (tx, rx): (Sender&lt;Result&lt;Vec&lt;DMXData&gt;&gt;&gt;, Receiver&lt;Result&lt;Vec&lt;DMXData&gt;&gt;&gt;) = mpsc::channel();</span></div>
<div class="line"><span id="592" class="lineNum"><a href="#592">592</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="593" class="lineNum"><a href="#593">593</a></span><span class="counterCov">2</span><span class="lineCov">    let thread_tx = tx.clone();</span></div>
<div class="line"><span id="594" class="lineNum"><a href="#594">594</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="595" class="lineNum"><a href="#595">595</a></span><span class="counterCov">2</span><span class="lineCov">    let universe = 1;</span></div>
<div class="line"><span id="596" class="lineNum"><a href="#596">596</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="597" class="lineNum"><a href="#597">597</a></span><span class="counterCov">4</span><span class="lineCov">    let rcv_thread = thread::spawn(move || {</span></div>
<div class="line"><span id="598" class="lineNum"><a href="#598">598</a></span><span class="counterCov">2</span><span class="lineCov">        let mut dmx_recv = SacnReceiver::with_ip(SocketAddr::new(IpAddr::V4(TEST_NETWORK_INTERFACE_IPV4[0].parse().unwrap()), ACN_SDT_MULTICAST_PORT), None).unwrap();</span></div>
<div class="line"><span id="599" class="lineNum"><a href="#599">599</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="600" class="lineNum"><a href="#600">600</a></span><span class="counterCov">2</span><span class="lineCov">        dmx_recv.listen_universes(&amp;[universe]).unwrap();</span></div>
<div class="line"><span id="601" class="lineNum"><a href="#601">601</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="602" class="lineNum"><a href="#602">602</a></span><span class="counterCov">2</span><span class="lineCov">        thread_tx.send(Ok(Vec::new())).unwrap();</span></div>
<div class="line"><span id="603" class="lineNum"><a href="#603">603</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="604" class="lineNum"><a href="#604">604</a></span><span class="counterCov">2</span><span class="lineCov">        thread_tx.send(dmx_recv.recv(None)).unwrap();</span></div>
<div class="line"><span id="605" class="lineNum"><a href="#605">605</a></span><span class="counterCov">2</span><span class="lineCov">    });</span></div>
<div class="line"><span id="606" class="lineNum"><a href="#606">606</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="607" class="lineNum"><a href="#607">607</a></span><span class="counterCov">2</span><span class="lineCov">    rx.recv().unwrap().unwrap(); // Blocks until the receiver says it is ready. </span></div>
<div class="line"><span id="608" class="lineNum"><a href="#608">608</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="609" class="lineNum"><a href="#609">609</a></span><span class="counterCov">2</span><span class="lineCov">    let ip: SocketAddr = SocketAddr::new(IpAddr::V4(TEST_NETWORK_INTERFACE_IPV4[0].parse().unwrap()), ACN_SDT_MULTICAST_PORT + 1);</span></div>
<div class="line"><span id="610" class="lineNum"><a href="#610">610</a></span><span class="counterCov">2</span><span class="lineCov">    let mut src = SacnSource::with_ip(&quot;Source&quot;, ip).unwrap();</span></div>
<div class="line"><span id="611" class="lineNum"><a href="#611">611</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="612" class="lineNum"><a href="#612">612</a></span><span class="counterCov">2</span><span class="lineCov">    let priority = 110;</span></div>
<div class="line"><span id="613" class="lineNum"><a href="#613">613</a></span><span class="counterCov">2</span><span class="lineCov">    let priority_2 = 109;</span></div>
<div class="line"><span id="614" class="lineNum"><a href="#614">614</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="615" class="lineNum"><a href="#615">615</a></span><span class="counterCov">2</span><span class="lineCov">    src.register_universe(universe).unwrap();</span></div>
<div class="line"><span id="616" class="lineNum"><a href="#616">616</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="617" class="lineNum"><a href="#617">617</a></span><span class="counterCov">2</span><span class="lineCov">    src.send(&amp;[universe], &amp;TEST_DATA_SINGLE_UNIVERSE, Some(priority), None, Some(universe)).unwrap(); // First packet with higher priority.</span></div>
<div class="line"><span id="618" class="lineNum"><a href="#618">618</a></span><span class="counterCov">2</span><span class="lineCov">    src.send(&amp;[universe], &amp;TEST_DATA_SINGLE_ALTERNATIVE_STARTCODE_UNIVERSE, Some(priority_2), None, Some(universe)).unwrap(); // Second packet with lower priority.</span></div>
<div class="line"><span id="619" class="lineNum"><a href="#619">619</a></span><span class="counterCov">2</span><span class="lineCov">    src.send_sync_packet(universe, None).unwrap(); // Trigger the packet to be passed up on the receiver.</span></div>
<div class="line"><span id="620" class="lineNum"><a href="#620">620</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="621" class="lineNum"><a href="#621">621</a></span><span class="counterCov">2</span><span class="lineCov">    let received_result: Result&lt;Vec&lt;DMXData&gt;&gt; = rx.recv().unwrap();</span></div>
<div class="line"><span id="622" class="lineNum"><a href="#622">622</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="623" class="lineNum"><a href="#623">623</a></span><span class="counterCov">2</span><span class="lineCov">    rcv_thread.join().unwrap();</span></div>
<div class="line"><span id="624" class="lineNum"><a href="#624">624</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="625" class="lineNum"><a href="#625">625</a></span><span class="counterCov">2</span><span class="lineCov">    assert!(!received_result.is_err(), &quot;Failed: Error when receiving data&quot;);</span></div>
<div class="line"><span id="626" class="lineNum"><a href="#626">626</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="627" class="lineNum"><a href="#627">627</a></span><span class="counterCov">2</span><span class="lineCov">    let received_data: Vec&lt;DMXData&gt; = received_result.unwrap();</span></div>
<div class="line"><span id="628" class="lineNum"><a href="#628">628</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="629" class="lineNum"><a href="#629">629</a></span><span class="counterCov">2</span><span class="lineCov">    assert_eq!(received_data.len(), 1); // Check only 1 universe received as expected.</span></div>
<div class="line"><span id="630" class="lineNum"><a href="#630">630</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="631" class="lineNum"><a href="#631">631</a></span><span class="counterCov">2</span><span class="lineCov">    let received_universe: DMXData = received_data[0].clone();</span></div>
<div class="line"><span id="632" class="lineNum"><a href="#632">632</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="633" class="lineNum"><a href="#633">633</a></span><span class="counterCov">2</span><span class="lineCov">    assert_eq!(received_universe.universe, universe); // Check that the universe received is as expected.</span></div>
<div class="line"><span id="634" class="lineNum"><a href="#634">634</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="635" class="lineNum"><a href="#635">635</a></span><span class="counterCov">2</span><span class="lineCov">    assert_eq!(received_universe.values, TEST_DATA_SINGLE_UNIVERSE.to_vec(), &quot;Received payload values don&#39;t match sent!&quot;);</span></div>
<div class="line"><span id="636" class="lineNum"><a href="#636">636</a></span><span class="counterCov">4</span><span class="lineCov">}</span></div>
<div class="line"><span id="637" class="lineNum"><a href="#637">637</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="638" class="lineNum"><a href="#638">638</a></span><span class="counterUnCov"></span><span class="lineUnCov">/// Sends 2 packets with the same universe, priority and synchronisation address from a sender to a receiver.</span></div>
<div class="line"><span id="639" class="lineNum"><a href="#639">639</a></span><span class="counterUnCov"></span><span class="lineUnCov">/// The receiver should discard the first packet when the second arrives as per ANSI E1.31-2018 Section 6.2.3.</span></div>
<div class="line"><span id="640" class="lineNum"><a href="#640">640</a></span><span class="counterUnCov"></span><span class="lineUnCov">/// A sync packet is then sent and the receiver output checked that the right packet was kept.</span></div>
<div class="line"><span id="641" class="lineNum"><a href="#641">641</a></span><span class="counterUnCov"></span><span class="lineUnCov">/// Tests that older packet is correctly discarded.</span></div>
<div class="line"><span id="642" class="lineNum"><a href="#642">642</a></span><span class="counterUnCov"></span><span class="lineUnCov">#[test]</span></div>
<div class="line"><span id="643" class="lineNum"><a href="#643">643</a></span><span class="counterCov">4</span><span class="lineCov">fn test_send_recv_two_packets_same_priority_same_universe_multicast_ipv4(){</span></div>
<div class="line"><span id="644" class="lineNum"><a href="#644">644</a></span><span class="counterCov">2</span><span class="lineCov">    let (tx, rx): (Sender&lt;Result&lt;Vec&lt;DMXData&gt;&gt;&gt;, Receiver&lt;Result&lt;Vec&lt;DMXData&gt;&gt;&gt;) = mpsc::channel();</span></div>
<div class="line"><span id="645" class="lineNum"><a href="#645">645</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="646" class="lineNum"><a href="#646">646</a></span><span class="counterCov">2</span><span class="lineCov">    let thread_tx = tx.clone();</span></div>
<div class="line"><span id="647" class="lineNum"><a href="#647">647</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="648" class="lineNum"><a href="#648">648</a></span><span class="counterCov">2</span><span class="lineCov">    let universe = 1;</span></div>
<div class="line"><span id="649" class="lineNum"><a href="#649">649</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="650" class="lineNum"><a href="#650">650</a></span><span class="counterCov">4</span><span class="lineCov">    let rcv_thread = thread::spawn(move || {</span></div>
<div class="line"><span id="651" class="lineNum"><a href="#651">651</a></span><span class="counterCov">2</span><span class="lineCov">        let mut dmx_recv = SacnReceiver::with_ip(SocketAddr::new(IpAddr::V4(TEST_NETWORK_INTERFACE_IPV4[0].parse().unwrap()), ACN_SDT_MULTICAST_PORT), None).unwrap();</span></div>
<div class="line"><span id="652" class="lineNum"><a href="#652">652</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="653" class="lineNum"><a href="#653">653</a></span><span class="counterCov">2</span><span class="lineCov">        dmx_recv.listen_universes(&amp;[universe]).unwrap();</span></div>
<div class="line"><span id="654" class="lineNum"><a href="#654">654</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="655" class="lineNum"><a href="#655">655</a></span><span class="counterCov">2</span><span class="lineCov">        thread_tx.send(Ok(Vec::new())).unwrap();</span></div>
<div class="line"><span id="656" class="lineNum"><a href="#656">656</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="657" class="lineNum"><a href="#657">657</a></span><span class="counterCov">2</span><span class="lineCov">        thread_tx.send(dmx_recv.recv(None)).unwrap();</span></div>
<div class="line"><span id="658" class="lineNum"><a href="#658">658</a></span><span class="counterCov">2</span><span class="lineCov">    });</span></div>
<div class="line"><span id="659" class="lineNum"><a href="#659">659</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="660" class="lineNum"><a href="#660">660</a></span><span class="counterCov">2</span><span class="lineCov">    rx.recv().unwrap().unwrap(); // Blocks until the receiver says it is ready. </span></div>
<div class="line"><span id="661" class="lineNum"><a href="#661">661</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="662" class="lineNum"><a href="#662">662</a></span><span class="counterCov">2</span><span class="lineCov">    let ip: SocketAddr = SocketAddr::new(IpAddr::V4(TEST_NETWORK_INTERFACE_IPV4[0].parse().unwrap()), ACN_SDT_MULTICAST_PORT + 1);</span></div>
<div class="line"><span id="663" class="lineNum"><a href="#663">663</a></span><span class="counterCov">2</span><span class="lineCov">    let mut src = SacnSource::with_ip(&quot;Source&quot;, ip).unwrap();</span></div>
<div class="line"><span id="664" class="lineNum"><a href="#664">664</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="665" class="lineNum"><a href="#665">665</a></span><span class="counterCov">2</span><span class="lineCov">    let priority = 110;</span></div>
<div class="line"><span id="666" class="lineNum"><a href="#666">666</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="667" class="lineNum"><a href="#667">667</a></span><span class="counterCov">2</span><span class="lineCov">    src.register_universe(universe).unwrap();</span></div>
<div class="line"><span id="668" class="lineNum"><a href="#668">668</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="669" class="lineNum"><a href="#669">669</a></span><span class="counterCov">2</span><span class="lineCov">    src.send(&amp;[universe], &amp;TEST_DATA_SINGLE_UNIVERSE, Some(priority), None, Some(universe)).unwrap(); // First packet</span></div>
<div class="line"><span id="670" class="lineNum"><a href="#670">670</a></span><span class="counterCov">2</span><span class="lineCov">    src.send(&amp;[universe], &amp;TEST_DATA_SINGLE_ALTERNATIVE_STARTCODE_UNIVERSE, Some(priority), None, Some(universe)).unwrap(); // Second packet which should override first.</span></div>
<div class="line"><span id="671" class="lineNum"><a href="#671">671</a></span><span class="counterCov">2</span><span class="lineCov">    src.send_sync_packet(universe, None).unwrap(); // Trigger the packet to be passed up on the receiver.</span></div>
<div class="line"><span id="672" class="lineNum"><a href="#672">672</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="673" class="lineNum"><a href="#673">673</a></span><span class="counterCov">2</span><span class="lineCov">    let received_result: Result&lt;Vec&lt;DMXData&gt;&gt; = rx.recv().unwrap();</span></div>
<div class="line"><span id="674" class="lineNum"><a href="#674">674</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="675" class="lineNum"><a href="#675">675</a></span><span class="counterCov">2</span><span class="lineCov">    rcv_thread.join().unwrap();</span></div>
<div class="line"><span id="676" class="lineNum"><a href="#676">676</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="677" class="lineNum"><a href="#677">677</a></span><span class="counterCov">2</span><span class="lineCov">    assert!(!received_result.is_err(), &quot;Failed: Error when receiving data&quot;);</span></div>
<div class="line"><span id="678" class="lineNum"><a href="#678">678</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="679" class="lineNum"><a href="#679">679</a></span><span class="counterCov">2</span><span class="lineCov">    let received_data: Vec&lt;DMXData&gt; = received_result.unwrap();</span></div>
<div class="line"><span id="680" class="lineNum"><a href="#680">680</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="681" class="lineNum"><a href="#681">681</a></span><span class="counterCov">2</span><span class="lineCov">    assert_eq!(received_data.len(), 1); // Check only 1 universe received as expected.</span></div>
<div class="line"><span id="682" class="lineNum"><a href="#682">682</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="683" class="lineNum"><a href="#683">683</a></span><span class="counterCov">2</span><span class="lineCov">    let received_universe: DMXData = received_data[0].clone();</span></div>
<div class="line"><span id="684" class="lineNum"><a href="#684">684</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="685" class="lineNum"><a href="#685">685</a></span><span class="counterCov">2</span><span class="lineCov">    assert_eq!(received_universe.universe, universe); // Check that the universe received is as expected.</span></div>
<div class="line"><span id="686" class="lineNum"><a href="#686">686</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="687" class="lineNum"><a href="#687">687</a></span><span class="counterCov">2</span><span class="lineCov">    assert_eq!(received_universe.values, TEST_DATA_SINGLE_ALTERNATIVE_STARTCODE_UNIVERSE.to_vec(), &quot;Received payload values don&#39;t match sent!&quot;);</span></div>
<div class="line"><span id="688" class="lineNum"><a href="#688">688</a></span><span class="counterCov">4</span><span class="lineCov">}</span></div>
<div class="line"><span id="689" class="lineNum"><a href="#689">689</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="690" class="lineNum"><a href="#690">690</a></span><span class="counterUnCov"></span><span class="lineUnCov">/// Sends data 2 packets with the same universe. The first packet is a synchronised packet with a synchronisation address</span></div>
<div class="line"><span id="691" class="lineNum"><a href="#691">691</a></span><span class="counterUnCov"></span><span class="lineUnCov">/// that is &gt; 0. The second packet isn&#39;t synchronised as it has a synchronisation address of 0. This second packet should</span></div>
<div class="line"><span id="692" class="lineNum"><a href="#692">692</a></span><span class="counterUnCov"></span><span class="lineUnCov">/// therefore override the waiting packet as per ANSI E1.31-2018 Section 6.2.4.1. </span></div>
<div class="line"><span id="693" class="lineNum"><a href="#693">693</a></span><span class="counterUnCov"></span><span class="lineUnCov">/// </span></div>
<div class="line"><span id="694" class="lineNum"><a href="#694">694</a></span><span class="counterUnCov"></span><span class="lineUnCov">/// To check that the waiting data is discarded the receiver receives once to check the second packet gets through and then </span></div>
<div class="line"><span id="695" class="lineNum"><a href="#695">695</a></span><span class="counterUnCov"></span><span class="lineUnCov">/// the source sends a sync_packet and the receiver receives again, since the waiting data was discarded it is expected that the</span></div>
<div class="line"><span id="696" class="lineNum"><a href="#696">696</a></span><span class="counterUnCov"></span><span class="lineUnCov">/// sync packet should have no effect and the receiver will timeout.</span></div>
<div class="line"><span id="697" class="lineNum"><a href="#697">697</a></span><span class="counterUnCov"></span><span class="lineUnCov">#[test]</span></div>
<div class="line"><span id="698" class="lineNum"><a href="#698">698</a></span><span class="counterCov">4</span><span class="lineCov">fn test_send_recv_sync_then_nosync_packet_same_universe_multicast_ipv4() {</span></div>
<div class="line"><span id="699" class="lineNum"><a href="#699">699</a></span><span class="counterCov">2</span><span class="lineCov">    let (tx, rx): (Sender&lt;Result&lt;Vec&lt;DMXData&gt;&gt;&gt;, Receiver&lt;Result&lt;Vec&lt;DMXData&gt;&gt;&gt;) = mpsc::channel();</span></div>
<div class="line"><span id="700" class="lineNum"><a href="#700">700</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="701" class="lineNum"><a href="#701">701</a></span><span class="counterCov">2</span><span class="lineCov">    let thread_tx = tx.clone();</span></div>
<div class="line"><span id="702" class="lineNum"><a href="#702">702</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="703" class="lineNum"><a href="#703">703</a></span><span class="counterCov">2</span><span class="lineCov">    let universe = 1;</span></div>
<div class="line"><span id="704" class="lineNum"><a href="#704">704</a></span><span class="counterUnCov"></span><span class="lineUnCov">    const TIMEOUT: Option&lt;Duration&gt; = Some(Duration::from_secs(2));</span></div>
<div class="line"><span id="705" class="lineNum"><a href="#705">705</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="706" class="lineNum"><a href="#706">706</a></span><span class="counterCov">4</span><span class="lineCov">    let rcv_thread = thread::spawn(move || {</span></div>
<div class="line"><span id="707" class="lineNum"><a href="#707">707</a></span><span class="counterCov">2</span><span class="lineCov">        let mut dmx_recv = SacnReceiver::with_ip(SocketAddr::new(IpAddr::V4(TEST_NETWORK_INTERFACE_IPV4[0].parse().unwrap()), ACN_SDT_MULTICAST_PORT), None).unwrap();</span></div>
<div class="line"><span id="708" class="lineNum"><a href="#708">708</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="709" class="lineNum"><a href="#709">709</a></span><span class="counterCov">2</span><span class="lineCov">        dmx_recv.listen_universes(&amp;[universe]).unwrap();</span></div>
<div class="line"><span id="710" class="lineNum"><a href="#710">710</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="711" class="lineNum"><a href="#711">711</a></span><span class="counterCov">2</span><span class="lineCov">        thread_tx.send(Ok(Vec::new())).unwrap();</span></div>
<div class="line"><span id="712" class="lineNum"><a href="#712">712</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="713" class="lineNum"><a href="#713">713</a></span><span class="counterCov">2</span><span class="lineCov">        thread_tx.send(dmx_recv.recv(None)).unwrap(); // Receive a packet, expected to be the second packet which has caused the first to be discarded.</span></div>
<div class="line"><span id="714" class="lineNum"><a href="#714">714</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="715" class="lineNum"><a href="#715">715</a></span><span class="counterCov">2</span><span class="lineCov">        thread_tx.send(dmx_recv.recv(TIMEOUT)).unwrap(); // Attempt to receive a packet, expected to timeout because the other data packet was discarded.</span></div>
<div class="line"><span id="716" class="lineNum"><a href="#716">716</a></span><span class="counterCov">2</span><span class="lineCov">    });</span></div>
<div class="line"><span id="717" class="lineNum"><a href="#717">717</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="718" class="lineNum"><a href="#718">718</a></span><span class="counterCov">2</span><span class="lineCov">    rx.recv().unwrap().unwrap(); // Blocks until the receiver says it is ready. </span></div>
<div class="line"><span id="719" class="lineNum"><a href="#719">719</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="720" class="lineNum"><a href="#720">720</a></span><span class="counterCov">2</span><span class="lineCov">    let ip: SocketAddr = SocketAddr::new(IpAddr::V4(TEST_NETWORK_INTERFACE_IPV4[0].parse().unwrap()), ACN_SDT_MULTICAST_PORT + 1);</span></div>
<div class="line"><span id="721" class="lineNum"><a href="#721">721</a></span><span class="counterCov">2</span><span class="lineCov">    let mut src = SacnSource::with_ip(&quot;Source&quot;, ip).unwrap();</span></div>
<div class="line"><span id="722" class="lineNum"><a href="#722">722</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="723" class="lineNum"><a href="#723">723</a></span><span class="counterCov">2</span><span class="lineCov">    src.register_universe(universe).unwrap();</span></div>
<div class="line"><span id="724" class="lineNum"><a href="#724">724</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="725" class="lineNum"><a href="#725">725</a></span><span class="counterCov">2</span><span class="lineCov">    src.send(&amp;[universe], &amp;TEST_DATA_SINGLE_UNIVERSE, None, None, Some(universe)).unwrap(); // First packet, with sync.</span></div>
<div class="line"><span id="726" class="lineNum"><a href="#726">726</a></span><span class="counterCov">2</span><span class="lineCov">    src.send(&amp;[universe], &amp;TEST_DATA_SINGLE_ALTERNATIVE_STARTCODE_UNIVERSE, None, None, None).unwrap(); // Second packet, no sync.</span></div>
<div class="line"><span id="727" class="lineNum"><a href="#727">727</a></span><span class="counterUnCov"></span><span class="lineUnCov">    </span></div>
<div class="line"><span id="728" class="lineNum"><a href="#728">728</a></span><span class="counterCov">2</span><span class="lineCov">    src.send_sync_packet(universe, None).unwrap(); // Send a sync packet, if the first packet isn&#39;t discarded it should now be passed up.</span></div>
<div class="line"><span id="729" class="lineNum"><a href="#729">729</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="730" class="lineNum"><a href="#730">730</a></span><span class="counterCov">2</span><span class="lineCov">    let first_received_result: Result&lt;Vec&lt;DMXData&gt;&gt; = rx.recv().unwrap();</span></div>
<div class="line"><span id="731" class="lineNum"><a href="#731">731</a></span><span class="counterCov">2</span><span class="lineCov">    let second_received_result: Result&lt;Vec&lt;DMXData&gt;&gt; = rx.recv().unwrap();</span></div>
<div class="line"><span id="732" class="lineNum"><a href="#732">732</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="733" class="lineNum"><a href="#733">733</a></span><span class="counterCov">2</span><span class="lineCov">    rcv_thread.join().unwrap(); // Finished with receiver</span></div>
<div class="line"><span id="734" class="lineNum"><a href="#734">734</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="735" class="lineNum"><a href="#735">735</a></span><span class="counterUnCov"></span><span class="lineUnCov">    // Check that the first lot of data received (which should be the second packet) is as expected.</span></div>
<div class="line"><span id="736" class="lineNum"><a href="#736">736</a></span><span class="counterCov">2</span><span class="lineCov">    assert!(!first_received_result.is_err(), &quot;Unexpected error when receiving first lot of data&quot;);</span></div>
<div class="line"><span id="737" class="lineNum"><a href="#737">737</a></span><span class="counterCov">2</span><span class="lineCov">    let received_data: Vec&lt;DMXData&gt; = first_received_result.unwrap();</span></div>
<div class="line"><span id="738" class="lineNum"><a href="#738">738</a></span><span class="counterCov">2</span><span class="lineCov">    assert_eq!(received_data.len(), 1); // Check only 1 universe received as expected.</span></div>
<div class="line"><span id="739" class="lineNum"><a href="#739">739</a></span><span class="counterCov">2</span><span class="lineCov">    let received_universe: DMXData = received_data[0].clone();</span></div>
<div class="line"><span id="740" class="lineNum"><a href="#740">740</a></span><span class="counterCov">2</span><span class="lineCov">    assert_eq!(received_universe.universe, universe); // Check that the universe received is as expected.</span></div>
<div class="line"><span id="741" class="lineNum"><a href="#741">741</a></span><span class="counterCov">2</span><span class="lineCov">    assert_eq!(received_universe.values, TEST_DATA_SINGLE_ALTERNATIVE_STARTCODE_UNIVERSE.to_vec(), &quot;Received payload values don&#39;t match sent!&quot;);</span></div>
<div class="line"><span id="742" class="lineNum"><a href="#742">742</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="743" class="lineNum"><a href="#743">743</a></span><span class="counterNoCov">0</span><span class="lineNoCov">    match second_received_result {</span></div>
<div class="line"><span id="744" class="lineNum"><a href="#744">744</a></span><span class="counterCov">2</span><span class="lineCov">        Err(e) =&gt; {</span></div>
<div class="line"><span id="745" class="lineNum"><a href="#745">745</a></span><span class="counterCov">2</span><span class="lineCov">            match e.kind() {</span></div>
<div class="line"><span id="746" class="lineNum"><a href="#746">746</a></span><span class="counterCov">2</span><span class="lineCov">                ErrorKind::Io(ref s) =&gt; {</span></div>
<div class="line"><span id="747" class="lineNum"><a href="#747">747</a></span><span class="counterCov">4</span><span class="lineCov">                    match s.kind() {</span></div>
<div class="line"><span id="748" class="lineNum"><a href="#748">748</a></span><span class="counterCov">2</span><span class="lineCov">                        std::io::ErrorKind::WouldBlock =&gt; {</span></div>
<div class="line"><span id="749" class="lineNum"><a href="#749">749</a></span><span class="counterUnCov"></span><span class="lineUnCov">                            // Expected to timeout.</span></div>
<div class="line"><span id="750" class="lineNum"><a href="#750">750</a></span><span class="counterUnCov"></span><span class="lineUnCov">                            // The different errors are due to windows and unix returning different errors for the same thing.</span></div>
<div class="line"><span id="751" class="lineNum"><a href="#751">751</a></span><span class="counterUnCov"></span><span class="lineUnCov">                            assert!(true, &quot;Timed out as expected meaning waiting data was successfully discarded&quot;);</span></div>
<div class="line"><span id="752" class="lineNum"><a href="#752">752</a></span><span class="counterUnCov"></span><span class="lineUnCov">                        },</span></div>
<div class="line"><span id="753" class="lineNum"><a href="#753">753</a></span><span class="counterUnCov"></span><span class="lineUnCov">                        std::io::ErrorKind::TimedOut =&gt; {</span></div>
<div class="line"><span id="754" class="lineNum"><a href="#754">754</a></span><span class="counterUnCov"></span><span class="lineUnCov">                            assert!(true, &quot;Timed out as expected meaning waiting data was successfully discarded&quot;);</span></div>
<div class="line"><span id="755" class="lineNum"><a href="#755">755</a></span><span class="counterUnCov"></span><span class="lineUnCov">                        },</span></div>
<div class="line"><span id="756" class="lineNum"><a href="#756">756</a></span><span class="counterUnCov"></span><span class="lineUnCov">                        _ =&gt; {</span></div>
<div class="line"><span id="757" class="lineNum"><a href="#757">757</a></span><span class="counterNoCov">0</span><span class="lineNoCov">                            assert!(false, &quot;Unexpected error returned&quot;);</span></div>
<div class="line"><span id="758" class="lineNum"><a href="#758">758</a></span><span class="counterUnCov"></span><span class="lineUnCov">                        }</span></div>
<div class="line"><span id="759" class="lineNum"><a href="#759">759</a></span><span class="counterUnCov"></span><span class="lineUnCov">                    }</span></div>
<div class="line"><span id="760" class="lineNum"><a href="#760">760</a></span><span class="counterUnCov"></span><span class="lineUnCov">                },</span></div>
<div class="line"><span id="761" class="lineNum"><a href="#761">761</a></span><span class="counterUnCov"></span><span class="lineUnCov">                _ =&gt; {</span></div>
<div class="line"><span id="762" class="lineNum"><a href="#762">762</a></span><span class="counterNoCov">0</span><span class="lineNoCov">                    assert!(false, &quot;Unexpected error returned&quot;);</span></div>
<div class="line"><span id="763" class="lineNum"><a href="#763">763</a></span><span class="counterUnCov"></span><span class="lineUnCov">                }</span></div>
<div class="line"><span id="764" class="lineNum"><a href="#764">764</a></span><span class="counterUnCov"></span><span class="lineUnCov">            }</span></div>
<div class="line"><span id="765" class="lineNum"><a href="#765">765</a></span><span class="counterUnCov"></span><span class="lineUnCov">        }</span></div>
<div class="line"><span id="766" class="lineNum"><a href="#766">766</a></span><span class="counterCov">2</span><span class="lineCov">        Ok(_) =&gt; {</span></div>
<div class="line"><span id="767" class="lineNum"><a href="#767">767</a></span><span class="counterNoCov">0</span><span class="lineNoCov">            assert!(false, &quot;Second receive attempt didn&#39;t timeout as expected, indicates that the synchronised data packet wasn&#39;t discarded as expected&quot;);</span></div>
<div class="line"><span id="768" class="lineNum"><a href="#768">768</a></span><span class="counterUnCov"></span><span class="lineUnCov">        }</span></div>
<div class="line"><span id="769" class="lineNum"><a href="#769">769</a></span><span class="counterUnCov"></span><span class="lineUnCov">    }</span></div>
<div class="line"><span id="770" class="lineNum"><a href="#770">770</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="771" class="lineNum"><a href="#771">771</a></span><span class="counterCov">4</span><span class="lineCov">}</span></div>
<div class="line"><span id="772" class="lineNum"><a href="#772">772</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="773" class="lineNum"><a href="#773">773</a></span><span class="counterUnCov"></span><span class="lineUnCov">#[test]</span></div>
<div class="line"><span id="774" class="lineNum"><a href="#774">774</a></span><span class="counterCov">4</span><span class="lineCov">fn test_send_recv_two_universe_multicast_ipv4(){</span></div>
<div class="line"><span id="775" class="lineNum"><a href="#775">775</a></span><span class="counterCov">2</span><span class="lineCov">    let (tx, rx): (Sender&lt;Result&lt;Vec&lt;DMXData&gt;&gt;&gt;, Receiver&lt;Result&lt;Vec&lt;DMXData&gt;&gt;&gt;) = mpsc::channel();</span></div>
<div class="line"><span id="776" class="lineNum"><a href="#776">776</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="777" class="lineNum"><a href="#777">777</a></span><span class="counterCov">2</span><span class="lineCov">    let thread_tx = tx.clone();</span></div>
<div class="line"><span id="778" class="lineNum"><a href="#778">778</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="779" class="lineNum"><a href="#779">779</a></span><span class="counterCov">2</span><span class="lineCov">    let universes = [1, 2];</span></div>
<div class="line"><span id="780" class="lineNum"><a href="#780">780</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="781" class="lineNum"><a href="#781">781</a></span><span class="counterCov">4</span><span class="lineCov">    let rcv_thread = thread::spawn(move || {</span></div>
<div class="line"><span id="782" class="lineNum"><a href="#782">782</a></span><span class="counterCov">2</span><span class="lineCov">        let mut dmx_recv = SacnReceiver::with_ip(SocketAddr::new(IpAddr::V4(TEST_NETWORK_INTERFACE_IPV4[0].parse().unwrap()), ACN_SDT_MULTICAST_PORT), None).unwrap();</span></div>
<div class="line"><span id="783" class="lineNum"><a href="#783">783</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="784" class="lineNum"><a href="#784">784</a></span><span class="counterCov">2</span><span class="lineCov">        dmx_recv.listen_universes(&amp;universes).unwrap();</span></div>
<div class="line"><span id="785" class="lineNum"><a href="#785">785</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="786" class="lineNum"><a href="#786">786</a></span><span class="counterCov">2</span><span class="lineCov">        thread_tx.send(Ok(Vec::new())).unwrap(); // Notify the sender that the receiver is ready.</span></div>
<div class="line"><span id="787" class="lineNum"><a href="#787">787</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="788" class="lineNum"><a href="#788">788</a></span><span class="counterCov">2</span><span class="lineCov">        thread_tx.send(dmx_recv.recv(None)).unwrap(); // Receive and pass on 2 lots of data, blocking.</span></div>
<div class="line"><span id="789" class="lineNum"><a href="#789">789</a></span><span class="counterCov">2</span><span class="lineCov">        thread_tx.send(dmx_recv.recv(None)).unwrap();</span></div>
<div class="line"><span id="790" class="lineNum"><a href="#790">790</a></span><span class="counterCov">2</span><span class="lineCov">    });</span></div>
<div class="line"><span id="791" class="lineNum"><a href="#791">791</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="792" class="lineNum"><a href="#792">792</a></span><span class="counterCov">2</span><span class="lineCov">    rx.recv().unwrap().unwrap(); // Blocks until the receiver says it is ready. </span></div>
<div class="line"><span id="793" class="lineNum"><a href="#793">793</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="794" class="lineNum"><a href="#794">794</a></span><span class="counterCov">2</span><span class="lineCov">    let ip: SocketAddr = SocketAddr::new(IpAddr::V4(TEST_NETWORK_INTERFACE_IPV4[0].parse().unwrap()), ACN_SDT_MULTICAST_PORT + 1);</span></div>
<div class="line"><span id="795" class="lineNum"><a href="#795">795</a></span><span class="counterCov">2</span><span class="lineCov">    let mut src = SacnSource::with_ip(&quot;Source&quot;, ip).unwrap();</span></div>
<div class="line"><span id="796" class="lineNum"><a href="#796">796</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="797" class="lineNum"><a href="#797">797</a></span><span class="counterCov">2</span><span class="lineCov">    src.register_universes(&amp;universes).unwrap();</span></div>
<div class="line"><span id="798" class="lineNum"><a href="#798">798</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="799" class="lineNum"><a href="#799">799</a></span><span class="counterUnCov"></span><span class="lineUnCov">    // Send 2 universes of data with default priority, no synchronisation and use multicast.</span></div>
<div class="line"><span id="800" class="lineNum"><a href="#800">800</a></span><span class="counterCov">2</span><span class="lineCov">    src.send(&amp;universes, &amp;TEST_DATA_MULTIPLE_UNIVERSE, None, None, None).unwrap();</span></div>
<div class="line"><span id="801" class="lineNum"><a href="#801">801</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="802" class="lineNum"><a href="#802">802</a></span><span class="counterUnCov"></span><span class="lineUnCov">    // Get the data that was sent to the receiver.</span></div>
<div class="line"><span id="803" class="lineNum"><a href="#803">803</a></span><span class="counterCov">2</span><span class="lineCov">    let received_result: Result&lt;Vec&lt;DMXData&gt;&gt; = rx.recv().unwrap();</span></div>
<div class="line"><span id="804" class="lineNum"><a href="#804">804</a></span><span class="counterCov">2</span><span class="lineCov">    let received_result_2: Result&lt;Vec&lt;DMXData&gt;&gt; = rx.recv().unwrap();</span></div>
<div class="line"><span id="805" class="lineNum"><a href="#805">805</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="806" class="lineNum"><a href="#806">806</a></span><span class="counterUnCov"></span><span class="lineUnCov">    // Receiver can be terminated.</span></div>
<div class="line"><span id="807" class="lineNum"><a href="#807">807</a></span><span class="counterCov">2</span><span class="lineCov">    rcv_thread.join().unwrap();</span></div>
<div class="line"><span id="808" class="lineNum"><a href="#808">808</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="809" class="lineNum"><a href="#809">809</a></span><span class="counterCov">2</span><span class="lineCov">    assert!(!received_result.is_err(), &quot;Failed: Error when receiving 1st universe of data&quot;);</span></div>
<div class="line"><span id="810" class="lineNum"><a href="#810">810</a></span><span class="counterCov">2</span><span class="lineCov">    assert!(!received_result_2.is_err(), &quot;Failed: Error when receiving 2nd universe of data&quot;);</span></div>
<div class="line"><span id="811" class="lineNum"><a href="#811">811</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="812" class="lineNum"><a href="#812">812</a></span><span class="counterCov">2</span><span class="lineCov">    let received_data: Vec&lt;DMXData&gt; = received_result.unwrap();</span></div>
<div class="line"><span id="813" class="lineNum"><a href="#813">813</a></span><span class="counterCov">2</span><span class="lineCov">    let received_data_2: Vec&lt;DMXData&gt; = received_result_2.unwrap();</span></div>
<div class="line"><span id="814" class="lineNum"><a href="#814">814</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="815" class="lineNum"><a href="#815">815</a></span><span class="counterCov">2</span><span class="lineCov">    assert_eq!(received_data.len(), 1);   // Check only 1 universe received from each individual recv() as expected, if this wasn&#39;t the case it would</span></div>
<div class="line"><span id="816" class="lineNum"><a href="#816">816</a></span><span class="counterCov">2</span><span class="lineCov">    assert_eq!(received_data_2.len(), 1); // indicate that the data has been synchronised incorrectly or that less data than expected was received.</span></div>
<div class="line"><span id="817" class="lineNum"><a href="#817">817</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="818" class="lineNum"><a href="#818">818</a></span><span class="counterCov">2</span><span class="lineCov">    assert_eq!(received_data[0].universe, universes[0]);   // Check that the universe received is as expected.</span></div>
<div class="line"><span id="819" class="lineNum"><a href="#819">819</a></span><span class="counterCov">2</span><span class="lineCov">    assert_eq!(received_data_2[0].universe, universes[1]);</span></div>
<div class="line"><span id="820" class="lineNum"><a href="#820">820</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="821" class="lineNum"><a href="#821">821</a></span><span class="counterCov">2</span><span class="lineCov">    assert_eq!(received_data[0].values, TEST_DATA_MULTIPLE_UNIVERSE[..513].to_vec());</span></div>
<div class="line"><span id="822" class="lineNum"><a href="#822">822</a></span><span class="counterCov">2</span><span class="lineCov">    assert_eq!(received_data_2[0].values, TEST_DATA_MULTIPLE_UNIVERSE[513..].to_vec());</span></div>
<div class="line"><span id="823" class="lineNum"><a href="#823">823</a></span><span class="counterCov">4</span><span class="lineCov">}</span></div>
<div class="line"><span id="824" class="lineNum"><a href="#824">824</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="825" class="lineNum"><a href="#825">825</a></span><span class="counterUnCov"></span><span class="lineUnCov">#[test]</span></div>
<div class="line"><span id="826" class="lineNum"><a href="#826">826</a></span><span class="counterCov">4</span><span class="lineCov">fn test_send_recv_single_universe_alternative_startcode_multicast_ipv4(){</span></div>
<div class="line"><span id="827" class="lineNum"><a href="#827">827</a></span><span class="counterCov">2</span><span class="lineCov">    let (tx, rx): (Sender&lt;Result&lt;Vec&lt;DMXData&gt;&gt;&gt;, Receiver&lt;Result&lt;Vec&lt;DMXData&gt;&gt;&gt;) = mpsc::channel();</span></div>
<div class="line"><span id="828" class="lineNum"><a href="#828">828</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="829" class="lineNum"><a href="#829">829</a></span><span class="counterCov">2</span><span class="lineCov">    let thread_tx = tx.clone();</span></div>
<div class="line"><span id="830" class="lineNum"><a href="#830">830</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="831" class="lineNum"><a href="#831">831</a></span><span class="counterCov">2</span><span class="lineCov">    let universe = 1;</span></div>
<div class="line"><span id="832" class="lineNum"><a href="#832">832</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="833" class="lineNum"><a href="#833">833</a></span><span class="counterCov">4</span><span class="lineCov">    let rcv_thread = thread::spawn(move || {</span></div>
<div class="line"><span id="834" class="lineNum"><a href="#834">834</a></span><span class="counterCov">2</span><span class="lineCov">        let mut dmx_recv = SacnReceiver::with_ip(SocketAddr::new(IpAddr::V4(TEST_NETWORK_INTERFACE_IPV4[0].parse().unwrap()), ACN_SDT_MULTICAST_PORT), None).unwrap();</span></div>
<div class="line"><span id="835" class="lineNum"><a href="#835">835</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="836" class="lineNum"><a href="#836">836</a></span><span class="counterCov">2</span><span class="lineCov">        dmx_recv.listen_universes(&amp;[universe]).unwrap();</span></div>
<div class="line"><span id="837" class="lineNum"><a href="#837">837</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="838" class="lineNum"><a href="#838">838</a></span><span class="counterCov">2</span><span class="lineCov">        thread_tx.send(Ok(Vec::new())).unwrap();</span></div>
<div class="line"><span id="839" class="lineNum"><a href="#839">839</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="840" class="lineNum"><a href="#840">840</a></span><span class="counterCov">2</span><span class="lineCov">        thread_tx.send(dmx_recv.recv(None)).unwrap();</span></div>
<div class="line"><span id="841" class="lineNum"><a href="#841">841</a></span><span class="counterCov">2</span><span class="lineCov">    });</span></div>
<div class="line"><span id="842" class="lineNum"><a href="#842">842</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="843" class="lineNum"><a href="#843">843</a></span><span class="counterCov">2</span><span class="lineCov">    rx.recv().unwrap().unwrap(); // Blocks until the receiver says it is ready. </span></div>
<div class="line"><span id="844" class="lineNum"><a href="#844">844</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="845" class="lineNum"><a href="#845">845</a></span><span class="counterCov">2</span><span class="lineCov">    let ip: SocketAddr = SocketAddr::new(IpAddr::V4(TEST_NETWORK_INTERFACE_IPV4[0].parse().unwrap()), ACN_SDT_MULTICAST_PORT + 1);</span></div>
<div class="line"><span id="846" class="lineNum"><a href="#846">846</a></span><span class="counterCov">2</span><span class="lineCov">    let mut src = SacnSource::with_ip(&quot;Source&quot;, ip).unwrap();</span></div>
<div class="line"><span id="847" class="lineNum"><a href="#847">847</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="848" class="lineNum"><a href="#848">848</a></span><span class="counterCov">2</span><span class="lineCov">    let priority = 100;</span></div>
<div class="line"><span id="849" class="lineNum"><a href="#849">849</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="850" class="lineNum"><a href="#850">850</a></span><span class="counterCov">2</span><span class="lineCov">    src.register_universe(universe).unwrap();</span></div>
<div class="line"><span id="851" class="lineNum"><a href="#851">851</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="852" class="lineNum"><a href="#852">852</a></span><span class="counterCov">2</span><span class="lineCov">    src.send(&amp;[universe], &amp;TEST_DATA_SINGLE_ALTERNATIVE_STARTCODE_UNIVERSE, Some(priority), None, None).unwrap();</span></div>
<div class="line"><span id="853" class="lineNum"><a href="#853">853</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="854" class="lineNum"><a href="#854">854</a></span><span class="counterCov">2</span><span class="lineCov">    let received_result: Result&lt;Vec&lt;DMXData&gt;&gt; = rx.recv().unwrap();</span></div>
<div class="line"><span id="855" class="lineNum"><a href="#855">855</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="856" class="lineNum"><a href="#856">856</a></span><span class="counterCov">2</span><span class="lineCov">    rcv_thread.join().unwrap();</span></div>
<div class="line"><span id="857" class="lineNum"><a href="#857">857</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="858" class="lineNum"><a href="#858">858</a></span><span class="counterCov">2</span><span class="lineCov">    assert!(!received_result.is_err(), &quot;Failed: Error when receiving data&quot;);</span></div>
<div class="line"><span id="859" class="lineNum"><a href="#859">859</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="860" class="lineNum"><a href="#860">860</a></span><span class="counterCov">2</span><span class="lineCov">    let received_data: Vec&lt;DMXData&gt; = received_result.unwrap();</span></div>
<div class="line"><span id="861" class="lineNum"><a href="#861">861</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="862" class="lineNum"><a href="#862">862</a></span><span class="counterCov">2</span><span class="lineCov">    assert_eq!(received_data.len(), 1); // Check only 1 universe received as expected.</span></div>
<div class="line"><span id="863" class="lineNum"><a href="#863">863</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="864" class="lineNum"><a href="#864">864</a></span><span class="counterCov">2</span><span class="lineCov">    let received_universe: DMXData = received_data[0].clone();</span></div>
<div class="line"><span id="865" class="lineNum"><a href="#865">865</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="866" class="lineNum"><a href="#866">866</a></span><span class="counterCov">2</span><span class="lineCov">    assert_eq!(received_universe.universe, universe); // Check that the universe received is as expected.</span></div>
<div class="line"><span id="867" class="lineNum"><a href="#867">867</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="868" class="lineNum"><a href="#868">868</a></span><span class="counterCov">2</span><span class="lineCov">    assert_eq!(received_universe.values, TEST_DATA_SINGLE_ALTERNATIVE_STARTCODE_UNIVERSE.to_vec(), &quot;Received payload values don&#39;t match sent!&quot;);</span></div>
<div class="line"><span id="869" class="lineNum"><a href="#869">869</a></span><span class="counterCov">4</span><span class="lineCov">}</span></div>
<div class="line"><span id="870" class="lineNum"><a href="#870">870</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="871" class="lineNum"><a href="#871">871</a></span><span class="counterUnCov"></span><span class="lineUnCov">/// Note: this test assumes perfect network conditions (0% reordering, loss, duplication etc.), this should be the case for</span></div>
<div class="line"><span id="872" class="lineNum"><a href="#872">872</a></span><span class="counterUnCov"></span><span class="lineUnCov">/// the loopback adapter with the low amount of data sent but this may be a possible cause if integration tests fail unexpectedly.</span></div>
<div class="line"><span id="873" class="lineNum"><a href="#873">873</a></span><span class="counterUnCov"></span><span class="lineUnCov">#[test]</span></div>
<div class="line"><span id="874" class="lineNum"><a href="#874">874</a></span><span class="counterCov">4</span><span class="lineCov">fn test_send_recv_across_universe_multicast_ipv4(){</span></div>
<div class="line"><span id="875" class="lineNum"><a href="#875">875</a></span><span class="counterCov">2</span><span class="lineCov">    let (tx, rx): (Sender&lt;Result&lt;Vec&lt;DMXData&gt;&gt;&gt;, Receiver&lt;Result&lt;Vec&lt;DMXData&gt;&gt;&gt;) = mpsc::channel();</span></div>
<div class="line"><span id="876" class="lineNum"><a href="#876">876</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="877" class="lineNum"><a href="#877">877</a></span><span class="counterCov">2</span><span class="lineCov">    let thread_tx = tx.clone();</span></div>
<div class="line"><span id="878" class="lineNum"><a href="#878">878</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="879" class="lineNum"><a href="#879">879</a></span><span class="counterUnCov"></span><span class="lineUnCov">    const UNIVERSES: [u16; 2] = [2, 3];</span></div>
<div class="line"><span id="880" class="lineNum"><a href="#880">880</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="881" class="lineNum"><a href="#881">881</a></span><span class="counterCov">4</span><span class="lineCov">    let rcv_thread = thread::spawn(move || {</span></div>
<div class="line"><span id="882" class="lineNum"><a href="#882">882</a></span><span class="counterCov">2</span><span class="lineCov">        let mut dmx_recv = SacnReceiver::with_ip(SocketAddr::new(Ipv4Addr::new(0,0,0,0).into(), ACN_SDT_MULTICAST_PORT), None).unwrap();</span></div>
<div class="line"><span id="883" class="lineNum"><a href="#883">883</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="884" class="lineNum"><a href="#884">884</a></span><span class="counterCov">2</span><span class="lineCov">        dmx_recv.listen_universes(&amp;UNIVERSES).unwrap();</span></div>
<div class="line"><span id="885" class="lineNum"><a href="#885">885</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="886" class="lineNum"><a href="#886">886</a></span><span class="counterCov">2</span><span class="lineCov">        thread_tx.send(Ok(Vec::new())).unwrap(); // Signal that the receiver is ready to receive.</span></div>
<div class="line"><span id="887" class="lineNum"><a href="#887">887</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="888" class="lineNum"><a href="#888">888</a></span><span class="counterCov">2</span><span class="lineCov">        thread_tx.send(dmx_recv.recv(None)).unwrap(); // Receive the sync packet, the data packets shouldn&#39;t have caused .recv to return as forced to wait for sync.</span></div>
<div class="line"><span id="889" class="lineNum"><a href="#889">889</a></span><span class="counterCov">2</span><span class="lineCov">    });</span></div>
<div class="line"><span id="890" class="lineNum"><a href="#890">890</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="891" class="lineNum"><a href="#891">891</a></span><span class="counterCov">2</span><span class="lineCov">    let _ = rx.recv().unwrap(); // Blocks until the receiver says it is ready. </span></div>
<div class="line"><span id="892" class="lineNum"><a href="#892">892</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="893" class="lineNum"><a href="#893">893</a></span><span class="counterCov">2</span><span class="lineCov">    let ip: SocketAddr = SocketAddr::new(IpAddr::V4(Ipv4Addr::new(0, 0, 0, 0)), ACN_SDT_MULTICAST_PORT + 1);</span></div>
<div class="line"><span id="894" class="lineNum"><a href="#894">894</a></span><span class="counterCov">2</span><span class="lineCov">    let mut src = SacnSource::with_ip(&quot;Source&quot;, ip).unwrap();</span></div>
<div class="line"><span id="895" class="lineNum"><a href="#895">895</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="896" class="lineNum"><a href="#896">896</a></span><span class="counterCov">2</span><span class="lineCov">    let priority = 100;</span></div>
<div class="line"><span id="897" class="lineNum"><a href="#897">897</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="898" class="lineNum"><a href="#898">898</a></span><span class="counterCov">2</span><span class="lineCov">    src.register_universes(&amp;UNIVERSES).unwrap();</span></div>
<div class="line"><span id="899" class="lineNum"><a href="#899">899</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="900" class="lineNum"><a href="#900">900</a></span><span class="counterCov">2</span><span class="lineCov">    src.send(&amp;UNIVERSES, &amp;TEST_DATA_MULTIPLE_UNIVERSE, Some(priority), None, Some(UNIVERSES[0])).unwrap();</span></div>
<div class="line"><span id="901" class="lineNum"><a href="#901">901</a></span><span class="counterCov">2</span><span class="lineCov">    sleep(Duration::from_millis(500)); // Small delay to allow the data packets to get through as per NSI-E1.31-2018 Appendix B.1 recommendation. See other warnings about the possibility of theses tests failing if the network isn&#39;t perfect.</span></div>
<div class="line"><span id="902" class="lineNum"><a href="#902">902</a></span><span class="counterCov">2</span><span class="lineCov">    src.send_sync_packet(UNIVERSES[0], None).unwrap();</span></div>
<div class="line"><span id="903" class="lineNum"><a href="#903">903</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="904" class="lineNum"><a href="#904">904</a></span><span class="counterCov">2</span><span class="lineCov">    let sync_pkt_res: Result&lt;Vec&lt;DMXData&gt;&gt; = rx.recv().unwrap();</span></div>
<div class="line"><span id="905" class="lineNum"><a href="#905">905</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="906" class="lineNum"><a href="#906">906</a></span><span class="counterCov">2</span><span class="lineCov">    rcv_thread.join().unwrap();</span></div>
<div class="line"><span id="907" class="lineNum"><a href="#907">907</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="908" class="lineNum"><a href="#908">908</a></span><span class="counterCov">2</span><span class="lineCov">    assert!(!sync_pkt_res.is_err(), &quot;Failed: Error when receiving packets&quot;);</span></div>
<div class="line"><span id="909" class="lineNum"><a href="#909">909</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="910" class="lineNum"><a href="#910">910</a></span><span class="counterCov">2</span><span class="lineCov">    let mut received_data: Vec&lt;DMXData&gt; = sync_pkt_res.unwrap();</span></div>
<div class="line"><span id="911" class="lineNum"><a href="#911">911</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="912" class="lineNum"><a href="#912">912</a></span><span class="counterCov">2</span><span class="lineCov">    received_data.sort(); // No guarantee on the ordering of the received data so sort it first to allow easier checking.</span></div>
<div class="line"><span id="913" class="lineNum"><a href="#913">913</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="914" class="lineNum"><a href="#914">914</a></span><span class="counterCov">2</span><span class="lineCov">    assert_eq!(received_data.len(), 2); // Check 2 universes received as expected.</span></div>
<div class="line"><span id="915" class="lineNum"><a href="#915">915</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="916" class="lineNum"><a href="#916">916</a></span><span class="counterCov">2</span><span class="lineCov">    assert_eq!(received_data[0].universe, 2); // Check that the universe received is as expected.</span></div>
<div class="line"><span id="917" class="lineNum"><a href="#917">917</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="918" class="lineNum"><a href="#918">918</a></span><span class="counterCov">2</span><span class="lineCov">    assert_eq!(received_data[0].sync_uni, 2); // Check that the sync universe is as expected.</span></div>
<div class="line"><span id="919" class="lineNum"><a href="#919">919</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="920" class="lineNum"><a href="#920">920</a></span><span class="counterCov">2</span><span class="lineCov">    assert_eq!(received_data[0].values, TEST_DATA_MULTIPLE_UNIVERSE[..UNIVERSE_CHANNEL_CAPACITY].to_vec(), &quot;Universe 1 received payload values don&#39;t match sent!&quot;);</span></div>
<div class="line"><span id="921" class="lineNum"><a href="#921">921</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="922" class="lineNum"><a href="#922">922</a></span><span class="counterCov">2</span><span class="lineCov">    assert_eq!(received_data[1].universe, 3); // Check that the universe received is as expected.</span></div>
<div class="line"><span id="923" class="lineNum"><a href="#923">923</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="924" class="lineNum"><a href="#924">924</a></span><span class="counterCov">2</span><span class="lineCov">    assert_eq!(received_data[1].sync_uni, 2); // Check that the sync universe is as expected.</span></div>
<div class="line"><span id="925" class="lineNum"><a href="#925">925</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="926" class="lineNum"><a href="#926">926</a></span><span class="counterCov">2</span><span class="lineCov">    assert_eq!(received_data[1].values, TEST_DATA_MULTIPLE_UNIVERSE[UNIVERSE_CHANNEL_CAPACITY..].to_vec(), &quot;Universe 2 received payload values don&#39;t match sent!&quot;);</span></div>
<div class="line"><span id="927" class="lineNum"><a href="#927">927</a></span><span class="counterCov">4</span><span class="lineCov">}</span></div>
<div class="line"><span id="928" class="lineNum"><a href="#928">928</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="929" class="lineNum"><a href="#929">929</a></span><span class="counterUnCov"></span><span class="lineUnCov">/// Note: this test assumes perfect network conditions (0% reordering, loss, duplication etc.), this should be the case for</span></div>
<div class="line"><span id="930" class="lineNum"><a href="#930">930</a></span><span class="counterUnCov"></span><span class="lineUnCov">/// the loopback adapter with the low amount of data sent but this may be a possible cause if integration tests fail unexpectedly.</span></div>
<div class="line"><span id="931" class="lineNum"><a href="#931">931</a></span><span class="counterUnCov"></span><span class="lineUnCov">#[test]</span></div>
<div class="line"><span id="932" class="lineNum"><a href="#932">932</a></span><span class="counterCov">4</span><span class="lineCov">fn test_send_recv_across_universe_unicast_ipv4(){</span></div>
<div class="line"><span id="933" class="lineNum"><a href="#933">933</a></span><span class="counterCov">2</span><span class="lineCov">    let (tx, rx): (Sender&lt;Result&lt;Vec&lt;DMXData&gt;&gt;&gt;, Receiver&lt;Result&lt;Vec&lt;DMXData&gt;&gt;&gt;) = mpsc::channel();</span></div>
<div class="line"><span id="934" class="lineNum"><a href="#934">934</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="935" class="lineNum"><a href="#935">935</a></span><span class="counterCov">2</span><span class="lineCov">    let thread_tx = tx.clone();</span></div>
<div class="line"><span id="936" class="lineNum"><a href="#936">936</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="937" class="lineNum"><a href="#937">937</a></span><span class="counterUnCov"></span><span class="lineUnCov">    const UNIVERSES: [u16; 2] = [2, 3];</span></div>
<div class="line"><span id="938" class="lineNum"><a href="#938">938</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="939" class="lineNum"><a href="#939">939</a></span><span class="counterCov">4</span><span class="lineCov">    let rcv_thread = thread::spawn(move || {</span></div>
<div class="line"><span id="940" class="lineNum"><a href="#940">940</a></span><span class="counterCov">2</span><span class="lineCov">        let mut dmx_recv = SacnReceiver::with_ip(SocketAddr::new(Ipv4Addr::new(127,0,0,1).into(), ACN_SDT_MULTICAST_PORT), None).unwrap();</span></div>
<div class="line"><span id="941" class="lineNum"><a href="#941">941</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="942" class="lineNum"><a href="#942">942</a></span><span class="counterCov">2</span><span class="lineCov">        dmx_recv.listen_universes(&amp;UNIVERSES).unwrap();</span></div>
<div class="line"><span id="943" class="lineNum"><a href="#943">943</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="944" class="lineNum"><a href="#944">944</a></span><span class="counterCov">2</span><span class="lineCov">        thread_tx.send(Ok(Vec::new())).unwrap(); // Signal that the receiver is ready to receive.</span></div>
<div class="line"><span id="945" class="lineNum"><a href="#945">945</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="946" class="lineNum"><a href="#946">946</a></span><span class="counterCov">2</span><span class="lineCov">        thread_tx.send(dmx_recv.recv(None)).unwrap(); // Receive the sync packet, the data packets shouldn&#39;t have caused .recv to return as forced to wait for sync.</span></div>
<div class="line"><span id="947" class="lineNum"><a href="#947">947</a></span><span class="counterCov">2</span><span class="lineCov">    });</span></div>
<div class="line"><span id="948" class="lineNum"><a href="#948">948</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="949" class="lineNum"><a href="#949">949</a></span><span class="counterCov">2</span><span class="lineCov">    let _ = rx.recv().unwrap(); // Blocks until the receiver says it is ready. </span></div>
<div class="line"><span id="950" class="lineNum"><a href="#950">950</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="951" class="lineNum"><a href="#951">951</a></span><span class="counterCov">2</span><span class="lineCov">    let ip: SocketAddr = SocketAddr::new(IpAddr::V4(Ipv4Addr::new(127, 0, 0, 1)), ACN_SDT_MULTICAST_PORT + 1);</span></div>
<div class="line"><span id="952" class="lineNum"><a href="#952">952</a></span><span class="counterCov">2</span><span class="lineCov">    let mut src = SacnSource::with_ip(&quot;Source&quot;, ip).unwrap();</span></div>
<div class="line"><span id="953" class="lineNum"><a href="#953">953</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="954" class="lineNum"><a href="#954">954</a></span><span class="counterCov">2</span><span class="lineCov">    let priority = 100;</span></div>
<div class="line"><span id="955" class="lineNum"><a href="#955">955</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="956" class="lineNum"><a href="#956">956</a></span><span class="counterCov">2</span><span class="lineCov">    src.register_universes(&amp;UNIVERSES).unwrap();</span></div>
<div class="line"><span id="957" class="lineNum"><a href="#957">957</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="958" class="lineNum"><a href="#958">958</a></span><span class="counterCov">2</span><span class="lineCov">    let _ = src.send(&amp;UNIVERSES, &amp;TEST_DATA_MULTIPLE_UNIVERSE, Some(priority), Some(SocketAddr::new(Ipv4Addr::new(127,0,0,1).into(), ACN_SDT_MULTICAST_PORT).into()), Some(UNIVERSES[0])).unwrap();</span></div>
<div class="line"><span id="959" class="lineNum"><a href="#959">959</a></span><span class="counterCov">2</span><span class="lineCov">    sleep(Duration::from_millis(500)); // Small delay to allow the data packets to get through as per NSI-E1.31-2018 Appendix B.1 recommendation.</span></div>
<div class="line"><span id="960" class="lineNum"><a href="#960">960</a></span><span class="counterCov">2</span><span class="lineCov">    src.send_sync_packet(UNIVERSES[0], Some(SocketAddr::new(Ipv4Addr::new(127,0,0,1).into(), ACN_SDT_MULTICAST_PORT).into())).unwrap();</span></div>
<div class="line"><span id="961" class="lineNum"><a href="#961">961</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="962" class="lineNum"><a href="#962">962</a></span><span class="counterCov">2</span><span class="lineCov">    let sync_pkt_res: Result&lt;Vec&lt;DMXData&gt;&gt; = rx.recv().unwrap();</span></div>
<div class="line"><span id="963" class="lineNum"><a href="#963">963</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="964" class="lineNum"><a href="#964">964</a></span><span class="counterCov">2</span><span class="lineCov">    rcv_thread.join().unwrap();</span></div>
<div class="line"><span id="965" class="lineNum"><a href="#965">965</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="966" class="lineNum"><a href="#966">966</a></span><span class="counterCov">2</span><span class="lineCov">    assert!(!sync_pkt_res.is_err(), &quot;Failed: Error when receiving packets&quot;);</span></div>
<div class="line"><span id="967" class="lineNum"><a href="#967">967</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="968" class="lineNum"><a href="#968">968</a></span><span class="counterCov">2</span><span class="lineCov">    let mut received_data: Vec&lt;DMXData&gt; = sync_pkt_res.unwrap();</span></div>
<div class="line"><span id="969" class="lineNum"><a href="#969">969</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="970" class="lineNum"><a href="#970">970</a></span><span class="counterCov">2</span><span class="lineCov">    received_data.sort(); // No guarantee on the ordering of the received data so sort it first to allow easier checking.</span></div>
<div class="line"><span id="971" class="lineNum"><a href="#971">971</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="972" class="lineNum"><a href="#972">972</a></span><span class="counterCov">2</span><span class="lineCov">    assert_eq!(received_data.len(), 2); // Check 2 universes received as expected.</span></div>
<div class="line"><span id="973" class="lineNum"><a href="#973">973</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="974" class="lineNum"><a href="#974">974</a></span><span class="counterCov">2</span><span class="lineCov">    assert_eq!(received_data[0].universe, 2); // Check that the universe received is as expected.</span></div>
<div class="line"><span id="975" class="lineNum"><a href="#975">975</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="976" class="lineNum"><a href="#976">976</a></span><span class="counterCov">2</span><span class="lineCov">    assert_eq!(received_data[0].sync_uni, 2); // Check that the sync universe is as expected.</span></div>
<div class="line"><span id="977" class="lineNum"><a href="#977">977</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="978" class="lineNum"><a href="#978">978</a></span><span class="counterCov">2</span><span class="lineCov">    assert_eq!(received_data[0].values, TEST_DATA_MULTIPLE_UNIVERSE[..UNIVERSE_CHANNEL_CAPACITY].to_vec(), &quot;Universe 1 received payload values don&#39;t match sent!&quot;);</span></div>
<div class="line"><span id="979" class="lineNum"><a href="#979">979</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="980" class="lineNum"><a href="#980">980</a></span><span class="counterCov">2</span><span class="lineCov">    assert_eq!(received_data[1].universe, 3); // Check that the universe received is as expected.</span></div>
<div class="line"><span id="981" class="lineNum"><a href="#981">981</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="982" class="lineNum"><a href="#982">982</a></span><span class="counterCov">2</span><span class="lineCov">    assert_eq!(received_data[1].sync_uni, 2); // Check that the sync universe is as expected.</span></div>
<div class="line"><span id="983" class="lineNum"><a href="#983">983</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="984" class="lineNum"><a href="#984">984</a></span><span class="counterCov">2</span><span class="lineCov">    assert_eq!(received_data[1].values, TEST_DATA_MULTIPLE_UNIVERSE[UNIVERSE_CHANNEL_CAPACITY..].to_vec(), &quot;Universe 2 received payload values don&#39;t match sent!&quot;);</span></div>
<div class="line"><span id="985" class="lineNum"><a href="#985">985</a></span><span class="counterCov">4</span><span class="lineCov">}</span></div>
<div class="line"><span id="986" class="lineNum"><a href="#986">986</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="987" class="lineNum"><a href="#987">987</a></span><span class="counterUnCov"></span><span class="lineUnCov">#[test]</span></div>
<div class="line"><span id="988" class="lineNum"><a href="#988">988</a></span><span class="counterCov">4</span><span class="lineCov">fn test_two_senders_one_recv_different_universes_multicast_ipv4(){</span></div>
<div class="line"><span id="989" class="lineNum"><a href="#989">989</a></span><span class="counterCov">2</span><span class="lineCov">    let universe_1 = 1;</span></div>
<div class="line"><span id="990" class="lineNum"><a href="#990">990</a></span><span class="counterCov">2</span><span class="lineCov">    let universe_2 = 2;</span></div>
<div class="line"><span id="991" class="lineNum"><a href="#991">991</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="992" class="lineNum"><a href="#992">992</a></span><span class="counterCov">2</span><span class="lineCov">    let mut dmx_recv = SacnReceiver::with_ip(SocketAddr::new(Ipv4Addr::new(0,0,0,0).into(), ACN_SDT_MULTICAST_PORT), None).unwrap();</span></div>
<div class="line"><span id="993" class="lineNum"><a href="#993">993</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="994" class="lineNum"><a href="#994">994</a></span><span class="counterCov">2</span><span class="lineCov">    dmx_recv.listen_universes(&amp;[universe_1]).unwrap();</span></div>
<div class="line"><span id="995" class="lineNum"><a href="#995">995</a></span><span class="counterCov">2</span><span class="lineCov">    dmx_recv.listen_universes(&amp;[universe_2]).unwrap();</span></div>
<div class="line"><span id="996" class="lineNum"><a href="#996">996</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="997" class="lineNum"><a href="#997">997</a></span><span class="counterCov">4</span><span class="lineCov">    let snd_thread_1 = thread::spawn(move || {</span></div>
<div class="line"><span id="998" class="lineNum"><a href="#998">998</a></span><span class="counterCov">2</span><span class="lineCov">        let ip: SocketAddr = SocketAddr::new(IpAddr::V4(Ipv4Addr::new(0, 0, 0, 0)), ACN_SDT_MULTICAST_PORT + 1);</span></div>
<div class="line"><span id="999" class="lineNum"><a href="#999">999</a></span><span class="counterCov">2</span><span class="lineCov">        let mut src = SacnSource::with_ip(&quot;Source&quot;, ip).unwrap();</span></div>
<div class="line"><span id="1000" class="lineNum"><a href="#1000">1000</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="1001" class="lineNum"><a href="#1001">1001</a></span><span class="counterCov">2</span><span class="lineCov">        let priority = 100;</span></div>
<div class="line"><span id="1002" class="lineNum"><a href="#1002">1002</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="1003" class="lineNum"><a href="#1003">1003</a></span><span class="counterCov">2</span><span class="lineCov">        src.register_universe(universe_1).unwrap();</span></div>
<div class="line"><span id="1004" class="lineNum"><a href="#1004">1004</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="1005" class="lineNum"><a href="#1005">1005</a></span><span class="counterCov">2</span><span class="lineCov">        let _ = src.send(&amp;[universe_1], &amp;TEST_DATA_SINGLE_UNIVERSE, Some(priority), None, None).unwrap();</span></div>
<div class="line"><span id="1006" class="lineNum"><a href="#1006">1006</a></span><span class="counterCov">2</span><span class="lineCov">    });</span></div>
<div class="line"><span id="1007" class="lineNum"><a href="#1007">1007</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="1008" class="lineNum"><a href="#1008">1008</a></span><span class="counterCov">4</span><span class="lineCov">    let snd_thread_2 = thread::spawn(move || {</span></div>
<div class="line"><span id="1009" class="lineNum"><a href="#1009">1009</a></span><span class="counterCov">2</span><span class="lineCov">        let ip: SocketAddr = SocketAddr::new(IpAddr::V4(Ipv4Addr::new(0, 0, 0, 0)), ACN_SDT_MULTICAST_PORT + 2);</span></div>
<div class="line"><span id="1010" class="lineNum"><a href="#1010">1010</a></span><span class="counterCov">2</span><span class="lineCov">        let mut src = SacnSource::with_ip(&quot;Source&quot;, ip).unwrap();</span></div>
<div class="line"><span id="1011" class="lineNum"><a href="#1011">1011</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="1012" class="lineNum"><a href="#1012">1012</a></span><span class="counterCov">2</span><span class="lineCov">        let priority = 100;</span></div>
<div class="line"><span id="1013" class="lineNum"><a href="#1013">1013</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="1014" class="lineNum"><a href="#1014">1014</a></span><span class="counterCov">2</span><span class="lineCov">        src.register_universe(universe_2).unwrap();</span></div>
<div class="line"><span id="1015" class="lineNum"><a href="#1015">1015</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="1016" class="lineNum"><a href="#1016">1016</a></span><span class="counterCov">2</span><span class="lineCov">        let _ = src.send(&amp;[universe_2], &amp;TEST_DATA_PARTIAL_CAPACITY_UNIVERSE, Some(priority), None, None).unwrap();</span></div>
<div class="line"><span id="1017" class="lineNum"><a href="#1017">1017</a></span><span class="counterCov">2</span><span class="lineCov">    });</span></div>
<div class="line"><span id="1018" class="lineNum"><a href="#1018">1018</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="1019" class="lineNum"><a href="#1019">1019</a></span><span class="counterCov">2</span><span class="lineCov">    let res1: Vec&lt;DMXData&gt; = dmx_recv.recv(None).unwrap();</span></div>
<div class="line"><span id="1020" class="lineNum"><a href="#1020">1020</a></span><span class="counterCov">2</span><span class="lineCov">    let res2: Vec&lt;DMXData&gt; = dmx_recv.recv(None).unwrap();</span></div>
<div class="line"><span id="1021" class="lineNum"><a href="#1021">1021</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="1022" class="lineNum"><a href="#1022">1022</a></span><span class="counterCov">2</span><span class="lineCov">    snd_thread_1.join().unwrap();</span></div>
<div class="line"><span id="1023" class="lineNum"><a href="#1023">1023</a></span><span class="counterCov">2</span><span class="lineCov">    snd_thread_2.join().unwrap();</span></div>
<div class="line"><span id="1024" class="lineNum"><a href="#1024">1024</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="1025" class="lineNum"><a href="#1025">1025</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="1026" class="lineNum"><a href="#1026">1026</a></span><span class="counterCov">2</span><span class="lineCov">    assert_eq!(res1.len(), 1);</span></div>
<div class="line"><span id="1027" class="lineNum"><a href="#1027">1027</a></span><span class="counterCov">2</span><span class="lineCov">    assert_eq!(res2.len(), 1);</span></div>
<div class="line"><span id="1028" class="lineNum"><a href="#1028">1028</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="1029" class="lineNum"><a href="#1029">1029</a></span><span class="counterCov">2</span><span class="lineCov">    let mut res = vec![res1[0].clone(), res2[0].clone()];</span></div>
<div class="line"><span id="1030" class="lineNum"><a href="#1030">1030</a></span><span class="counterCov">2</span><span class="lineCov">    res.sort_unstable();</span></div>
<div class="line"><span id="1031" class="lineNum"><a href="#1031">1031</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="1032" class="lineNum"><a href="#1032">1032</a></span><span class="counterCov">2</span><span class="lineCov">    assert_eq!(res[0].universe, universe_1);</span></div>
<div class="line"><span id="1033" class="lineNum"><a href="#1033">1033</a></span><span class="counterCov">2</span><span class="lineCov">    assert_eq!(res[1].universe, universe_2);</span></div>
<div class="line"><span id="1034" class="lineNum"><a href="#1034">1034</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="1035" class="lineNum"><a href="#1035">1035</a></span><span class="counterCov">2</span><span class="lineCov">    assert_eq!(res[0].values, TEST_DATA_SINGLE_UNIVERSE.to_vec());</span></div>
<div class="line"><span id="1036" class="lineNum"><a href="#1036">1036</a></span><span class="counterCov">2</span><span class="lineCov">    assert_eq!(res[1].values, TEST_DATA_PARTIAL_CAPACITY_UNIVERSE.to_vec());</span></div>
<div class="line"><span id="1037" class="lineNum"><a href="#1037">1037</a></span><span class="counterCov">4</span><span class="lineCov">}</span></div>
<div class="line"><span id="1038" class="lineNum"><a href="#1038">1038</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="1039" class="lineNum"><a href="#1039">1039</a></span><span class="counterUnCov"></span><span class="lineUnCov">#[test]</span></div>
<div class="line"><span id="1040" class="lineNum"><a href="#1040">1040</a></span><span class="counterCov">4</span><span class="lineCov">fn test_two_senders_one_recv_same_universe_no_sync_multicast_ipv4(){</span></div>
<div class="line"><span id="1041" class="lineNum"><a href="#1041">1041</a></span><span class="counterCov">2</span><span class="lineCov">    let universe = 1;</span></div>
<div class="line"><span id="1042" class="lineNum"><a href="#1042">1042</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="1043" class="lineNum"><a href="#1043">1043</a></span><span class="counterCov">2</span><span class="lineCov">    let mut dmx_recv = SacnReceiver::with_ip(SocketAddr::new(Ipv4Addr::new(0,0,0,0).into(), ACN_SDT_MULTICAST_PORT), None).unwrap();</span></div>
<div class="line"><span id="1044" class="lineNum"><a href="#1044">1044</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="1045" class="lineNum"><a href="#1045">1045</a></span><span class="counterCov">2</span><span class="lineCov">    dmx_recv.listen_universes(&amp;[universe]).unwrap();</span></div>
<div class="line"><span id="1046" class="lineNum"><a href="#1046">1046</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="1047" class="lineNum"><a href="#1047">1047</a></span><span class="counterCov">4</span><span class="lineCov">    let snd_thread_1 = thread::spawn(move || {</span></div>
<div class="line"><span id="1048" class="lineNum"><a href="#1048">1048</a></span><span class="counterCov">2</span><span class="lineCov">        let ip: SocketAddr = SocketAddr::new(IpAddr::V4(Ipv4Addr::new(0, 0, 0, 0)), ACN_SDT_MULTICAST_PORT + 1);</span></div>
<div class="line"><span id="1049" class="lineNum"><a href="#1049">1049</a></span><span class="counterCov">2</span><span class="lineCov">        let mut src = SacnSource::with_ip(&quot;Source&quot;, ip).unwrap();</span></div>
<div class="line"><span id="1050" class="lineNum"><a href="#1050">1050</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="1051" class="lineNum"><a href="#1051">1051</a></span><span class="counterCov">2</span><span class="lineCov">        let priority = 100;</span></div>
<div class="line"><span id="1052" class="lineNum"><a href="#1052">1052</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="1053" class="lineNum"><a href="#1053">1053</a></span><span class="counterCov">2</span><span class="lineCov">        src.register_universe(universe).unwrap();</span></div>
<div class="line"><span id="1054" class="lineNum"><a href="#1054">1054</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="1055" class="lineNum"><a href="#1055">1055</a></span><span class="counterCov">2</span><span class="lineCov">        let _ = src.send(&amp;[universe], &amp;TEST_DATA_SINGLE_UNIVERSE, Some(priority), None, None).unwrap();</span></div>
<div class="line"><span id="1056" class="lineNum"><a href="#1056">1056</a></span><span class="counterCov">2</span><span class="lineCov">    });</span></div>
<div class="line"><span id="1057" class="lineNum"><a href="#1057">1057</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="1058" class="lineNum"><a href="#1058">1058</a></span><span class="counterCov">4</span><span class="lineCov">    let snd_thread_2 = thread::spawn(move || {</span></div>
<div class="line"><span id="1059" class="lineNum"><a href="#1059">1059</a></span><span class="counterCov">2</span><span class="lineCov">        let ip: SocketAddr = SocketAddr::new(IpAddr::V4(Ipv4Addr::new(0, 0, 0, 0)), ACN_SDT_MULTICAST_PORT + 2);</span></div>
<div class="line"><span id="1060" class="lineNum"><a href="#1060">1060</a></span><span class="counterCov">2</span><span class="lineCov">        let mut src = SacnSource::with_ip(&quot;Source&quot;, ip).unwrap();</span></div>
<div class="line"><span id="1061" class="lineNum"><a href="#1061">1061</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="1062" class="lineNum"><a href="#1062">1062</a></span><span class="counterCov">2</span><span class="lineCov">        let priority = 100;</span></div>
<div class="line"><span id="1063" class="lineNum"><a href="#1063">1063</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="1064" class="lineNum"><a href="#1064">1064</a></span><span class="counterCov">2</span><span class="lineCov">        src.register_universe(universe).unwrap();</span></div>
<div class="line"><span id="1065" class="lineNum"><a href="#1065">1065</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="1066" class="lineNum"><a href="#1066">1066</a></span><span class="counterCov">2</span><span class="lineCov">        let _ = src.send(&amp;[universe], &amp;TEST_DATA_PARTIAL_CAPACITY_UNIVERSE, Some(priority), None, None).unwrap();</span></div>
<div class="line"><span id="1067" class="lineNum"><a href="#1067">1067</a></span><span class="counterCov">2</span><span class="lineCov">    });</span></div>
<div class="line"><span id="1068" class="lineNum"><a href="#1068">1068</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="1069" class="lineNum"><a href="#1069">1069</a></span><span class="counterCov">2</span><span class="lineCov">    let res1: Vec&lt;DMXData&gt; = dmx_recv.recv(None).unwrap();</span></div>
<div class="line"><span id="1070" class="lineNum"><a href="#1070">1070</a></span><span class="counterCov">2</span><span class="lineCov">    let res2: Vec&lt;DMXData&gt; = dmx_recv.recv(None).unwrap();</span></div>
<div class="line"><span id="1071" class="lineNum"><a href="#1071">1071</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="1072" class="lineNum"><a href="#1072">1072</a></span><span class="counterCov">2</span><span class="lineCov">    snd_thread_1.join().unwrap();</span></div>
<div class="line"><span id="1073" class="lineNum"><a href="#1073">1073</a></span><span class="counterCov">2</span><span class="lineCov">    snd_thread_2.join().unwrap();</span></div>
<div class="line"><span id="1074" class="lineNum"><a href="#1074">1074</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="1075" class="lineNum"><a href="#1075">1075</a></span><span class="counterCov">2</span><span class="lineCov">    assert_eq!(res1.len(), 1);</span></div>
<div class="line"><span id="1076" class="lineNum"><a href="#1076">1076</a></span><span class="counterCov">2</span><span class="lineCov">    assert_eq!(res2.len(), 1);</span></div>
<div class="line"><span id="1077" class="lineNum"><a href="#1077">1077</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="1078" class="lineNum"><a href="#1078">1078</a></span><span class="counterCov">2</span><span class="lineCov">    let res = vec![res1[0].clone(), res2[0].clone()];</span></div>
<div class="line"><span id="1079" class="lineNum"><a href="#1079">1079</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="1080" class="lineNum"><a href="#1080">1080</a></span><span class="counterCov">2</span><span class="lineCov">    assert_eq!(res[0].universe, universe);</span></div>
<div class="line"><span id="1081" class="lineNum"><a href="#1081">1081</a></span><span class="counterCov">2</span><span class="lineCov">    assert_eq!(res[1].universe, universe);</span></div>
<div class="line"><span id="1082" class="lineNum"><a href="#1082">1082</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="1083" class="lineNum"><a href="#1083">1083</a></span><span class="counterCov">4</span><span class="lineCov">    if res[0].values == TEST_DATA_SINGLE_UNIVERSE.to_vec() {</span></div>
<div class="line"><span id="1084" class="lineNum"><a href="#1084">1084</a></span><span class="counterCov">1</span><span class="lineCov">        assert_eq!(res[1].values, TEST_DATA_PARTIAL_CAPACITY_UNIVERSE.to_vec());</span></div>
<div class="line"><span id="1085" class="lineNum"><a href="#1085">1085</a></span><span class="counterUnCov"></span><span class="lineUnCov">    } else {</span></div>
<div class="line"><span id="1086" class="lineNum"><a href="#1086">1086</a></span><span class="counterCov">1</span><span class="lineCov">        assert_eq!(res[0].values, TEST_DATA_PARTIAL_CAPACITY_UNIVERSE.to_vec());</span></div>
<div class="line"><span id="1087" class="lineNum"><a href="#1087">1087</a></span><span class="counterCov">1</span><span class="lineCov">        assert_eq!(res[1].values, TEST_DATA_SINGLE_UNIVERSE.to_vec());</span></div>
<div class="line"><span id="1088" class="lineNum"><a href="#1088">1088</a></span><span class="counterUnCov"></span><span class="lineUnCov">    }</span></div>
<div class="line"><span id="1089" class="lineNum"><a href="#1089">1089</a></span><span class="counterCov">4</span><span class="lineCov">}</span></div>
<div class="line"><span id="1090" class="lineNum"><a href="#1090">1090</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="1091" class="lineNum"><a href="#1091">1091</a></span><span class="counterUnCov"></span><span class="lineUnCov">#[test]</span></div>
<div class="line"><span id="1092" class="lineNum"><a href="#1092">1092</a></span><span class="counterCov">4</span><span class="lineCov">fn test_two_senders_one_recv_same_universe_custom_merge_fn_sync_multicast_ipv4(){</span></div>
<div class="line"><span id="1093" class="lineNum"><a href="#1093">1093</a></span><span class="counterCov">2</span><span class="lineCov">    let (tx, rx): (SyncSender&lt;()&gt;, Receiver&lt;()&gt;) = mpsc::sync_channel(0); // Used for handshaking</span></div>
<div class="line"><span id="1094" class="lineNum"><a href="#1094">1094</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="1095" class="lineNum"><a href="#1095">1095</a></span><span class="counterCov">2</span><span class="lineCov">    let snd_tx = tx.clone();</span></div>
<div class="line"><span id="1096" class="lineNum"><a href="#1096">1096</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="1097" class="lineNum"><a href="#1097">1097</a></span><span class="counterCov">2</span><span class="lineCov">    let universe = 1;</span></div>
<div class="line"><span id="1098" class="lineNum"><a href="#1098">1098</a></span><span class="counterCov">2</span><span class="lineCov">    let sync_uni = 2;</span></div>
<div class="line"><span id="1099" class="lineNum"><a href="#1099">1099</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="1100" class="lineNum"><a href="#1100">1100</a></span><span class="counterCov">2</span><span class="lineCov">    let mut dmx_recv = SacnReceiver::with_ip(SocketAddr::new(TEST_NETWORK_INTERFACE_IPV4[0].parse().unwrap(), ACN_SDT_MULTICAST_PORT), None).unwrap();</span></div>
<div class="line"><span id="1101" class="lineNum"><a href="#1101">1101</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="1102" class="lineNum"><a href="#1102">1102</a></span><span class="counterCov">2</span><span class="lineCov">    dmx_recv.listen_universes(&amp;[universe, sync_uni]).unwrap();</span></div>
<div class="line"><span id="1103" class="lineNum"><a href="#1103">1103</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="1104" class="lineNum"><a href="#1104">1104</a></span><span class="counterCov">2</span><span class="lineCov">    dmx_recv.set_merge_fn(htp_dmx_merge).unwrap();</span></div>
<div class="line"><span id="1105" class="lineNum"><a href="#1105">1105</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="1106" class="lineNum"><a href="#1106">1106</a></span><span class="counterCov">4</span><span class="lineCov">    let snd_thread_1 = thread::spawn(move || {</span></div>
<div class="line"><span id="1107" class="lineNum"><a href="#1107">1107</a></span><span class="counterCov">2</span><span class="lineCov">        let ip: SocketAddr = SocketAddr::new(IpAddr::V4(TEST_NETWORK_INTERFACE_IPV4[1].parse().unwrap()), ACN_SDT_MULTICAST_PORT + 1);</span></div>
<div class="line"><span id="1108" class="lineNum"><a href="#1108">1108</a></span><span class="counterCov">2</span><span class="lineCov">        let mut src = SacnSource::with_ip(&quot;Source&quot;, ip).unwrap();</span></div>
<div class="line"><span id="1109" class="lineNum"><a href="#1109">1109</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="1110" class="lineNum"><a href="#1110">1110</a></span><span class="counterCov">2</span><span class="lineCov">        let priority = 100;</span></div>
<div class="line"><span id="1111" class="lineNum"><a href="#1111">1111</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="1112" class="lineNum"><a href="#1112">1112</a></span><span class="counterCov">2</span><span class="lineCov">        src.register_universe(universe).unwrap();</span></div>
<div class="line"><span id="1113" class="lineNum"><a href="#1113">1113</a></span><span class="counterCov">2</span><span class="lineCov">        src.register_universe(sync_uni).unwrap();</span></div>
<div class="line"><span id="1114" class="lineNum"><a href="#1114">1114</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="1115" class="lineNum"><a href="#1115">1115</a></span><span class="counterCov">2</span><span class="lineCov">        src.send(&amp;[universe], &amp;TEST_DATA_SINGLE_UNIVERSE, Some(priority), None, Some(sync_uni)).unwrap();</span></div>
<div class="line"><span id="1116" class="lineNum"><a href="#1116">1116</a></span><span class="counterCov">2</span><span class="lineCov">        snd_tx.send(()).unwrap();</span></div>
<div class="line"><span id="1117" class="lineNum"><a href="#1117">1117</a></span><span class="counterCov">2</span><span class="lineCov">    });</span></div>
<div class="line"><span id="1118" class="lineNum"><a href="#1118">1118</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="1119" class="lineNum"><a href="#1119">1119</a></span><span class="counterCov">4</span><span class="lineCov">    let snd_thread_2 = thread::spawn(move || {</span></div>
<div class="line"><span id="1120" class="lineNum"><a href="#1120">1120</a></span><span class="counterCov">2</span><span class="lineCov">        let ip: SocketAddr = SocketAddr::new(IpAddr::V4(TEST_NETWORK_INTERFACE_IPV4[2].parse().unwrap()), ACN_SDT_MULTICAST_PORT + 2);</span></div>
<div class="line"><span id="1121" class="lineNum"><a href="#1121">1121</a></span><span class="counterCov">2</span><span class="lineCov">        let mut src = SacnSource::with_ip(&quot;Source 2&quot;, ip).unwrap();</span></div>
<div class="line"><span id="1122" class="lineNum"><a href="#1122">1122</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="1123" class="lineNum"><a href="#1123">1123</a></span><span class="counterCov">2</span><span class="lineCov">        let priority = 100;</span></div>
<div class="line"><span id="1124" class="lineNum"><a href="#1124">1124</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="1125" class="lineNum"><a href="#1125">1125</a></span><span class="counterCov">2</span><span class="lineCov">        src.register_universe(universe).unwrap();</span></div>
<div class="line"><span id="1126" class="lineNum"><a href="#1126">1126</a></span><span class="counterCov">2</span><span class="lineCov">        src.register_universe(sync_uni).unwrap();</span></div>
<div class="line"><span id="1127" class="lineNum"><a href="#1127">1127</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="1128" class="lineNum"><a href="#1128">1128</a></span><span class="counterCov">2</span><span class="lineCov">        src.send(&amp;[universe], &amp;TEST_DATA_PARTIAL_CAPACITY_UNIVERSE, Some(priority), None, Some(sync_uni)).unwrap();</span></div>
<div class="line"><span id="1129" class="lineNum"><a href="#1129">1129</a></span><span class="counterCov">2</span><span class="lineCov">        rx.recv().unwrap(); // Must only send once both threads have sent for this test to test what happens in that situation (where there will be a merge).</span></div>
<div class="line"><span id="1130" class="lineNum"><a href="#1130">1130</a></span><span class="counterCov">2</span><span class="lineCov">        src.send_sync_packet(sync_uni, None).unwrap();</span></div>
<div class="line"><span id="1131" class="lineNum"><a href="#1131">1131</a></span><span class="counterCov">2</span><span class="lineCov">    });</span></div>
<div class="line"><span id="1132" class="lineNum"><a href="#1132">1132</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="1133" class="lineNum"><a href="#1133">1133</a></span><span class="counterCov">2</span><span class="lineCov">    let res1: Vec&lt;DMXData&gt; = dmx_recv.recv(None).unwrap();</span></div>
<div class="line"><span id="1134" class="lineNum"><a href="#1134">1134</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="1135" class="lineNum"><a href="#1135">1135</a></span><span class="counterCov">2</span><span class="lineCov">    snd_thread_1.join().unwrap();</span></div>
<div class="line"><span id="1136" class="lineNum"><a href="#1136">1136</a></span><span class="counterCov">2</span><span class="lineCov">    snd_thread_2.join().unwrap();</span></div>
<div class="line"><span id="1137" class="lineNum"><a href="#1137">1137</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="1138" class="lineNum"><a href="#1138">1138</a></span><span class="counterCov">2</span><span class="lineCov">    assert_eq!(res1.len(), 1);</span></div>
<div class="line"><span id="1139" class="lineNum"><a href="#1139">1139</a></span><span class="counterCov">6</span><span class="lineCov">    assert_eq!(res1[0].values, htp_dmx_merge(&amp;DMXData {</span></div>
<div class="line"><span id="1140" class="lineNum"><a href="#1140">1140</a></span><span class="counterUnCov"></span><span class="lineUnCov">        universe: universe,</span></div>
<div class="line"><span id="1141" class="lineNum"><a href="#1141">1141</a></span><span class="counterCov">2</span><span class="lineCov">        values: TEST_DATA_SINGLE_UNIVERSE.to_vec(),</span></div>
<div class="line"><span id="1142" class="lineNum"><a href="#1142">1142</a></span><span class="counterUnCov"></span><span class="lineUnCov">        sync_uni: sync_uni,</span></div>
<div class="line"><span id="1143" class="lineNum"><a href="#1143">1143</a></span><span class="counterUnCov"></span><span class="lineUnCov">        priority: 100,</span></div>
<div class="line"><span id="1144" class="lineNum"><a href="#1144">1144</a></span><span class="counterCov">2</span><span class="lineCov">        src_cid: None,</span></div>
<div class="line"><span id="1145" class="lineNum"><a href="#1145">1145</a></span><span class="counterUnCov"></span><span class="lineUnCov">        preview: false,</span></div>
<div class="line"><span id="1146" class="lineNum"><a href="#1146">1146</a></span><span class="counterCov">2</span><span class="lineCov">        recv_timestamp: Instant::now()</span></div>
<div class="line"><span id="1147" class="lineNum"><a href="#1147">1147</a></span><span class="counterUnCov"></span><span class="lineUnCov">    },</span></div>
<div class="line"><span id="1148" class="lineNum"><a href="#1148">1148</a></span><span class="counterCov">2</span><span class="lineCov">    &amp;DMXData {</span></div>
<div class="line"><span id="1149" class="lineNum"><a href="#1149">1149</a></span><span class="counterUnCov"></span><span class="lineUnCov">        universe: universe,</span></div>
<div class="line"><span id="1150" class="lineNum"><a href="#1150">1150</a></span><span class="counterCov">2</span><span class="lineCov">        values: TEST_DATA_PARTIAL_CAPACITY_UNIVERSE.to_vec(),</span></div>
<div class="line"><span id="1151" class="lineNum"><a href="#1151">1151</a></span><span class="counterUnCov"></span><span class="lineUnCov">        sync_uni: sync_uni,</span></div>
<div class="line"><span id="1152" class="lineNum"><a href="#1152">1152</a></span><span class="counterUnCov"></span><span class="lineUnCov">        priority: 100,</span></div>
<div class="line"><span id="1153" class="lineNum"><a href="#1153">1153</a></span><span class="counterCov">2</span><span class="lineCov">        src_cid: None,</span></div>
<div class="line"><span id="1154" class="lineNum"><a href="#1154">1154</a></span><span class="counterUnCov"></span><span class="lineUnCov">        preview: false,</span></div>
<div class="line"><span id="1155" class="lineNum"><a href="#1155">1155</a></span><span class="counterCov">2</span><span class="lineCov">        recv_timestamp: Instant::now()</span></div>
<div class="line"><span id="1156" class="lineNum"><a href="#1156">1156</a></span><span class="counterUnCov"></span><span class="lineUnCov">    },).unwrap().values);</span></div>
<div class="line"><span id="1157" class="lineNum"><a href="#1157">1157</a></span><span class="counterCov">4</span><span class="lineCov">}</span></div>
<div class="line"><span id="1158" class="lineNum"><a href="#1158">1158</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="1159" class="lineNum"><a href="#1159">1159</a></span><span class="counterUnCov"></span><span class="lineUnCov">#[test]</span></div>
<div class="line"><span id="1160" class="lineNum"><a href="#1160">1160</a></span><span class="counterCov">4</span><span class="lineCov">fn test_two_senders_two_recv_multicast_ipv4(){</span></div>
<div class="line"><span id="1161" class="lineNum"><a href="#1161">1161</a></span><span class="counterUnCov"></span><span class="lineUnCov">    const SND_THREADS: usize = 2;</span></div>
<div class="line"><span id="1162" class="lineNum"><a href="#1162">1162</a></span><span class="counterUnCov"></span><span class="lineUnCov">    const RCV_THREADS: usize = 2;</span></div>
<div class="line"><span id="1163" class="lineNum"><a href="#1163">1163</a></span><span class="counterUnCov"></span><span class="lineUnCov">    const SND_DATA_LEN: usize = 100;</span></div>
<div class="line"><span id="1164" class="lineNum"><a href="#1164">1164</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="1165" class="lineNum"><a href="#1165">1165</a></span><span class="counterCov">2</span><span class="lineCov">    let mut snd_data: Vec&lt;Vec&lt;u8&gt;&gt; = Vec::new();</span></div>
<div class="line"><span id="1166" class="lineNum"><a href="#1166">1166</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="1167" class="lineNum"><a href="#1167">1167</a></span><span class="counterCov">6</span><span class="lineCov">    for i in 1 .. SND_THREADS + 1 {</span></div>
<div class="line"><span id="1168" class="lineNum"><a href="#1168">1168</a></span><span class="counterCov">4</span><span class="lineCov">        let mut d: Vec&lt;u8&gt; = Vec::new();</span></div>
<div class="line"><span id="1169" class="lineNum"><a href="#1169">1169</a></span><span class="counterCov">404</span><span class="lineCov">        for _k in 0 .. SND_DATA_LEN {</span></div>
<div class="line"><span id="1170" class="lineNum"><a href="#1170">1170</a></span><span class="counterCov">400</span><span class="lineCov">            d.push(i as u8);</span></div>
<div class="line"><span id="1171" class="lineNum"><a href="#1171">1171</a></span><span class="counterUnCov"></span><span class="lineUnCov">        }</span></div>
<div class="line"><span id="1172" class="lineNum"><a href="#1172">1172</a></span><span class="counterCov">4</span><span class="lineCov">        snd_data.push(d);</span></div>
<div class="line"><span id="1173" class="lineNum"><a href="#1173">1173</a></span><span class="counterUnCov"></span><span class="lineUnCov">    }</span></div>
<div class="line"><span id="1174" class="lineNum"><a href="#1174">1174</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="1175" class="lineNum"><a href="#1175">1175</a></span><span class="counterCov">2</span><span class="lineCov">    let mut snd_threads = Vec::new();</span></div>
<div class="line"><span id="1176" class="lineNum"><a href="#1176">1176</a></span><span class="counterCov">2</span><span class="lineCov">    let mut rcv_threads = Vec::new();</span></div>
<div class="line"><span id="1177" class="lineNum"><a href="#1177">1177</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="1178" class="lineNum"><a href="#1178">1178</a></span><span class="counterCov">2</span><span class="lineCov">    let (rcv_tx, rcv_rx): (SyncSender&lt;Vec&lt;Result&lt;Vec&lt;DMXData&gt;&gt;&gt;&gt;, Receiver&lt;Vec&lt;Result&lt;Vec&lt;DMXData&gt;&gt;&gt;&gt;) = mpsc::sync_channel(0);</span></div>
<div class="line"><span id="1179" class="lineNum"><a href="#1179">1179</a></span><span class="counterCov">2</span><span class="lineCov">    let (snd_tx, snd_rx): (SyncSender&lt;()&gt;, Receiver&lt;()&gt;) = mpsc::sync_channel(0); // Used for handshaking, allows syncing the sender states.</span></div>
<div class="line"><span id="1180" class="lineNum"><a href="#1180">1180</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="1181" class="lineNum"><a href="#1181">1181</a></span><span class="counterCov">2</span><span class="lineCov">    assert!(RCV_THREADS &lt;= TEST_NETWORK_INTERFACE_IPV4.len(), &quot;Number of test network interface ips less than number of recv threads!&quot;);</span></div>
<div class="line"><span id="1182" class="lineNum"><a href="#1182">1182</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="1183" class="lineNum"><a href="#1183">1183</a></span><span class="counterUnCov"></span><span class="lineUnCov">    const BASE_UNIVERSE: u16 = 2;</span></div>
<div class="line"><span id="1184" class="lineNum"><a href="#1184">1184</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="1185" class="lineNum"><a href="#1185">1185</a></span><span class="counterCov">6</span><span class="lineCov">    for i in 0 .. SND_THREADS {</span></div>
<div class="line"><span id="1186" class="lineNum"><a href="#1186">1186</a></span><span class="counterCov">4</span><span class="lineCov">        let tx = snd_tx.clone();</span></div>
<div class="line"><span id="1187" class="lineNum"><a href="#1187">1187</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="1188" class="lineNum"><a href="#1188">1188</a></span><span class="counterCov">4</span><span class="lineCov">        let data = snd_data[i].clone();</span></div>
<div class="line"><span id="1189" class="lineNum"><a href="#1189">1189</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="1190" class="lineNum"><a href="#1190">1190</a></span><span class="counterCov">8</span><span class="lineCov">        snd_threads.push(thread::spawn(move || {</span></div>
<div class="line"><span id="1191" class="lineNum"><a href="#1191">1191</a></span><span class="counterCov">4</span><span class="lineCov">            let ip: SocketAddr = SocketAddr::new(IpAddr::V4(TEST_NETWORK_INTERFACE_IPV4[0].parse().unwrap()), ACN_SDT_MULTICAST_PORT + 1 + (i as u16));</span></div>
<div class="line"><span id="1192" class="lineNum"><a href="#1192">1192</a></span><span class="counterUnCov"></span><span class="lineUnCov">            // https://www.programming-idioms.org/idiom/153/concatenate-string-with-integer/1975/rust (11/01/2020)</span></div>
<div class="line"><span id="1193" class="lineNum"><a href="#1193">1193</a></span><span class="counterCov">4</span><span class="lineCov">            let mut src = SacnSource::with_ip(&amp;format!(&quot;Source {}&quot;, i), ip).unwrap();</span></div>
<div class="line"><span id="1194" class="lineNum"><a href="#1194">1194</a></span><span class="counterUnCov"></span><span class="lineUnCov">    </span></div>
<div class="line"><span id="1195" class="lineNum"><a href="#1195">1195</a></span><span class="counterCov">4</span><span class="lineCov">            let priority = 100;</span></div>
<div class="line"><span id="1196" class="lineNum"><a href="#1196">1196</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="1197" class="lineNum"><a href="#1197">1197</a></span><span class="counterCov">4</span><span class="lineCov">            let universe: u16 = (i as u16) + BASE_UNIVERSE; </span></div>
<div class="line"><span id="1198" class="lineNum"><a href="#1198">1198</a></span><span class="counterUnCov"></span><span class="lineUnCov">    </span></div>
<div class="line"><span id="1199" class="lineNum"><a href="#1199">1199</a></span><span class="counterCov">4</span><span class="lineCov">            src.register_universe(universe).unwrap(); // Senders all send on different universes.</span></div>
<div class="line"><span id="1200" class="lineNum"><a href="#1200">1200</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="1201" class="lineNum"><a href="#1201">1201</a></span><span class="counterCov">4</span><span class="lineCov">            tx.send(()).unwrap(); // Forces each sender thread to wait till the controlling thread receives which stops sending before the receivers are ready.</span></div>
<div class="line"><span id="1202" class="lineNum"><a href="#1202">1202</a></span><span class="counterUnCov"></span><span class="lineUnCov">    </span></div>
<div class="line"><span id="1203" class="lineNum"><a href="#1203">1203</a></span><span class="counterCov">4</span><span class="lineCov">            src.send(&amp;[universe], &amp;data, Some(priority), None, None).unwrap();</span></div>
<div class="line"><span id="1204" class="lineNum"><a href="#1204">1204</a></span><span class="counterCov">4</span><span class="lineCov">        }));</span></div>
<div class="line"><span id="1205" class="lineNum"><a href="#1205">1205</a></span><span class="counterUnCov"></span><span class="lineUnCov">    }</span></div>
<div class="line"><span id="1206" class="lineNum"><a href="#1206">1206</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="1207" class="lineNum"><a href="#1207">1207</a></span><span class="counterCov">6</span><span class="lineCov">    for i in 0 .. RCV_THREADS {</span></div>
<div class="line"><span id="1208" class="lineNum"><a href="#1208">1208</a></span><span class="counterCov">4</span><span class="lineCov">        let tx = rcv_tx.clone();</span></div>
<div class="line"><span id="1209" class="lineNum"><a href="#1209">1209</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="1210" class="lineNum"><a href="#1210">1210</a></span><span class="counterCov">8</span><span class="lineCov">        rcv_threads.push(thread::spawn(move || {</span></div>
<div class="line"><span id="1211" class="lineNum"><a href="#1211">1211</a></span><span class="counterUnCov"></span><span class="lineUnCov">            // Port kept the same so must use multiple IP&#39;s.</span></div>
<div class="line"><span id="1212" class="lineNum"><a href="#1212">1212</a></span><span class="counterCov">4</span><span class="lineCov">            let mut dmx_recv = SacnReceiver::with_ip(SocketAddr::new(IpAddr::V4(TEST_NETWORK_INTERFACE_IPV4[i].parse().unwrap()), ACN_SDT_MULTICAST_PORT), None).unwrap();</span></div>
<div class="line"><span id="1213" class="lineNum"><a href="#1213">1213</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="1214" class="lineNum"><a href="#1214">1214</a></span><span class="counterUnCov"></span><span class="lineUnCov">            // Receivers listen to all universes</span></div>
<div class="line"><span id="1215" class="lineNum"><a href="#1215">1215</a></span><span class="counterCov">12</span><span class="lineCov">            for i in (BASE_UNIVERSE as u16) .. ((SND_THREADS as u16) + (BASE_UNIVERSE as u16)) {</span></div>
<div class="line"><span id="1216" class="lineNum"><a href="#1216">1216</a></span><span class="counterCov">8</span><span class="lineCov">                dmx_recv.listen_universes(&amp;[i]).unwrap();</span></div>
<div class="line"><span id="1217" class="lineNum"><a href="#1217">1217</a></span><span class="counterUnCov"></span><span class="lineUnCov">            }</span></div>
<div class="line"><span id="1218" class="lineNum"><a href="#1218">1218</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="1219" class="lineNum"><a href="#1219">1219</a></span><span class="counterCov">4</span><span class="lineCov">            let mut res: Vec&lt;Result&lt;Vec&lt;DMXData&gt;&gt;&gt; = Vec::new();</span></div>
<div class="line"><span id="1220" class="lineNum"><a href="#1220">1220</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="1221" class="lineNum"><a href="#1221">1221</a></span><span class="counterCov">4</span><span class="lineCov">            tx.send(Vec::new()).unwrap(); // Receiver notifies controlling thread it is ready.</span></div>
<div class="line"><span id="1222" class="lineNum"><a href="#1222">1222</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="1223" class="lineNum"><a href="#1223">1223</a></span><span class="counterCov">12</span><span class="lineCov">            for _i in 0 .. SND_THREADS { // Receiver should receive from every universe.</span></div>
<div class="line"><span id="1224" class="lineNum"><a href="#1224">1224</a></span><span class="counterCov">8</span><span class="lineCov">                res.push(dmx_recv.recv(None)); // Receiver won&#39;t complete this until it receives from the senders which are all held waiting on the controlling thread.</span></div>
<div class="line"><span id="1225" class="lineNum"><a href="#1225">1225</a></span><span class="counterUnCov"></span><span class="lineUnCov">            }</span></div>
<div class="line"><span id="1226" class="lineNum"><a href="#1226">1226</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="1227" class="lineNum"><a href="#1227">1227</a></span><span class="counterUnCov"></span><span class="lineUnCov">            // Results of each receive are sent back, this allows checking that each receive was an expected universe, all universes were received and there were no errors.</span></div>
<div class="line"><span id="1228" class="lineNum"><a href="#1228">1228</a></span><span class="counterCov">4</span><span class="lineCov">            tx.send(res).unwrap(); </span></div>
<div class="line"><span id="1229" class="lineNum"><a href="#1229">1229</a></span><span class="counterCov">4</span><span class="lineCov">        }));</span></div>
<div class="line"><span id="1230" class="lineNum"><a href="#1230">1230</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="1231" class="lineNum"><a href="#1231">1231</a></span><span class="counterCov">4</span><span class="lineCov">        assert_eq!(rcv_rx.recv().unwrap().len(), 0); // Wait till the receiver has notified controlling thread it is ready.</span></div>
<div class="line"><span id="1232" class="lineNum"><a href="#1232">1232</a></span><span class="counterUnCov"></span><span class="lineUnCov">    }</span></div>
<div class="line"><span id="1233" class="lineNum"><a href="#1233">1233</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="1234" class="lineNum"><a href="#1234">1234</a></span><span class="counterCov">6</span><span class="lineCov">    for _i in 0 .. SND_THREADS {</span></div>
<div class="line"><span id="1235" class="lineNum"><a href="#1235">1235</a></span><span class="counterCov">4</span><span class="lineCov">        snd_rx.recv().unwrap(); // Allow each sender to progress</span></div>
<div class="line"><span id="1236" class="lineNum"><a href="#1236">1236</a></span><span class="counterUnCov"></span><span class="lineUnCov">    }</span></div>
<div class="line"><span id="1237" class="lineNum"><a href="#1237">1237</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="1238" class="lineNum"><a href="#1238">1238</a></span><span class="counterCov">6</span><span class="lineCov">    for _i in 0 .. RCV_THREADS {</span></div>
<div class="line"><span id="1239" class="lineNum"><a href="#1239">1239</a></span><span class="counterCov">4</span><span class="lineCov">        let res: Vec&lt;Result&lt;Vec&lt;DMXData&gt;&gt;&gt; = rcv_rx.recv().unwrap();</span></div>
<div class="line"><span id="1240" class="lineNum"><a href="#1240">1240</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="1241" class="lineNum"><a href="#1241">1241</a></span><span class="counterCov">4</span><span class="lineCov">        assert_eq!(res.len(), SND_THREADS);</span></div>
<div class="line"><span id="1242" class="lineNum"><a href="#1242">1242</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="1243" class="lineNum"><a href="#1243">1243</a></span><span class="counterCov">4</span><span class="lineCov">        let mut rcv_dmx_datas: Vec&lt;DMXData&gt; = Vec::new();</span></div>
<div class="line"><span id="1244" class="lineNum"><a href="#1244">1244</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="1245" class="lineNum"><a href="#1245">1245</a></span><span class="counterCov">12</span><span class="lineCov">        for r in res {</span></div>
<div class="line"><span id="1246" class="lineNum"><a href="#1246">1246</a></span><span class="counterCov">8</span><span class="lineCov">            let data: Vec&lt;DMXData&gt; = r.unwrap(); // Check that there are no errors when receiving.</span></div>
<div class="line"><span id="1247" class="lineNum"><a href="#1247">1247</a></span><span class="counterCov">8</span><span class="lineCov">            assert_eq!(data.len(), 1); // Check that each universe was received separately.</span></div>
<div class="line"><span id="1248" class="lineNum"><a href="#1248">1248</a></span><span class="counterCov">8</span><span class="lineCov">            rcv_dmx_datas.push(data[0].clone());</span></div>
<div class="line"><span id="1249" class="lineNum"><a href="#1249">1249</a></span><span class="counterCov">12</span><span class="lineCov">        }</span></div>
<div class="line"><span id="1250" class="lineNum"><a href="#1250">1250</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="1251" class="lineNum"><a href="#1251">1251</a></span><span class="counterCov">4</span><span class="lineCov">        rcv_dmx_datas.sort_unstable(); // Sorting by universe allows easier checking as order received may vary depending on network.</span></div>
<div class="line"><span id="1252" class="lineNum"><a href="#1252">1252</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="1253" class="lineNum"><a href="#1253">1253</a></span><span class="counterCov">12</span><span class="lineCov">        for k in 0 .. SND_THREADS {</span></div>
<div class="line"><span id="1254" class="lineNum"><a href="#1254">1254</a></span><span class="counterCov">8</span><span class="lineCov">            assert_eq!(rcv_dmx_datas[k].universe, ((k as u16) + BASE_UNIVERSE)); // Check that the universe received is as expected.</span></div>
<div class="line"><span id="1255" class="lineNum"><a href="#1255">1255</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="1256" class="lineNum"><a href="#1256">1256</a></span><span class="counterCov">8</span><span class="lineCov">            assert_eq!(rcv_dmx_datas[k].values, snd_data[k], &quot;Received payload values don&#39;t match sent!&quot;);</span></div>
<div class="line"><span id="1257" class="lineNum"><a href="#1257">1257</a></span><span class="counterUnCov"></span><span class="lineUnCov">        }</span></div>
<div class="line"><span id="1258" class="lineNum"><a href="#1258">1258</a></span><span class="counterCov">4</span><span class="lineCov">    }</span></div>
<div class="line"><span id="1259" class="lineNum"><a href="#1259">1259</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="1260" class="lineNum"><a href="#1260">1260</a></span><span class="counterCov">6</span><span class="lineCov">    for s in snd_threads {</span></div>
<div class="line"><span id="1261" class="lineNum"><a href="#1261">1261</a></span><span class="counterCov">4</span><span class="lineCov">        s.join().unwrap();</span></div>
<div class="line"><span id="1262" class="lineNum"><a href="#1262">1262</a></span><span class="counterCov">2</span><span class="lineCov">    }</span></div>
<div class="line"><span id="1263" class="lineNum"><a href="#1263">1263</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="1264" class="lineNum"><a href="#1264">1264</a></span><span class="counterCov">6</span><span class="lineCov">    for r in rcv_threads {</span></div>
<div class="line"><span id="1265" class="lineNum"><a href="#1265">1265</a></span><span class="counterCov">4</span><span class="lineCov">        r.join().unwrap();</span></div>
<div class="line"><span id="1266" class="lineNum"><a href="#1266">1266</a></span><span class="counterCov">2</span><span class="lineCov">    }</span></div>
<div class="line"><span id="1267" class="lineNum"><a href="#1267">1267</a></span><span class="counterCov">4</span><span class="lineCov">}</span></div>
<div class="line"><span id="1268" class="lineNum"><a href="#1268">1268</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="1269" class="lineNum"><a href="#1269">1269</a></span><span class="counterUnCov"></span><span class="lineUnCov">#[test]</span></div>
<div class="line"><span id="1270" class="lineNum"><a href="#1270">1270</a></span><span class="counterCov">4</span><span class="lineCov">fn test_three_senders_two_recv_multicast_ipv4(){</span></div>
<div class="line"><span id="1271" class="lineNum"><a href="#1271">1271</a></span><span class="counterUnCov"></span><span class="lineUnCov">    const SND_THREADS: usize = 3;</span></div>
<div class="line"><span id="1272" class="lineNum"><a href="#1272">1272</a></span><span class="counterUnCov"></span><span class="lineUnCov">    const RCV_THREADS: usize = 2;</span></div>
<div class="line"><span id="1273" class="lineNum"><a href="#1273">1273</a></span><span class="counterUnCov"></span><span class="lineUnCov">    const SND_DATA_LEN: usize = 100;</span></div>
<div class="line"><span id="1274" class="lineNum"><a href="#1274">1274</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="1275" class="lineNum"><a href="#1275">1275</a></span><span class="counterCov">2</span><span class="lineCov">    let mut snd_data: Vec&lt;Vec&lt;u8&gt;&gt; = Vec::new();</span></div>
<div class="line"><span id="1276" class="lineNum"><a href="#1276">1276</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="1277" class="lineNum"><a href="#1277">1277</a></span><span class="counterCov">8</span><span class="lineCov">    for i in 1 .. SND_THREADS + 1 {</span></div>
<div class="line"><span id="1278" class="lineNum"><a href="#1278">1278</a></span><span class="counterCov">6</span><span class="lineCov">        let mut d: Vec&lt;u8&gt; = Vec::new();</span></div>
<div class="line"><span id="1279" class="lineNum"><a href="#1279">1279</a></span><span class="counterCov">606</span><span class="lineCov">        for _k in 0 .. SND_DATA_LEN {</span></div>
<div class="line"><span id="1280" class="lineNum"><a href="#1280">1280</a></span><span class="counterCov">600</span><span class="lineCov">            d.push(i as u8);</span></div>
<div class="line"><span id="1281" class="lineNum"><a href="#1281">1281</a></span><span class="counterUnCov"></span><span class="lineUnCov">        }</span></div>
<div class="line"><span id="1282" class="lineNum"><a href="#1282">1282</a></span><span class="counterCov">6</span><span class="lineCov">        snd_data.push(d);</span></div>
<div class="line"><span id="1283" class="lineNum"><a href="#1283">1283</a></span><span class="counterUnCov"></span><span class="lineUnCov">    }</span></div>
<div class="line"><span id="1284" class="lineNum"><a href="#1284">1284</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="1285" class="lineNum"><a href="#1285">1285</a></span><span class="counterCov">2</span><span class="lineCov">    let mut snd_threads = Vec::new();</span></div>
<div class="line"><span id="1286" class="lineNum"><a href="#1286">1286</a></span><span class="counterCov">2</span><span class="lineCov">    let mut rcv_threads = Vec::new();</span></div>
<div class="line"><span id="1287" class="lineNum"><a href="#1287">1287</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="1288" class="lineNum"><a href="#1288">1288</a></span><span class="counterCov">2</span><span class="lineCov">    let (rcv_tx, rcv_rx): (SyncSender&lt;Vec&lt;Result&lt;Vec&lt;DMXData&gt;&gt;&gt;&gt;, Receiver&lt;Vec&lt;Result&lt;Vec&lt;DMXData&gt;&gt;&gt;&gt;) = mpsc::sync_channel(0);</span></div>
<div class="line"><span id="1289" class="lineNum"><a href="#1289">1289</a></span><span class="counterCov">2</span><span class="lineCov">    let (snd_tx, snd_rx): (SyncSender&lt;()&gt;, Receiver&lt;()&gt;) = mpsc::sync_channel(0); // Used for handshaking, allows syncing the sender states.</span></div>
<div class="line"><span id="1290" class="lineNum"><a href="#1290">1290</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="1291" class="lineNum"><a href="#1291">1291</a></span><span class="counterCov">2</span><span class="lineCov">    assert!(RCV_THREADS &lt;= TEST_NETWORK_INTERFACE_IPV4.len(), &quot;Number of test network interface ips less than number of recv threads!&quot;);</span></div>
<div class="line"><span id="1292" class="lineNum"><a href="#1292">1292</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="1293" class="lineNum"><a href="#1293">1293</a></span><span class="counterUnCov"></span><span class="lineUnCov">    const BASE_UNIVERSE: u16 = 2;</span></div>
<div class="line"><span id="1294" class="lineNum"><a href="#1294">1294</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="1295" class="lineNum"><a href="#1295">1295</a></span><span class="counterCov">8</span><span class="lineCov">    for i in 0 .. SND_THREADS {</span></div>
<div class="line"><span id="1296" class="lineNum"><a href="#1296">1296</a></span><span class="counterCov">6</span><span class="lineCov">        let tx = snd_tx.clone();</span></div>
<div class="line"><span id="1297" class="lineNum"><a href="#1297">1297</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="1298" class="lineNum"><a href="#1298">1298</a></span><span class="counterCov">6</span><span class="lineCov">        let data = snd_data[i].clone();</span></div>
<div class="line"><span id="1299" class="lineNum"><a href="#1299">1299</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="1300" class="lineNum"><a href="#1300">1300</a></span><span class="counterCov">12</span><span class="lineCov">        snd_threads.push(thread::spawn(move || {</span></div>
<div class="line"><span id="1301" class="lineNum"><a href="#1301">1301</a></span><span class="counterCov">6</span><span class="lineCov">            let ip: SocketAddr = SocketAddr::new(IpAddr::V4(TEST_NETWORK_INTERFACE_IPV4[0].parse().unwrap()), ACN_SDT_MULTICAST_PORT + 1 + (i as u16));</span></div>
<div class="line"><span id="1302" class="lineNum"><a href="#1302">1302</a></span><span class="counterUnCov"></span><span class="lineUnCov">            // https://www.programming-idioms.org/idiom/153/concatenate-string-with-integer/1975/rust (11/01/2020)</span></div>
<div class="line"><span id="1303" class="lineNum"><a href="#1303">1303</a></span><span class="counterCov">6</span><span class="lineCov">            let mut src = SacnSource::with_ip(&amp;format!(&quot;Source {}&quot;, i), ip).unwrap();</span></div>
<div class="line"><span id="1304" class="lineNum"><a href="#1304">1304</a></span><span class="counterUnCov"></span><span class="lineUnCov">    </span></div>
<div class="line"><span id="1305" class="lineNum"><a href="#1305">1305</a></span><span class="counterCov">6</span><span class="lineCov">            let priority = 100;</span></div>
<div class="line"><span id="1306" class="lineNum"><a href="#1306">1306</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="1307" class="lineNum"><a href="#1307">1307</a></span><span class="counterCov">6</span><span class="lineCov">            let universe: u16 = (i as u16) + BASE_UNIVERSE; </span></div>
<div class="line"><span id="1308" class="lineNum"><a href="#1308">1308</a></span><span class="counterUnCov"></span><span class="lineUnCov">    </span></div>
<div class="line"><span id="1309" class="lineNum"><a href="#1309">1309</a></span><span class="counterCov">6</span><span class="lineCov">            src.register_universe(universe).unwrap(); // Senders all send on different universes.</span></div>
<div class="line"><span id="1310" class="lineNum"><a href="#1310">1310</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="1311" class="lineNum"><a href="#1311">1311</a></span><span class="counterCov">6</span><span class="lineCov">            tx.send(()).unwrap(); // Forces each sender thread to wait till the controlling thread receives which stops sending before the receivers are ready.</span></div>
<div class="line"><span id="1312" class="lineNum"><a href="#1312">1312</a></span><span class="counterUnCov"></span><span class="lineUnCov">    </span></div>
<div class="line"><span id="1313" class="lineNum"><a href="#1313">1313</a></span><span class="counterCov">6</span><span class="lineCov">            src.send(&amp;[universe], &amp;data, Some(priority), None, None).unwrap();</span></div>
<div class="line"><span id="1314" class="lineNum"><a href="#1314">1314</a></span><span class="counterCov">6</span><span class="lineCov">        }));</span></div>
<div class="line"><span id="1315" class="lineNum"><a href="#1315">1315</a></span><span class="counterUnCov"></span><span class="lineUnCov">    }</span></div>
<div class="line"><span id="1316" class="lineNum"><a href="#1316">1316</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="1317" class="lineNum"><a href="#1317">1317</a></span><span class="counterCov">6</span><span class="lineCov">    for i in 0 .. RCV_THREADS {</span></div>
<div class="line"><span id="1318" class="lineNum"><a href="#1318">1318</a></span><span class="counterCov">4</span><span class="lineCov">        let tx = rcv_tx.clone();</span></div>
<div class="line"><span id="1319" class="lineNum"><a href="#1319">1319</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="1320" class="lineNum"><a href="#1320">1320</a></span><span class="counterCov">8</span><span class="lineCov">        rcv_threads.push(thread::spawn(move || {</span></div>
<div class="line"><span id="1321" class="lineNum"><a href="#1321">1321</a></span><span class="counterUnCov"></span><span class="lineUnCov">            // Port kept the same so must use multiple IP&#39;s.</span></div>
<div class="line"><span id="1322" class="lineNum"><a href="#1322">1322</a></span><span class="counterCov">4</span><span class="lineCov">            let mut dmx_recv = SacnReceiver::with_ip(SocketAddr::new(IpAddr::V4(TEST_NETWORK_INTERFACE_IPV4[i].parse().unwrap()), ACN_SDT_MULTICAST_PORT), None).unwrap();</span></div>
<div class="line"><span id="1323" class="lineNum"><a href="#1323">1323</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="1324" class="lineNum"><a href="#1324">1324</a></span><span class="counterUnCov"></span><span class="lineUnCov">            // Receivers listen to all universes</span></div>
<div class="line"><span id="1325" class="lineNum"><a href="#1325">1325</a></span><span class="counterCov">16</span><span class="lineCov">            for i in (BASE_UNIVERSE as u16) .. ((SND_THREADS as u16) + (BASE_UNIVERSE as u16)) {</span></div>
<div class="line"><span id="1326" class="lineNum"><a href="#1326">1326</a></span><span class="counterCov">12</span><span class="lineCov">                dmx_recv.listen_universes(&amp;[i]).unwrap();</span></div>
<div class="line"><span id="1327" class="lineNum"><a href="#1327">1327</a></span><span class="counterUnCov"></span><span class="lineUnCov">            }</span></div>
<div class="line"><span id="1328" class="lineNum"><a href="#1328">1328</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="1329" class="lineNum"><a href="#1329">1329</a></span><span class="counterCov">4</span><span class="lineCov">            let mut res: Vec&lt;Result&lt;Vec&lt;DMXData&gt;&gt;&gt; = Vec::new();</span></div>
<div class="line"><span id="1330" class="lineNum"><a href="#1330">1330</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="1331" class="lineNum"><a href="#1331">1331</a></span><span class="counterCov">4</span><span class="lineCov">            tx.send(Vec::new()).unwrap(); // Receiver notifies controlling thread it is ready.</span></div>
<div class="line"><span id="1332" class="lineNum"><a href="#1332">1332</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="1333" class="lineNum"><a href="#1333">1333</a></span><span class="counterCov">16</span><span class="lineCov">            for _i in 0 .. SND_THREADS { // Receiver should receive from every universe.</span></div>
<div class="line"><span id="1334" class="lineNum"><a href="#1334">1334</a></span><span class="counterCov">12</span><span class="lineCov">                res.push(dmx_recv.recv(None)); // Receiver won&#39;t complete this until it receives from the senders which are all held waiting on the controlling thread.</span></div>
<div class="line"><span id="1335" class="lineNum"><a href="#1335">1335</a></span><span class="counterUnCov"></span><span class="lineUnCov">            }</span></div>
<div class="line"><span id="1336" class="lineNum"><a href="#1336">1336</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="1337" class="lineNum"><a href="#1337">1337</a></span><span class="counterUnCov"></span><span class="lineUnCov">            // Results of each receive are sent back, this allows checking that each receiver was an expected universe, all universes were received and there were no errors.</span></div>
<div class="line"><span id="1338" class="lineNum"><a href="#1338">1338</a></span><span class="counterCov">4</span><span class="lineCov">            tx.send(res).unwrap(); </span></div>
<div class="line"><span id="1339" class="lineNum"><a href="#1339">1339</a></span><span class="counterCov">4</span><span class="lineCov">        }));</span></div>
<div class="line"><span id="1340" class="lineNum"><a href="#1340">1340</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="1341" class="lineNum"><a href="#1341">1341</a></span><span class="counterCov">4</span><span class="lineCov">        assert_eq!(rcv_rx.recv().unwrap().len(), 0); // Wait till the receiver has notified controlling thread it is ready.</span></div>
<div class="line"><span id="1342" class="lineNum"><a href="#1342">1342</a></span><span class="counterUnCov"></span><span class="lineUnCov">    }</span></div>
<div class="line"><span id="1343" class="lineNum"><a href="#1343">1343</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="1344" class="lineNum"><a href="#1344">1344</a></span><span class="counterCov">8</span><span class="lineCov">    for _i in 0 .. SND_THREADS {</span></div>
<div class="line"><span id="1345" class="lineNum"><a href="#1345">1345</a></span><span class="counterCov">6</span><span class="lineCov">        snd_rx.recv().unwrap(); // Allow each sender to progress</span></div>
<div class="line"><span id="1346" class="lineNum"><a href="#1346">1346</a></span><span class="counterUnCov"></span><span class="lineUnCov">    }</span></div>
<div class="line"><span id="1347" class="lineNum"><a href="#1347">1347</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="1348" class="lineNum"><a href="#1348">1348</a></span><span class="counterCov">6</span><span class="lineCov">    for _i in 0 .. RCV_THREADS {</span></div>
<div class="line"><span id="1349" class="lineNum"><a href="#1349">1349</a></span><span class="counterCov">4</span><span class="lineCov">        let res: Vec&lt;Result&lt;Vec&lt;DMXData&gt;&gt;&gt; = rcv_rx.recv().unwrap();</span></div>
<div class="line"><span id="1350" class="lineNum"><a href="#1350">1350</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="1351" class="lineNum"><a href="#1351">1351</a></span><span class="counterCov">4</span><span class="lineCov">        assert_eq!(res.len(), SND_THREADS);</span></div>
<div class="line"><span id="1352" class="lineNum"><a href="#1352">1352</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="1353" class="lineNum"><a href="#1353">1353</a></span><span class="counterCov">4</span><span class="lineCov">        let mut rcv_dmx_datas: Vec&lt;DMXData&gt; = Vec::new();</span></div>
<div class="line"><span id="1354" class="lineNum"><a href="#1354">1354</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="1355" class="lineNum"><a href="#1355">1355</a></span><span class="counterCov">16</span><span class="lineCov">        for r in res {</span></div>
<div class="line"><span id="1356" class="lineNum"><a href="#1356">1356</a></span><span class="counterCov">12</span><span class="lineCov">            let data: Vec&lt;DMXData&gt; = r.unwrap(); // Check that there are no errors when receiving.</span></div>
<div class="line"><span id="1357" class="lineNum"><a href="#1357">1357</a></span><span class="counterCov">12</span><span class="lineCov">            assert_eq!(data.len(), 1); // Check that each universe was received separately.</span></div>
<div class="line"><span id="1358" class="lineNum"><a href="#1358">1358</a></span><span class="counterCov">12</span><span class="lineCov">            rcv_dmx_datas.push(data[0].clone());</span></div>
<div class="line"><span id="1359" class="lineNum"><a href="#1359">1359</a></span><span class="counterCov">16</span><span class="lineCov">        }</span></div>
<div class="line"><span id="1360" class="lineNum"><a href="#1360">1360</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="1361" class="lineNum"><a href="#1361">1361</a></span><span class="counterCov">4</span><span class="lineCov">        rcv_dmx_datas.sort_unstable(); // Sorting by universe allows easier checking as order received may vary depending on network.</span></div>
<div class="line"><span id="1362" class="lineNum"><a href="#1362">1362</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="1363" class="lineNum"><a href="#1363">1363</a></span><span class="counterCov">16</span><span class="lineCov">        for k in 0 .. SND_THREADS {</span></div>
<div class="line"><span id="1364" class="lineNum"><a href="#1364">1364</a></span><span class="counterCov">12</span><span class="lineCov">            assert_eq!(rcv_dmx_datas[k].universe, ((k as u16) + BASE_UNIVERSE)); // Check that the universe received is as expected.</span></div>
<div class="line"><span id="1365" class="lineNum"><a href="#1365">1365</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="1366" class="lineNum"><a href="#1366">1366</a></span><span class="counterCov">12</span><span class="lineCov">            assert_eq!(rcv_dmx_datas[k].values, snd_data[k], &quot;Received payload values don&#39;t match sent!&quot;);</span></div>
<div class="line"><span id="1367" class="lineNum"><a href="#1367">1367</a></span><span class="counterUnCov"></span><span class="lineUnCov">        }</span></div>
<div class="line"><span id="1368" class="lineNum"><a href="#1368">1368</a></span><span class="counterCov">4</span><span class="lineCov">    }</span></div>
<div class="line"><span id="1369" class="lineNum"><a href="#1369">1369</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="1370" class="lineNum"><a href="#1370">1370</a></span><span class="counterCov">8</span><span class="lineCov">    for s in snd_threads {</span></div>
<div class="line"><span id="1371" class="lineNum"><a href="#1371">1371</a></span><span class="counterCov">6</span><span class="lineCov">        s.join().unwrap();</span></div>
<div class="line"><span id="1372" class="lineNum"><a href="#1372">1372</a></span><span class="counterCov">2</span><span class="lineCov">    }</span></div>
<div class="line"><span id="1373" class="lineNum"><a href="#1373">1373</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="1374" class="lineNum"><a href="#1374">1374</a></span><span class="counterCov">6</span><span class="lineCov">    for r in rcv_threads {</span></div>
<div class="line"><span id="1375" class="lineNum"><a href="#1375">1375</a></span><span class="counterCov">4</span><span class="lineCov">        r.join().unwrap();</span></div>
<div class="line"><span id="1376" class="lineNum"><a href="#1376">1376</a></span><span class="counterCov">2</span><span class="lineCov">    }</span></div>
<div class="line"><span id="1377" class="lineNum"><a href="#1377">1377</a></span><span class="counterCov">4</span><span class="lineCov">}</span></div>
<div class="line"><span id="1378" class="lineNum"><a href="#1378">1378</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="1379" class="lineNum"><a href="#1379">1379</a></span><span class="counterUnCov"></span><span class="lineUnCov">#[test]</span></div>
<div class="line"><span id="1380" class="lineNum"><a href="#1380">1380</a></span><span class="counterCov">4</span><span class="lineCov">fn test_two_senders_three_recv_multicast_ipv4(){</span></div>
<div class="line"><span id="1381" class="lineNum"><a href="#1381">1381</a></span><span class="counterUnCov"></span><span class="lineUnCov">    const SND_THREADS: usize = 2;</span></div>
<div class="line"><span id="1382" class="lineNum"><a href="#1382">1382</a></span><span class="counterUnCov"></span><span class="lineUnCov">    const RCV_THREADS: usize = 3;</span></div>
<div class="line"><span id="1383" class="lineNum"><a href="#1383">1383</a></span><span class="counterUnCov"></span><span class="lineUnCov">    const SND_DATA_LEN: usize = 100;</span></div>
<div class="line"><span id="1384" class="lineNum"><a href="#1384">1384</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="1385" class="lineNum"><a href="#1385">1385</a></span><span class="counterCov">2</span><span class="lineCov">    let mut snd_data: Vec&lt;Vec&lt;u8&gt;&gt; = Vec::new();</span></div>
<div class="line"><span id="1386" class="lineNum"><a href="#1386">1386</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="1387" class="lineNum"><a href="#1387">1387</a></span><span class="counterCov">6</span><span class="lineCov">    for i in 1 .. SND_THREADS + 1 {</span></div>
<div class="line"><span id="1388" class="lineNum"><a href="#1388">1388</a></span><span class="counterCov">4</span><span class="lineCov">        let mut d: Vec&lt;u8&gt; = Vec::new();</span></div>
<div class="line"><span id="1389" class="lineNum"><a href="#1389">1389</a></span><span class="counterCov">404</span><span class="lineCov">        for _k in 0 .. SND_DATA_LEN {</span></div>
<div class="line"><span id="1390" class="lineNum"><a href="#1390">1390</a></span><span class="counterCov">400</span><span class="lineCov">            d.push(i as u8);</span></div>
<div class="line"><span id="1391" class="lineNum"><a href="#1391">1391</a></span><span class="counterUnCov"></span><span class="lineUnCov">        }</span></div>
<div class="line"><span id="1392" class="lineNum"><a href="#1392">1392</a></span><span class="counterCov">4</span><span class="lineCov">        snd_data.push(d);</span></div>
<div class="line"><span id="1393" class="lineNum"><a href="#1393">1393</a></span><span class="counterUnCov"></span><span class="lineUnCov">    }</span></div>
<div class="line"><span id="1394" class="lineNum"><a href="#1394">1394</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="1395" class="lineNum"><a href="#1395">1395</a></span><span class="counterCov">2</span><span class="lineCov">    let mut snd_threads = Vec::new();</span></div>
<div class="line"><span id="1396" class="lineNum"><a href="#1396">1396</a></span><span class="counterCov">2</span><span class="lineCov">    let mut rcv_threads = Vec::new();</span></div>
<div class="line"><span id="1397" class="lineNum"><a href="#1397">1397</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="1398" class="lineNum"><a href="#1398">1398</a></span><span class="counterCov">2</span><span class="lineCov">    let (rcv_tx, rcv_rx): (SyncSender&lt;Vec&lt;Result&lt;Vec&lt;DMXData&gt;&gt;&gt;&gt;, Receiver&lt;Vec&lt;Result&lt;Vec&lt;DMXData&gt;&gt;&gt;&gt;) = mpsc::sync_channel(0);</span></div>
<div class="line"><span id="1399" class="lineNum"><a href="#1399">1399</a></span><span class="counterCov">2</span><span class="lineCov">    let (snd_tx, snd_rx): (SyncSender&lt;()&gt;, Receiver&lt;()&gt;) = mpsc::sync_channel(0); // Used for handshaking, allows syncing the sender states.</span></div>
<div class="line"><span id="1400" class="lineNum"><a href="#1400">1400</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="1401" class="lineNum"><a href="#1401">1401</a></span><span class="counterCov">2</span><span class="lineCov">    assert!(RCV_THREADS &lt;= TEST_NETWORK_INTERFACE_IPV4.len(), &quot;Number of test network interface ips less than number of recv threads!&quot;);</span></div>
<div class="line"><span id="1402" class="lineNum"><a href="#1402">1402</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="1403" class="lineNum"><a href="#1403">1403</a></span><span class="counterUnCov"></span><span class="lineUnCov">    const BASE_UNIVERSE: u16 = 2;</span></div>
<div class="line"><span id="1404" class="lineNum"><a href="#1404">1404</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="1405" class="lineNum"><a href="#1405">1405</a></span><span class="counterCov">6</span><span class="lineCov">    for i in 0 .. SND_THREADS {</span></div>
<div class="line"><span id="1406" class="lineNum"><a href="#1406">1406</a></span><span class="counterCov">4</span><span class="lineCov">        let tx = snd_tx.clone();</span></div>
<div class="line"><span id="1407" class="lineNum"><a href="#1407">1407</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="1408" class="lineNum"><a href="#1408">1408</a></span><span class="counterCov">4</span><span class="lineCov">        let data = snd_data[i].clone();</span></div>
<div class="line"><span id="1409" class="lineNum"><a href="#1409">1409</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="1410" class="lineNum"><a href="#1410">1410</a></span><span class="counterCov">8</span><span class="lineCov">        snd_threads.push(thread::spawn(move || {</span></div>
<div class="line"><span id="1411" class="lineNum"><a href="#1411">1411</a></span><span class="counterCov">4</span><span class="lineCov">            let ip: SocketAddr = SocketAddr::new(IpAddr::V4(TEST_NETWORK_INTERFACE_IPV4[0].parse().unwrap()), ACN_SDT_MULTICAST_PORT + 1 + (i as u16));</span></div>
<div class="line"><span id="1412" class="lineNum"><a href="#1412">1412</a></span><span class="counterUnCov"></span><span class="lineUnCov">            // https://www.programming-idioms.org/idiom/153/concatenate-string-with-integer/1975/rust (11/01/2020)</span></div>
<div class="line"><span id="1413" class="lineNum"><a href="#1413">1413</a></span><span class="counterCov">4</span><span class="lineCov">            let mut src = SacnSource::with_ip(&amp;format!(&quot;Source {}&quot;, i), ip).unwrap();</span></div>
<div class="line"><span id="1414" class="lineNum"><a href="#1414">1414</a></span><span class="counterUnCov"></span><span class="lineUnCov">    </span></div>
<div class="line"><span id="1415" class="lineNum"><a href="#1415">1415</a></span><span class="counterCov">4</span><span class="lineCov">            let priority = 100;</span></div>
<div class="line"><span id="1416" class="lineNum"><a href="#1416">1416</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="1417" class="lineNum"><a href="#1417">1417</a></span><span class="counterCov">4</span><span class="lineCov">            let universe: u16 = (i as u16) + BASE_UNIVERSE; </span></div>
<div class="line"><span id="1418" class="lineNum"><a href="#1418">1418</a></span><span class="counterUnCov"></span><span class="lineUnCov">    </span></div>
<div class="line"><span id="1419" class="lineNum"><a href="#1419">1419</a></span><span class="counterCov">4</span><span class="lineCov">            src.register_universe(universe).unwrap(); // Senders all send on different universes.</span></div>
<div class="line"><span id="1420" class="lineNum"><a href="#1420">1420</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="1421" class="lineNum"><a href="#1421">1421</a></span><span class="counterCov">4</span><span class="lineCov">            tx.send(()).unwrap(); // Forces each sender thread to wait till the controlling thread receives which stops sending before the receivers are ready.</span></div>
<div class="line"><span id="1422" class="lineNum"><a href="#1422">1422</a></span><span class="counterUnCov"></span><span class="lineUnCov">    </span></div>
<div class="line"><span id="1423" class="lineNum"><a href="#1423">1423</a></span><span class="counterCov">4</span><span class="lineCov">            src.send(&amp;[universe], &amp;data, Some(priority), None, None).unwrap();</span></div>
<div class="line"><span id="1424" class="lineNum"><a href="#1424">1424</a></span><span class="counterCov">4</span><span class="lineCov">        }));</span></div>
<div class="line"><span id="1425" class="lineNum"><a href="#1425">1425</a></span><span class="counterUnCov"></span><span class="lineUnCov">    }</span></div>
<div class="line"><span id="1426" class="lineNum"><a href="#1426">1426</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="1427" class="lineNum"><a href="#1427">1427</a></span><span class="counterCov">8</span><span class="lineCov">    for i in 0 .. RCV_THREADS {</span></div>
<div class="line"><span id="1428" class="lineNum"><a href="#1428">1428</a></span><span class="counterCov">6</span><span class="lineCov">        let tx = rcv_tx.clone();</span></div>
<div class="line"><span id="1429" class="lineNum"><a href="#1429">1429</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="1430" class="lineNum"><a href="#1430">1430</a></span><span class="counterCov">12</span><span class="lineCov">        rcv_threads.push(thread::spawn(move || {</span></div>
<div class="line"><span id="1431" class="lineNum"><a href="#1431">1431</a></span><span class="counterUnCov"></span><span class="lineUnCov">            // Port kept the same so must use multiple IP&#39;s.</span></div>
<div class="line"><span id="1432" class="lineNum"><a href="#1432">1432</a></span><span class="counterCov">6</span><span class="lineCov">            let mut dmx_recv = SacnReceiver::with_ip(SocketAddr::new(IpAddr::V4(TEST_NETWORK_INTERFACE_IPV4[i].parse().unwrap()), ACN_SDT_MULTICAST_PORT), None).unwrap();</span></div>
<div class="line"><span id="1433" class="lineNum"><a href="#1433">1433</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="1434" class="lineNum"><a href="#1434">1434</a></span><span class="counterUnCov"></span><span class="lineUnCov">            // Receivers listen to all universes</span></div>
<div class="line"><span id="1435" class="lineNum"><a href="#1435">1435</a></span><span class="counterCov">18</span><span class="lineCov">            for i in (BASE_UNIVERSE as u16) .. ((SND_THREADS as u16) + (BASE_UNIVERSE as u16)) {</span></div>
<div class="line"><span id="1436" class="lineNum"><a href="#1436">1436</a></span><span class="counterCov">12</span><span class="lineCov">                dmx_recv.listen_universes(&amp;[i]).unwrap();</span></div>
<div class="line"><span id="1437" class="lineNum"><a href="#1437">1437</a></span><span class="counterUnCov"></span><span class="lineUnCov">            }</span></div>
<div class="line"><span id="1438" class="lineNum"><a href="#1438">1438</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="1439" class="lineNum"><a href="#1439">1439</a></span><span class="counterCov">6</span><span class="lineCov">            let mut res: Vec&lt;Result&lt;Vec&lt;DMXData&gt;&gt;&gt; = Vec::new();</span></div>
<div class="line"><span id="1440" class="lineNum"><a href="#1440">1440</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="1441" class="lineNum"><a href="#1441">1441</a></span><span class="counterCov">6</span><span class="lineCov">            tx.send(Vec::new()).unwrap(); // Receiver notifies controlling thread it is ready.</span></div>
<div class="line"><span id="1442" class="lineNum"><a href="#1442">1442</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="1443" class="lineNum"><a href="#1443">1443</a></span><span class="counterCov">18</span><span class="lineCov">            for _i in 0 .. SND_THREADS { // Receiver should receive from every universe.</span></div>
<div class="line"><span id="1444" class="lineNum"><a href="#1444">1444</a></span><span class="counterCov">12</span><span class="lineCov">                res.push(dmx_recv.recv(None)); // Receiver won&#39;t complete this until it receives from the senders which are all held waiting on the controlling thread.</span></div>
<div class="line"><span id="1445" class="lineNum"><a href="#1445">1445</a></span><span class="counterUnCov"></span><span class="lineUnCov">            }</span></div>
<div class="line"><span id="1446" class="lineNum"><a href="#1446">1446</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="1447" class="lineNum"><a href="#1447">1447</a></span><span class="counterUnCov"></span><span class="lineUnCov">            // Results of each receive are sent back, this allows checking that each receive was an expected universe, all universes were received and there were no errors.</span></div>
<div class="line"><span id="1448" class="lineNum"><a href="#1448">1448</a></span><span class="counterCov">6</span><span class="lineCov">            tx.send(res).unwrap(); </span></div>
<div class="line"><span id="1449" class="lineNum"><a href="#1449">1449</a></span><span class="counterCov">6</span><span class="lineCov">        }));</span></div>
<div class="line"><span id="1450" class="lineNum"><a href="#1450">1450</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="1451" class="lineNum"><a href="#1451">1451</a></span><span class="counterCov">6</span><span class="lineCov">        assert_eq!(rcv_rx.recv().unwrap().len(), 0); // Wait till the receiver has notified controlling thread it is ready.</span></div>
<div class="line"><span id="1452" class="lineNum"><a href="#1452">1452</a></span><span class="counterUnCov"></span><span class="lineUnCov">    }</span></div>
<div class="line"><span id="1453" class="lineNum"><a href="#1453">1453</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="1454" class="lineNum"><a href="#1454">1454</a></span><span class="counterCov">6</span><span class="lineCov">    for _i in 0 .. SND_THREADS {</span></div>
<div class="line"><span id="1455" class="lineNum"><a href="#1455">1455</a></span><span class="counterCov">4</span><span class="lineCov">        snd_rx.recv().unwrap(); // Allow each sender to progress</span></div>
<div class="line"><span id="1456" class="lineNum"><a href="#1456">1456</a></span><span class="counterUnCov"></span><span class="lineUnCov">    }</span></div>
<div class="line"><span id="1457" class="lineNum"><a href="#1457">1457</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="1458" class="lineNum"><a href="#1458">1458</a></span><span class="counterCov">8</span><span class="lineCov">    for _i in 0 .. RCV_THREADS {</span></div>
<div class="line"><span id="1459" class="lineNum"><a href="#1459">1459</a></span><span class="counterCov">6</span><span class="lineCov">        let res: Vec&lt;Result&lt;Vec&lt;DMXData&gt;&gt;&gt; = rcv_rx.recv().unwrap();</span></div>
<div class="line"><span id="1460" class="lineNum"><a href="#1460">1460</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="1461" class="lineNum"><a href="#1461">1461</a></span><span class="counterCov">6</span><span class="lineCov">        assert_eq!(res.len(), SND_THREADS);</span></div>
<div class="line"><span id="1462" class="lineNum"><a href="#1462">1462</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="1463" class="lineNum"><a href="#1463">1463</a></span><span class="counterCov">6</span><span class="lineCov">        let mut rcv_dmx_datas: Vec&lt;DMXData&gt; = Vec::new();</span></div>
<div class="line"><span id="1464" class="lineNum"><a href="#1464">1464</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="1465" class="lineNum"><a href="#1465">1465</a></span><span class="counterCov">18</span><span class="lineCov">        for r in res {</span></div>
<div class="line"><span id="1466" class="lineNum"><a href="#1466">1466</a></span><span class="counterCov">12</span><span class="lineCov">            let data: Vec&lt;DMXData&gt; = r.unwrap(); // Check that there are no errors when receiving.</span></div>
<div class="line"><span id="1467" class="lineNum"><a href="#1467">1467</a></span><span class="counterCov">12</span><span class="lineCov">            assert_eq!(data.len(), 1); // Check that each universe was received separately.</span></div>
<div class="line"><span id="1468" class="lineNum"><a href="#1468">1468</a></span><span class="counterCov">12</span><span class="lineCov">            rcv_dmx_datas.push(data[0].clone());</span></div>
<div class="line"><span id="1469" class="lineNum"><a href="#1469">1469</a></span><span class="counterCov">18</span><span class="lineCov">        }</span></div>
<div class="line"><span id="1470" class="lineNum"><a href="#1470">1470</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="1471" class="lineNum"><a href="#1471">1471</a></span><span class="counterCov">6</span><span class="lineCov">        rcv_dmx_datas.sort_unstable(); // Sorting by universe allows easier checking as order received may vary depending on network.</span></div>
<div class="line"><span id="1472" class="lineNum"><a href="#1472">1472</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="1473" class="lineNum"><a href="#1473">1473</a></span><span class="counterCov">18</span><span class="lineCov">        for k in 0 .. SND_THREADS {</span></div>
<div class="line"><span id="1474" class="lineNum"><a href="#1474">1474</a></span><span class="counterCov">12</span><span class="lineCov">            assert_eq!(rcv_dmx_datas[k].universe, ((k as u16) + BASE_UNIVERSE)); // Check that the universe received is as expected.</span></div>
<div class="line"><span id="1475" class="lineNum"><a href="#1475">1475</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="1476" class="lineNum"><a href="#1476">1476</a></span><span class="counterCov">12</span><span class="lineCov">            assert_eq!(rcv_dmx_datas[k].values, snd_data[k], &quot;Received payload values don&#39;t match sent!&quot;);</span></div>
<div class="line"><span id="1477" class="lineNum"><a href="#1477">1477</a></span><span class="counterUnCov"></span><span class="lineUnCov">        }</span></div>
<div class="line"><span id="1478" class="lineNum"><a href="#1478">1478</a></span><span class="counterCov">6</span><span class="lineCov">    }</span></div>
<div class="line"><span id="1479" class="lineNum"><a href="#1479">1479</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="1480" class="lineNum"><a href="#1480">1480</a></span><span class="counterCov">6</span><span class="lineCov">    for s in snd_threads {</span></div>
<div class="line"><span id="1481" class="lineNum"><a href="#1481">1481</a></span><span class="counterCov">4</span><span class="lineCov">        s.join().unwrap();</span></div>
<div class="line"><span id="1482" class="lineNum"><a href="#1482">1482</a></span><span class="counterCov">2</span><span class="lineCov">    }</span></div>
<div class="line"><span id="1483" class="lineNum"><a href="#1483">1483</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="1484" class="lineNum"><a href="#1484">1484</a></span><span class="counterCov">8</span><span class="lineCov">    for r in rcv_threads {</span></div>
<div class="line"><span id="1485" class="lineNum"><a href="#1485">1485</a></span><span class="counterCov">6</span><span class="lineCov">        r.join().unwrap();</span></div>
<div class="line"><span id="1486" class="lineNum"><a href="#1486">1486</a></span><span class="counterCov">2</span><span class="lineCov">    }</span></div>
<div class="line"><span id="1487" class="lineNum"><a href="#1487">1487</a></span><span class="counterCov">4</span><span class="lineCov">}</span></div>
<div class="line"><span id="1488" class="lineNum"><a href="#1488">1488</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="1489" class="lineNum"><a href="#1489">1489</a></span><span class="counterUnCov"></span><span class="lineUnCov">#[test]</span></div>
<div class="line"><span id="1490" class="lineNum"><a href="#1490">1490</a></span><span class="counterCov">4</span><span class="lineCov">fn test_three_senders_three_recv_multicast_ipv4(){</span></div>
<div class="line"><span id="1491" class="lineNum"><a href="#1491">1491</a></span><span class="counterUnCov"></span><span class="lineUnCov">    const SND_THREADS: usize = 3;</span></div>
<div class="line"><span id="1492" class="lineNum"><a href="#1492">1492</a></span><span class="counterUnCov"></span><span class="lineUnCov">    const RCV_THREADS: usize = 3;</span></div>
<div class="line"><span id="1493" class="lineNum"><a href="#1493">1493</a></span><span class="counterUnCov"></span><span class="lineUnCov">    const SND_DATA_LEN: usize = 100;</span></div>
<div class="line"><span id="1494" class="lineNum"><a href="#1494">1494</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="1495" class="lineNum"><a href="#1495">1495</a></span><span class="counterCov">2</span><span class="lineCov">    let mut snd_data: Vec&lt;Vec&lt;u8&gt;&gt; = Vec::new();</span></div>
<div class="line"><span id="1496" class="lineNum"><a href="#1496">1496</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="1497" class="lineNum"><a href="#1497">1497</a></span><span class="counterCov">8</span><span class="lineCov">    for i in 1 .. SND_THREADS + 1 {</span></div>
<div class="line"><span id="1498" class="lineNum"><a href="#1498">1498</a></span><span class="counterCov">6</span><span class="lineCov">        let mut d: Vec&lt;u8&gt; = Vec::new();</span></div>
<div class="line"><span id="1499" class="lineNum"><a href="#1499">1499</a></span><span class="counterCov">606</span><span class="lineCov">        for _k in 0 .. SND_DATA_LEN {</span></div>
<div class="line"><span id="1500" class="lineNum"><a href="#1500">1500</a></span><span class="counterCov">600</span><span class="lineCov">            d.push(i as u8);</span></div>
<div class="line"><span id="1501" class="lineNum"><a href="#1501">1501</a></span><span class="counterUnCov"></span><span class="lineUnCov">        }</span></div>
<div class="line"><span id="1502" class="lineNum"><a href="#1502">1502</a></span><span class="counterCov">6</span><span class="lineCov">        snd_data.push(d);</span></div>
<div class="line"><span id="1503" class="lineNum"><a href="#1503">1503</a></span><span class="counterUnCov"></span><span class="lineUnCov">    }</span></div>
<div class="line"><span id="1504" class="lineNum"><a href="#1504">1504</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="1505" class="lineNum"><a href="#1505">1505</a></span><span class="counterCov">2</span><span class="lineCov">    let mut snd_threads = Vec::new();</span></div>
<div class="line"><span id="1506" class="lineNum"><a href="#1506">1506</a></span><span class="counterCov">2</span><span class="lineCov">    let mut rcv_threads = Vec::new();</span></div>
<div class="line"><span id="1507" class="lineNum"><a href="#1507">1507</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="1508" class="lineNum"><a href="#1508">1508</a></span><span class="counterCov">2</span><span class="lineCov">    let (rcv_tx, rcv_rx): (SyncSender&lt;Vec&lt;Result&lt;Vec&lt;DMXData&gt;&gt;&gt;&gt;, Receiver&lt;Vec&lt;Result&lt;Vec&lt;DMXData&gt;&gt;&gt;&gt;) = mpsc::sync_channel(0);</span></div>
<div class="line"><span id="1509" class="lineNum"><a href="#1509">1509</a></span><span class="counterCov">2</span><span class="lineCov">    let (snd_tx, snd_rx): (SyncSender&lt;()&gt;, Receiver&lt;()&gt;) = mpsc::sync_channel(0); // Used for handshaking, allows syncing the sender states.</span></div>
<div class="line"><span id="1510" class="lineNum"><a href="#1510">1510</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="1511" class="lineNum"><a href="#1511">1511</a></span><span class="counterCov">2</span><span class="lineCov">    assert!(RCV_THREADS &lt;= TEST_NETWORK_INTERFACE_IPV4.len(), &quot;Number of test network interface ips less than number of recv threads!&quot;);</span></div>
<div class="line"><span id="1512" class="lineNum"><a href="#1512">1512</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="1513" class="lineNum"><a href="#1513">1513</a></span><span class="counterUnCov"></span><span class="lineUnCov">    const BASE_UNIVERSE: u16 = 2;</span></div>
<div class="line"><span id="1514" class="lineNum"><a href="#1514">1514</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="1515" class="lineNum"><a href="#1515">1515</a></span><span class="counterCov">8</span><span class="lineCov">    for i in 0 .. SND_THREADS {</span></div>
<div class="line"><span id="1516" class="lineNum"><a href="#1516">1516</a></span><span class="counterCov">6</span><span class="lineCov">        let tx = snd_tx.clone();</span></div>
<div class="line"><span id="1517" class="lineNum"><a href="#1517">1517</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="1518" class="lineNum"><a href="#1518">1518</a></span><span class="counterCov">6</span><span class="lineCov">        let data = snd_data[i].clone();</span></div>
<div class="line"><span id="1519" class="lineNum"><a href="#1519">1519</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="1520" class="lineNum"><a href="#1520">1520</a></span><span class="counterCov">12</span><span class="lineCov">        snd_threads.push(thread::spawn(move || {</span></div>
<div class="line"><span id="1521" class="lineNum"><a href="#1521">1521</a></span><span class="counterCov">6</span><span class="lineCov">            let ip: SocketAddr = SocketAddr::new(IpAddr::V4(TEST_NETWORK_INTERFACE_IPV4[0].parse().unwrap()), ACN_SDT_MULTICAST_PORT + 1 + (i as u16));</span></div>
<div class="line"><span id="1522" class="lineNum"><a href="#1522">1522</a></span><span class="counterUnCov"></span><span class="lineUnCov">            // https://www.programming-idioms.org/idiom/153/concatenate-string-with-integer/1975/rust (11/01/2020)</span></div>
<div class="line"><span id="1523" class="lineNum"><a href="#1523">1523</a></span><span class="counterCov">6</span><span class="lineCov">            let mut src = SacnSource::with_ip(&amp;format!(&quot;Source {}&quot;, i), ip).unwrap();</span></div>
<div class="line"><span id="1524" class="lineNum"><a href="#1524">1524</a></span><span class="counterUnCov"></span><span class="lineUnCov">    </span></div>
<div class="line"><span id="1525" class="lineNum"><a href="#1525">1525</a></span><span class="counterCov">6</span><span class="lineCov">            let priority = 100;</span></div>
<div class="line"><span id="1526" class="lineNum"><a href="#1526">1526</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="1527" class="lineNum"><a href="#1527">1527</a></span><span class="counterCov">6</span><span class="lineCov">            let universe: u16 = (i as u16) + BASE_UNIVERSE; </span></div>
<div class="line"><span id="1528" class="lineNum"><a href="#1528">1528</a></span><span class="counterUnCov"></span><span class="lineUnCov">    </span></div>
<div class="line"><span id="1529" class="lineNum"><a href="#1529">1529</a></span><span class="counterCov">6</span><span class="lineCov">            src.register_universe(universe).unwrap(); // Senders all send on different universes.</span></div>
<div class="line"><span id="1530" class="lineNum"><a href="#1530">1530</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="1531" class="lineNum"><a href="#1531">1531</a></span><span class="counterCov">6</span><span class="lineCov">            tx.send(()).unwrap(); // Forces each sender thread to wait till the controlling thread receives which stops sending before the receivers are ready.</span></div>
<div class="line"><span id="1532" class="lineNum"><a href="#1532">1532</a></span><span class="counterUnCov"></span><span class="lineUnCov">    </span></div>
<div class="line"><span id="1533" class="lineNum"><a href="#1533">1533</a></span><span class="counterCov">6</span><span class="lineCov">            src.send(&amp;[universe], &amp;data, Some(priority), None, None).unwrap();</span></div>
<div class="line"><span id="1534" class="lineNum"><a href="#1534">1534</a></span><span class="counterCov">6</span><span class="lineCov">        }));</span></div>
<div class="line"><span id="1535" class="lineNum"><a href="#1535">1535</a></span><span class="counterUnCov"></span><span class="lineUnCov">    }</span></div>
<div class="line"><span id="1536" class="lineNum"><a href="#1536">1536</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="1537" class="lineNum"><a href="#1537">1537</a></span><span class="counterCov">8</span><span class="lineCov">    for i in 0 .. RCV_THREADS {</span></div>
<div class="line"><span id="1538" class="lineNum"><a href="#1538">1538</a></span><span class="counterCov">6</span><span class="lineCov">        let tx = rcv_tx.clone();</span></div>
<div class="line"><span id="1539" class="lineNum"><a href="#1539">1539</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="1540" class="lineNum"><a href="#1540">1540</a></span><span class="counterCov">12</span><span class="lineCov">        rcv_threads.push(thread::spawn(move || {</span></div>
<div class="line"><span id="1541" class="lineNum"><a href="#1541">1541</a></span><span class="counterUnCov"></span><span class="lineUnCov">            // Port kept the same so must use multiple IP&#39;s.</span></div>
<div class="line"><span id="1542" class="lineNum"><a href="#1542">1542</a></span><span class="counterCov">6</span><span class="lineCov">            let mut dmx_recv = SacnReceiver::with_ip(SocketAddr::new(IpAddr::V4(TEST_NETWORK_INTERFACE_IPV4[i].parse().unwrap()), ACN_SDT_MULTICAST_PORT), None).unwrap();</span></div>
<div class="line"><span id="1543" class="lineNum"><a href="#1543">1543</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="1544" class="lineNum"><a href="#1544">1544</a></span><span class="counterUnCov"></span><span class="lineUnCov">            // Receivers listen to all universes</span></div>
<div class="line"><span id="1545" class="lineNum"><a href="#1545">1545</a></span><span class="counterCov">24</span><span class="lineCov">            for i in (BASE_UNIVERSE as u16) .. ((SND_THREADS as u16) + (BASE_UNIVERSE as u16)) {</span></div>
<div class="line"><span id="1546" class="lineNum"><a href="#1546">1546</a></span><span class="counterCov">18</span><span class="lineCov">                dmx_recv.listen_universes(&amp;[i]).unwrap();</span></div>
<div class="line"><span id="1547" class="lineNum"><a href="#1547">1547</a></span><span class="counterUnCov"></span><span class="lineUnCov">            }</span></div>
<div class="line"><span id="1548" class="lineNum"><a href="#1548">1548</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="1549" class="lineNum"><a href="#1549">1549</a></span><span class="counterCov">6</span><span class="lineCov">            let mut res: Vec&lt;Result&lt;Vec&lt;DMXData&gt;&gt;&gt; = Vec::new();</span></div>
<div class="line"><span id="1550" class="lineNum"><a href="#1550">1550</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="1551" class="lineNum"><a href="#1551">1551</a></span><span class="counterCov">6</span><span class="lineCov">            tx.send(Vec::new()).unwrap(); // Receiver notifies controlling thread it is ready.</span></div>
<div class="line"><span id="1552" class="lineNum"><a href="#1552">1552</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="1553" class="lineNum"><a href="#1553">1553</a></span><span class="counterCov">24</span><span class="lineCov">            for _i in 0 .. SND_THREADS { // Receiver should receive from every universe.</span></div>
<div class="line"><span id="1554" class="lineNum"><a href="#1554">1554</a></span><span class="counterCov">18</span><span class="lineCov">                res.push(dmx_recv.recv(None)); // Receiver won&#39;t complete this until it receives from the senders which are all held waiting on the controlling thread.</span></div>
<div class="line"><span id="1555" class="lineNum"><a href="#1555">1555</a></span><span class="counterUnCov"></span><span class="lineUnCov">            }</span></div>
<div class="line"><span id="1556" class="lineNum"><a href="#1556">1556</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="1557" class="lineNum"><a href="#1557">1557</a></span><span class="counterUnCov"></span><span class="lineUnCov">            // Results of each receive are sent back, this allows checking that each receive was an expected universe, all universes were received and there were no errors.</span></div>
<div class="line"><span id="1558" class="lineNum"><a href="#1558">1558</a></span><span class="counterCov">6</span><span class="lineCov">            tx.send(res).unwrap(); </span></div>
<div class="line"><span id="1559" class="lineNum"><a href="#1559">1559</a></span><span class="counterCov">6</span><span class="lineCov">        }));</span></div>
<div class="line"><span id="1560" class="lineNum"><a href="#1560">1560</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="1561" class="lineNum"><a href="#1561">1561</a></span><span class="counterCov">6</span><span class="lineCov">        assert_eq!(rcv_rx.recv().unwrap().len(), 0); // Wait till the receiver has notified controlling thread it is ready.</span></div>
<div class="line"><span id="1562" class="lineNum"><a href="#1562">1562</a></span><span class="counterUnCov"></span><span class="lineUnCov">    }</span></div>
<div class="line"><span id="1563" class="lineNum"><a href="#1563">1563</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="1564" class="lineNum"><a href="#1564">1564</a></span><span class="counterCov">8</span><span class="lineCov">    for _i in 0 .. SND_THREADS {</span></div>
<div class="line"><span id="1565" class="lineNum"><a href="#1565">1565</a></span><span class="counterCov">6</span><span class="lineCov">        snd_rx.recv().unwrap(); // Allow each sender to progress</span></div>
<div class="line"><span id="1566" class="lineNum"><a href="#1566">1566</a></span><span class="counterUnCov"></span><span class="lineUnCov">    }</span></div>
<div class="line"><span id="1567" class="lineNum"><a href="#1567">1567</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="1568" class="lineNum"><a href="#1568">1568</a></span><span class="counterCov">8</span><span class="lineCov">    for _i in 0 .. RCV_THREADS {</span></div>
<div class="line"><span id="1569" class="lineNum"><a href="#1569">1569</a></span><span class="counterCov">6</span><span class="lineCov">        let res: Vec&lt;Result&lt;Vec&lt;DMXData&gt;&gt;&gt; = rcv_rx.recv().unwrap();</span></div>
<div class="line"><span id="1570" class="lineNum"><a href="#1570">1570</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="1571" class="lineNum"><a href="#1571">1571</a></span><span class="counterCov">6</span><span class="lineCov">        assert_eq!(res.len(), SND_THREADS);</span></div>
<div class="line"><span id="1572" class="lineNum"><a href="#1572">1572</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="1573" class="lineNum"><a href="#1573">1573</a></span><span class="counterCov">6</span><span class="lineCov">        let mut rcv_dmx_datas: Vec&lt;DMXData&gt; = Vec::new();</span></div>
<div class="line"><span id="1574" class="lineNum"><a href="#1574">1574</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="1575" class="lineNum"><a href="#1575">1575</a></span><span class="counterCov">24</span><span class="lineCov">        for r in res {</span></div>
<div class="line"><span id="1576" class="lineNum"><a href="#1576">1576</a></span><span class="counterCov">18</span><span class="lineCov">            let data: Vec&lt;DMXData&gt; = r.unwrap(); // Check that there are no errors when receiving.</span></div>
<div class="line"><span id="1577" class="lineNum"><a href="#1577">1577</a></span><span class="counterCov">18</span><span class="lineCov">            assert_eq!(data.len(), 1); // Check that each universe was received separately.</span></div>
<div class="line"><span id="1578" class="lineNum"><a href="#1578">1578</a></span><span class="counterCov">18</span><span class="lineCov">            rcv_dmx_datas.push(data[0].clone());</span></div>
<div class="line"><span id="1579" class="lineNum"><a href="#1579">1579</a></span><span class="counterCov">24</span><span class="lineCov">        }</span></div>
<div class="line"><span id="1580" class="lineNum"><a href="#1580">1580</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="1581" class="lineNum"><a href="#1581">1581</a></span><span class="counterCov">6</span><span class="lineCov">        rcv_dmx_datas.sort_unstable(); // Sorting by universe allows easier checking as order received may vary depending on network.</span></div>
<div class="line"><span id="1582" class="lineNum"><a href="#1582">1582</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="1583" class="lineNum"><a href="#1583">1583</a></span><span class="counterCov">24</span><span class="lineCov">        for k in 0 .. SND_THREADS {</span></div>
<div class="line"><span id="1584" class="lineNum"><a href="#1584">1584</a></span><span class="counterCov">18</span><span class="lineCov">            assert_eq!(rcv_dmx_datas[k].universe, ((k as u16) + BASE_UNIVERSE)); // Check that the universe received is as expected.</span></div>
<div class="line"><span id="1585" class="lineNum"><a href="#1585">1585</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="1586" class="lineNum"><a href="#1586">1586</a></span><span class="counterCov">18</span><span class="lineCov">            assert_eq!(rcv_dmx_datas[k].values, snd_data[k], &quot;Received payload values don&#39;t match sent!&quot;);</span></div>
<div class="line"><span id="1587" class="lineNum"><a href="#1587">1587</a></span><span class="counterUnCov"></span><span class="lineUnCov">        }</span></div>
<div class="line"><span id="1588" class="lineNum"><a href="#1588">1588</a></span><span class="counterCov">6</span><span class="lineCov">    }</span></div>
<div class="line"><span id="1589" class="lineNum"><a href="#1589">1589</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="1590" class="lineNum"><a href="#1590">1590</a></span><span class="counterCov">8</span><span class="lineCov">    for s in snd_threads {</span></div>
<div class="line"><span id="1591" class="lineNum"><a href="#1591">1591</a></span><span class="counterCov">6</span><span class="lineCov">        s.join().unwrap();</span></div>
<div class="line"><span id="1592" class="lineNum"><a href="#1592">1592</a></span><span class="counterCov">2</span><span class="lineCov">    }</span></div>
<div class="line"><span id="1593" class="lineNum"><a href="#1593">1593</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="1594" class="lineNum"><a href="#1594">1594</a></span><span class="counterCov">8</span><span class="lineCov">    for r in rcv_threads {</span></div>
<div class="line"><span id="1595" class="lineNum"><a href="#1595">1595</a></span><span class="counterCov">6</span><span class="lineCov">        r.join().unwrap();</span></div>
<div class="line"><span id="1596" class="lineNum"><a href="#1596">1596</a></span><span class="counterCov">2</span><span class="lineCov">    }</span></div>
<div class="line"><span id="1597" class="lineNum"><a href="#1597">1597</a></span><span class="counterCov">4</span><span class="lineCov">}</span></div>
<div class="line"><span id="1598" class="lineNum"><a href="#1598">1598</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="1599" class="lineNum"><a href="#1599">1599</a></span><span class="counterUnCov"></span><span class="lineUnCov">#[test]</span></div>
<div class="line"><span id="1600" class="lineNum"><a href="#1600">1600</a></span><span class="counterCov">4</span><span class="lineCov">fn test_universe_discovery_one_universe_one_source_ipv4(){</span></div>
<div class="line"><span id="1601" class="lineNum"><a href="#1601">1601</a></span><span class="counterUnCov"></span><span class="lineUnCov">    const SND_THREADS: usize = 1;</span></div>
<div class="line"><span id="1602" class="lineNum"><a href="#1602">1602</a></span><span class="counterUnCov"></span><span class="lineUnCov">    const BASE_UNIVERSE: u16 = 2;</span></div>
<div class="line"><span id="1603" class="lineNum"><a href="#1603">1603</a></span><span class="counterUnCov"></span><span class="lineUnCov">    const UNIVERSE_COUNT: usize = 1;</span></div>
<div class="line"><span id="1604" class="lineNum"><a href="#1604">1604</a></span><span class="counterUnCov"></span><span class="lineUnCov">    const SOURCE_NAMES: [&amp;&#39;static str; 1] = [&quot;Source 1&quot;];</span></div>
<div class="line"><span id="1605" class="lineNum"><a href="#1605">1605</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="1606" class="lineNum"><a href="#1606">1606</a></span><span class="counterCov">2</span><span class="lineCov">    let (snd_tx, snd_rx): (SyncSender&lt;()&gt;, Receiver&lt;()&gt;) = mpsc::sync_channel(0);</span></div>
<div class="line"><span id="1607" class="lineNum"><a href="#1607">1607</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="1608" class="lineNum"><a href="#1608">1608</a></span><span class="counterCov">2</span><span class="lineCov">    let mut snd_threads = Vec::new();</span></div>
<div class="line"><span id="1609" class="lineNum"><a href="#1609">1609</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="1610" class="lineNum"><a href="#1610">1610</a></span><span class="counterCov">4</span><span class="lineCov">    for i in 0 .. SND_THREADS {</span></div>
<div class="line"><span id="1611" class="lineNum"><a href="#1611">1611</a></span><span class="counterCov">2</span><span class="lineCov">        let tx = snd_tx.clone();</span></div>
<div class="line"><span id="1612" class="lineNum"><a href="#1612">1612</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="1613" class="lineNum"><a href="#1613">1613</a></span><span class="counterCov">4</span><span class="lineCov">        snd_threads.push(thread::spawn(move || {</span></div>
<div class="line"><span id="1614" class="lineNum"><a href="#1614">1614</a></span><span class="counterCov">2</span><span class="lineCov">            let ip: SocketAddr = SocketAddr::new(IpAddr::V4(TEST_NETWORK_INTERFACE_IPV4[0].parse().unwrap()), ACN_SDT_MULTICAST_PORT + 1 + (i as u16));</span></div>
<div class="line"><span id="1615" class="lineNum"><a href="#1615">1615</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="1616" class="lineNum"><a href="#1616">1616</a></span><span class="counterCov">2</span><span class="lineCov">            let mut src = SacnSource::with_ip(SOURCE_NAMES[i], ip).unwrap();</span></div>
<div class="line"><span id="1617" class="lineNum"><a href="#1617">1617</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="1618" class="lineNum"><a href="#1618">1618</a></span><span class="counterCov">2</span><span class="lineCov">            let mut universes: Vec&lt;u16&gt; = Vec::new();</span></div>
<div class="line"><span id="1619" class="lineNum"><a href="#1619">1619</a></span><span class="counterCov">4</span><span class="lineCov">            for j in 0 .. UNIVERSE_COUNT {</span></div>
<div class="line"><span id="1620" class="lineNum"><a href="#1620">1620</a></span><span class="counterCov">2</span><span class="lineCov">                universes.push(((i + j) as u16) + BASE_UNIVERSE);</span></div>
<div class="line"><span id="1621" class="lineNum"><a href="#1621">1621</a></span><span class="counterUnCov"></span><span class="lineUnCov">            }</span></div>
<div class="line"><span id="1622" class="lineNum"><a href="#1622">1622</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="1623" class="lineNum"><a href="#1623">1623</a></span><span class="counterCov">2</span><span class="lineCov">            src.register_universes(&amp;universes).unwrap();</span></div>
<div class="line"><span id="1624" class="lineNum"><a href="#1624">1624</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="1625" class="lineNum"><a href="#1625">1625</a></span><span class="counterCov">2</span><span class="lineCov">            tx.send(()).unwrap(); // Used to force the sender to wait till the receiver has received a universe discovery.</span></div>
<div class="line"><span id="1626" class="lineNum"><a href="#1626">1626</a></span><span class="counterCov">2</span><span class="lineCov">        }));</span></div>
<div class="line"><span id="1627" class="lineNum"><a href="#1627">1627</a></span><span class="counterUnCov"></span><span class="lineUnCov">    }</span></div>
<div class="line"><span id="1628" class="lineNum"><a href="#1628">1628</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="1629" class="lineNum"><a href="#1629">1629</a></span><span class="counterCov">2</span><span class="lineCov">    let mut dmx_recv = SacnReceiver::with_ip(SocketAddr::new(IpAddr::V4(TEST_NETWORK_INTERFACE_IPV4[0].parse().unwrap()), ACN_SDT_MULTICAST_PORT), None).unwrap();</span></div>
<div class="line"><span id="1630" class="lineNum"><a href="#1630">1630</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="1631" class="lineNum"><a href="#1631">1631</a></span><span class="counterCov">10</span><span class="lineCov">    loop { </span></div>
<div class="line"><span id="1632" class="lineNum"><a href="#1632">1632</a></span><span class="counterCov">10</span><span class="lineCov">        let result = dmx_recv.recv(Some(Duration::from_secs(2)));</span></div>
<div class="line"><span id="1633" class="lineNum"><a href="#1633">1633</a></span><span class="counterNoCov">0</span><span class="lineNoCov">        match result { </span></div>
<div class="line"><span id="1634" class="lineNum"><a href="#1634">1634</a></span><span class="counterCov">10</span><span class="lineCov">            Err(e) =&gt; {</span></div>
<div class="line"><span id="1635" class="lineNum"><a href="#1635">1635</a></span><span class="counterCov">10</span><span class="lineCov">                match e.kind() {</span></div>
<div class="line"><span id="1636" class="lineNum"><a href="#1636">1636</a></span><span class="counterCov">10</span><span class="lineCov">                    &amp;ErrorKind::Io(ref s) =&gt; {</span></div>
<div class="line"><span id="1637" class="lineNum"><a href="#1637">1637</a></span><span class="counterCov">10</span><span class="lineCov">                        match s.kind() {</span></div>
<div class="line"><span id="1638" class="lineNum"><a href="#1638">1638</a></span><span class="counterCov">10</span><span class="lineCov">                            std::io::ErrorKind::WouldBlock =&gt; {</span></div>
<div class="line"><span id="1639" class="lineNum"><a href="#1639">1639</a></span><span class="counterUnCov"></span><span class="lineUnCov">                                // Expected to timeout / would block.</span></div>
<div class="line"><span id="1640" class="lineNum"><a href="#1640">1640</a></span><span class="counterUnCov"></span><span class="lineUnCov">                                // The different errors are due to windows and unix returning different errors for the same thing.</span></div>
<div class="line"><span id="1641" class="lineNum"><a href="#1641">1641</a></span><span class="counterUnCov"></span><span class="lineUnCov">                            },</span></div>
<div class="line"><span id="1642" class="lineNum"><a href="#1642">1642</a></span><span class="counterUnCov"></span><span class="lineUnCov">                            std::io::ErrorKind::TimedOut =&gt; {},</span></div>
<div class="line"><span id="1643" class="lineNum"><a href="#1643">1643</a></span><span class="counterUnCov"></span><span class="lineUnCov">                            _ =&gt; {</span></div>
<div class="line"><span id="1644" class="lineNum"><a href="#1644">1644</a></span><span class="counterNoCov">0</span><span class="lineNoCov">                                assert!(false, &quot;Unexpected error returned&quot;);</span></div>
<div class="line"><span id="1645" class="lineNum"><a href="#1645">1645</a></span><span class="counterUnCov"></span><span class="lineUnCov">                            }</span></div>
<div class="line"><span id="1646" class="lineNum"><a href="#1646">1646</a></span><span class="counterUnCov"></span><span class="lineUnCov">                        }</span></div>
<div class="line"><span id="1647" class="lineNum"><a href="#1647">1647</a></span><span class="counterUnCov"></span><span class="lineUnCov">                    },</span></div>
<div class="line"><span id="1648" class="lineNum"><a href="#1648">1648</a></span><span class="counterUnCov"></span><span class="lineUnCov">                    _ =&gt; {</span></div>
<div class="line"><span id="1649" class="lineNum"><a href="#1649">1649</a></span><span class="counterNoCov">0</span><span class="lineNoCov">                        assert!(false, &quot;Unexpected error returned&quot;);</span></div>
<div class="line"><span id="1650" class="lineNum"><a href="#1650">1650</a></span><span class="counterUnCov"></span><span class="lineUnCov">                    }</span></div>
<div class="line"><span id="1651" class="lineNum"><a href="#1651">1651</a></span><span class="counterUnCov"></span><span class="lineUnCov">                }</span></div>
<div class="line"><span id="1652" class="lineNum"><a href="#1652">1652</a></span><span class="counterCov">10</span><span class="lineCov">            },</span></div>
<div class="line"><span id="1653" class="lineNum"><a href="#1653">1653</a></span><span class="counterUnCov"></span><span class="lineUnCov">            Ok(_) =&gt; {</span></div>
<div class="line"><span id="1654" class="lineNum"><a href="#1654">1654</a></span><span class="counterNoCov">0</span><span class="lineNoCov">                assert!(false, &quot;No data should have been passed up!&quot;);</span></div>
<div class="line"><span id="1655" class="lineNum"><a href="#1655">1655</a></span><span class="counterUnCov"></span><span class="lineUnCov">            }</span></div>
<div class="line"><span id="1656" class="lineNum"><a href="#1656">1656</a></span><span class="counterUnCov"></span><span class="lineUnCov">        }</span></div>
<div class="line"><span id="1657" class="lineNum"><a href="#1657">1657</a></span><span class="counterUnCov"></span><span class="lineUnCov">        </span></div>
<div class="line"><span id="1658" class="lineNum"><a href="#1658">1658</a></span><span class="counterCov">10</span><span class="lineCov">        let discovered = dmx_recv.get_discovered_sources(); </span></div>
<div class="line"><span id="1659" class="lineNum"><a href="#1659">1659</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="1660" class="lineNum"><a href="#1660">1660</a></span><span class="counterCov">10</span><span class="lineCov">        if discovered.len() &gt; 0 {</span></div>
<div class="line"><span id="1661" class="lineNum"><a href="#1661">1661</a></span><span class="counterCov">2</span><span class="lineCov">            assert_eq!(discovered.len(), 1);</span></div>
<div class="line"><span id="1662" class="lineNum"><a href="#1662">1662</a></span><span class="counterCov">2</span><span class="lineCov">            assert_eq!(discovered[0].name, SOURCE_NAMES[0]);</span></div>
<div class="line"><span id="1663" class="lineNum"><a href="#1663">1663</a></span><span class="counterCov">2</span><span class="lineCov">            let universes = discovered[0].get_all_universes();</span></div>
<div class="line"><span id="1664" class="lineNum"><a href="#1664">1664</a></span><span class="counterCov">2</span><span class="lineCov">            assert_eq!(universes.len(), UNIVERSE_COUNT);</span></div>
<div class="line"><span id="1665" class="lineNum"><a href="#1665">1665</a></span><span class="counterCov">4</span><span class="lineCov">            for j in 0 .. UNIVERSE_COUNT {</span></div>
<div class="line"><span id="1666" class="lineNum"><a href="#1666">1666</a></span><span class="counterCov">2</span><span class="lineCov">                assert_eq!(universes[j], (j as u16) + BASE_UNIVERSE);</span></div>
<div class="line"><span id="1667" class="lineNum"><a href="#1667">1667</a></span><span class="counterUnCov"></span><span class="lineUnCov">            }</span></div>
<div class="line"><span id="1668" class="lineNum"><a href="#1668">1668</a></span><span class="counterUnCov"></span><span class="lineUnCov">            break;</span></div>
<div class="line"><span id="1669" class="lineNum"><a href="#1669">1669</a></span><span class="counterCov">2</span><span class="lineCov">        }</span></div>
<div class="line"><span id="1670" class="lineNum"><a href="#1670">1670</a></span><span class="counterCov">10</span><span class="lineCov">    }</span></div>
<div class="line"><span id="1671" class="lineNum"><a href="#1671">1671</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="1672" class="lineNum"><a href="#1672">1672</a></span><span class="counterCov">2</span><span class="lineCov">    snd_rx.recv().unwrap();</span></div>
<div class="line"><span id="1673" class="lineNum"><a href="#1673">1673</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="1674" class="lineNum"><a href="#1674">1674</a></span><span class="counterCov">4</span><span class="lineCov">    for s in snd_threads {</span></div>
<div class="line"><span id="1675" class="lineNum"><a href="#1675">1675</a></span><span class="counterCov">2</span><span class="lineCov">        s.join().unwrap();</span></div>
<div class="line"><span id="1676" class="lineNum"><a href="#1676">1676</a></span><span class="counterCov">2</span><span class="lineCov">    }</span></div>
<div class="line"><span id="1677" class="lineNum"><a href="#1677">1677</a></span><span class="counterCov">4</span><span class="lineCov">}</span></div>
<div class="line"><span id="1678" class="lineNum"><a href="#1678">1678</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="1679" class="lineNum"><a href="#1679">1679</a></span><span class="counterUnCov"></span><span class="lineUnCov">/// Measures the time taken in milliseconds between 2 discovery packets to check that the interval fits with expected.</span></div>
<div class="line"><span id="1680" class="lineNum"><a href="#1680">1680</a></span><span class="counterUnCov"></span><span class="lineUnCov">#[test]</span></div>
<div class="line"><span id="1681" class="lineNum"><a href="#1681">1681</a></span><span class="counterCov">4</span><span class="lineCov">fn test_universe_discovery_interval_ipv4(){</span></div>
<div class="line"><span id="1682" class="lineNum"><a href="#1682">1682</a></span><span class="counterUnCov"></span><span class="lineUnCov">    const SND_THREADS: usize = 1;</span></div>
<div class="line"><span id="1683" class="lineNum"><a href="#1683">1683</a></span><span class="counterUnCov"></span><span class="lineUnCov">    const BASE_UNIVERSE: u16 = 1;</span></div>
<div class="line"><span id="1684" class="lineNum"><a href="#1684">1684</a></span><span class="counterUnCov"></span><span class="lineUnCov">    const SOURCE_NAMES: [&amp;&#39;static str; 1] = [&quot;Source 1&quot;];</span></div>
<div class="line"><span id="1685" class="lineNum"><a href="#1685">1685</a></span><span class="counterUnCov"></span><span class="lineUnCov">    const INTERVAL_EXPECTED_MILLIS: u128 = E131_UNIVERSE_DISCOVERY_INTERVAL.as_millis(); // Expected discovery packet interval is every 10 seconds (10000 milliseconds).</span></div>
<div class="line"><span id="1686" class="lineNum"><a href="#1686">1686</a></span><span class="counterUnCov"></span><span class="lineUnCov">    const INTERVAL_TOLERANCE_MILLIS: u128 = 1000; // Allow up to a second either side of this interval to account for random variations.</span></div>
<div class="line"><span id="1687" class="lineNum"><a href="#1687">1687</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="1688" class="lineNum"><a href="#1688">1688</a></span><span class="counterCov">2</span><span class="lineCov">    let (snd_tx, snd_rx): (SyncSender&lt;()&gt;, Receiver&lt;()&gt;) = mpsc::sync_channel(0);</span></div>
<div class="line"><span id="1689" class="lineNum"><a href="#1689">1689</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="1690" class="lineNum"><a href="#1690">1690</a></span><span class="counterCov">2</span><span class="lineCov">    let mut snd_threads = Vec::new();</span></div>
<div class="line"><span id="1691" class="lineNum"><a href="#1691">1691</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="1692" class="lineNum"><a href="#1692">1692</a></span><span class="counterCov">4</span><span class="lineCov">    for i in 0 .. SND_THREADS {</span></div>
<div class="line"><span id="1693" class="lineNum"><a href="#1693">1693</a></span><span class="counterCov">2</span><span class="lineCov">        let tx = snd_tx.clone();</span></div>
<div class="line"><span id="1694" class="lineNum"><a href="#1694">1694</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="1695" class="lineNum"><a href="#1695">1695</a></span><span class="counterCov">4</span><span class="lineCov">        snd_threads.push(thread::spawn(move || {</span></div>
<div class="line"><span id="1696" class="lineNum"><a href="#1696">1696</a></span><span class="counterCov">2</span><span class="lineCov">            let ip: SocketAddr = SocketAddr::new(IpAddr::V4(TEST_NETWORK_INTERFACE_IPV4[0].parse().unwrap()), ACN_SDT_MULTICAST_PORT + 1 + (i as u16));</span></div>
<div class="line"><span id="1697" class="lineNum"><a href="#1697">1697</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="1698" class="lineNum"><a href="#1698">1698</a></span><span class="counterCov">2</span><span class="lineCov">            tx.send(()).unwrap(); // Force the send thread to wait before creating the sender, should sync once the receiver has been created.</span></div>
<div class="line"><span id="1699" class="lineNum"><a href="#1699">1699</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="1700" class="lineNum"><a href="#1700">1700</a></span><span class="counterCov">2</span><span class="lineCov">            let mut src = SacnSource::with_ip(SOURCE_NAMES[i], ip).unwrap();</span></div>
<div class="line"><span id="1701" class="lineNum"><a href="#1701">1701</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="1702" class="lineNum"><a href="#1702">1702</a></span><span class="counterCov">2</span><span class="lineCov">            src.register_universes(&amp;[BASE_UNIVERSE]).unwrap();</span></div>
<div class="line"><span id="1703" class="lineNum"><a href="#1703">1703</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="1704" class="lineNum"><a href="#1704">1704</a></span><span class="counterCov">2</span><span class="lineCov">            tx.send(()).unwrap(); // Used to force the sender to wait till the receiver has received a universe discovery.</span></div>
<div class="line"><span id="1705" class="lineNum"><a href="#1705">1705</a></span><span class="counterCov">2</span><span class="lineCov">        }));</span></div>
<div class="line"><span id="1706" class="lineNum"><a href="#1706">1706</a></span><span class="counterUnCov"></span><span class="lineUnCov">    }</span></div>
<div class="line"><span id="1707" class="lineNum"><a href="#1707">1707</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="1708" class="lineNum"><a href="#1708">1708</a></span><span class="counterCov">2</span><span class="lineCov">    let mut dmx_recv = SacnReceiver::with_ip(SocketAddr::new(IpAddr::V4(TEST_NETWORK_INTERFACE_IPV4[0].parse().unwrap()), ACN_SDT_MULTICAST_PORT), None).unwrap();</span></div>
<div class="line"><span id="1709" class="lineNum"><a href="#1709">1709</a></span><span class="counterCov">2</span><span class="lineCov">    dmx_recv.set_announce_source_discovery(true); // Make the receiver explicitly notify when it receives a universe discovery packet.</span></div>
<div class="line"><span id="1710" class="lineNum"><a href="#1710">1710</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="1711" class="lineNum"><a href="#1711">1711</a></span><span class="counterCov">2</span><span class="lineCov">    snd_rx.recv().unwrap(); // Receiver created and ready so allow the sender to be created.</span></div>
<div class="line"><span id="1712" class="lineNum"><a href="#1712">1712</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="1713" class="lineNum"><a href="#1713">1713</a></span><span class="counterCov">2</span><span class="lineCov">    let mut interval_start = Instant::now(); // Assignment never used.</span></div>
<div class="line"><span id="1714" class="lineNum"><a href="#1714">1714</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="1715" class="lineNum"><a href="#1715">1715</a></span><span class="counterCov">2</span><span class="lineCov">    match dmx_recv.recv(None) {</span></div>
<div class="line"><span id="1716" class="lineNum"><a href="#1716">1716</a></span><span class="counterCov">2</span><span class="lineCov">        Err(e) =&gt; {</span></div>
<div class="line"><span id="1717" class="lineNum"><a href="#1717">1717</a></span><span class="counterCov">2</span><span class="lineCov">            match e.kind() {</span></div>
<div class="line"><span id="1718" class="lineNum"><a href="#1718">1718</a></span><span class="counterCov">2</span><span class="lineCov">                ErrorKind::SourceDiscovered(_) =&gt; {</span></div>
<div class="line"><span id="1719" class="lineNum"><a href="#1719">1719</a></span><span class="counterUnCov"></span><span class="lineUnCov">                    // Measure the time between the first and second discovery packets, this removes the uncertainty in the time taken for the sender to start.</span></div>
<div class="line"><span id="1720" class="lineNum"><a href="#1720">1720</a></span><span class="counterCov">2</span><span class="lineCov">                    interval_start = Instant::now();</span></div>
<div class="line"><span id="1721" class="lineNum"><a href="#1721">1721</a></span><span class="counterUnCov"></span><span class="lineUnCov">                }</span></div>
<div class="line"><span id="1722" class="lineNum"><a href="#1722">1722</a></span><span class="counterNoCov">0</span><span class="lineNoCov">                k =&gt; {</span></div>
<div class="line"><span id="1723" class="lineNum"><a href="#1723">1723</a></span><span class="counterNoCov">0</span><span class="lineNoCov">                    assert!(false, &quot;Unexpected error kind, {:?}&quot;, k);</span></div>
<div class="line"><span id="1724" class="lineNum"><a href="#1724">1724</a></span><span class="counterUnCov"></span><span class="lineUnCov">                }</span></div>
<div class="line"><span id="1725" class="lineNum"><a href="#1725">1725</a></span><span class="counterUnCov"></span><span class="lineUnCov">            }</span></div>
<div class="line"><span id="1726" class="lineNum"><a href="#1726">1726</a></span><span class="counterUnCov"></span><span class="lineUnCov">        }</span></div>
<div class="line"><span id="1727" class="lineNum"><a href="#1727">1727</a></span><span class="counterCov">2</span><span class="lineCov">        Ok(d) =&gt; {</span></div>
<div class="line"><span id="1728" class="lineNum"><a href="#1728">1728</a></span><span class="counterNoCov">0</span><span class="lineNoCov">            assert!(false, &quot;No data expected, {:?}&quot;, d);</span></div>
<div class="line"><span id="1729" class="lineNum"><a href="#1729">1729</a></span><span class="counterUnCov"></span><span class="lineUnCov">        }</span></div>
<div class="line"><span id="1730" class="lineNum"><a href="#1730">1730</a></span><span class="counterUnCov"></span><span class="lineUnCov">    }</span></div>
<div class="line"><span id="1731" class="lineNum"><a href="#1731">1731</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="1732" class="lineNum"><a href="#1732">1732</a></span><span class="counterCov">2</span><span class="lineCov">    match dmx_recv.recv(None) {</span></div>
<div class="line"><span id="1733" class="lineNum"><a href="#1733">1733</a></span><span class="counterCov">2</span><span class="lineCov">        Err(e) =&gt; {</span></div>
<div class="line"><span id="1734" class="lineNum"><a href="#1734">1734</a></span><span class="counterCov">2</span><span class="lineCov">            match e.kind() {</span></div>
<div class="line"><span id="1735" class="lineNum"><a href="#1735">1735</a></span><span class="counterCov">2</span><span class="lineCov">                ErrorKind::SourceDiscovered(_) =&gt; {</span></div>
<div class="line"><span id="1736" class="lineNum"><a href="#1736">1736</a></span><span class="counterCov">2</span><span class="lineCov">                    let interval = interval_start.elapsed();</span></div>
<div class="line"><span id="1737" class="lineNum"><a href="#1737">1737</a></span><span class="counterCov">2</span><span class="lineCov">                    let interval_millis = interval.as_millis();</span></div>
<div class="line"><span id="1738" class="lineNum"><a href="#1738">1738</a></span><span class="counterCov">2</span><span class="lineCov">                    assert!(interval_millis &gt; (INTERVAL_EXPECTED_MILLIS - INTERVAL_TOLERANCE_MILLIS), format!(&quot;Discovery interval is shorter than expected, {} ms&quot;, interval_millis));</span></div>
<div class="line"><span id="1739" class="lineNum"><a href="#1739">1739</a></span><span class="counterCov">2</span><span class="lineCov">                    assert!(interval_millis &lt; (INTERVAL_EXPECTED_MILLIS + INTERVAL_TOLERANCE_MILLIS), format!(&quot;Discovery interval is longer than expected, {} ms&quot;, interval_millis));</span></div>
<div class="line"><span id="1740" class="lineNum"><a href="#1740">1740</a></span><span class="counterUnCov"></span><span class="lineUnCov">                }</span></div>
<div class="line"><span id="1741" class="lineNum"><a href="#1741">1741</a></span><span class="counterNoCov">0</span><span class="lineNoCov">                k =&gt; {</span></div>
<div class="line"><span id="1742" class="lineNum"><a href="#1742">1742</a></span><span class="counterNoCov">0</span><span class="lineNoCov">                    assert!(false, &quot;Unexpected error kind, {:?}&quot;, k);</span></div>
<div class="line"><span id="1743" class="lineNum"><a href="#1743">1743</a></span><span class="counterUnCov"></span><span class="lineUnCov">                }</span></div>
<div class="line"><span id="1744" class="lineNum"><a href="#1744">1744</a></span><span class="counterUnCov"></span><span class="lineUnCov">            }</span></div>
<div class="line"><span id="1745" class="lineNum"><a href="#1745">1745</a></span><span class="counterUnCov"></span><span class="lineUnCov">        }</span></div>
<div class="line"><span id="1746" class="lineNum"><a href="#1746">1746</a></span><span class="counterCov">2</span><span class="lineCov">        Ok(d) =&gt; {</span></div>
<div class="line"><span id="1747" class="lineNum"><a href="#1747">1747</a></span><span class="counterNoCov">0</span><span class="lineNoCov">            assert!(false, &quot;No data expected, {:?}&quot;, d);</span></div>
<div class="line"><span id="1748" class="lineNum"><a href="#1748">1748</a></span><span class="counterUnCov"></span><span class="lineUnCov">        }</span></div>
<div class="line"><span id="1749" class="lineNum"><a href="#1749">1749</a></span><span class="counterUnCov"></span><span class="lineUnCov">    }</span></div>
<div class="line"><span id="1750" class="lineNum"><a href="#1750">1750</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="1751" class="lineNum"><a href="#1751">1751</a></span><span class="counterCov">2</span><span class="lineCov">    snd_rx.recv().unwrap(); // Allow sender to finish.</span></div>
<div class="line"><span id="1752" class="lineNum"><a href="#1752">1752</a></span><span class="counterCov">4</span><span class="lineCov">}</span></div>
<div class="line"><span id="1753" class="lineNum"><a href="#1753">1753</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="1754" class="lineNum"><a href="#1754">1754</a></span><span class="counterUnCov"></span><span class="lineUnCov">/// Sets up a sender and a receiver, the sender then updates its sending universes multiple times within an ANSI E1.31-2018 </span></div>
<div class="line"><span id="1755" class="lineNum"><a href="#1755">1755</a></span><span class="counterUnCov"></span><span class="lineUnCov">/// E131_UNIVERSE_DISCOVERY_INTERVAL and the receiver asserts that it only receives updates on the interval as expected / compliant</span></div>
<div class="line"><span id="1756" class="lineNum"><a href="#1756">1756</a></span><span class="counterUnCov"></span><span class="lineUnCov">/// with ANSI E1.31-2018 Section 4.3</span></div>
<div class="line"><span id="1757" class="lineNum"><a href="#1757">1757</a></span><span class="counterUnCov"></span><span class="lineUnCov">/// </span></div>
<div class="line"><span id="1758" class="lineNum"><a href="#1758">1758</a></span><span class="counterUnCov"></span><span class="lineUnCov">#[test]</span></div>
<div class="line"><span id="1759" class="lineNum"><a href="#1759">1759</a></span><span class="counterCov">4</span><span class="lineCov">fn test_universe_discovery_interval_with_updates_ipv4(){</span></div>
<div class="line"><span id="1760" class="lineNum"><a href="#1760">1760</a></span><span class="counterUnCov"></span><span class="lineUnCov">    const SND_THREADS: usize = 1;</span></div>
<div class="line"><span id="1761" class="lineNum"><a href="#1761">1761</a></span><span class="counterUnCov"></span><span class="lineUnCov">    const BASE_UNIVERSE: u16 = 1;</span></div>
<div class="line"><span id="1762" class="lineNum"><a href="#1762">1762</a></span><span class="counterUnCov"></span><span class="lineUnCov">    const SOURCE_NAMES: [&amp;&#39;static str; 1] = [&quot;Source 1&quot;];</span></div>
<div class="line"><span id="1763" class="lineNum"><a href="#1763">1763</a></span><span class="counterUnCov"></span><span class="lineUnCov">    const INTERVAL_EXPECTED_MILLIS: u128 = E131_UNIVERSE_DISCOVERY_INTERVAL.as_millis(); // Expected discovery packet interval is every 10 seconds (10000 milliseconds).</span></div>
<div class="line"><span id="1764" class="lineNum"><a href="#1764">1764</a></span><span class="counterUnCov"></span><span class="lineUnCov">    const INTERVAL_TOLERANCE_MILLIS: u128 = 1000; // Allow up to a second either side of this interval to account for random variations.</span></div>
<div class="line"><span id="1765" class="lineNum"><a href="#1765">1765</a></span><span class="counterUnCov"></span><span class="lineUnCov">    const SENDER_REGISTER_DELAY: Duration = Duration::from_secs(1); // The time between registering new universe on the sender.</span></div>
<div class="line"><span id="1766" class="lineNum"><a href="#1766">1766</a></span><span class="counterUnCov"></span><span class="lineUnCov">    const UNIVERSES_TO_REGISTER: usize = 5; // The number of universes to register on the src.</span></div>
<div class="line"><span id="1767" class="lineNum"><a href="#1767">1767</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="1768" class="lineNum"><a href="#1768">1768</a></span><span class="counterCov">2</span><span class="lineCov">    let (snd_tx, snd_rx): (SyncSender&lt;()&gt;, Receiver&lt;()&gt;) = mpsc::sync_channel(0);</span></div>
<div class="line"><span id="1769" class="lineNum"><a href="#1769">1769</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="1770" class="lineNum"><a href="#1770">1770</a></span><span class="counterCov">2</span><span class="lineCov">    let mut snd_threads = Vec::new();</span></div>
<div class="line"><span id="1771" class="lineNum"><a href="#1771">1771</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="1772" class="lineNum"><a href="#1772">1772</a></span><span class="counterCov">4</span><span class="lineCov">    for i in 0 .. SND_THREADS {</span></div>
<div class="line"><span id="1773" class="lineNum"><a href="#1773">1773</a></span><span class="counterCov">2</span><span class="lineCov">        let tx = snd_tx.clone();</span></div>
<div class="line"><span id="1774" class="lineNum"><a href="#1774">1774</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="1775" class="lineNum"><a href="#1775">1775</a></span><span class="counterCov">4</span><span class="lineCov">        snd_threads.push(thread::spawn(move || {</span></div>
<div class="line"><span id="1776" class="lineNum"><a href="#1776">1776</a></span><span class="counterCov">2</span><span class="lineCov">            let ip: SocketAddr = SocketAddr::new(IpAddr::V4(TEST_NETWORK_INTERFACE_IPV4[0].parse().unwrap()), ACN_SDT_MULTICAST_PORT + 1 + (i as u16));</span></div>
<div class="line"><span id="1777" class="lineNum"><a href="#1777">1777</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="1778" class="lineNum"><a href="#1778">1778</a></span><span class="counterCov">2</span><span class="lineCov">            tx.send(()).unwrap(); // Force the send thread to wait before creating the sender, should sync once the receiver has been created.</span></div>
<div class="line"><span id="1779" class="lineNum"><a href="#1779">1779</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="1780" class="lineNum"><a href="#1780">1780</a></span><span class="counterCov">2</span><span class="lineCov">            let mut src = SacnSource::with_ip(SOURCE_NAMES[i], ip).unwrap();</span></div>
<div class="line"><span id="1781" class="lineNum"><a href="#1781">1781</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="1782" class="lineNum"><a href="#1782">1782</a></span><span class="counterCov">12</span><span class="lineCov">            for _ in 0 .. UNIVERSES_TO_REGISTER {</span></div>
<div class="line"><span id="1783" class="lineNum"><a href="#1783">1783</a></span><span class="counterCov">10</span><span class="lineCov">                src.register_universes(&amp;[BASE_UNIVERSE]).unwrap();</span></div>
<div class="line"><span id="1784" class="lineNum"><a href="#1784">1784</a></span><span class="counterCov">10</span><span class="lineCov">                sleep(SENDER_REGISTER_DELAY);</span></div>
<div class="line"><span id="1785" class="lineNum"><a href="#1785">1785</a></span><span class="counterUnCov"></span><span class="lineUnCov">            }</span></div>
<div class="line"><span id="1786" class="lineNum"><a href="#1786">1786</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="1787" class="lineNum"><a href="#1787">1787</a></span><span class="counterCov">2</span><span class="lineCov">            tx.send(()).unwrap(); // Used to force the sender to wait till the receiver has received a universe discovery.</span></div>
<div class="line"><span id="1788" class="lineNum"><a href="#1788">1788</a></span><span class="counterCov">2</span><span class="lineCov">        }));</span></div>
<div class="line"><span id="1789" class="lineNum"><a href="#1789">1789</a></span><span class="counterUnCov"></span><span class="lineUnCov">    }</span></div>
<div class="line"><span id="1790" class="lineNum"><a href="#1790">1790</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="1791" class="lineNum"><a href="#1791">1791</a></span><span class="counterCov">2</span><span class="lineCov">    let mut dmx_recv = SacnReceiver::with_ip(SocketAddr::new(IpAddr::V4(TEST_NETWORK_INTERFACE_IPV4[0].parse().unwrap()), ACN_SDT_MULTICAST_PORT), None).unwrap();</span></div>
<div class="line"><span id="1792" class="lineNum"><a href="#1792">1792</a></span><span class="counterCov">2</span><span class="lineCov">    dmx_recv.set_announce_source_discovery(true); // Make the receiver explicitly notify when it receives a universe discovery packet.</span></div>
<div class="line"><span id="1793" class="lineNum"><a href="#1793">1793</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="1794" class="lineNum"><a href="#1794">1794</a></span><span class="counterCov">2</span><span class="lineCov">    snd_rx.recv().unwrap(); // Receiver created and ready so allow the sender to be created.</span></div>
<div class="line"><span id="1795" class="lineNum"><a href="#1795">1795</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="1796" class="lineNum"><a href="#1796">1796</a></span><span class="counterCov">2</span><span class="lineCov">    let mut interval_start = Instant::now(); // Assignment never used.</span></div>
<div class="line"><span id="1797" class="lineNum"><a href="#1797">1797</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="1798" class="lineNum"><a href="#1798">1798</a></span><span class="counterCov">2</span><span class="lineCov">    match dmx_recv.recv(None) {</span></div>
<div class="line"><span id="1799" class="lineNum"><a href="#1799">1799</a></span><span class="counterCov">2</span><span class="lineCov">        Err(e) =&gt; {</span></div>
<div class="line"><span id="1800" class="lineNum"><a href="#1800">1800</a></span><span class="counterCov">2</span><span class="lineCov">            match e.kind() {</span></div>
<div class="line"><span id="1801" class="lineNum"><a href="#1801">1801</a></span><span class="counterCov">2</span><span class="lineCov">                ErrorKind::SourceDiscovered(_) =&gt; {</span></div>
<div class="line"><span id="1802" class="lineNum"><a href="#1802">1802</a></span><span class="counterUnCov"></span><span class="lineUnCov">                    // Measure the time between the first and second discovery packets, this removes the uncertainty in the time taken for the sender to start.</span></div>
<div class="line"><span id="1803" class="lineNum"><a href="#1803">1803</a></span><span class="counterCov">2</span><span class="lineCov">                    interval_start = Instant::now();</span></div>
<div class="line"><span id="1804" class="lineNum"><a href="#1804">1804</a></span><span class="counterUnCov"></span><span class="lineUnCov">                }</span></div>
<div class="line"><span id="1805" class="lineNum"><a href="#1805">1805</a></span><span class="counterNoCov">0</span><span class="lineNoCov">                k =&gt; {</span></div>
<div class="line"><span id="1806" class="lineNum"><a href="#1806">1806</a></span><span class="counterNoCov">0</span><span class="lineNoCov">                    assert!(false, &quot;Unexpected error kind, {:?}&quot;, k);</span></div>
<div class="line"><span id="1807" class="lineNum"><a href="#1807">1807</a></span><span class="counterUnCov"></span><span class="lineUnCov">                }</span></div>
<div class="line"><span id="1808" class="lineNum"><a href="#1808">1808</a></span><span class="counterUnCov"></span><span class="lineUnCov">            }</span></div>
<div class="line"><span id="1809" class="lineNum"><a href="#1809">1809</a></span><span class="counterUnCov"></span><span class="lineUnCov">        }</span></div>
<div class="line"><span id="1810" class="lineNum"><a href="#1810">1810</a></span><span class="counterCov">2</span><span class="lineCov">        Ok(d) =&gt; {</span></div>
<div class="line"><span id="1811" class="lineNum"><a href="#1811">1811</a></span><span class="counterNoCov">0</span><span class="lineNoCov">            assert!(false, &quot;No data expected, {:?}&quot;, d);</span></div>
<div class="line"><span id="1812" class="lineNum"><a href="#1812">1812</a></span><span class="counterUnCov"></span><span class="lineUnCov">        }</span></div>
<div class="line"><span id="1813" class="lineNum"><a href="#1813">1813</a></span><span class="counterUnCov"></span><span class="lineUnCov">    }</span></div>
<div class="line"><span id="1814" class="lineNum"><a href="#1814">1814</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="1815" class="lineNum"><a href="#1815">1815</a></span><span class="counterCov">2</span><span class="lineCov">    match dmx_recv.recv(None) {</span></div>
<div class="line"><span id="1816" class="lineNum"><a href="#1816">1816</a></span><span class="counterCov">2</span><span class="lineCov">        Err(e) =&gt; {</span></div>
<div class="line"><span id="1817" class="lineNum"><a href="#1817">1817</a></span><span class="counterCov">2</span><span class="lineCov">            match e.kind() {</span></div>
<div class="line"><span id="1818" class="lineNum"><a href="#1818">1818</a></span><span class="counterCov">2</span><span class="lineCov">                ErrorKind::SourceDiscovered(_) =&gt; {</span></div>
<div class="line"><span id="1819" class="lineNum"><a href="#1819">1819</a></span><span class="counterCov">2</span><span class="lineCov">                    let interval = interval_start.elapsed();</span></div>
<div class="line"><span id="1820" class="lineNum"><a href="#1820">1820</a></span><span class="counterCov">2</span><span class="lineCov">                    let interval_millis = interval.as_millis();</span></div>
<div class="line"><span id="1821" class="lineNum"><a href="#1821">1821</a></span><span class="counterCov">2</span><span class="lineCov">                    assert!(interval_millis &gt; (INTERVAL_EXPECTED_MILLIS - INTERVAL_TOLERANCE_MILLIS), format!(&quot;Discovery interval is shorter than expected, {} ms&quot;, interval_millis));</span></div>
<div class="line"><span id="1822" class="lineNum"><a href="#1822">1822</a></span><span class="counterCov">2</span><span class="lineCov">                    assert!(interval_millis &lt; (INTERVAL_EXPECTED_MILLIS + INTERVAL_TOLERANCE_MILLIS), format!(&quot;Discovery interval is longer than expected, {} ms&quot;, interval_millis));</span></div>
<div class="line"><span id="1823" class="lineNum"><a href="#1823">1823</a></span><span class="counterUnCov"></span><span class="lineUnCov">                }</span></div>
<div class="line"><span id="1824" class="lineNum"><a href="#1824">1824</a></span><span class="counterNoCov">0</span><span class="lineNoCov">                k =&gt; {</span></div>
<div class="line"><span id="1825" class="lineNum"><a href="#1825">1825</a></span><span class="counterNoCov">0</span><span class="lineNoCov">                    assert!(false, &quot;Unexpected error kind, {:?}&quot;, k);</span></div>
<div class="line"><span id="1826" class="lineNum"><a href="#1826">1826</a></span><span class="counterUnCov"></span><span class="lineUnCov">                }</span></div>
<div class="line"><span id="1827" class="lineNum"><a href="#1827">1827</a></span><span class="counterUnCov"></span><span class="lineUnCov">            }</span></div>
<div class="line"><span id="1828" class="lineNum"><a href="#1828">1828</a></span><span class="counterUnCov"></span><span class="lineUnCov">        }</span></div>
<div class="line"><span id="1829" class="lineNum"><a href="#1829">1829</a></span><span class="counterCov">2</span><span class="lineCov">        Ok(d) =&gt; {</span></div>
<div class="line"><span id="1830" class="lineNum"><a href="#1830">1830</a></span><span class="counterNoCov">0</span><span class="lineNoCov">            assert!(false, &quot;No data expected, {:?}&quot;, d);</span></div>
<div class="line"><span id="1831" class="lineNum"><a href="#1831">1831</a></span><span class="counterUnCov"></span><span class="lineUnCov">        }</span></div>
<div class="line"><span id="1832" class="lineNum"><a href="#1832">1832</a></span><span class="counterUnCov"></span><span class="lineUnCov">    }</span></div>
<div class="line"><span id="1833" class="lineNum"><a href="#1833">1833</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="1834" class="lineNum"><a href="#1834">1834</a></span><span class="counterCov">2</span><span class="lineCov">    snd_rx.recv().unwrap(); // Allow sender to finish.</span></div>
<div class="line"><span id="1835" class="lineNum"><a href="#1835">1835</a></span><span class="counterCov">4</span><span class="lineCov">}</span></div>
<div class="line"><span id="1836" class="lineNum"><a href="#1836">1836</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="1837" class="lineNum"><a href="#1837">1837</a></span><span class="counterUnCov"></span><span class="lineUnCov">#[test]</span></div>
<div class="line"><span id="1838" class="lineNum"><a href="#1838">1838</a></span><span class="counterCov">4</span><span class="lineCov">fn test_universe_discovery_multiple_universe_one_source_ipv4(){</span></div>
<div class="line"><span id="1839" class="lineNum"><a href="#1839">1839</a></span><span class="counterUnCov"></span><span class="lineUnCov">    const SND_THREADS: usize = 1;</span></div>
<div class="line"><span id="1840" class="lineNum"><a href="#1840">1840</a></span><span class="counterUnCov"></span><span class="lineUnCov">    const BASE_UNIVERSE: u16 = 2;</span></div>
<div class="line"><span id="1841" class="lineNum"><a href="#1841">1841</a></span><span class="counterUnCov"></span><span class="lineUnCov">    const UNIVERSE_COUNT: usize = 5;</span></div>
<div class="line"><span id="1842" class="lineNum"><a href="#1842">1842</a></span><span class="counterUnCov"></span><span class="lineUnCov">    const SOURCE_NAMES: [&amp;&#39;static str; 1] = [&quot;Source 1&quot;];</span></div>
<div class="line"><span id="1843" class="lineNum"><a href="#1843">1843</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="1844" class="lineNum"><a href="#1844">1844</a></span><span class="counterCov">2</span><span class="lineCov">    let (snd_tx, snd_rx): (SyncSender&lt;()&gt;, Receiver&lt;()&gt;) = mpsc::sync_channel(0);</span></div>
<div class="line"><span id="1845" class="lineNum"><a href="#1845">1845</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="1846" class="lineNum"><a href="#1846">1846</a></span><span class="counterCov">2</span><span class="lineCov">    let mut snd_threads = Vec::new();</span></div>
<div class="line"><span id="1847" class="lineNum"><a href="#1847">1847</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="1848" class="lineNum"><a href="#1848">1848</a></span><span class="counterCov">4</span><span class="lineCov">    for i in 0 .. SND_THREADS {</span></div>
<div class="line"><span id="1849" class="lineNum"><a href="#1849">1849</a></span><span class="counterCov">2</span><span class="lineCov">        let tx = snd_tx.clone();</span></div>
<div class="line"><span id="1850" class="lineNum"><a href="#1850">1850</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="1851" class="lineNum"><a href="#1851">1851</a></span><span class="counterCov">4</span><span class="lineCov">        snd_threads.push(thread::spawn(move || {</span></div>
<div class="line"><span id="1852" class="lineNum"><a href="#1852">1852</a></span><span class="counterCov">2</span><span class="lineCov">            let ip: SocketAddr = SocketAddr::new(IpAddr::V4(TEST_NETWORK_INTERFACE_IPV4[0].parse().unwrap()), ACN_SDT_MULTICAST_PORT + 1 + (i as u16));</span></div>
<div class="line"><span id="1853" class="lineNum"><a href="#1853">1853</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="1854" class="lineNum"><a href="#1854">1854</a></span><span class="counterCov">2</span><span class="lineCov">            let mut src = SacnSource::with_ip(SOURCE_NAMES[i], ip).unwrap();</span></div>
<div class="line"><span id="1855" class="lineNum"><a href="#1855">1855</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="1856" class="lineNum"><a href="#1856">1856</a></span><span class="counterCov">2</span><span class="lineCov">            let mut universes: Vec&lt;u16&gt; = Vec::new();</span></div>
<div class="line"><span id="1857" class="lineNum"><a href="#1857">1857</a></span><span class="counterCov">12</span><span class="lineCov">            for j in 0 .. UNIVERSE_COUNT {</span></div>
<div class="line"><span id="1858" class="lineNum"><a href="#1858">1858</a></span><span class="counterCov">10</span><span class="lineCov">                universes.push(((i + j) as u16) + BASE_UNIVERSE);</span></div>
<div class="line"><span id="1859" class="lineNum"><a href="#1859">1859</a></span><span class="counterUnCov"></span><span class="lineUnCov">            }</span></div>
<div class="line"><span id="1860" class="lineNum"><a href="#1860">1860</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="1861" class="lineNum"><a href="#1861">1861</a></span><span class="counterCov">2</span><span class="lineCov">            src.register_universes(&amp;universes).unwrap();</span></div>
<div class="line"><span id="1862" class="lineNum"><a href="#1862">1862</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="1863" class="lineNum"><a href="#1863">1863</a></span><span class="counterCov">2</span><span class="lineCov">            tx.send(()).unwrap(); // Used to force the sender to wait till the receiver has received a universe discovery.</span></div>
<div class="line"><span id="1864" class="lineNum"><a href="#1864">1864</a></span><span class="counterCov">2</span><span class="lineCov">        }));</span></div>
<div class="line"><span id="1865" class="lineNum"><a href="#1865">1865</a></span><span class="counterUnCov"></span><span class="lineUnCov">    }</span></div>
<div class="line"><span id="1866" class="lineNum"><a href="#1866">1866</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="1867" class="lineNum"><a href="#1867">1867</a></span><span class="counterCov">2</span><span class="lineCov">    let mut dmx_recv = SacnReceiver::with_ip(SocketAddr::new(IpAddr::V4(TEST_NETWORK_INTERFACE_IPV4[0].parse().unwrap()), ACN_SDT_MULTICAST_PORT), None).unwrap();</span></div>
<div class="line"><span id="1868" class="lineNum"><a href="#1868">1868</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="1869" class="lineNum"><a href="#1869">1869</a></span><span class="counterCov">10</span><span class="lineCov">    loop { </span></div>
<div class="line"><span id="1870" class="lineNum"><a href="#1870">1870</a></span><span class="counterCov">10</span><span class="lineCov">        let result = dmx_recv.recv(Some(Duration::from_secs(2)));</span></div>
<div class="line"><span id="1871" class="lineNum"><a href="#1871">1871</a></span><span class="counterNoCov">0</span><span class="lineNoCov">        match result { </span></div>
<div class="line"><span id="1872" class="lineNum"><a href="#1872">1872</a></span><span class="counterCov">10</span><span class="lineCov">            Err(e) =&gt; {</span></div>
<div class="line"><span id="1873" class="lineNum"><a href="#1873">1873</a></span><span class="counterCov">10</span><span class="lineCov">                match e.kind() {</span></div>
<div class="line"><span id="1874" class="lineNum"><a href="#1874">1874</a></span><span class="counterCov">10</span><span class="lineCov">                    &amp;ErrorKind::Io(ref s) =&gt; {</span></div>
<div class="line"><span id="1875" class="lineNum"><a href="#1875">1875</a></span><span class="counterCov">10</span><span class="lineCov">                        match s.kind() {</span></div>
<div class="line"><span id="1876" class="lineNum"><a href="#1876">1876</a></span><span class="counterCov">10</span><span class="lineCov">                            std::io::ErrorKind::WouldBlock =&gt; {</span></div>
<div class="line"><span id="1877" class="lineNum"><a href="#1877">1877</a></span><span class="counterUnCov"></span><span class="lineUnCov">                                // Expected to timeout / would block.</span></div>
<div class="line"><span id="1878" class="lineNum"><a href="#1878">1878</a></span><span class="counterUnCov"></span><span class="lineUnCov">                                // The different errors are due to windows and unix returning different errors for the same thing.</span></div>
<div class="line"><span id="1879" class="lineNum"><a href="#1879">1879</a></span><span class="counterUnCov"></span><span class="lineUnCov">                            },</span></div>
<div class="line"><span id="1880" class="lineNum"><a href="#1880">1880</a></span><span class="counterUnCov"></span><span class="lineUnCov">                            std::io::ErrorKind::TimedOut =&gt; {},</span></div>
<div class="line"><span id="1881" class="lineNum"><a href="#1881">1881</a></span><span class="counterUnCov"></span><span class="lineUnCov">                            _ =&gt; {</span></div>
<div class="line"><span id="1882" class="lineNum"><a href="#1882">1882</a></span><span class="counterNoCov">0</span><span class="lineNoCov">                                assert!(false, &quot;Unexpected error returned&quot;);</span></div>
<div class="line"><span id="1883" class="lineNum"><a href="#1883">1883</a></span><span class="counterUnCov"></span><span class="lineUnCov">                            }</span></div>
<div class="line"><span id="1884" class="lineNum"><a href="#1884">1884</a></span><span class="counterUnCov"></span><span class="lineUnCov">                        }</span></div>
<div class="line"><span id="1885" class="lineNum"><a href="#1885">1885</a></span><span class="counterUnCov"></span><span class="lineUnCov">                    },</span></div>
<div class="line"><span id="1886" class="lineNum"><a href="#1886">1886</a></span><span class="counterUnCov"></span><span class="lineUnCov">                    _ =&gt; {</span></div>
<div class="line"><span id="1887" class="lineNum"><a href="#1887">1887</a></span><span class="counterNoCov">0</span><span class="lineNoCov">                        assert!(false, &quot;Unexpected error returned&quot;);</span></div>
<div class="line"><span id="1888" class="lineNum"><a href="#1888">1888</a></span><span class="counterUnCov"></span><span class="lineUnCov">                    }</span></div>
<div class="line"><span id="1889" class="lineNum"><a href="#1889">1889</a></span><span class="counterUnCov"></span><span class="lineUnCov">                }</span></div>
<div class="line"><span id="1890" class="lineNum"><a href="#1890">1890</a></span><span class="counterCov">10</span><span class="lineCov">            },</span></div>
<div class="line"><span id="1891" class="lineNum"><a href="#1891">1891</a></span><span class="counterUnCov"></span><span class="lineUnCov">            Ok(_) =&gt; {</span></div>
<div class="line"><span id="1892" class="lineNum"><a href="#1892">1892</a></span><span class="counterNoCov">0</span><span class="lineNoCov">                assert!(false, &quot;No data should have been passed up!&quot;);</span></div>
<div class="line"><span id="1893" class="lineNum"><a href="#1893">1893</a></span><span class="counterUnCov"></span><span class="lineUnCov">            }</span></div>
<div class="line"><span id="1894" class="lineNum"><a href="#1894">1894</a></span><span class="counterUnCov"></span><span class="lineUnCov">        }</span></div>
<div class="line"><span id="1895" class="lineNum"><a href="#1895">1895</a></span><span class="counterUnCov"></span><span class="lineUnCov">        </span></div>
<div class="line"><span id="1896" class="lineNum"><a href="#1896">1896</a></span><span class="counterCov">10</span><span class="lineCov">        let discovered = dmx_recv.get_discovered_sources(); </span></div>
<div class="line"><span id="1897" class="lineNum"><a href="#1897">1897</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="1898" class="lineNum"><a href="#1898">1898</a></span><span class="counterCov">10</span><span class="lineCov">        if discovered.len() &gt; 0 {</span></div>
<div class="line"><span id="1899" class="lineNum"><a href="#1899">1899</a></span><span class="counterCov">2</span><span class="lineCov">            assert_eq!(discovered.len(), 1);</span></div>
<div class="line"><span id="1900" class="lineNum"><a href="#1900">1900</a></span><span class="counterCov">2</span><span class="lineCov">            assert_eq!(discovered[0].name, SOURCE_NAMES[0]);</span></div>
<div class="line"><span id="1901" class="lineNum"><a href="#1901">1901</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="1902" class="lineNum"><a href="#1902">1902</a></span><span class="counterCov">2</span><span class="lineCov">            let universes = discovered[0].get_all_universes();</span></div>
<div class="line"><span id="1903" class="lineNum"><a href="#1903">1903</a></span><span class="counterCov">2</span><span class="lineCov">            assert_eq!(universes.len(), UNIVERSE_COUNT);</span></div>
<div class="line"><span id="1904" class="lineNum"><a href="#1904">1904</a></span><span class="counterCov">12</span><span class="lineCov">            for j in 0 .. UNIVERSE_COUNT {</span></div>
<div class="line"><span id="1905" class="lineNum"><a href="#1905">1905</a></span><span class="counterCov">10</span><span class="lineCov">                assert_eq!(universes[j], (j as u16) + BASE_UNIVERSE);</span></div>
<div class="line"><span id="1906" class="lineNum"><a href="#1906">1906</a></span><span class="counterUnCov"></span><span class="lineUnCov">            }</span></div>
<div class="line"><span id="1907" class="lineNum"><a href="#1907">1907</a></span><span class="counterUnCov"></span><span class="lineUnCov">            break;</span></div>
<div class="line"><span id="1908" class="lineNum"><a href="#1908">1908</a></span><span class="counterCov">2</span><span class="lineCov">        }</span></div>
<div class="line"><span id="1909" class="lineNum"><a href="#1909">1909</a></span><span class="counterCov">10</span><span class="lineCov">    }</span></div>
<div class="line"><span id="1910" class="lineNum"><a href="#1910">1910</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="1911" class="lineNum"><a href="#1911">1911</a></span><span class="counterCov">2</span><span class="lineCov">    snd_rx.recv().unwrap();</span></div>
<div class="line"><span id="1912" class="lineNum"><a href="#1912">1912</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="1913" class="lineNum"><a href="#1913">1913</a></span><span class="counterCov">4</span><span class="lineCov">    for s in snd_threads {</span></div>
<div class="line"><span id="1914" class="lineNum"><a href="#1914">1914</a></span><span class="counterCov">2</span><span class="lineCov">        s.join().unwrap();</span></div>
<div class="line"><span id="1915" class="lineNum"><a href="#1915">1915</a></span><span class="counterCov">2</span><span class="lineCov">    }</span></div>
<div class="line"><span id="1916" class="lineNum"><a href="#1916">1916</a></span><span class="counterCov">4</span><span class="lineCov">}</span></div>
<div class="line"><span id="1917" class="lineNum"><a href="#1917">1917</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="1918" class="lineNum"><a href="#1918">1918</a></span><span class="counterUnCov"></span><span class="lineUnCov">#[test]</span></div>
<div class="line"><span id="1919" class="lineNum"><a href="#1919">1919</a></span><span class="counterCov">4</span><span class="lineCov">fn test_universe_discovery_multiple_pages_one_source_ipv4(){</span></div>
<div class="line"><span id="1920" class="lineNum"><a href="#1920">1920</a></span><span class="counterUnCov"></span><span class="lineUnCov">    const SND_THREADS: usize = 1;</span></div>
<div class="line"><span id="1921" class="lineNum"><a href="#1921">1921</a></span><span class="counterUnCov"></span><span class="lineUnCov">    const BASE_UNIVERSE: u16 = 2;</span></div>
<div class="line"><span id="1922" class="lineNum"><a href="#1922">1922</a></span><span class="counterUnCov"></span><span class="lineUnCov">    const UNIVERSE_COUNT: usize = 600;</span></div>
<div class="line"><span id="1923" class="lineNum"><a href="#1923">1923</a></span><span class="counterUnCov"></span><span class="lineUnCov">    const SOURCE_NAMES: [&amp;&#39;static str; 1] = [&quot;Source 1&quot;];</span></div>
<div class="line"><span id="1924" class="lineNum"><a href="#1924">1924</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="1925" class="lineNum"><a href="#1925">1925</a></span><span class="counterCov">2</span><span class="lineCov">    let (snd_tx, snd_rx): (SyncSender&lt;()&gt;, Receiver&lt;()&gt;) = mpsc::sync_channel(0);</span></div>
<div class="line"><span id="1926" class="lineNum"><a href="#1926">1926</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="1927" class="lineNum"><a href="#1927">1927</a></span><span class="counterCov">2</span><span class="lineCov">    let mut snd_threads = Vec::new();</span></div>
<div class="line"><span id="1928" class="lineNum"><a href="#1928">1928</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="1929" class="lineNum"><a href="#1929">1929</a></span><span class="counterCov">4</span><span class="lineCov">    for i in 0 .. SND_THREADS {</span></div>
<div class="line"><span id="1930" class="lineNum"><a href="#1930">1930</a></span><span class="counterCov">2</span><span class="lineCov">        let tx = snd_tx.clone();</span></div>
<div class="line"><span id="1931" class="lineNum"><a href="#1931">1931</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="1932" class="lineNum"><a href="#1932">1932</a></span><span class="counterCov">4</span><span class="lineCov">        snd_threads.push(thread::spawn(move || {</span></div>
<div class="line"><span id="1933" class="lineNum"><a href="#1933">1933</a></span><span class="counterCov">2</span><span class="lineCov">            let ip: SocketAddr = SocketAddr::new(IpAddr::V4(TEST_NETWORK_INTERFACE_IPV4[0].parse().unwrap()), ACN_SDT_MULTICAST_PORT + 1 + (i as u16));</span></div>
<div class="line"><span id="1934" class="lineNum"><a href="#1934">1934</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="1935" class="lineNum"><a href="#1935">1935</a></span><span class="counterCov">2</span><span class="lineCov">            let mut src = SacnSource::with_ip(SOURCE_NAMES[i], ip).unwrap();</span></div>
<div class="line"><span id="1936" class="lineNum"><a href="#1936">1936</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="1937" class="lineNum"><a href="#1937">1937</a></span><span class="counterCov">2</span><span class="lineCov">            src.set_is_sending_discovery(false); // To stop universe discovery packets being sent until all universes are registered.</span></div>
<div class="line"><span id="1938" class="lineNum"><a href="#1938">1938</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="1939" class="lineNum"><a href="#1939">1939</a></span><span class="counterCov">2</span><span class="lineCov">            let mut universes: Vec&lt;u16&gt; = Vec::new();</span></div>
<div class="line"><span id="1940" class="lineNum"><a href="#1940">1940</a></span><span class="counterCov">1202</span><span class="lineCov">            for j in 0 .. UNIVERSE_COUNT {</span></div>
<div class="line"><span id="1941" class="lineNum"><a href="#1941">1941</a></span><span class="counterCov">1200</span><span class="lineCov">                universes.push(((i + j) as u16) + BASE_UNIVERSE);</span></div>
<div class="line"><span id="1942" class="lineNum"><a href="#1942">1942</a></span><span class="counterUnCov"></span><span class="lineUnCov">            }</span></div>
<div class="line"><span id="1943" class="lineNum"><a href="#1943">1943</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="1944" class="lineNum"><a href="#1944">1944</a></span><span class="counterCov">2</span><span class="lineCov">            src.register_universes(&amp;universes).unwrap();</span></div>
<div class="line"><span id="1945" class="lineNum"><a href="#1945">1945</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="1946" class="lineNum"><a href="#1946">1946</a></span><span class="counterCov">2</span><span class="lineCov">            src.set_is_sending_discovery(true);</span></div>
<div class="line"><span id="1947" class="lineNum"><a href="#1947">1947</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="1948" class="lineNum"><a href="#1948">1948</a></span><span class="counterCov">2</span><span class="lineCov">            tx.send(()).unwrap(); // Used to force the sender to wait till the receiver has received a universe discovery.</span></div>
<div class="line"><span id="1949" class="lineNum"><a href="#1949">1949</a></span><span class="counterCov">2</span><span class="lineCov">        }));</span></div>
<div class="line"><span id="1950" class="lineNum"><a href="#1950">1950</a></span><span class="counterUnCov"></span><span class="lineUnCov">    }</span></div>
<div class="line"><span id="1951" class="lineNum"><a href="#1951">1951</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="1952" class="lineNum"><a href="#1952">1952</a></span><span class="counterCov">2</span><span class="lineCov">    let mut dmx_recv = SacnReceiver::with_ip(SocketAddr::new(IpAddr::V4(TEST_NETWORK_INTERFACE_IPV4[0].parse().unwrap()), ACN_SDT_MULTICAST_PORT), None).unwrap();</span></div>
<div class="line"><span id="1953" class="lineNum"><a href="#1953">1953</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="1954" class="lineNum"><a href="#1954">1954</a></span><span class="counterCov">10</span><span class="lineCov">    loop { </span></div>
<div class="line"><span id="1955" class="lineNum"><a href="#1955">1955</a></span><span class="counterCov">10</span><span class="lineCov">        let result = dmx_recv.recv(Some(Duration::from_secs(2)));</span></div>
<div class="line"><span id="1956" class="lineNum"><a href="#1956">1956</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="1957" class="lineNum"><a href="#1957">1957</a></span><span class="counterNoCov">0</span><span class="lineNoCov">        match result { </span></div>
<div class="line"><span id="1958" class="lineNum"><a href="#1958">1958</a></span><span class="counterCov">10</span><span class="lineCov">            Err(e) =&gt; {</span></div>
<div class="line"><span id="1959" class="lineNum"><a href="#1959">1959</a></span><span class="counterCov">10</span><span class="lineCov">                match e.kind() {</span></div>
<div class="line"><span id="1960" class="lineNum"><a href="#1960">1960</a></span><span class="counterCov">10</span><span class="lineCov">                    &amp;ErrorKind::Io(ref s) =&gt; {</span></div>
<div class="line"><span id="1961" class="lineNum"><a href="#1961">1961</a></span><span class="counterCov">10</span><span class="lineCov">                        match s.kind() {</span></div>
<div class="line"><span id="1962" class="lineNum"><a href="#1962">1962</a></span><span class="counterCov">10</span><span class="lineCov">                            std::io::ErrorKind::WouldBlock =&gt; {</span></div>
<div class="line"><span id="1963" class="lineNum"><a href="#1963">1963</a></span><span class="counterUnCov"></span><span class="lineUnCov">                                // Expected to timeout / would block.</span></div>
<div class="line"><span id="1964" class="lineNum"><a href="#1964">1964</a></span><span class="counterUnCov"></span><span class="lineUnCov">                                // The different errors are due to windows and unix returning different errors for the same thing.</span></div>
<div class="line"><span id="1965" class="lineNum"><a href="#1965">1965</a></span><span class="counterUnCov"></span><span class="lineUnCov">                            },</span></div>
<div class="line"><span id="1966" class="lineNum"><a href="#1966">1966</a></span><span class="counterUnCov"></span><span class="lineUnCov">                            std::io::ErrorKind::TimedOut =&gt; {},</span></div>
<div class="line"><span id="1967" class="lineNum"><a href="#1967">1967</a></span><span class="counterUnCov"></span><span class="lineUnCov">                            _ =&gt; {</span></div>
<div class="line"><span id="1968" class="lineNum"><a href="#1968">1968</a></span><span class="counterNoCov">0</span><span class="lineNoCov">                                assert!(false, &quot;Unexpected error returned&quot;);</span></div>
<div class="line"><span id="1969" class="lineNum"><a href="#1969">1969</a></span><span class="counterUnCov"></span><span class="lineUnCov">                            }</span></div>
<div class="line"><span id="1970" class="lineNum"><a href="#1970">1970</a></span><span class="counterUnCov"></span><span class="lineUnCov">                        }</span></div>
<div class="line"><span id="1971" class="lineNum"><a href="#1971">1971</a></span><span class="counterUnCov"></span><span class="lineUnCov">                    },</span></div>
<div class="line"><span id="1972" class="lineNum"><a href="#1972">1972</a></span><span class="counterUnCov"></span><span class="lineUnCov">                    _ =&gt; {</span></div>
<div class="line"><span id="1973" class="lineNum"><a href="#1973">1973</a></span><span class="counterNoCov">0</span><span class="lineNoCov">                        assert!(false, &quot;Unexpected error returned&quot;);</span></div>
<div class="line"><span id="1974" class="lineNum"><a href="#1974">1974</a></span><span class="counterUnCov"></span><span class="lineUnCov">                    }</span></div>
<div class="line"><span id="1975" class="lineNum"><a href="#1975">1975</a></span><span class="counterUnCov"></span><span class="lineUnCov">                }</span></div>
<div class="line"><span id="1976" class="lineNum"><a href="#1976">1976</a></span><span class="counterCov">10</span><span class="lineCov">            },</span></div>
<div class="line"><span id="1977" class="lineNum"><a href="#1977">1977</a></span><span class="counterUnCov"></span><span class="lineUnCov">            Ok(_) =&gt; {</span></div>
<div class="line"><span id="1978" class="lineNum"><a href="#1978">1978</a></span><span class="counterNoCov">0</span><span class="lineNoCov">                assert!(false, &quot;No data should have been passed up!&quot;);</span></div>
<div class="line"><span id="1979" class="lineNum"><a href="#1979">1979</a></span><span class="counterUnCov"></span><span class="lineUnCov">            }</span></div>
<div class="line"><span id="1980" class="lineNum"><a href="#1980">1980</a></span><span class="counterUnCov"></span><span class="lineUnCov">        }</span></div>
<div class="line"><span id="1981" class="lineNum"><a href="#1981">1981</a></span><span class="counterUnCov"></span><span class="lineUnCov">        </span></div>
<div class="line"><span id="1982" class="lineNum"><a href="#1982">1982</a></span><span class="counterCov">10</span><span class="lineCov">        let discovered = dmx_recv.get_discovered_sources(); </span></div>
<div class="line"><span id="1983" class="lineNum"><a href="#1983">1983</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="1984" class="lineNum"><a href="#1984">1984</a></span><span class="counterCov">10</span><span class="lineCov">        if discovered.len() &gt; 0 {</span></div>
<div class="line"><span id="1985" class="lineNum"><a href="#1985">1985</a></span><span class="counterCov">2</span><span class="lineCov">            assert_eq!(discovered.len(), 1);</span></div>
<div class="line"><span id="1986" class="lineNum"><a href="#1986">1986</a></span><span class="counterCov">2</span><span class="lineCov">            assert_eq!(discovered[0].name, SOURCE_NAMES[0]);</span></div>
<div class="line"><span id="1987" class="lineNum"><a href="#1987">1987</a></span><span class="counterCov">2</span><span class="lineCov">            let universes = discovered[0].get_all_universes();</span></div>
<div class="line"><span id="1988" class="lineNum"><a href="#1988">1988</a></span><span class="counterCov">2</span><span class="lineCov">            assert_eq!(universes.len(), UNIVERSE_COUNT);</span></div>
<div class="line"><span id="1989" class="lineNum"><a href="#1989">1989</a></span><span class="counterCov">1202</span><span class="lineCov">            for j in 0 .. UNIVERSE_COUNT {</span></div>
<div class="line"><span id="1990" class="lineNum"><a href="#1990">1990</a></span><span class="counterCov">1200</span><span class="lineCov">                assert_eq!(universes[j], (j as u16) + BASE_UNIVERSE);</span></div>
<div class="line"><span id="1991" class="lineNum"><a href="#1991">1991</a></span><span class="counterUnCov"></span><span class="lineUnCov">            }</span></div>
<div class="line"><span id="1992" class="lineNum"><a href="#1992">1992</a></span><span class="counterUnCov"></span><span class="lineUnCov">            break;</span></div>
<div class="line"><span id="1993" class="lineNum"><a href="#1993">1993</a></span><span class="counterCov">2</span><span class="lineCov">        }</span></div>
<div class="line"><span id="1994" class="lineNum"><a href="#1994">1994</a></span><span class="counterCov">10</span><span class="lineCov">    }</span></div>
<div class="line"><span id="1995" class="lineNum"><a href="#1995">1995</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="1996" class="lineNum"><a href="#1996">1996</a></span><span class="counterCov">2</span><span class="lineCov">    snd_rx.recv().unwrap();</span></div>
<div class="line"><span id="1997" class="lineNum"><a href="#1997">1997</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="1998" class="lineNum"><a href="#1998">1998</a></span><span class="counterCov">4</span><span class="lineCov">    for s in snd_threads {</span></div>
<div class="line"><span id="1999" class="lineNum"><a href="#1999">1999</a></span><span class="counterCov">2</span><span class="lineCov">        s.join().unwrap();</span></div>
<div class="line"><span id="2000" class="lineNum"><a href="#2000">2000</a></span><span class="counterCov">2</span><span class="lineCov">    }</span></div>
<div class="line"><span id="2001" class="lineNum"><a href="#2001">2001</a></span><span class="counterCov">4</span><span class="lineCov">}</span></div>
<div class="line"><span id="2002" class="lineNum"><a href="#2002">2002</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="2003" class="lineNum"><a href="#2003">2003</a></span><span class="counterUnCov"></span><span class="lineUnCov">/// Creates a sender and a receiver with the sender having no registered universes.</span></div>
<div class="line"><span id="2004" class="lineNum"><a href="#2004">2004</a></span><span class="counterUnCov"></span><span class="lineUnCov">/// Receiver waits for a discovery packet from the sender and uses it to show that the sender is transmitting</span></div>
<div class="line"><span id="2005" class="lineNum"><a href="#2005">2005</a></span><span class="counterUnCov"></span><span class="lineUnCov">/// an empty list of universes as expected.</span></div>
<div class="line"><span id="2006" class="lineNum"><a href="#2006">2006</a></span><span class="counterUnCov"></span><span class="lineUnCov">#[test]</span></div>
<div class="line"><span id="2007" class="lineNum"><a href="#2007">2007</a></span><span class="counterCov">4</span><span class="lineCov">fn test_universe_discovery_no_universes_ipv4(){</span></div>
<div class="line"><span id="2008" class="lineNum"><a href="#2008">2008</a></span><span class="counterUnCov"></span><span class="lineUnCov">    const SND_THREADS: usize = 1;</span></div>
<div class="line"><span id="2009" class="lineNum"><a href="#2009">2009</a></span><span class="counterUnCov"></span><span class="lineUnCov">    const SOURCE_NAMES: [&amp;&#39;static str; 1] = [&quot;Source 1&quot;];</span></div>
<div class="line"><span id="2010" class="lineNum"><a href="#2010">2010</a></span><span class="counterCov">2</span><span class="lineCov">    let (snd_tx, snd_rx): (SyncSender&lt;()&gt;, Receiver&lt;()&gt;) = mpsc::sync_channel(0);</span></div>
<div class="line"><span id="2011" class="lineNum"><a href="#2011">2011</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="2012" class="lineNum"><a href="#2012">2012</a></span><span class="counterCov">2</span><span class="lineCov">    let mut snd_threads = Vec::new();</span></div>
<div class="line"><span id="2013" class="lineNum"><a href="#2013">2013</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="2014" class="lineNum"><a href="#2014">2014</a></span><span class="counterCov">4</span><span class="lineCov">    for i in 0 .. SND_THREADS {</span></div>
<div class="line"><span id="2015" class="lineNum"><a href="#2015">2015</a></span><span class="counterCov">2</span><span class="lineCov">        let tx = snd_tx.clone();</span></div>
<div class="line"><span id="2016" class="lineNum"><a href="#2016">2016</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="2017" class="lineNum"><a href="#2017">2017</a></span><span class="counterCov">4</span><span class="lineCov">        snd_threads.push(thread::spawn(move || {</span></div>
<div class="line"><span id="2018" class="lineNum"><a href="#2018">2018</a></span><span class="counterCov">2</span><span class="lineCov">            let ip: SocketAddr = SocketAddr::new(IpAddr::V4(TEST_NETWORK_INTERFACE_IPV4[0].parse().unwrap()), ACN_SDT_MULTICAST_PORT + 1 + (i as u16));</span></div>
<div class="line"><span id="2019" class="lineNum"><a href="#2019">2019</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="2020" class="lineNum"><a href="#2020">2020</a></span><span class="counterCov">2</span><span class="lineCov">            tx.send(()).unwrap(); // Force the send thread to wait before creating the sender, should sync once the receiver has been created.</span></div>
<div class="line"><span id="2021" class="lineNum"><a href="#2021">2021</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="2022" class="lineNum"><a href="#2022">2022</a></span><span class="counterCov">2</span><span class="lineCov">            let mut src = SacnSource::with_ip(SOURCE_NAMES[i], ip).unwrap();</span></div>
<div class="line"><span id="2023" class="lineNum"><a href="#2023">2023</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="2024" class="lineNum"><a href="#2024">2024</a></span><span class="counterUnCov"></span><span class="lineUnCov">            // Explicitly make sure that the src is sending discovery packets (by default not).</span></div>
<div class="line"><span id="2025" class="lineNum"><a href="#2025">2025</a></span><span class="counterCov">2</span><span class="lineCov">            src.set_is_sending_discovery(true);</span></div>
<div class="line"><span id="2026" class="lineNum"><a href="#2026">2026</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="2027" class="lineNum"><a href="#2027">2027</a></span><span class="counterUnCov"></span><span class="lineUnCov">            // No universes registered so should transmit an empty list.</span></div>
<div class="line"><span id="2028" class="lineNum"><a href="#2028">2028</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="2029" class="lineNum"><a href="#2029">2029</a></span><span class="counterCov">2</span><span class="lineCov">            tx.send(()).unwrap(); // Used to force the sender to wait till the receiver has received a universe discovery.</span></div>
<div class="line"><span id="2030" class="lineNum"><a href="#2030">2030</a></span><span class="counterCov">2</span><span class="lineCov">        }));</span></div>
<div class="line"><span id="2031" class="lineNum"><a href="#2031">2031</a></span><span class="counterUnCov"></span><span class="lineUnCov">    }</span></div>
<div class="line"><span id="2032" class="lineNum"><a href="#2032">2032</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="2033" class="lineNum"><a href="#2033">2033</a></span><span class="counterCov">2</span><span class="lineCov">    let mut dmx_recv = SacnReceiver::with_ip(SocketAddr::new(IpAddr::V4(TEST_NETWORK_INTERFACE_IPV4[0].parse().unwrap()), ACN_SDT_MULTICAST_PORT), None).unwrap();</span></div>
<div class="line"><span id="2034" class="lineNum"><a href="#2034">2034</a></span><span class="counterCov">2</span><span class="lineCov">    dmx_recv.set_announce_source_discovery(true); // Make the receiver explicitly notify when it receives a universe discovery packet.</span></div>
<div class="line"><span id="2035" class="lineNum"><a href="#2035">2035</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="2036" class="lineNum"><a href="#2036">2036</a></span><span class="counterCov">2</span><span class="lineCov">    snd_rx.recv().unwrap(); // Receiver created and ready so allow the sender to be created.</span></div>
<div class="line"><span id="2037" class="lineNum"><a href="#2037">2037</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="2038" class="lineNum"><a href="#2038">2038</a></span><span class="counterCov">2</span><span class="lineCov">    match dmx_recv.recv(None) {</span></div>
<div class="line"><span id="2039" class="lineNum"><a href="#2039">2039</a></span><span class="counterCov">2</span><span class="lineCov">        Err(e) =&gt; {</span></div>
<div class="line"><span id="2040" class="lineNum"><a href="#2040">2040</a></span><span class="counterCov">2</span><span class="lineCov">            match e.kind() {</span></div>
<div class="line"><span id="2041" class="lineNum"><a href="#2041">2041</a></span><span class="counterCov">2</span><span class="lineCov">                ErrorKind::SourceDiscovered(src_name) =&gt; {</span></div>
<div class="line"><span id="2042" class="lineNum"><a href="#2042">2042</a></span><span class="counterCov">2</span><span class="lineCov">                    assert_eq!(src_name, SOURCE_NAMES[0], &quot;Name of source discovered doesn&#39;t match expected&quot;);</span></div>
<div class="line"><span id="2043" class="lineNum"><a href="#2043">2043</a></span><span class="counterCov">2</span><span class="lineCov">                    let sources = dmx_recv.get_discovered_sources();</span></div>
<div class="line"><span id="2044" class="lineNum"><a href="#2044">2044</a></span><span class="counterCov">2</span><span class="lineCov">                    assert_eq!(sources.len(), 1, &quot;Number of sources discovered doesn&#39;t match expected (1)&quot;);</span></div>
<div class="line"><span id="2045" class="lineNum"><a href="#2045">2045</a></span><span class="counterCov">2</span><span class="lineCov">                    assert_eq!(sources[0].get_all_universes(), Vec::new(), &quot;Number of universes on source is greater than expected (0)&quot;);</span></div>
<div class="line"><span id="2046" class="lineNum"><a href="#2046">2046</a></span><span class="counterCov">2</span><span class="lineCov">                }</span></div>
<div class="line"><span id="2047" class="lineNum"><a href="#2047">2047</a></span><span class="counterNoCov">0</span><span class="lineNoCov">                k =&gt; {</span></div>
<div class="line"><span id="2048" class="lineNum"><a href="#2048">2048</a></span><span class="counterNoCov">0</span><span class="lineNoCov">                    assert!(false, &quot;Unexpected error kind, {:?}&quot;, k);</span></div>
<div class="line"><span id="2049" class="lineNum"><a href="#2049">2049</a></span><span class="counterUnCov"></span><span class="lineUnCov">                }</span></div>
<div class="line"><span id="2050" class="lineNum"><a href="#2050">2050</a></span><span class="counterUnCov"></span><span class="lineUnCov">            }</span></div>
<div class="line"><span id="2051" class="lineNum"><a href="#2051">2051</a></span><span class="counterUnCov"></span><span class="lineUnCov">        }</span></div>
<div class="line"><span id="2052" class="lineNum"><a href="#2052">2052</a></span><span class="counterCov">2</span><span class="lineCov">        Ok(d) =&gt; {</span></div>
<div class="line"><span id="2053" class="lineNum"><a href="#2053">2053</a></span><span class="counterNoCov">0</span><span class="lineNoCov">            assert!(false, &quot;No data expected, {:?}&quot;, d);</span></div>
<div class="line"><span id="2054" class="lineNum"><a href="#2054">2054</a></span><span class="counterUnCov"></span><span class="lineUnCov">        }</span></div>
<div class="line"><span id="2055" class="lineNum"><a href="#2055">2055</a></span><span class="counterUnCov"></span><span class="lineUnCov">    }</span></div>
<div class="line"><span id="2056" class="lineNum"><a href="#2056">2056</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="2057" class="lineNum"><a href="#2057">2057</a></span><span class="counterCov">2</span><span class="lineCov">    snd_rx.recv().unwrap(); // Allow sender to finish.</span></div>
<div class="line"><span id="2058" class="lineNum"><a href="#2058">2058</a></span><span class="counterCov">4</span><span class="lineCov">}</span></div>
<div class="line"><span id="2059" class="lineNum"><a href="#2059">2059</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="2060" class="lineNum"><a href="#2060">2060</a></span><span class="counterUnCov"></span><span class="lineUnCov">/// Creates a receiver with a source limit of 2 and then creates 3 sources to trigger a sources exceeded condition.</span></div>
<div class="line"><span id="2061" class="lineNum"><a href="#2061">2061</a></span><span class="counterUnCov"></span><span class="lineUnCov">#[test]</span></div>
<div class="line"><span id="2062" class="lineNum"><a href="#2062">2062</a></span><span class="counterCov">4</span><span class="lineCov">fn test_receiver_sources_exceeded_3() {</span></div>
<div class="line"><span id="2063" class="lineNum"><a href="#2063">2063</a></span><span class="counterUnCov"></span><span class="lineUnCov">    const SND_THREADS: usize = 3;</span></div>
<div class="line"><span id="2064" class="lineNum"><a href="#2064">2064</a></span><span class="counterUnCov"></span><span class="lineUnCov">    const RCV_THREADS: usize = 1;</span></div>
<div class="line"><span id="2065" class="lineNum"><a href="#2065">2065</a></span><span class="counterUnCov"></span><span class="lineUnCov">    const SRC_LIMIT: Option&lt;usize&gt; = Some(2);</span></div>
<div class="line"><span id="2066" class="lineNum"><a href="#2066">2066</a></span><span class="counterUnCov"></span><span class="lineUnCov">    const TIMEOUT: Option&lt;Duration&gt; = Some(Duration::from_secs(3));</span></div>
<div class="line"><span id="2067" class="lineNum"><a href="#2067">2067</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="2068" class="lineNum"><a href="#2068">2068</a></span><span class="counterCov">2</span><span class="lineCov">    let mut snd_threads = Vec::new();</span></div>
<div class="line"><span id="2069" class="lineNum"><a href="#2069">2069</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="2070" class="lineNum"><a href="#2070">2070</a></span><span class="counterUnCov"></span><span class="lineUnCov">    // Separate message queues used so threads don&#39;t take messages to allow them to proceed as a message to allow finishing.</span></div>
<div class="line"><span id="2071" class="lineNum"><a href="#2071">2071</a></span><span class="counterUnCov"></span><span class="lineUnCov">    // This is less efficient than using different message types within a single queue however as this is a test the priority is simplicity.</span></div>
<div class="line"><span id="2072" class="lineNum"><a href="#2072">2072</a></span><span class="counterCov">2</span><span class="lineCov">    let (snd_tx, snd_rx): (SyncSender&lt;()&gt;, Receiver&lt;()&gt;) = mpsc::sync_channel(0); // Used for handshaking, allows syncing the sender states.</span></div>
<div class="line"><span id="2073" class="lineNum"><a href="#2073">2073</a></span><span class="counterCov">2</span><span class="lineCov">    let (finish_snd_tx, finish_snd_rx): (SyncSender&lt;()&gt;, Receiver&lt;()&gt;) = mpsc::sync_channel(0); // Used for handshaking to tell the source threads to finish.</span></div>
<div class="line"><span id="2074" class="lineNum"><a href="#2074">2074</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="2075" class="lineNum"><a href="#2075">2075</a></span><span class="counterCov">2</span><span class="lineCov">    assert!(RCV_THREADS &lt;= TEST_NETWORK_INTERFACE_IPV4.len(), &quot;Number of test network interface ips less than number of recv threads!&quot;);</span></div>
<div class="line"><span id="2076" class="lineNum"><a href="#2076">2076</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="2077" class="lineNum"><a href="#2077">2077</a></span><span class="counterUnCov"></span><span class="lineUnCov">    const BASE_UNIVERSE: u16 = 2;</span></div>
<div class="line"><span id="2078" class="lineNum"><a href="#2078">2078</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="2079" class="lineNum"><a href="#2079">2079</a></span><span class="counterCov">8</span><span class="lineCov">    for i in 0 .. SND_THREADS {</span></div>
<div class="line"><span id="2080" class="lineNum"><a href="#2080">2080</a></span><span class="counterCov">6</span><span class="lineCov">        let tx = snd_tx.clone();</span></div>
<div class="line"><span id="2081" class="lineNum"><a href="#2081">2081</a></span><span class="counterCov">6</span><span class="lineCov">        let fin_tx = finish_snd_tx.clone();</span></div>
<div class="line"><span id="2082" class="lineNum"><a href="#2082">2082</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="2083" class="lineNum"><a href="#2083">2083</a></span><span class="counterCov">6</span><span class="lineCov">        let data = [1, 2, 3];</span></div>
<div class="line"><span id="2084" class="lineNum"><a href="#2084">2084</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="2085" class="lineNum"><a href="#2085">2085</a></span><span class="counterCov">12</span><span class="lineCov">        snd_threads.push(thread::spawn(move || {</span></div>
<div class="line"><span id="2086" class="lineNum"><a href="#2086">2086</a></span><span class="counterCov">6</span><span class="lineCov">            let ip: SocketAddr = SocketAddr::new(IpAddr::V4(TEST_NETWORK_INTERFACE_IPV4[0].parse().unwrap()), ACN_SDT_MULTICAST_PORT + 1 + (i as u16));</span></div>
<div class="line"><span id="2087" class="lineNum"><a href="#2087">2087</a></span><span class="counterUnCov"></span><span class="lineUnCov">            // https://www.programming-idioms.org/idiom/153/concatenate-string-with-integer/1975/rust (11/01/2020)</span></div>
<div class="line"><span id="2088" class="lineNum"><a href="#2088">2088</a></span><span class="counterCov">6</span><span class="lineCov">            let mut src = SacnSource::with_ip(&amp;format!(&quot;Source {}&quot;, i), ip).unwrap();</span></div>
<div class="line"><span id="2089" class="lineNum"><a href="#2089">2089</a></span><span class="counterUnCov"></span><span class="lineUnCov">    </span></div>
<div class="line"><span id="2090" class="lineNum"><a href="#2090">2090</a></span><span class="counterCov">6</span><span class="lineCov">            let priority = 100;</span></div>
<div class="line"><span id="2091" class="lineNum"><a href="#2091">2091</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="2092" class="lineNum"><a href="#2092">2092</a></span><span class="counterCov">6</span><span class="lineCov">            let universe: u16 = (i as u16) + BASE_UNIVERSE; </span></div>
<div class="line"><span id="2093" class="lineNum"><a href="#2093">2093</a></span><span class="counterUnCov"></span><span class="lineUnCov">    </span></div>
<div class="line"><span id="2094" class="lineNum"><a href="#2094">2094</a></span><span class="counterCov">6</span><span class="lineCov">            src.register_universe(universe).unwrap(); // Senders all send on different universes.</span></div>
<div class="line"><span id="2095" class="lineNum"><a href="#2095">2095</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="2096" class="lineNum"><a href="#2096">2096</a></span><span class="counterCov">6</span><span class="lineCov">            tx.send(()).unwrap(); // Forces each sender thread to wait till the controlling thread receives which stops sending before the receivers are ready.</span></div>
<div class="line"><span id="2097" class="lineNum"><a href="#2097">2097</a></span><span class="counterUnCov"></span><span class="lineUnCov">    </span></div>
<div class="line"><span id="2098" class="lineNum"><a href="#2098">2098</a></span><span class="counterCov">6</span><span class="lineCov">            src.send(&amp;[universe], &amp;data, Some(priority), None, None).unwrap();</span></div>
<div class="line"><span id="2099" class="lineNum"><a href="#2099">2099</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="2100" class="lineNum"><a href="#2100">2100</a></span><span class="counterCov">6</span><span class="lineCov">            fin_tx.send(()).unwrap(); // Forces each sender to wait and not terminate.</span></div>
<div class="line"><span id="2101" class="lineNum"><a href="#2101">2101</a></span><span class="counterCov">6</span><span class="lineCov">        }));</span></div>
<div class="line"><span id="2102" class="lineNum"><a href="#2102">2102</a></span><span class="counterUnCov"></span><span class="lineUnCov">    }</span></div>
<div class="line"><span id="2103" class="lineNum"><a href="#2103">2103</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="2104" class="lineNum"><a href="#2104">2104</a></span><span class="counterCov">2</span><span class="lineCov">    let mut dmx_recv = SacnReceiver::with_ip(SocketAddr::new(IpAddr::V4(TEST_NETWORK_INTERFACE_IPV4[0].parse().unwrap()), ACN_SDT_MULTICAST_PORT), SRC_LIMIT).unwrap();</span></div>
<div class="line"><span id="2105" class="lineNum"><a href="#2105">2105</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="2106" class="lineNum"><a href="#2106">2106</a></span><span class="counterUnCov"></span><span class="lineUnCov">    // Receivers listen to all universes</span></div>
<div class="line"><span id="2107" class="lineNum"><a href="#2107">2107</a></span><span class="counterCov">8</span><span class="lineCov">    for i in (BASE_UNIVERSE as u16) .. ((SND_THREADS as u16) + (BASE_UNIVERSE as u16)) {</span></div>
<div class="line"><span id="2108" class="lineNum"><a href="#2108">2108</a></span><span class="counterCov">6</span><span class="lineCov">        dmx_recv.listen_universes(&amp;[i]).unwrap();</span></div>
<div class="line"><span id="2109" class="lineNum"><a href="#2109">2109</a></span><span class="counterUnCov"></span><span class="lineUnCov">    }</span></div>
<div class="line"><span id="2110" class="lineNum"><a href="#2110">2110</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="2111" class="lineNum"><a href="#2111">2111</a></span><span class="counterCov">8</span><span class="lineCov">    for _ in 0 .. SND_THREADS {</span></div>
<div class="line"><span id="2112" class="lineNum"><a href="#2112">2112</a></span><span class="counterCov">6</span><span class="lineCov">        snd_rx.recv().unwrap(); // Allow each sender to progress</span></div>
<div class="line"><span id="2113" class="lineNum"><a href="#2113">2113</a></span><span class="counterUnCov"></span><span class="lineUnCov">    }</span></div>
<div class="line"><span id="2114" class="lineNum"><a href="#2114">2114</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="2115" class="lineNum"><a href="#2115">2115</a></span><span class="counterUnCov"></span><span class="lineUnCov">    // Asserts that the first 2 recv attempts are successful.</span></div>
<div class="line"><span id="2116" class="lineNum"><a href="#2116">2116</a></span><span class="counterCov">2</span><span class="lineCov">    dmx_recv.recv(TIMEOUT).unwrap();</span></div>
<div class="line"><span id="2117" class="lineNum"><a href="#2117">2117</a></span><span class="counterCov">2</span><span class="lineCov">    dmx_recv.recv(TIMEOUT).unwrap();</span></div>
<div class="line"><span id="2118" class="lineNum"><a href="#2118">2118</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="2119" class="lineNum"><a href="#2119">2119</a></span><span class="counterUnCov"></span><span class="lineUnCov">    // On receiving the third time from the third source the sources exceeded error should be thrown.</span></div>
<div class="line"><span id="2120" class="lineNum"><a href="#2120">2120</a></span><span class="counterCov">2</span><span class="lineCov">    match dmx_recv.recv(TIMEOUT) {</span></div>
<div class="line"><span id="2121" class="lineNum"><a href="#2121">2121</a></span><span class="counterCov">2</span><span class="lineCov">        Err(e) =&gt; {</span></div>
<div class="line"><span id="2122" class="lineNum"><a href="#2122">2122</a></span><span class="counterCov">2</span><span class="lineCov">            match *e.kind() {</span></div>
<div class="line"><span id="2123" class="lineNum"><a href="#2123">2123</a></span><span class="counterCov">2</span><span class="lineCov">                ErrorKind::SourcesExceededError(_) =&gt; {</span></div>
<div class="line"><span id="2124" class="lineNum"><a href="#2124">2124</a></span><span class="counterUnCov"></span><span class="lineUnCov">                    assert!(true, &quot;Expected error returned&quot;);</span></div>
<div class="line"><span id="2125" class="lineNum"><a href="#2125">2125</a></span><span class="counterUnCov"></span><span class="lineUnCov">                }</span></div>
<div class="line"><span id="2126" class="lineNum"><a href="#2126">2126</a></span><span class="counterUnCov"></span><span class="lineUnCov">                _ =&gt; {</span></div>
<div class="line"><span id="2127" class="lineNum"><a href="#2127">2127</a></span><span class="counterNoCov">0</span><span class="lineNoCov">                    assert!(false, &quot;Unexpected error type returned&quot;);</span></div>
<div class="line"><span id="2128" class="lineNum"><a href="#2128">2128</a></span><span class="counterUnCov"></span><span class="lineUnCov">                }</span></div>
<div class="line"><span id="2129" class="lineNum"><a href="#2129">2129</a></span><span class="counterUnCov"></span><span class="lineUnCov">            }</span></div>
<div class="line"><span id="2130" class="lineNum"><a href="#2130">2130</a></span><span class="counterUnCov"></span><span class="lineUnCov">        }</span></div>
<div class="line"><span id="2131" class="lineNum"><a href="#2131">2131</a></span><span class="counterCov">2</span><span class="lineCov">        Ok(_) =&gt; {</span></div>
<div class="line"><span id="2132" class="lineNum"><a href="#2132">2132</a></span><span class="counterNoCov">0</span><span class="lineNoCov">            assert!(false, &quot;Recv was successful even though source limit was exceeded&quot;);</span></div>
<div class="line"><span id="2133" class="lineNum"><a href="#2133">2133</a></span><span class="counterUnCov"></span><span class="lineUnCov">        }</span></div>
<div class="line"><span id="2134" class="lineNum"><a href="#2134">2134</a></span><span class="counterCov">2</span><span class="lineCov">    }</span></div>
<div class="line"><span id="2135" class="lineNum"><a href="#2135">2135</a></span><span class="counterUnCov"></span><span class="lineUnCov">    </span></div>
<div class="line"><span id="2136" class="lineNum"><a href="#2136">2136</a></span><span class="counterUnCov"></span><span class="lineUnCov">    // Allow the senders to finish / terminate.</span></div>
<div class="line"><span id="2137" class="lineNum"><a href="#2137">2137</a></span><span class="counterCov">8</span><span class="lineCov">    for _ in 0 .. SND_THREADS {</span></div>
<div class="line"><span id="2138" class="lineNum"><a href="#2138">2138</a></span><span class="counterCov">6</span><span class="lineCov">        finish_snd_rx.recv().unwrap();</span></div>
<div class="line"><span id="2139" class="lineNum"><a href="#2139">2139</a></span><span class="counterUnCov"></span><span class="lineUnCov">    }</span></div>
<div class="line"><span id="2140" class="lineNum"><a href="#2140">2140</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="2141" class="lineNum"><a href="#2141">2141</a></span><span class="counterCov">8</span><span class="lineCov">    for _ in 0 .. SND_THREADS {</span></div>
<div class="line"><span id="2142" class="lineNum"><a href="#2142">2142</a></span><span class="counterCov">6</span><span class="lineCov">        snd_threads.pop().unwrap().join().unwrap();</span></div>
<div class="line"><span id="2143" class="lineNum"><a href="#2143">2143</a></span><span class="counterUnCov"></span><span class="lineUnCov">    }</span></div>
<div class="line"><span id="2144" class="lineNum"><a href="#2144">2144</a></span><span class="counterCov">4</span><span class="lineCov">}</span></div>
<div class="line"><span id="2145" class="lineNum"><a href="#2145">2145</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="2146" class="lineNum"><a href="#2146">2146</a></span><span class="counterUnCov"></span><span class="lineUnCov">/// Creates a receiver with a source limit of 2 and then creates 2 sources which send to the receiver. </span></div>
<div class="line"><span id="2147" class="lineNum"><a href="#2147">2147</a></span><span class="counterUnCov"></span><span class="lineUnCov">/// This shouldn&#39;t trigger a SourcesExceededCondition</span></div>
<div class="line"><span id="2148" class="lineNum"><a href="#2148">2148</a></span><span class="counterUnCov"></span><span class="lineUnCov">#[test]</span></div>
<div class="line"><span id="2149" class="lineNum"><a href="#2149">2149</a></span><span class="counterCov">4</span><span class="lineCov">fn test_receiver_source_limit_2() {</span></div>
<div class="line"><span id="2150" class="lineNum"><a href="#2150">2150</a></span><span class="counterUnCov"></span><span class="lineUnCov">    const SND_THREADS: usize = 2;</span></div>
<div class="line"><span id="2151" class="lineNum"><a href="#2151">2151</a></span><span class="counterUnCov"></span><span class="lineUnCov">    const RCV_THREADS: usize = 1;</span></div>
<div class="line"><span id="2152" class="lineNum"><a href="#2152">2152</a></span><span class="counterUnCov"></span><span class="lineUnCov">    const SRC_LIMIT: Option&lt;usize&gt; = Some(2);</span></div>
<div class="line"><span id="2153" class="lineNum"><a href="#2153">2153</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="2154" class="lineNum"><a href="#2154">2154</a></span><span class="counterCov">2</span><span class="lineCov">    let mut snd_threads = Vec::new();</span></div>
<div class="line"><span id="2155" class="lineNum"><a href="#2155">2155</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="2156" class="lineNum"><a href="#2156">2156</a></span><span class="counterCov">2</span><span class="lineCov">    let (snd_tx, snd_rx): (SyncSender&lt;()&gt;, Receiver&lt;()&gt;) = mpsc::sync_channel(0); // Used for handshaking, allows syncing the sender states.</span></div>
<div class="line"><span id="2157" class="lineNum"><a href="#2157">2157</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="2158" class="lineNum"><a href="#2158">2158</a></span><span class="counterCov">2</span><span class="lineCov">    assert!(RCV_THREADS &lt;= TEST_NETWORK_INTERFACE_IPV4.len(), &quot;Number of test network interface ips less than number of recv threads!&quot;);</span></div>
<div class="line"><span id="2159" class="lineNum"><a href="#2159">2159</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="2160" class="lineNum"><a href="#2160">2160</a></span><span class="counterUnCov"></span><span class="lineUnCov">    const BASE_UNIVERSE: u16 = 2;</span></div>
<div class="line"><span id="2161" class="lineNum"><a href="#2161">2161</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="2162" class="lineNum"><a href="#2162">2162</a></span><span class="counterCov">6</span><span class="lineCov">    for i in 0 .. SND_THREADS {</span></div>
<div class="line"><span id="2163" class="lineNum"><a href="#2163">2163</a></span><span class="counterCov">4</span><span class="lineCov">        let tx = snd_tx.clone();</span></div>
<div class="line"><span id="2164" class="lineNum"><a href="#2164">2164</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="2165" class="lineNum"><a href="#2165">2165</a></span><span class="counterCov">4</span><span class="lineCov">        let data = [1, 2, 3];</span></div>
<div class="line"><span id="2166" class="lineNum"><a href="#2166">2166</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="2167" class="lineNum"><a href="#2167">2167</a></span><span class="counterCov">8</span><span class="lineCov">        snd_threads.push(thread::spawn(move || {</span></div>
<div class="line"><span id="2168" class="lineNum"><a href="#2168">2168</a></span><span class="counterCov">4</span><span class="lineCov">            let ip: SocketAddr = SocketAddr::new(IpAddr::V4(TEST_NETWORK_INTERFACE_IPV4[0].parse().unwrap()), ACN_SDT_MULTICAST_PORT + 1 + (i as u16));</span></div>
<div class="line"><span id="2169" class="lineNum"><a href="#2169">2169</a></span><span class="counterCov">4</span><span class="lineCov">            let mut src = SacnSource::with_ip(&amp;format!(&quot;Source {}&quot;, i), ip).unwrap();</span></div>
<div class="line"><span id="2170" class="lineNum"><a href="#2170">2170</a></span><span class="counterUnCov"></span><span class="lineUnCov">    </span></div>
<div class="line"><span id="2171" class="lineNum"><a href="#2171">2171</a></span><span class="counterCov">4</span><span class="lineCov">            let priority = 100;</span></div>
<div class="line"><span id="2172" class="lineNum"><a href="#2172">2172</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="2173" class="lineNum"><a href="#2173">2173</a></span><span class="counterCov">4</span><span class="lineCov">            let universe: u16 = (i as u16) + BASE_UNIVERSE; </span></div>
<div class="line"><span id="2174" class="lineNum"><a href="#2174">2174</a></span><span class="counterUnCov"></span><span class="lineUnCov">    </span></div>
<div class="line"><span id="2175" class="lineNum"><a href="#2175">2175</a></span><span class="counterCov">4</span><span class="lineCov">            src.register_universe(universe).unwrap(); // Senders all send on different universes.</span></div>
<div class="line"><span id="2176" class="lineNum"><a href="#2176">2176</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="2177" class="lineNum"><a href="#2177">2177</a></span><span class="counterCov">4</span><span class="lineCov">            tx.send(()).unwrap(); // Forces each sender thread to wait till the controlling thread receives which stops sending before the receivers are ready.</span></div>
<div class="line"><span id="2178" class="lineNum"><a href="#2178">2178</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="2179" class="lineNum"><a href="#2179">2179</a></span><span class="counterUnCov"></span><span class="lineUnCov">            // Each source sends twice (meaning 4 packets total), this checks that the receiver isn&#39;t using the number of packets as the way to check for the number</span></div>
<div class="line"><span id="2180" class="lineNum"><a href="#2180">2180</a></span><span class="counterUnCov"></span><span class="lineUnCov">            // of sources. </span></div>
<div class="line"><span id="2181" class="lineNum"><a href="#2181">2181</a></span><span class="counterCov">4</span><span class="lineCov">            src.send(&amp;[universe], &amp;data, Some(priority), None, None).unwrap();</span></div>
<div class="line"><span id="2182" class="lineNum"><a href="#2182">2182</a></span><span class="counterCov">4</span><span class="lineCov">            src.send(&amp;[universe], &amp;data, Some(priority), None, None).unwrap();</span></div>
<div class="line"><span id="2183" class="lineNum"><a href="#2183">2183</a></span><span class="counterCov">4</span><span class="lineCov">        }));</span></div>
<div class="line"><span id="2184" class="lineNum"><a href="#2184">2184</a></span><span class="counterUnCov"></span><span class="lineUnCov">    }</span></div>
<div class="line"><span id="2185" class="lineNum"><a href="#2185">2185</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="2186" class="lineNum"><a href="#2186">2186</a></span><span class="counterCov">2</span><span class="lineCov">    let mut dmx_recv = SacnReceiver::with_ip(SocketAddr::new(IpAddr::V4(TEST_NETWORK_INTERFACE_IPV4[0].parse().unwrap()), ACN_SDT_MULTICAST_PORT), SRC_LIMIT).unwrap();</span></div>
<div class="line"><span id="2187" class="lineNum"><a href="#2187">2187</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="2188" class="lineNum"><a href="#2188">2188</a></span><span class="counterUnCov"></span><span class="lineUnCov">    // Receivers listen to all universes</span></div>
<div class="line"><span id="2189" class="lineNum"><a href="#2189">2189</a></span><span class="counterCov">6</span><span class="lineCov">    for i in (BASE_UNIVERSE as u16) .. ((SND_THREADS as u16) + (BASE_UNIVERSE as u16)) {</span></div>
<div class="line"><span id="2190" class="lineNum"><a href="#2190">2190</a></span><span class="counterCov">4</span><span class="lineCov">        dmx_recv.listen_universes(&amp;[i]).unwrap();</span></div>
<div class="line"><span id="2191" class="lineNum"><a href="#2191">2191</a></span><span class="counterUnCov"></span><span class="lineUnCov">    }</span></div>
<div class="line"><span id="2192" class="lineNum"><a href="#2192">2192</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="2193" class="lineNum"><a href="#2193">2193</a></span><span class="counterCov">6</span><span class="lineCov">    for _i in 0 .. SND_THREADS {</span></div>
<div class="line"><span id="2194" class="lineNum"><a href="#2194">2194</a></span><span class="counterCov">4</span><span class="lineCov">        snd_rx.recv().unwrap(); // Allow each sender to progress</span></div>
<div class="line"><span id="2195" class="lineNum"><a href="#2195">2195</a></span><span class="counterUnCov"></span><span class="lineUnCov">    }</span></div>
<div class="line"><span id="2196" class="lineNum"><a href="#2196">2196</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="2197" class="lineNum"><a href="#2197">2197</a></span><span class="counterUnCov"></span><span class="lineUnCov">    // Asserts that the recv attempts are successful.</span></div>
<div class="line"><span id="2198" class="lineNum"><a href="#2198">2198</a></span><span class="counterCov">2</span><span class="lineCov">    dmx_recv.recv(None).unwrap();</span></div>
<div class="line"><span id="2199" class="lineNum"><a href="#2199">2199</a></span><span class="counterCov">2</span><span class="lineCov">    dmx_recv.recv(None).unwrap();</span></div>
<div class="line"><span id="2200" class="lineNum"><a href="#2200">2200</a></span><span class="counterCov">2</span><span class="lineCov">    dmx_recv.recv(None).unwrap();</span></div>
<div class="line"><span id="2201" class="lineNum"><a href="#2201">2201</a></span><span class="counterCov">2</span><span class="lineCov">    dmx_recv.recv(None).unwrap();</span></div>
<div class="line"><span id="2202" class="lineNum"><a href="#2202">2202</a></span><span class="counterCov">4</span><span class="lineCov">}</span></div>
<div class="line"><span id="2203" class="lineNum"><a href="#2203">2203</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="2204" class="lineNum"><a href="#2204">2204</a></span><span class="counterUnCov"></span><span class="lineUnCov">/// Creates a receiver with a source limit of 2 and then creates 2 sources which send to the receiver.</span></div>
<div class="line"><span id="2205" class="lineNum"><a href="#2205">2205</a></span><span class="counterUnCov"></span><span class="lineUnCov">/// A source then terminates and another source is created.</span></div>
<div class="line"><span id="2206" class="lineNum"><a href="#2206">2206</a></span><span class="counterUnCov"></span><span class="lineUnCov">/// At all points the total source count was less than or equal to the limit of 2 sources as specified by the receiver</span></div>
<div class="line"><span id="2207" class="lineNum"><a href="#2207">2207</a></span><span class="counterUnCov"></span><span class="lineUnCov">/// so this should not cause a SourcesExceededCondition.</span></div>
<div class="line"><span id="2208" class="lineNum"><a href="#2208">2208</a></span><span class="counterUnCov"></span><span class="lineUnCov">#[test]</span></div>
<div class="line"><span id="2209" class="lineNum"><a href="#2209">2209</a></span><span class="counterCov">4</span><span class="lineCov">fn test_receiver_source_limit_2_termination_check() {</span></div>
<div class="line"><span id="2210" class="lineNum"><a href="#2210">2210</a></span><span class="counterUnCov"></span><span class="lineUnCov">    const SND_THREADS: usize = 2;</span></div>
<div class="line"><span id="2211" class="lineNum"><a href="#2211">2211</a></span><span class="counterUnCov"></span><span class="lineUnCov">    const SRC_LIMIT: Option&lt;usize&gt; = Some(2);</span></div>
<div class="line"><span id="2212" class="lineNum"><a href="#2212">2212</a></span><span class="counterUnCov"></span><span class="lineUnCov">    const RECV_TIMEOUT: Option&lt;Duration&gt; = Some(Duration::from_secs(5));</span></div>
<div class="line"><span id="2213" class="lineNum"><a href="#2213">2213</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="2214" class="lineNum"><a href="#2214">2214</a></span><span class="counterCov">2</span><span class="lineCov">    let mut snd_threads = Vec::new();</span></div>
<div class="line"><span id="2215" class="lineNum"><a href="#2215">2215</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="2216" class="lineNum"><a href="#2216">2216</a></span><span class="counterCov">2</span><span class="lineCov">    let (snd_tx, snd_rx): (SyncSender&lt;()&gt;, Receiver&lt;()&gt;) = mpsc::sync_channel(0); // Used for handshaking, allows syncing the sender states.</span></div>
<div class="line"><span id="2217" class="lineNum"><a href="#2217">2217</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="2218" class="lineNum"><a href="#2218">2218</a></span><span class="counterUnCov"></span><span class="lineUnCov">    const BASE_UNIVERSE: u16 = 2;</span></div>
<div class="line"><span id="2219" class="lineNum"><a href="#2219">2219</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="2220" class="lineNum"><a href="#2220">2220</a></span><span class="counterCov">6</span><span class="lineCov">    for i in 0 .. SND_THREADS {</span></div>
<div class="line"><span id="2221" class="lineNum"><a href="#2221">2221</a></span><span class="counterCov">4</span><span class="lineCov">        let tx = snd_tx.clone();</span></div>
<div class="line"><span id="2222" class="lineNum"><a href="#2222">2222</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="2223" class="lineNum"><a href="#2223">2223</a></span><span class="counterCov">4</span><span class="lineCov">        let data = [1, 2, 3];</span></div>
<div class="line"><span id="2224" class="lineNum"><a href="#2224">2224</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="2225" class="lineNum"><a href="#2225">2225</a></span><span class="counterCov">8</span><span class="lineCov">        snd_threads.push(thread::spawn(move || {</span></div>
<div class="line"><span id="2226" class="lineNum"><a href="#2226">2226</a></span><span class="counterCov">4</span><span class="lineCov">            let ip: SocketAddr = SocketAddr::new(IpAddr::V4(TEST_NETWORK_INTERFACE_IPV4[0].parse().unwrap()), ACN_SDT_MULTICAST_PORT + 1 + (i as u16));</span></div>
<div class="line"><span id="2227" class="lineNum"><a href="#2227">2227</a></span><span class="counterCov">4</span><span class="lineCov">            let mut src = SacnSource::with_ip(&amp;format!(&quot;Source {}&quot;, i), ip).unwrap();</span></div>
<div class="line"><span id="2228" class="lineNum"><a href="#2228">2228</a></span><span class="counterUnCov"></span><span class="lineUnCov">    </span></div>
<div class="line"><span id="2229" class="lineNum"><a href="#2229">2229</a></span><span class="counterCov">4</span><span class="lineCov">            let priority = 100;</span></div>
<div class="line"><span id="2230" class="lineNum"><a href="#2230">2230</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="2231" class="lineNum"><a href="#2231">2231</a></span><span class="counterCov">4</span><span class="lineCov">            let universe: u16 = (i as u16) + BASE_UNIVERSE; </span></div>
<div class="line"><span id="2232" class="lineNum"><a href="#2232">2232</a></span><span class="counterUnCov"></span><span class="lineUnCov">    </span></div>
<div class="line"><span id="2233" class="lineNum"><a href="#2233">2233</a></span><span class="counterCov">4</span><span class="lineCov">            src.register_universe(universe).unwrap(); // Senders all send on different universes.</span></div>
<div class="line"><span id="2234" class="lineNum"><a href="#2234">2234</a></span><span class="counterUnCov"></span><span class="lineUnCov">            </span></div>
<div class="line"><span id="2235" class="lineNum"><a href="#2235">2235</a></span><span class="counterCov">4</span><span class="lineCov">            tx.send(()).unwrap(); // Forces each sender thread to wait till the controlling thread receives which stops sending before the receivers are ready.</span></div>
<div class="line"><span id="2236" class="lineNum"><a href="#2236">2236</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="2237" class="lineNum"><a href="#2237">2237</a></span><span class="counterUnCov"></span><span class="lineUnCov">            // Each source sends twice (meaning 4 packets total), this checks that the receiver isn&#39;t using the number of packets as the way to check for the number</span></div>
<div class="line"><span id="2238" class="lineNum"><a href="#2238">2238</a></span><span class="counterUnCov"></span><span class="lineUnCov">            // of sources. </span></div>
<div class="line"><span id="2239" class="lineNum"><a href="#2239">2239</a></span><span class="counterCov">4</span><span class="lineCov">            src.send(&amp;[universe], &amp;data, Some(priority), None, None).unwrap();</span></div>
<div class="line"><span id="2240" class="lineNum"><a href="#2240">2240</a></span><span class="counterCov">4</span><span class="lineCov">            src.send(&amp;[universe], &amp;data, Some(priority), None, None).unwrap();</span></div>
<div class="line"><span id="2241" class="lineNum"><a href="#2241">2241</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="2242" class="lineNum"><a href="#2242">2242</a></span><span class="counterCov">6</span><span class="lineCov">            if i == 0 { // Forces the first thread not to terminate and to wait. The second thread will finish and terminate the source.</span></div>
<div class="line"><span id="2243" class="lineNum"><a href="#2243">2243</a></span><span class="counterCov">2</span><span class="lineCov">                tx.send(()).unwrap();</span></div>
<div class="line"><span id="2244" class="lineNum"><a href="#2244">2244</a></span><span class="counterUnCov"></span><span class="lineUnCov">            }</span></div>
<div class="line"><span id="2245" class="lineNum"><a href="#2245">2245</a></span><span class="counterCov">4</span><span class="lineCov">        }));</span></div>
<div class="line"><span id="2246" class="lineNum"><a href="#2246">2246</a></span><span class="counterUnCov"></span><span class="lineUnCov">    }</span></div>
<div class="line"><span id="2247" class="lineNum"><a href="#2247">2247</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="2248" class="lineNum"><a href="#2248">2248</a></span><span class="counterCov">2</span><span class="lineCov">    let mut dmx_recv = SacnReceiver::with_ip(SocketAddr::new(IpAddr::V4(TEST_NETWORK_INTERFACE_IPV4[0].parse().unwrap()), ACN_SDT_MULTICAST_PORT), SRC_LIMIT).unwrap();</span></div>
<div class="line"><span id="2249" class="lineNum"><a href="#2249">2249</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="2250" class="lineNum"><a href="#2250">2250</a></span><span class="counterUnCov"></span><span class="lineUnCov">    // Receivers listen to all universes</span></div>
<div class="line"><span id="2251" class="lineNum"><a href="#2251">2251</a></span><span class="counterCov">6</span><span class="lineCov">    for i in (BASE_UNIVERSE as u16) .. ((SND_THREADS as u16) + (BASE_UNIVERSE as u16)) {</span></div>
<div class="line"><span id="2252" class="lineNum"><a href="#2252">2252</a></span><span class="counterCov">4</span><span class="lineCov">        dmx_recv.listen_universes(&amp;[i]).unwrap();</span></div>
<div class="line"><span id="2253" class="lineNum"><a href="#2253">2253</a></span><span class="counterUnCov"></span><span class="lineUnCov">    }</span></div>
<div class="line"><span id="2254" class="lineNum"><a href="#2254">2254</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="2255" class="lineNum"><a href="#2255">2255</a></span><span class="counterCov">2</span><span class="lineCov">    snd_rx.recv().unwrap();</span></div>
<div class="line"><span id="2256" class="lineNum"><a href="#2256">2256</a></span><span class="counterCov">2</span><span class="lineCov">    snd_rx.recv().unwrap();</span></div>
<div class="line"><span id="2257" class="lineNum"><a href="#2257">2257</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="2258" class="lineNum"><a href="#2258">2258</a></span><span class="counterUnCov"></span><span class="lineUnCov">    // Asserts that the recv attempts are successful.</span></div>
<div class="line"><span id="2259" class="lineNum"><a href="#2259">2259</a></span><span class="counterCov">2</span><span class="lineCov">    dmx_recv.recv(RECV_TIMEOUT).unwrap();</span></div>
<div class="line"><span id="2260" class="lineNum"><a href="#2260">2260</a></span><span class="counterCov">2</span><span class="lineCov">    dmx_recv.recv(RECV_TIMEOUT).unwrap();</span></div>
<div class="line"><span id="2261" class="lineNum"><a href="#2261">2261</a></span><span class="counterCov">2</span><span class="lineCov">    dmx_recv.recv(RECV_TIMEOUT).unwrap();</span></div>
<div class="line"><span id="2262" class="lineNum"><a href="#2262">2262</a></span><span class="counterCov">2</span><span class="lineCov">    dmx_recv.recv(RECV_TIMEOUT).unwrap();</span></div>
<div class="line"><span id="2263" class="lineNum"><a href="#2263">2263</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="2264" class="lineNum"><a href="#2264">2264</a></span><span class="counterUnCov"></span><span class="lineUnCov">    // The first source is held back from terminating but the second source should terminate.</span></div>
<div class="line"><span id="2265" class="lineNum"><a href="#2265">2265</a></span><span class="counterCov">2</span><span class="lineCov">    let second_thread = snd_threads.remove(1);</span></div>
<div class="line"><span id="2266" class="lineNum"><a href="#2266">2266</a></span><span class="counterCov">2</span><span class="lineCov">    second_thread.join().unwrap();</span></div>
<div class="line"><span id="2267" class="lineNum"><a href="#2267">2267</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="2268" class="lineNum"><a href="#2268">2268</a></span><span class="counterUnCov"></span><span class="lineUnCov">    // Create a new source which sends to the receiver.</span></div>
<div class="line"><span id="2269" class="lineNum"><a href="#2269">2269</a></span><span class="counterCov">2</span><span class="lineCov">    let data = [1, 2, 3];</span></div>
<div class="line"><span id="2270" class="lineNum"><a href="#2270">2270</a></span><span class="counterCov">4</span><span class="lineCov">    let new_src_thread = thread::spawn(move || {</span></div>
<div class="line"><span id="2271" class="lineNum"><a href="#2271">2271</a></span><span class="counterCov">2</span><span class="lineCov">        let ip: SocketAddr = SocketAddr::new(IpAddr::V4(TEST_NETWORK_INTERFACE_IPV4[0].parse().unwrap()), ACN_SDT_MULTICAST_PORT + 1 + (3 as u16));</span></div>
<div class="line"><span id="2272" class="lineNum"><a href="#2272">2272</a></span><span class="counterCov">2</span><span class="lineCov">        let mut src = SacnSource::with_ip(&amp;format!(&quot;Source {}&quot;, 3), ip).unwrap();</span></div>
<div class="line"><span id="2273" class="lineNum"><a href="#2273">2273</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="2274" class="lineNum"><a href="#2274">2274</a></span><span class="counterCov">2</span><span class="lineCov">        src.register_universe(BASE_UNIVERSE).unwrap();</span></div>
<div class="line"><span id="2275" class="lineNum"><a href="#2275">2275</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="2276" class="lineNum"><a href="#2276">2276</a></span><span class="counterUnCov"></span><span class="lineUnCov">        // New source now sends twice which the receiver should receive.</span></div>
<div class="line"><span id="2277" class="lineNum"><a href="#2277">2277</a></span><span class="counterCov">2</span><span class="lineCov">        src.send(&amp;[BASE_UNIVERSE], &amp;data, None, None, None).unwrap();</span></div>
<div class="line"><span id="2278" class="lineNum"><a href="#2278">2278</a></span><span class="counterCov">2</span><span class="lineCov">        src.send(&amp;[BASE_UNIVERSE], &amp;data, None, None, None).unwrap();</span></div>
<div class="line"><span id="2279" class="lineNum"><a href="#2279">2279</a></span><span class="counterCov">2</span><span class="lineCov">    });</span></div>
<div class="line"><span id="2280" class="lineNum"><a href="#2280">2280</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="2281" class="lineNum"><a href="#2281">2281</a></span><span class="counterUnCov"></span><span class="lineUnCov">    // Asserts that the recv attempts are successful (no source exceeded).</span></div>
<div class="line"><span id="2282" class="lineNum"><a href="#2282">2282</a></span><span class="counterCov">2</span><span class="lineCov">    dmx_recv.recv(RECV_TIMEOUT).unwrap();</span></div>
<div class="line"><span id="2283" class="lineNum"><a href="#2283">2283</a></span><span class="counterCov">2</span><span class="lineCov">    dmx_recv.recv(RECV_TIMEOUT).unwrap();</span></div>
<div class="line"><span id="2284" class="lineNum"><a href="#2284">2284</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="2285" class="lineNum"><a href="#2285">2285</a></span><span class="counterUnCov"></span><span class="lineUnCov">    // Allow the first source to progress and finish.</span></div>
<div class="line"><span id="2286" class="lineNum"><a href="#2286">2286</a></span><span class="counterCov">2</span><span class="lineCov">    snd_rx.recv().unwrap();</span></div>
<div class="line"><span id="2287" class="lineNum"><a href="#2287">2287</a></span><span class="counterCov">2</span><span class="lineCov">    let first_thread = snd_threads.remove(0);</span></div>
<div class="line"><span id="2288" class="lineNum"><a href="#2288">2288</a></span><span class="counterCov">2</span><span class="lineCov">    first_thread.join().unwrap();</span></div>
<div class="line"><span id="2289" class="lineNum"><a href="#2289">2289</a></span><span class="counterUnCov"></span><span class="lineUnCov">    </span></div>
<div class="line"><span id="2290" class="lineNum"><a href="#2290">2290</a></span><span class="counterUnCov"></span><span class="lineUnCov">    // Finish the new source.</span></div>
<div class="line"><span id="2291" class="lineNum"><a href="#2291">2291</a></span><span class="counterCov">2</span><span class="lineCov">    new_src_thread.join().unwrap();</span></div>
<div class="line"><span id="2292" class="lineNum"><a href="#2292">2292</a></span><span class="counterCov">4</span><span class="lineCov">}</span></div>
<div class="line"><span id="2293" class="lineNum"><a href="#2293">2293</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="2294" class="lineNum"><a href="#2294">2294</a></span><span class="counterUnCov"></span><span class="lineUnCov">/// Create 2 receivers with a single sender, one receiver listens to preview_data and the other doesn&#39;t. </span></div>
<div class="line"><span id="2295" class="lineNum"><a href="#2295">2295</a></span><span class="counterUnCov"></span><span class="lineUnCov">/// The sender then sends data with the preview flag set and not and the receivers check they receive the data correctly.</span></div>
<div class="line"><span id="2296" class="lineNum"><a href="#2296">2296</a></span><span class="counterUnCov"></span><span class="lineUnCov">#[test]</span></div>
<div class="line"><span id="2297" class="lineNum"><a href="#2297">2297</a></span><span class="counterCov">4</span><span class="lineCov">fn test_preview_data_2_receiver_1_sender() {</span></div>
<div class="line"><span id="2298" class="lineNum"><a href="#2298">2298</a></span><span class="counterUnCov"></span><span class="lineUnCov">    const RCV_THREADS: usize = 2;</span></div>
<div class="line"><span id="2299" class="lineNum"><a href="#2299">2299</a></span><span class="counterUnCov"></span><span class="lineUnCov">    const UNIVERSE: u16 = 1;</span></div>
<div class="line"><span id="2300" class="lineNum"><a href="#2300">2300</a></span><span class="counterUnCov"></span><span class="lineUnCov">    const NORMAL_DATA: [u8; 4] = [0, 1, 2, 3];</span></div>
<div class="line"><span id="2301" class="lineNum"><a href="#2301">2301</a></span><span class="counterUnCov"></span><span class="lineUnCov">    const PREVIEW_DATA: [u8; 4] = [9, 10, 11, 12];</span></div>
<div class="line"><span id="2302" class="lineNum"><a href="#2302">2302</a></span><span class="counterUnCov"></span><span class="lineUnCov">    const TIMEOUT: Option&lt;Duration&gt; = Some(Duration::from_secs(3));</span></div>
<div class="line"><span id="2303" class="lineNum"><a href="#2303">2303</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="2304" class="lineNum"><a href="#2304">2304</a></span><span class="counterCov">2</span><span class="lineCov">    let mut rcv_threads = Vec::new();</span></div>
<div class="line"><span id="2305" class="lineNum"><a href="#2305">2305</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="2306" class="lineNum"><a href="#2306">2306</a></span><span class="counterCov">2</span><span class="lineCov">    let (rcv_tx, rcv_rx): (SyncSender&lt;Result&lt;Vec&lt;DMXData&gt;&gt;&gt;, Receiver&lt;Result&lt;Vec&lt;DMXData&gt;&gt;&gt;) = mpsc::sync_channel(0);</span></div>
<div class="line"><span id="2307" class="lineNum"><a href="#2307">2307</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="2308" class="lineNum"><a href="#2308">2308</a></span><span class="counterUnCov"></span><span class="lineUnCov">    // Check that the test setup is correct.</span></div>
<div class="line"><span id="2309" class="lineNum"><a href="#2309">2309</a></span><span class="counterCov">2</span><span class="lineCov">    assert!(RCV_THREADS &lt;= TEST_NETWORK_INTERFACE_IPV4.len(), &quot;Number of test network interface ips less than number of recv threads!&quot;);</span></div>
<div class="line"><span id="2310" class="lineNum"><a href="#2310">2310</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="2311" class="lineNum"><a href="#2311">2311</a></span><span class="counterCov">6</span><span class="lineCov">    for i in 0 .. RCV_THREADS {</span></div>
<div class="line"><span id="2312" class="lineNum"><a href="#2312">2312</a></span><span class="counterCov">4</span><span class="lineCov">        let tx = rcv_tx.clone();</span></div>
<div class="line"><span id="2313" class="lineNum"><a href="#2313">2313</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="2314" class="lineNum"><a href="#2314">2314</a></span><span class="counterCov">8</span><span class="lineCov">        rcv_threads.push(thread::spawn(move || {</span></div>
<div class="line"><span id="2315" class="lineNum"><a href="#2315">2315</a></span><span class="counterUnCov"></span><span class="lineUnCov">            // Port kept the same so must use multiple IP&#39;s.</span></div>
<div class="line"><span id="2316" class="lineNum"><a href="#2316">2316</a></span><span class="counterCov">4</span><span class="lineCov">            let mut dmx_recv = SacnReceiver::with_ip(SocketAddr::new(IpAddr::V4(TEST_NETWORK_INTERFACE_IPV4[i].parse().unwrap()), ACN_SDT_MULTICAST_PORT), None).unwrap();</span></div>
<div class="line"><span id="2317" class="lineNum"><a href="#2317">2317</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="2318" class="lineNum"><a href="#2318">2318</a></span><span class="counterCov">6</span><span class="lineCov">            if i == 0 {</span></div>
<div class="line"><span id="2319" class="lineNum"><a href="#2319">2319</a></span><span class="counterCov">2</span><span class="lineCov">                dmx_recv.set_process_preview_data(true); // The first receiver should listen for preview data.</span></div>
<div class="line"><span id="2320" class="lineNum"><a href="#2320">2320</a></span><span class="counterUnCov"></span><span class="lineUnCov">            }</span></div>
<div class="line"><span id="2321" class="lineNum"><a href="#2321">2321</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="2322" class="lineNum"><a href="#2322">2322</a></span><span class="counterUnCov"></span><span class="lineUnCov">            // Receivers listen to the same universe</span></div>
<div class="line"><span id="2323" class="lineNum"><a href="#2323">2323</a></span><span class="counterCov">4</span><span class="lineCov">            dmx_recv.listen_universes(&amp;[UNIVERSE]).unwrap();</span></div>
<div class="line"><span id="2324" class="lineNum"><a href="#2324">2324</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="2325" class="lineNum"><a href="#2325">2325</a></span><span class="counterCov">4</span><span class="lineCov">            tx.send(Ok(Vec::new())).unwrap(); // Receiver notifies controlling thread it is ready.</span></div>
<div class="line"><span id="2326" class="lineNum"><a href="#2326">2326</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="2327" class="lineNum"><a href="#2327">2327</a></span><span class="counterCov">4</span><span class="lineCov">            let result = dmx_recv.recv(None).unwrap();</span></div>
<div class="line"><span id="2328" class="lineNum"><a href="#2328">2328</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="2329" class="lineNum"><a href="#2329">2329</a></span><span class="counterCov">4</span><span class="lineCov">            assert_eq!(result.len(), 1);</span></div>
<div class="line"><span id="2330" class="lineNum"><a href="#2330">2330</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="2331" class="lineNum"><a href="#2331">2331</a></span><span class="counterCov">2</span><span class="lineCov">            let data = &amp;result[0];</span></div>
<div class="line"><span id="2332" class="lineNum"><a href="#2332">2332</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="2333" class="lineNum"><a href="#2333">2333</a></span><span class="counterCov">3</span><span class="lineCov">            assert_eq!(data.universe, UNIVERSE);</span></div>
<div class="line"><span id="2334" class="lineNum"><a href="#2334">2334</a></span><span class="counterCov">3</span><span class="lineCov">            assert_eq!(data.values, NORMAL_DATA);</span></div>
<div class="line"><span id="2335" class="lineNum"><a href="#2335">2335</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="2336" class="lineNum"><a href="#2336">2336</a></span><span class="counterCov">4</span><span class="lineCov">            assert_eq!(data.preview, false);</span></div>
<div class="line"><span id="2337" class="lineNum"><a href="#2337">2337</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="2338" class="lineNum"><a href="#2338">2338</a></span><span class="counterCov">7</span><span class="lineCov">            if i == 0 {</span></div>
<div class="line"><span id="2339" class="lineNum"><a href="#2339">2339</a></span><span class="counterUnCov"></span><span class="lineUnCov">                // The receiver listening to preview_data will receive twice.</span></div>
<div class="line"><span id="2340" class="lineNum"><a href="#2340">2340</a></span><span class="counterCov">2</span><span class="lineCov">                let preview_result = dmx_recv.recv(None).unwrap();</span></div>
<div class="line"><span id="2341" class="lineNum"><a href="#2341">2341</a></span><span class="counterCov">2</span><span class="lineCov">                assert_eq!(preview_result.len(), 1);</span></div>
<div class="line"><span id="2342" class="lineNum"><a href="#2342">2342</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="2343" class="lineNum"><a href="#2343">2343</a></span><span class="counterCov">2</span><span class="lineCov">                let preview_data = &amp;preview_result[0];</span></div>
<div class="line"><span id="2344" class="lineNum"><a href="#2344">2344</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="2345" class="lineNum"><a href="#2345">2345</a></span><span class="counterCov">2</span><span class="lineCov">                assert_eq!(preview_data.universe, UNIVERSE);</span></div>
<div class="line"><span id="2346" class="lineNum"><a href="#2346">2346</a></span><span class="counterCov">2</span><span class="lineCov">                assert_eq!(preview_data.values, PREVIEW_DATA);</span></div>
<div class="line"><span id="2347" class="lineNum"><a href="#2347">2347</a></span><span class="counterCov">2</span><span class="lineCov">                assert_eq!(preview_data.preview, true);</span></div>
<div class="line"><span id="2348" class="lineNum"><a href="#2348">2348</a></span><span class="counterCov">2</span><span class="lineCov">            } else {</span></div>
<div class="line"><span id="2349" class="lineNum"><a href="#2349">2349</a></span><span class="counterUnCov"></span><span class="lineUnCov">                // The other receiver should not.</span></div>
<div class="line"><span id="2350" class="lineNum"><a href="#2350">2350</a></span><span class="counterCov">2</span><span class="lineCov">                match dmx_recv.recv(TIMEOUT) { </span></div>
<div class="line"><span id="2351" class="lineNum"><a href="#2351">2351</a></span><span class="counterCov">2</span><span class="lineCov">                    Err(e) =&gt; {</span></div>
<div class="line"><span id="2352" class="lineNum"><a href="#2352">2352</a></span><span class="counterCov">2</span><span class="lineCov">                        match e.kind() {</span></div>
<div class="line"><span id="2353" class="lineNum"><a href="#2353">2353</a></span><span class="counterCov">2</span><span class="lineCov">                            &amp;ErrorKind::Io(ref s) =&gt; {</span></div>
<div class="line"><span id="2354" class="lineNum"><a href="#2354">2354</a></span><span class="counterCov">2</span><span class="lineCov">                                match s.kind() {</span></div>
<div class="line"><span id="2355" class="lineNum"><a href="#2355">2355</a></span><span class="counterCov">2</span><span class="lineCov">                                    std::io::ErrorKind::WouldBlock =&gt; {</span></div>
<div class="line"><span id="2356" class="lineNum"><a href="#2356">2356</a></span><span class="counterUnCov"></span><span class="lineUnCov">                                        // Expected to timeout / would block.</span></div>
<div class="line"><span id="2357" class="lineNum"><a href="#2357">2357</a></span><span class="counterUnCov"></span><span class="lineUnCov">                                        // The different errors are due to windows and unix returning different errors for the same thing.</span></div>
<div class="line"><span id="2358" class="lineNum"><a href="#2358">2358</a></span><span class="counterUnCov"></span><span class="lineUnCov">                                    },</span></div>
<div class="line"><span id="2359" class="lineNum"><a href="#2359">2359</a></span><span class="counterUnCov"></span><span class="lineUnCov">                                    std::io::ErrorKind::TimedOut =&gt; {},</span></div>
<div class="line"><span id="2360" class="lineNum"><a href="#2360">2360</a></span><span class="counterUnCov"></span><span class="lineUnCov">                                    _ =&gt; {</span></div>
<div class="line"><span id="2361" class="lineNum"><a href="#2361">2361</a></span><span class="counterNoCov">0</span><span class="lineNoCov">                                        assert!(false, &quot;Unexpected error returned&quot;);</span></div>
<div class="line"><span id="2362" class="lineNum"><a href="#2362">2362</a></span><span class="counterUnCov"></span><span class="lineUnCov">                                    }</span></div>
<div class="line"><span id="2363" class="lineNum"><a href="#2363">2363</a></span><span class="counterUnCov"></span><span class="lineUnCov">                                }</span></div>
<div class="line"><span id="2364" class="lineNum"><a href="#2364">2364</a></span><span class="counterUnCov"></span><span class="lineUnCov">                            },</span></div>
<div class="line"><span id="2365" class="lineNum"><a href="#2365">2365</a></span><span class="counterUnCov"></span><span class="lineUnCov">                            _ =&gt; {</span></div>
<div class="line"><span id="2366" class="lineNum"><a href="#2366">2366</a></span><span class="counterNoCov">0</span><span class="lineNoCov">                                assert!(false, &quot;Unexpected error returned&quot;);</span></div>
<div class="line"><span id="2367" class="lineNum"><a href="#2367">2367</a></span><span class="counterUnCov"></span><span class="lineUnCov">                            }</span></div>
<div class="line"><span id="2368" class="lineNum"><a href="#2368">2368</a></span><span class="counterUnCov"></span><span class="lineUnCov">                        }</span></div>
<div class="line"><span id="2369" class="lineNum"><a href="#2369">2369</a></span><span class="counterCov">2</span><span class="lineCov">                    },</span></div>
<div class="line"><span id="2370" class="lineNum"><a href="#2370">2370</a></span><span class="counterUnCov"></span><span class="lineUnCov">                    Ok(_) =&gt; {</span></div>
<div class="line"><span id="2371" class="lineNum"><a href="#2371">2371</a></span><span class="counterNoCov">0</span><span class="lineNoCov">                        assert!(false, &quot;Non-preview receiver received preview data&quot;);</span></div>
<div class="line"><span id="2372" class="lineNum"><a href="#2372">2372</a></span><span class="counterUnCov"></span><span class="lineUnCov">                    }</span></div>
<div class="line"><span id="2373" class="lineNum"><a href="#2373">2373</a></span><span class="counterUnCov"></span><span class="lineUnCov">                }</span></div>
<div class="line"><span id="2374" class="lineNum"><a href="#2374">2374</a></span><span class="counterCov">2</span><span class="lineCov">            }</span></div>
<div class="line"><span id="2375" class="lineNum"><a href="#2375">2375</a></span><span class="counterCov">4</span><span class="lineCov">        }));</span></div>
<div class="line"><span id="2376" class="lineNum"><a href="#2376">2376</a></span><span class="counterUnCov"></span><span class="lineUnCov">    }</span></div>
<div class="line"><span id="2377" class="lineNum"><a href="#2377">2377</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="2378" class="lineNum"><a href="#2378">2378</a></span><span class="counterUnCov"></span><span class="lineUnCov">    // Sender waits for both receivers to be ready.</span></div>
<div class="line"><span id="2379" class="lineNum"><a href="#2379">2379</a></span><span class="counterCov">6</span><span class="lineCov">    for _ in 0 .. RCV_THREADS {</span></div>
<div class="line"><span id="2380" class="lineNum"><a href="#2380">2380</a></span><span class="counterCov">4</span><span class="lineCov">        rcv_rx.recv().unwrap().unwrap();</span></div>
<div class="line"><span id="2381" class="lineNum"><a href="#2381">2381</a></span><span class="counterUnCov"></span><span class="lineUnCov">    }</span></div>
<div class="line"><span id="2382" class="lineNum"><a href="#2382">2382</a></span><span class="counterUnCov"></span><span class="lineUnCov">    </span></div>
<div class="line"><span id="2383" class="lineNum"><a href="#2383">2383</a></span><span class="counterCov">2</span><span class="lineCov">    let ip: SocketAddr = SocketAddr::new(IpAddr::V4(TEST_NETWORK_INTERFACE_IPV4[0].parse().unwrap()), ACN_SDT_MULTICAST_PORT + 1);</span></div>
<div class="line"><span id="2384" class="lineNum"><a href="#2384">2384</a></span><span class="counterCov">2</span><span class="lineCov">    let mut src = SacnSource::with_ip(&quot;Source&quot;, ip).unwrap();</span></div>
<div class="line"><span id="2385" class="lineNum"><a href="#2385">2385</a></span><span class="counterCov">2</span><span class="lineCov">    src.register_universe(UNIVERSE).unwrap();</span></div>
<div class="line"><span id="2386" class="lineNum"><a href="#2386">2386</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="2387" class="lineNum"><a href="#2387">2387</a></span><span class="counterUnCov"></span><span class="lineUnCov">    // Send data without the preview flag.</span></div>
<div class="line"><span id="2388" class="lineNum"><a href="#2388">2388</a></span><span class="counterCov">2</span><span class="lineCov">    src.send(&amp;[UNIVERSE], &amp;NORMAL_DATA, None, None, None).unwrap();</span></div>
<div class="line"><span id="2389" class="lineNum"><a href="#2389">2389</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="2390" class="lineNum"><a href="#2390">2390</a></span><span class="counterCov">2</span><span class="lineCov">    src.set_preview_mode(true).unwrap();</span></div>
<div class="line"><span id="2391" class="lineNum"><a href="#2391">2391</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="2392" class="lineNum"><a href="#2392">2392</a></span><span class="counterUnCov"></span><span class="lineUnCov">    // Send data with the preview flag.</span></div>
<div class="line"><span id="2393" class="lineNum"><a href="#2393">2393</a></span><span class="counterCov">2</span><span class="lineCov">    src.send(&amp;[UNIVERSE], &amp;PREVIEW_DATA, None, None, None).unwrap();</span></div>
<div class="line"><span id="2394" class="lineNum"><a href="#2394">2394</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="2395" class="lineNum"><a href="#2395">2395</a></span><span class="counterUnCov"></span><span class="lineUnCov">    // Finish with the receive threads.</span></div>
<div class="line"><span id="2396" class="lineNum"><a href="#2396">2396</a></span><span class="counterCov">6</span><span class="lineCov">    for r in rcv_threads {</span></div>
<div class="line"><span id="2397" class="lineNum"><a href="#2397">2397</a></span><span class="counterCov">4</span><span class="lineCov">        r.join().unwrap();</span></div>
<div class="line"><span id="2398" class="lineNum"><a href="#2398">2398</a></span><span class="counterCov">2</span><span class="lineCov">    }</span></div>
<div class="line"><span id="2399" class="lineNum"><a href="#2399">2399</a></span><span class="counterCov">4</span><span class="lineCov">}</span></div>
<div class="line"><span id="2400" class="lineNum"><a href="#2400">2400</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="2401" class="lineNum"><a href="#2401">2401</a></span><span class="counterUnCov"></span><span class="lineUnCov">/// Creates a receiver and a sender. The sender sends a data packet to the receiver and then holds.</span></div>
<div class="line"><span id="2402" class="lineNum"><a href="#2402">2402</a></span><span class="counterUnCov"></span><span class="lineUnCov">/// The receiver (with announce_timeout flag set to true) then waits for the timeout notification to happen.</span></div>
<div class="line"><span id="2403" class="lineNum"><a href="#2403">2403</a></span><span class="counterUnCov"></span><span class="lineUnCov">/// This shows that the timeout mechanism for a source works.</span></div>
<div class="line"><span id="2404" class="lineNum"><a href="#2404">2404</a></span><span class="counterUnCov"></span><span class="lineUnCov">#[test]</span></div>
<div class="line"><span id="2405" class="lineNum"><a href="#2405">2405</a></span><span class="counterCov">4</span><span class="lineCov">fn test_source_1_universe_timeout(){</span></div>
<div class="line"><span id="2406" class="lineNum"><a href="#2406">2406</a></span><span class="counterUnCov"></span><span class="lineUnCov">    // Allow the timeout notification to come up to 2.5 seconds too late compared to the expected 2.5 seconds.</span></div>
<div class="line"><span id="2407" class="lineNum"><a href="#2407">2407</a></span><span class="counterUnCov"></span><span class="lineUnCov">    // (2.5s base as per ANSI E1.31-2018 Appendix A E131_NETWORK_DATA_LOSS_TIMEOUT, tolerance as per documentation for recv() method).</span></div>
<div class="line"><span id="2408" class="lineNum"><a href="#2408">2408</a></span><span class="counterUnCov"></span><span class="lineUnCov">    // Both tolerances allow 50 ms for code execution time.</span></div>
<div class="line"><span id="2409" class="lineNum"><a href="#2409">2409</a></span><span class="counterCov">2</span><span class="lineCov">    let acceptable_lower_bound: Duration = E131_NETWORK_DATA_LOSS_TIMEOUT - Duration::from_millis(50);</span></div>
<div class="line"><span id="2410" class="lineNum"><a href="#2410">2410</a></span><span class="counterCov">2</span><span class="lineCov">    let acceptable_upper_bound: Duration = 2 * E131_NETWORK_DATA_LOSS_TIMEOUT + Duration::from_millis(50);</span></div>
<div class="line"><span id="2411" class="lineNum"><a href="#2411">2411</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="2412" class="lineNum"><a href="#2412">2412</a></span><span class="counterCov">2</span><span class="lineCov">    let (tx, rx): (SyncSender&lt;()&gt;, Receiver&lt;()&gt;) = mpsc::sync_channel(0);</span></div>
<div class="line"><span id="2413" class="lineNum"><a href="#2413">2413</a></span><span class="counterUnCov"></span><span class="lineUnCov">    </span></div>
<div class="line"><span id="2414" class="lineNum"><a href="#2414">2414</a></span><span class="counterCov">2</span><span class="lineCov">    let thread_tx = tx.clone();</span></div>
<div class="line"><span id="2415" class="lineNum"><a href="#2415">2415</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="2416" class="lineNum"><a href="#2416">2416</a></span><span class="counterCov">2</span><span class="lineCov">    let universe = 1;</span></div>
<div class="line"><span id="2417" class="lineNum"><a href="#2417">2417</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="2418" class="lineNum"><a href="#2418">2418</a></span><span class="counterCov">4</span><span class="lineCov">    let snd_thread = thread::spawn(move || {</span></div>
<div class="line"><span id="2419" class="lineNum"><a href="#2419">2419</a></span><span class="counterCov">2</span><span class="lineCov">        let ip: SocketAddr = SocketAddr::new(Ipv4Addr::LOCALHOST.into(), ACN_SDT_MULTICAST_PORT + 1);</span></div>
<div class="line"><span id="2420" class="lineNum"><a href="#2420">2420</a></span><span class="counterCov">2</span><span class="lineCov">        let mut src = SacnSource::with_ip(&quot;Source&quot;, ip).unwrap();</span></div>
<div class="line"><span id="2421" class="lineNum"><a href="#2421">2421</a></span><span class="counterCov">2</span><span class="lineCov">        let priority = 100;</span></div>
<div class="line"><span id="2422" class="lineNum"><a href="#2422">2422</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="2423" class="lineNum"><a href="#2423">2423</a></span><span class="counterCov">2</span><span class="lineCov">        src.register_universe(universe).unwrap();</span></div>
<div class="line"><span id="2424" class="lineNum"><a href="#2424">2424</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="2425" class="lineNum"><a href="#2425">2425</a></span><span class="counterCov">2</span><span class="lineCov">        let dst_ip: SocketAddr = SocketAddr::new(Ipv4Addr::LOCALHOST.into(), ACN_SDT_MULTICAST_PORT);</span></div>
<div class="line"><span id="2426" class="lineNum"><a href="#2426">2426</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="2427" class="lineNum"><a href="#2427">2427</a></span><span class="counterCov">2</span><span class="lineCov">        thread_tx.send(()).unwrap(); // Sender waits till the receiver says it is ready.</span></div>
<div class="line"><span id="2428" class="lineNum"><a href="#2428">2428</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="2429" class="lineNum"><a href="#2429">2429</a></span><span class="counterCov">2</span><span class="lineCov">        src.send(&amp;[universe], &amp;TEST_DATA_SINGLE_UNIVERSE, Some(priority), Some(dst_ip), None).unwrap();</span></div>
<div class="line"><span id="2430" class="lineNum"><a href="#2430">2430</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="2431" class="lineNum"><a href="#2431">2431</a></span><span class="counterUnCov"></span><span class="lineUnCov">        // Sender waits till the receiver says it can terminate, this prevents the automatic stream_terminated packets being sent.</span></div>
<div class="line"><span id="2432" class="lineNum"><a href="#2432">2432</a></span><span class="counterCov">2</span><span class="lineCov">        thread_tx.send(()).unwrap();</span></div>
<div class="line"><span id="2433" class="lineNum"><a href="#2433">2433</a></span><span class="counterCov">2</span><span class="lineCov">    });</span></div>
<div class="line"><span id="2434" class="lineNum"><a href="#2434">2434</a></span><span class="counterUnCov"></span><span class="lineUnCov">    </span></div>
<div class="line"><span id="2435" class="lineNum"><a href="#2435">2435</a></span><span class="counterCov">2</span><span class="lineCov">    let mut dmx_recv = SacnReceiver::with_ip(SocketAddr::new(Ipv4Addr::LOCALHOST.into(), ACN_SDT_MULTICAST_PORT), None).unwrap();</span></div>
<div class="line"><span id="2436" class="lineNum"><a href="#2436">2436</a></span><span class="counterCov">2</span><span class="lineCov">    dmx_recv.listen_universes(&amp;[universe]).unwrap();</span></div>
<div class="line"><span id="2437" class="lineNum"><a href="#2437">2437</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="2438" class="lineNum"><a href="#2438">2438</a></span><span class="counterUnCov"></span><span class="lineUnCov">    // Want to know when the source times out.</span></div>
<div class="line"><span id="2439" class="lineNum"><a href="#2439">2439</a></span><span class="counterCov">2</span><span class="lineCov">    dmx_recv.set_announce_timeout(true);</span></div>
<div class="line"><span id="2440" class="lineNum"><a href="#2440">2440</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="2441" class="lineNum"><a href="#2441">2441</a></span><span class="counterUnCov"></span><span class="lineUnCov">    // Receiver created successfully so allow the sender to progress.</span></div>
<div class="line"><span id="2442" class="lineNum"><a href="#2442">2442</a></span><span class="counterCov">2</span><span class="lineCov">    rx.recv().unwrap();</span></div>
<div class="line"><span id="2443" class="lineNum"><a href="#2443">2443</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="2444" class="lineNum"><a href="#2444">2444</a></span><span class="counterUnCov"></span><span class="lineUnCov">    // Get the packet of data and check that it is correct.</span></div>
<div class="line"><span id="2445" class="lineNum"><a href="#2445">2445</a></span><span class="counterCov">2</span><span class="lineCov">    let received_data: Vec&lt;DMXData&gt; = dmx_recv.recv(None).unwrap();</span></div>
<div class="line"><span id="2446" class="lineNum"><a href="#2446">2446</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="2447" class="lineNum"><a href="#2447">2447</a></span><span class="counterCov">2</span><span class="lineCov">    assert_eq!(received_data.len(), 1); // Check only 1 universe received as expected.</span></div>
<div class="line"><span id="2448" class="lineNum"><a href="#2448">2448</a></span><span class="counterCov">2</span><span class="lineCov">    assert_eq!(received_data[0].universe, universe); // Check that the universe received is as expected.</span></div>
<div class="line"><span id="2449" class="lineNum"><a href="#2449">2449</a></span><span class="counterCov">2</span><span class="lineCov">    assert_eq!(received_data[0].values, TEST_DATA_SINGLE_UNIVERSE.to_vec(), &quot;Received payload values don&#39;t match sent!&quot;);</span></div>
<div class="line"><span id="2450" class="lineNum"><a href="#2450">2450</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="2451" class="lineNum"><a href="#2451">2451</a></span><span class="counterCov">2</span><span class="lineCov">    let start_time: Instant = Instant::now();</span></div>
<div class="line"><span id="2452" class="lineNum"><a href="#2452">2452</a></span><span class="counterCov">2</span><span class="lineCov">    match dmx_recv.recv(Some(acceptable_upper_bound)) { // This will return a WouldBlock/Timedout error if the timeout takes too long.</span></div>
<div class="line"><span id="2453" class="lineNum"><a href="#2453">2453</a></span><span class="counterCov">2</span><span class="lineCov">        Err(e) =&gt; {</span></div>
<div class="line"><span id="2454" class="lineNum"><a href="#2454">2454</a></span><span class="counterCov">2</span><span class="lineCov">            match e.kind() {</span></div>
<div class="line"><span id="2455" class="lineNum"><a href="#2455">2455</a></span><span class="counterCov">2</span><span class="lineCov">                ErrorKind::UniverseTimeout(_src_cid, timedout_uni) =&gt; {</span></div>
<div class="line"><span id="2456" class="lineNum"><a href="#2456">2456</a></span><span class="counterCov">2</span><span class="lineCov">                    if start_time.elapsed() &lt; acceptable_lower_bound{</span></div>
<div class="line"><span id="2457" class="lineNum"><a href="#2457">2457</a></span><span class="counterNoCov">0</span><span class="lineNoCov">                        assert!(false, &quot;Timeout came quicker than expected&quot;);</span></div>
<div class="line"><span id="2458" class="lineNum"><a href="#2458">2458</a></span><span class="counterUnCov"></span><span class="lineUnCov">                    }</span></div>
<div class="line"><span id="2459" class="lineNum"><a href="#2459">2459</a></span><span class="counterCov">2</span><span class="lineCov">                    assert_eq!(*timedout_uni, universe, &quot;Timed out universe doesn&#39;t match expected&quot;);</span></div>
<div class="line"><span id="2460" class="lineNum"><a href="#2460">2460</a></span><span class="counterUnCov"></span><span class="lineUnCov">                    assert!(true, &quot;Universe timed out as expected&quot;);</span></div>
<div class="line"><span id="2461" class="lineNum"><a href="#2461">2461</a></span><span class="counterUnCov"></span><span class="lineUnCov">                }</span></div>
<div class="line"><span id="2462" class="lineNum"><a href="#2462">2462</a></span><span class="counterNoCov">0</span><span class="lineNoCov">                ErrorKind::Io(ref s) =&gt; {</span></div>
<div class="line"><span id="2463" class="lineNum"><a href="#2463">2463</a></span><span class="counterNoCov">0</span><span class="lineNoCov">                    match s.kind() {</span></div>
<div class="line"><span id="2464" class="lineNum"><a href="#2464">2464</a></span><span class="counterNoCov">0</span><span class="lineNoCov">                        std::io::ErrorKind::WouldBlock | std::io::ErrorKind::TimedOut =&gt; {</span></div>
<div class="line"><span id="2465" class="lineNum"><a href="#2465">2465</a></span><span class="counterNoCov">0</span><span class="lineNoCov">                            assert!(false, &quot;Timeout took too long to come through&quot;);</span></div>
<div class="line"><span id="2466" class="lineNum"><a href="#2466">2466</a></span><span class="counterUnCov"></span><span class="lineUnCov">                        },</span></div>
<div class="line"><span id="2467" class="lineNum"><a href="#2467">2467</a></span><span class="counterUnCov"></span><span class="lineUnCov">                        _ =&gt; {</span></div>
<div class="line"><span id="2468" class="lineNum"><a href="#2468">2468</a></span><span class="counterNoCov">0</span><span class="lineNoCov">                            assert!(false, &quot;Unexpected error returned&quot;);</span></div>
<div class="line"><span id="2469" class="lineNum"><a href="#2469">2469</a></span><span class="counterUnCov"></span><span class="lineUnCov">                        }</span></div>
<div class="line"><span id="2470" class="lineNum"><a href="#2470">2470</a></span><span class="counterUnCov"></span><span class="lineUnCov">                    }</span></div>
<div class="line"><span id="2471" class="lineNum"><a href="#2471">2471</a></span><span class="counterUnCov"></span><span class="lineUnCov">                },</span></div>
<div class="line"><span id="2472" class="lineNum"><a href="#2472">2472</a></span><span class="counterUnCov"></span><span class="lineUnCov">                _ =&gt; {</span></div>
<div class="line"><span id="2473" class="lineNum"><a href="#2473">2473</a></span><span class="counterNoCov">0</span><span class="lineNoCov">                    assert!(false, &quot;Unexpected error returned&quot;);</span></div>
<div class="line"><span id="2474" class="lineNum"><a href="#2474">2474</a></span><span class="counterUnCov"></span><span class="lineUnCov">                }</span></div>
<div class="line"><span id="2475" class="lineNum"><a href="#2475">2475</a></span><span class="counterUnCov"></span><span class="lineUnCov">            }</span></div>
<div class="line"><span id="2476" class="lineNum"><a href="#2476">2476</a></span><span class="counterUnCov"></span><span class="lineUnCov">        }</span></div>
<div class="line"><span id="2477" class="lineNum"><a href="#2477">2477</a></span><span class="counterCov">2</span><span class="lineCov">        Ok(x) =&gt; {</span></div>
<div class="line"><span id="2478" class="lineNum"><a href="#2478">2478</a></span><span class="counterNoCov">0</span><span class="lineNoCov">            assert!(false, format!(&quot;Data received unexpectedly as none sent! {:?}&quot;, x));</span></div>
<div class="line"><span id="2479" class="lineNum"><a href="#2479">2479</a></span><span class="counterUnCov"></span><span class="lineUnCov">        }</span></div>
<div class="line"><span id="2480" class="lineNum"><a href="#2480">2480</a></span><span class="counterUnCov"></span><span class="lineUnCov">    }</span></div>
<div class="line"><span id="2481" class="lineNum"><a href="#2481">2481</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="2482" class="lineNum"><a href="#2482">2482</a></span><span class="counterCov">2</span><span class="lineCov">    rx.recv().unwrap(); // Allow the sender to finish.</span></div>
<div class="line"><span id="2483" class="lineNum"><a href="#2483">2483</a></span><span class="counterCov">2</span><span class="lineCov">    snd_thread.join().unwrap();</span></div>
<div class="line"><span id="2484" class="lineNum"><a href="#2484">2484</a></span><span class="counterCov">4</span><span class="lineCov">}</span></div>
<div class="line"><span id="2485" class="lineNum"><a href="#2485">2485</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="2486" class="lineNum"><a href="#2486">2486</a></span><span class="counterUnCov"></span><span class="lineUnCov">/// Creates a receiver and a sender. The sender sends 2 data packets to the receiver on different universes and then waits a short time </span></div>
<div class="line"><span id="2487" class="lineNum"><a href="#2487">2487</a></span><span class="counterUnCov"></span><span class="lineUnCov">/// (&lt; E131_NETWORK_DATA_LOSS_TIMEOUT) and sends another data packet for the first universe allowing the second universe to timeout.</span></div>
<div class="line"><span id="2488" class="lineNum"><a href="#2488">2488</a></span><span class="counterUnCov"></span><span class="lineUnCov">/// The receiver checks all 3 data packets are received correctly and that (with announce_timeout flag set to true) only the universe on which</span></div>
<div class="line"><span id="2489" class="lineNum"><a href="#2489">2489</a></span><span class="counterUnCov"></span><span class="lineUnCov">/// a single packet was sent times out.</span></div>
<div class="line"><span id="2490" class="lineNum"><a href="#2490">2490</a></span><span class="counterUnCov"></span><span class="lineUnCov">/// </span></div>
<div class="line"><span id="2491" class="lineNum"><a href="#2491">2491</a></span><span class="counterUnCov"></span><span class="lineUnCov">/// This shows that the timeout mechanism is per universe and not for an entire source as a single universe can timeout while other universe</span></div>
<div class="line"><span id="2492" class="lineNum"><a href="#2492">2492</a></span><span class="counterUnCov"></span><span class="lineUnCov">/// continue as normal as per ANSI E1.31-2018 Section 6.7.1.</span></div>
<div class="line"><span id="2493" class="lineNum"><a href="#2493">2493</a></span><span class="counterUnCov"></span><span class="lineUnCov">/// </span></div>
<div class="line"><span id="2494" class="lineNum"><a href="#2494">2494</a></span><span class="counterUnCov"></span><span class="lineUnCov">#[test]</span></div>
<div class="line"><span id="2495" class="lineNum"><a href="#2495">2495</a></span><span class="counterCov">4</span><span class="lineCov">fn test_source_2_universe_1_timeout(){</span></div>
<div class="line"><span id="2496" class="lineNum"><a href="#2496">2496</a></span><span class="counterUnCov"></span><span class="lineUnCov">    // Allow the timeout notification to come up to 2.5 seconds too late compared to the expected 2.5 seconds.</span></div>
<div class="line"><span id="2497" class="lineNum"><a href="#2497">2497</a></span><span class="counterUnCov"></span><span class="lineUnCov">    // (2.5s base as per ANSI E1.31-2018 Appendix A E131_NETWORK_DATA_LOSS_TIMEOUT, tolerance as per documentation for recv() method).</span></div>
<div class="line"><span id="2498" class="lineNum"><a href="#2498">2498</a></span><span class="counterUnCov"></span><span class="lineUnCov">    // Both tolerances allow 50 ms for code execution time.</span></div>
<div class="line"><span id="2499" class="lineNum"><a href="#2499">2499</a></span><span class="counterCov">2</span><span class="lineCov">    let acceptable_lower_bound: Duration = E131_NETWORK_DATA_LOSS_TIMEOUT - Duration::from_millis(50);</span></div>
<div class="line"><span id="2500" class="lineNum"><a href="#2500">2500</a></span><span class="counterCov">2</span><span class="lineCov">    let acceptable_upper_bound: Duration = 2 * E131_NETWORK_DATA_LOSS_TIMEOUT + Duration::from_millis(50);</span></div>
<div class="line"><span id="2501" class="lineNum"><a href="#2501">2501</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="2502" class="lineNum"><a href="#2502">2502</a></span><span class="counterCov">2</span><span class="lineCov">    let (tx, rx): (SyncSender&lt;()&gt;, Receiver&lt;()&gt;) = mpsc::sync_channel(0);</span></div>
<div class="line"><span id="2503" class="lineNum"><a href="#2503">2503</a></span><span class="counterUnCov"></span><span class="lineUnCov">    </span></div>
<div class="line"><span id="2504" class="lineNum"><a href="#2504">2504</a></span><span class="counterCov">2</span><span class="lineCov">    let thread_tx = tx.clone();</span></div>
<div class="line"><span id="2505" class="lineNum"><a href="#2505">2505</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="2506" class="lineNum"><a href="#2506">2506</a></span><span class="counterCov">2</span><span class="lineCov">    let universe_no_timeout = 1;</span></div>
<div class="line"><span id="2507" class="lineNum"><a href="#2507">2507</a></span><span class="counterCov">2</span><span class="lineCov">    let universe_timeout = 2;</span></div>
<div class="line"><span id="2508" class="lineNum"><a href="#2508">2508</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="2509" class="lineNum"><a href="#2509">2509</a></span><span class="counterCov">4</span><span class="lineCov">    let snd_thread = thread::spawn(move || {</span></div>
<div class="line"><span id="2510" class="lineNum"><a href="#2510">2510</a></span><span class="counterCov">2</span><span class="lineCov">        let ip: SocketAddr = SocketAddr::new(Ipv4Addr::LOCALHOST.into(), ACN_SDT_MULTICAST_PORT + 1);</span></div>
<div class="line"><span id="2511" class="lineNum"><a href="#2511">2511</a></span><span class="counterCov">2</span><span class="lineCov">        let mut src = SacnSource::with_ip(&quot;Source&quot;, ip).unwrap();</span></div>
<div class="line"><span id="2512" class="lineNum"><a href="#2512">2512</a></span><span class="counterCov">2</span><span class="lineCov">        let priority = 100;</span></div>
<div class="line"><span id="2513" class="lineNum"><a href="#2513">2513</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="2514" class="lineNum"><a href="#2514">2514</a></span><span class="counterCov">2</span><span class="lineCov">        src.register_universes(&amp;[universe_no_timeout, universe_timeout]).unwrap();</span></div>
<div class="line"><span id="2515" class="lineNum"><a href="#2515">2515</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="2516" class="lineNum"><a href="#2516">2516</a></span><span class="counterCov">2</span><span class="lineCov">        let dst_ip: SocketAddr = SocketAddr::new(Ipv4Addr::LOCALHOST.into(), ACN_SDT_MULTICAST_PORT);</span></div>
<div class="line"><span id="2517" class="lineNum"><a href="#2517">2517</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="2518" class="lineNum"><a href="#2518">2518</a></span><span class="counterCov">2</span><span class="lineCov">        thread_tx.send(()).unwrap(); // Sender waits till the receiver says it is ready.</span></div>
<div class="line"><span id="2519" class="lineNum"><a href="#2519">2519</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="2520" class="lineNum"><a href="#2520">2520</a></span><span class="counterCov">2</span><span class="lineCov">        src.send(&amp;[universe_no_timeout], &amp;TEST_DATA_SINGLE_UNIVERSE, Some(priority), Some(dst_ip), None).unwrap();</span></div>
<div class="line"><span id="2521" class="lineNum"><a href="#2521">2521</a></span><span class="counterCov">2</span><span class="lineCov">        src.send(&amp;[universe_timeout], &amp;TEST_DATA_SINGLE_ALTERNATIVE_STARTCODE_UNIVERSE, Some(priority), Some(dst_ip), None).unwrap();</span></div>
<div class="line"><span id="2522" class="lineNum"><a href="#2522">2522</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="2523" class="lineNum"><a href="#2523">2523</a></span><span class="counterCov">2</span><span class="lineCov">        sleep(Duration::from_secs(1)); // Wait a small amount of time.</span></div>
<div class="line"><span id="2524" class="lineNum"><a href="#2524">2524</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="2525" class="lineNum"><a href="#2525">2525</a></span><span class="counterUnCov"></span><span class="lineUnCov">        // Send another packet to the universe that shouldn&#39;t timeout so that it doesn&#39;t timeout.</span></div>
<div class="line"><span id="2526" class="lineNum"><a href="#2526">2526</a></span><span class="counterCov">2</span><span class="lineCov">        src.send(&amp;[universe_no_timeout], &amp;TEST_DATA_SINGLE_UNIVERSE, Some(priority), Some(dst_ip), None).unwrap();</span></div>
<div class="line"><span id="2527" class="lineNum"><a href="#2527">2527</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="2528" class="lineNum"><a href="#2528">2528</a></span><span class="counterCov">2</span><span class="lineCov">        sleep(Duration::from_secs(1)); // Wait a small amount of time.</span></div>
<div class="line"><span id="2529" class="lineNum"><a href="#2529">2529</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="2530" class="lineNum"><a href="#2530">2530</a></span><span class="counterUnCov"></span><span class="lineUnCov">        // Send another packet to the universe that shouldn&#39;t timeout so that it doesn&#39;t timeout.</span></div>
<div class="line"><span id="2531" class="lineNum"><a href="#2531">2531</a></span><span class="counterCov">2</span><span class="lineCov">        src.send(&amp;[universe_no_timeout], &amp;TEST_DATA_SINGLE_UNIVERSE, Some(priority), Some(dst_ip), None).unwrap();</span></div>
<div class="line"><span id="2532" class="lineNum"><a href="#2532">2532</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="2533" class="lineNum"><a href="#2533">2533</a></span><span class="counterCov">2</span><span class="lineCov">        sleep(Duration::from_secs(1)); // Wait a small amount of time.</span></div>
<div class="line"><span id="2534" class="lineNum"><a href="#2534">2534</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="2535" class="lineNum"><a href="#2535">2535</a></span><span class="counterUnCov"></span><span class="lineUnCov">        // Send another packet to the universe that shouldn&#39;t timeout so that it doesn&#39;t timeout.</span></div>
<div class="line"><span id="2536" class="lineNum"><a href="#2536">2536</a></span><span class="counterCov">2</span><span class="lineCov">        src.send(&amp;[universe_no_timeout], &amp;TEST_DATA_SINGLE_UNIVERSE, Some(priority), Some(dst_ip), None).unwrap();</span></div>
<div class="line"><span id="2537" class="lineNum"><a href="#2537">2537</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="2538" class="lineNum"><a href="#2538">2538</a></span><span class="counterCov">2</span><span class="lineCov">        sleep(Duration::from_secs(1)); // Wait a small amount of time.</span></div>
<div class="line"><span id="2539" class="lineNum"><a href="#2539">2539</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="2540" class="lineNum"><a href="#2540">2540</a></span><span class="counterUnCov"></span><span class="lineUnCov">        // Send another packet to the universe that shouldn&#39;t timeout so that it doesn&#39;t timeout.</span></div>
<div class="line"><span id="2541" class="lineNum"><a href="#2541">2541</a></span><span class="counterCov">2</span><span class="lineCov">        src.send(&amp;[universe_no_timeout], &amp;TEST_DATA_SINGLE_UNIVERSE, Some(priority), Some(dst_ip), None).unwrap();</span></div>
<div class="line"><span id="2542" class="lineNum"><a href="#2542">2542</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="2543" class="lineNum"><a href="#2543">2543</a></span><span class="counterUnCov"></span><span class="lineUnCov">        // Sender waits till the receiver says it can terminate, this prevents the automatic stream_terminated packets being sent.</span></div>
<div class="line"><span id="2544" class="lineNum"><a href="#2544">2544</a></span><span class="counterCov">2</span><span class="lineCov">        thread_tx.send(()).unwrap(); </span></div>
<div class="line"><span id="2545" class="lineNum"><a href="#2545">2545</a></span><span class="counterCov">2</span><span class="lineCov">    });</span></div>
<div class="line"><span id="2546" class="lineNum"><a href="#2546">2546</a></span><span class="counterUnCov"></span><span class="lineUnCov">    </span></div>
<div class="line"><span id="2547" class="lineNum"><a href="#2547">2547</a></span><span class="counterCov">2</span><span class="lineCov">    let mut dmx_recv = SacnReceiver::with_ip(SocketAddr::new(Ipv4Addr::LOCALHOST.into(), ACN_SDT_MULTICAST_PORT), None).unwrap();</span></div>
<div class="line"><span id="2548" class="lineNum"><a href="#2548">2548</a></span><span class="counterCov">2</span><span class="lineCov">    dmx_recv.listen_universes(&amp;[universe_no_timeout, universe_timeout]).unwrap();</span></div>
<div class="line"><span id="2549" class="lineNum"><a href="#2549">2549</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="2550" class="lineNum"><a href="#2550">2550</a></span><span class="counterUnCov"></span><span class="lineUnCov">    // Want to know when the source times out.</span></div>
<div class="line"><span id="2551" class="lineNum"><a href="#2551">2551</a></span><span class="counterCov">2</span><span class="lineCov">    dmx_recv.set_announce_timeout(true);</span></div>
<div class="line"><span id="2552" class="lineNum"><a href="#2552">2552</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="2553" class="lineNum"><a href="#2553">2553</a></span><span class="counterUnCov"></span><span class="lineUnCov">    // Receiver created successfully so allow the sender to progress.</span></div>
<div class="line"><span id="2554" class="lineNum"><a href="#2554">2554</a></span><span class="counterCov">2</span><span class="lineCov">    rx.recv().unwrap();</span></div>
<div class="line"><span id="2555" class="lineNum"><a href="#2555">2555</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="2556" class="lineNum"><a href="#2556">2556</a></span><span class="counterUnCov"></span><span class="lineUnCov">    // Get the packets of data and check that they are correct.</span></div>
<div class="line"><span id="2557" class="lineNum"><a href="#2557">2557</a></span><span class="counterCov">2</span><span class="lineCov">    let received_data: Vec&lt;DMXData&gt; = dmx_recv.recv(None).unwrap();</span></div>
<div class="line"><span id="2558" class="lineNum"><a href="#2558">2558</a></span><span class="counterCov">2</span><span class="lineCov">    assert_eq!(received_data.len(), 1); // Check only 1 universe of data received as expected.</span></div>
<div class="line"><span id="2559" class="lineNum"><a href="#2559">2559</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="2560" class="lineNum"><a href="#2560">2560</a></span><span class="counterCov">4</span><span class="lineCov">    if received_data[0].universe == universe_no_timeout {</span></div>
<div class="line"><span id="2561" class="lineNum"><a href="#2561">2561</a></span><span class="counterCov">2</span><span class="lineCov">        assert_eq!(received_data[0].values, TEST_DATA_SINGLE_UNIVERSE.to_vec(), &quot;Received payload values don&#39;t match sent!&quot;);</span></div>
<div class="line"><span id="2562" class="lineNum"><a href="#2562">2562</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="2563" class="lineNum"><a href="#2563">2563</a></span><span class="counterUnCov"></span><span class="lineUnCov">        // Get the next data packet and check it is the other packet as expected.</span></div>
<div class="line"><span id="2564" class="lineNum"><a href="#2564">2564</a></span><span class="counterCov">2</span><span class="lineCov">        let received_data: Vec&lt;DMXData&gt; = dmx_recv.recv(None).unwrap();</span></div>
<div class="line"><span id="2565" class="lineNum"><a href="#2565">2565</a></span><span class="counterCov">2</span><span class="lineCov">        assert_eq!(received_data.len(), 1); // Check only 1 universe received as expected.</span></div>
<div class="line"><span id="2566" class="lineNum"><a href="#2566">2566</a></span><span class="counterCov">2</span><span class="lineCov">        if received_data[0].universe == universe_timeout {</span></div>
<div class="line"><span id="2567" class="lineNum"><a href="#2567">2567</a></span><span class="counterCov">2</span><span class="lineCov">            assert_eq!(received_data[0].values, TEST_DATA_SINGLE_ALTERNATIVE_STARTCODE_UNIVERSE.to_vec(), &quot;Received payload values don&#39;t match sent!&quot;);</span></div>
<div class="line"><span id="2568" class="lineNum"><a href="#2568">2568</a></span><span class="counterUnCov"></span><span class="lineUnCov">        } else {</span></div>
<div class="line"><span id="2569" class="lineNum"><a href="#2569">2569</a></span><span class="counterNoCov">0</span><span class="lineNoCov">            assert!(false, &quot;Data packet from unexpected universe received&quot;);</span></div>
<div class="line"><span id="2570" class="lineNum"><a href="#2570">2570</a></span><span class="counterUnCov"></span><span class="lineUnCov">        }</span></div>
<div class="line"><span id="2571" class="lineNum"><a href="#2571">2571</a></span><span class="counterCov">2</span><span class="lineCov">    } else if received_data[0].universe == universe_timeout {</span></div>
<div class="line"><span id="2572" class="lineNum"><a href="#2572">2572</a></span><span class="counterNoCov">0</span><span class="lineNoCov">        assert_eq!(received_data[0].values, TEST_DATA_SINGLE_ALTERNATIVE_STARTCODE_UNIVERSE.to_vec(), &quot;Received payload values don&#39;t match sent!&quot;);</span></div>
<div class="line"><span id="2573" class="lineNum"><a href="#2573">2573</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="2574" class="lineNum"><a href="#2574">2574</a></span><span class="counterUnCov"></span><span class="lineUnCov">        // Get the next data packet and check it is the other packet as expected.</span></div>
<div class="line"><span id="2575" class="lineNum"><a href="#2575">2575</a></span><span class="counterNoCov">0</span><span class="lineNoCov">        let received_data: Vec&lt;DMXData&gt; = dmx_recv.recv(None).unwrap();</span></div>
<div class="line"><span id="2576" class="lineNum"><a href="#2576">2576</a></span><span class="counterNoCov">0</span><span class="lineNoCov">        assert_eq!(received_data.len(), 1); // Check only 1 universe received as expected.</span></div>
<div class="line"><span id="2577" class="lineNum"><a href="#2577">2577</a></span><span class="counterNoCov">0</span><span class="lineNoCov">        if received_data[0].universe == universe_no_timeout {</span></div>
<div class="line"><span id="2578" class="lineNum"><a href="#2578">2578</a></span><span class="counterNoCov">0</span><span class="lineNoCov">            assert_eq!(received_data[0].values, TEST_DATA_SINGLE_UNIVERSE.to_vec(), &quot;Received payload values don&#39;t match sent!&quot;);</span></div>
<div class="line"><span id="2579" class="lineNum"><a href="#2579">2579</a></span><span class="counterUnCov"></span><span class="lineUnCov">        } else {</span></div>
<div class="line"><span id="2580" class="lineNum"><a href="#2580">2580</a></span><span class="counterNoCov">0</span><span class="lineNoCov">            assert!(false, &quot;Data packet from unexpected universe received&quot;);</span></div>
<div class="line"><span id="2581" class="lineNum"><a href="#2581">2581</a></span><span class="counterUnCov"></span><span class="lineUnCov">        }</span></div>
<div class="line"><span id="2582" class="lineNum"><a href="#2582">2582</a></span><span class="counterNoCov">0</span><span class="lineNoCov">    } else {</span></div>
<div class="line"><span id="2583" class="lineNum"><a href="#2583">2583</a></span><span class="counterNoCov">0</span><span class="lineNoCov">        assert!(false, &quot;Data packet from unexpected universe received&quot;);</span></div>
<div class="line"><span id="2584" class="lineNum"><a href="#2584">2584</a></span><span class="counterUnCov"></span><span class="lineUnCov">    }</span></div>
<div class="line"><span id="2585" class="lineNum"><a href="#2585">2585</a></span><span class="counterUnCov"></span><span class="lineUnCov">    // Start the expected timeout timer.</span></div>
<div class="line"><span id="2586" class="lineNum"><a href="#2586">2586</a></span><span class="counterCov">2</span><span class="lineCov">    let start_time: Instant = Instant::now();</span></div>
<div class="line"><span id="2587" class="lineNum"><a href="#2587">2587</a></span><span class="counterUnCov"></span><span class="lineUnCov">    </span></div>
<div class="line"><span id="2588" class="lineNum"><a href="#2588">2588</a></span><span class="counterCov">6</span><span class="lineCov">    loop { // Loop till a timeout happens, ignoring the data packets send to the non-timeout uni.</span></div>
<div class="line"><span id="2589" class="lineNum"><a href="#2589">2589</a></span><span class="counterCov">6</span><span class="lineCov">        match dmx_recv.recv(Some(acceptable_upper_bound)) { // This will return a WouldBlock/Timedout error if the timeout takes too long.</span></div>
<div class="line"><span id="2590" class="lineNum"><a href="#2590">2590</a></span><span class="counterCov">6</span><span class="lineCov">            Err(e) =&gt; {</span></div>
<div class="line"><span id="2591" class="lineNum"><a href="#2591">2591</a></span><span class="counterCov">2</span><span class="lineCov">                match e.kind() {</span></div>
<div class="line"><span id="2592" class="lineNum"><a href="#2592">2592</a></span><span class="counterCov">2</span><span class="lineCov">                    ErrorKind::UniverseTimeout(_src_cid, universe) =&gt; {</span></div>
<div class="line"><span id="2593" class="lineNum"><a href="#2593">2593</a></span><span class="counterCov">2</span><span class="lineCov">                        if start_time.elapsed() &lt; acceptable_lower_bound{</span></div>
<div class="line"><span id="2594" class="lineNum"><a href="#2594">2594</a></span><span class="counterNoCov">0</span><span class="lineNoCov">                            assert!(false, &quot;Timeout came quicker than expected&quot;);</span></div>
<div class="line"><span id="2595" class="lineNum"><a href="#2595">2595</a></span><span class="counterUnCov"></span><span class="lineUnCov">                        }</span></div>
<div class="line"><span id="2596" class="lineNum"><a href="#2596">2596</a></span><span class="counterCov">2</span><span class="lineCov">                        assert_eq!(*universe, universe_timeout, &quot;Unexpected universe timed out&quot;);</span></div>
<div class="line"><span id="2597" class="lineNum"><a href="#2597">2597</a></span><span class="counterUnCov"></span><span class="lineUnCov">                        assert!(true, &quot;Universe timed out as expected&quot;);</span></div>
<div class="line"><span id="2598" class="lineNum"><a href="#2598">2598</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="2599" class="lineNum"><a href="#2599">2599</a></span><span class="counterUnCov"></span><span class="lineUnCov">                        // Know that the timeout universe timed out as expected so check that the other universe hasn&#39;t timed out.</span></div>
<div class="line"><span id="2600" class="lineNum"><a href="#2600">2600</a></span><span class="counterUnCov"></span><span class="lineUnCov">                        // Makes use of a timeout of 0 which should check the source timeouts without actually receiving any data as it times out instantly.</span></div>
<div class="line"><span id="2601" class="lineNum"><a href="#2601">2601</a></span><span class="counterCov">2</span><span class="lineCov">                        match dmx_recv.recv(Some(Duration::from_millis(0))) {</span></div>
<div class="line"><span id="2602" class="lineNum"><a href="#2602">2602</a></span><span class="counterCov">2</span><span class="lineCov">                            Err(e) =&gt; {</span></div>
<div class="line"><span id="2603" class="lineNum"><a href="#2603">2603</a></span><span class="counterCov">2</span><span class="lineCov">                                match e.kind() {</span></div>
<div class="line"><span id="2604" class="lineNum"><a href="#2604">2604</a></span><span class="counterCov">2</span><span class="lineCov">                                    ErrorKind::Io(ref s) =&gt; {</span></div>
<div class="line"><span id="2605" class="lineNum"><a href="#2605">2605</a></span><span class="counterCov">2</span><span class="lineCov">                                        match s.kind() {</span></div>
<div class="line"><span id="2606" class="lineNum"><a href="#2606">2606</a></span><span class="counterCov">2</span><span class="lineCov">                                            std::io::ErrorKind::WouldBlock | std::io::ErrorKind::TimedOut =&gt; {</span></div>
<div class="line"><span id="2607" class="lineNum"><a href="#2607">2607</a></span><span class="counterUnCov"></span><span class="lineUnCov">                                                assert!(true, &quot;Other universe hasn&#39;t timedout as expected&quot;);</span></div>
<div class="line"><span id="2608" class="lineNum"><a href="#2608">2608</a></span><span class="counterUnCov"></span><span class="lineUnCov">                                            },</span></div>
<div class="line"><span id="2609" class="lineNum"><a href="#2609">2609</a></span><span class="counterUnCov"></span><span class="lineUnCov">                                            _ =&gt; {</span></div>
<div class="line"><span id="2610" class="lineNum"><a href="#2610">2610</a></span><span class="counterNoCov">0</span><span class="lineNoCov">                                                assert!(false, &quot;Unexpected error returned&quot;);</span></div>
<div class="line"><span id="2611" class="lineNum"><a href="#2611">2611</a></span><span class="counterUnCov"></span><span class="lineUnCov">                                            }</span></div>
<div class="line"><span id="2612" class="lineNum"><a href="#2612">2612</a></span><span class="counterUnCov"></span><span class="lineUnCov">                                        }</span></div>
<div class="line"><span id="2613" class="lineNum"><a href="#2613">2613</a></span><span class="counterUnCov"></span><span class="lineUnCov">                                    },</span></div>
<div class="line"><span id="2614" class="lineNum"><a href="#2614">2614</a></span><span class="counterUnCov"></span><span class="lineUnCov">                                    _ =&gt; {</span></div>
<div class="line"><span id="2615" class="lineNum"><a href="#2615">2615</a></span><span class="counterNoCov">0</span><span class="lineNoCov">                                        assert!(false, &quot;Unexpected error returned&quot;);</span></div>
<div class="line"><span id="2616" class="lineNum"><a href="#2616">2616</a></span><span class="counterUnCov"></span><span class="lineUnCov">                                    }</span></div>
<div class="line"><span id="2617" class="lineNum"><a href="#2617">2617</a></span><span class="counterUnCov"></span><span class="lineUnCov">                                }</span></div>
<div class="line"><span id="2618" class="lineNum"><a href="#2618">2618</a></span><span class="counterUnCov"></span><span class="lineUnCov">                            }</span></div>
<div class="line"><span id="2619" class="lineNum"><a href="#2619">2619</a></span><span class="counterCov">2</span><span class="lineCov">                            Ok(x) =&gt; {</span></div>
<div class="line"><span id="2620" class="lineNum"><a href="#2620">2620</a></span><span class="counterNoCov">0</span><span class="lineNoCov">                                assert!(false, format!(&quot;Data received unexpectedly as none sent! {:?}&quot;, x));</span></div>
<div class="line"><span id="2621" class="lineNum"><a href="#2621">2621</a></span><span class="counterUnCov"></span><span class="lineUnCov">                            }</span></div>
<div class="line"><span id="2622" class="lineNum"><a href="#2622">2622</a></span><span class="counterUnCov"></span><span class="lineUnCov">                        }</span></div>
<div class="line"><span id="2623" class="lineNum"><a href="#2623">2623</a></span><span class="counterUnCov"></span><span class="lineUnCov">                        break;</span></div>
<div class="line"><span id="2624" class="lineNum"><a href="#2624">2624</a></span><span class="counterUnCov"></span><span class="lineUnCov">                    }</span></div>
<div class="line"><span id="2625" class="lineNum"><a href="#2625">2625</a></span><span class="counterNoCov">0</span><span class="lineNoCov">                    ErrorKind::Io(ref s) =&gt; {</span></div>
<div class="line"><span id="2626" class="lineNum"><a href="#2626">2626</a></span><span class="counterNoCov">0</span><span class="lineNoCov">                        match s.kind() {</span></div>
<div class="line"><span id="2627" class="lineNum"><a href="#2627">2627</a></span><span class="counterNoCov">0</span><span class="lineNoCov">                            std::io::ErrorKind::WouldBlock | std::io::ErrorKind::TimedOut =&gt; {</span></div>
<div class="line"><span id="2628" class="lineNum"><a href="#2628">2628</a></span><span class="counterNoCov">0</span><span class="lineNoCov">                                assert!(false, format!(&quot;Timeout took too long to come through: {:?}&quot;, start_time.elapsed()));</span></div>
<div class="line"><span id="2629" class="lineNum"><a href="#2629">2629</a></span><span class="counterUnCov"></span><span class="lineUnCov">                            },</span></div>
<div class="line"><span id="2630" class="lineNum"><a href="#2630">2630</a></span><span class="counterUnCov"></span><span class="lineUnCov">                            _ =&gt; {</span></div>
<div class="line"><span id="2631" class="lineNum"><a href="#2631">2631</a></span><span class="counterNoCov">0</span><span class="lineNoCov">                                assert!(false, &quot;Unexpected error returned&quot;);</span></div>
<div class="line"><span id="2632" class="lineNum"><a href="#2632">2632</a></span><span class="counterUnCov"></span><span class="lineUnCov">                            }</span></div>
<div class="line"><span id="2633" class="lineNum"><a href="#2633">2633</a></span><span class="counterUnCov"></span><span class="lineUnCov">                        }</span></div>
<div class="line"><span id="2634" class="lineNum"><a href="#2634">2634</a></span><span class="counterUnCov"></span><span class="lineUnCov">                    },</span></div>
<div class="line"><span id="2635" class="lineNum"><a href="#2635">2635</a></span><span class="counterUnCov"></span><span class="lineUnCov">                    _ =&gt; {</span></div>
<div class="line"><span id="2636" class="lineNum"><a href="#2636">2636</a></span><span class="counterNoCov">0</span><span class="lineNoCov">                        assert!(false, &quot;Unexpected error returned&quot;);</span></div>
<div class="line"><span id="2637" class="lineNum"><a href="#2637">2637</a></span><span class="counterUnCov"></span><span class="lineUnCov">                    }</span></div>
<div class="line"><span id="2638" class="lineNum"><a href="#2638">2638</a></span><span class="counterUnCov"></span><span class="lineUnCov">                }</span></div>
<div class="line"><span id="2639" class="lineNum"><a href="#2639">2639</a></span><span class="counterUnCov"></span><span class="lineUnCov">            }</span></div>
<div class="line"><span id="2640" class="lineNum"><a href="#2640">2640</a></span><span class="counterCov">6</span><span class="lineCov">            Ok(p) =&gt; { // Check that only data from the non-timed out universe is received.</span></div>
<div class="line"><span id="2641" class="lineNum"><a href="#2641">2641</a></span><span class="counterCov">4</span><span class="lineCov">                assert_eq!(p.len(), 1, &quot;Data packet universe count doesn&#39;t match expected&quot;);</span></div>
<div class="line"><span id="2642" class="lineNum"><a href="#2642">2642</a></span><span class="counterCov">4</span><span class="lineCov">                assert_eq!(p[0].universe, universe_no_timeout, &quot;Data packet universe doesn&#39;t match expected&quot;);</span></div>
<div class="line"><span id="2643" class="lineNum"><a href="#2643">2643</a></span><span class="counterCov">4</span><span class="lineCov">                assert_eq!(p[0].values, TEST_DATA_SINGLE_UNIVERSE.to_vec(), &quot;Data packet values don&#39;t match expected&quot;);</span></div>
<div class="line"><span id="2644" class="lineNum"><a href="#2644">2644</a></span><span class="counterUnCov"></span><span class="lineUnCov">            }</span></div>
<div class="line"><span id="2645" class="lineNum"><a href="#2645">2645</a></span><span class="counterCov">4</span><span class="lineCov">        }</span></div>
<div class="line"><span id="2646" class="lineNum"><a href="#2646">2646</a></span><span class="counterUnCov"></span><span class="lineUnCov">    }</span></div>
<div class="line"><span id="2647" class="lineNum"><a href="#2647">2647</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="2648" class="lineNum"><a href="#2648">2648</a></span><span class="counterCov">2</span><span class="lineCov">    rx.recv().unwrap(); // Allow the sender to finish.</span></div>
<div class="line"><span id="2649" class="lineNum"><a href="#2649">2649</a></span><span class="counterCov">2</span><span class="lineCov">    snd_thread.join().unwrap();</span></div>
<div class="line"><span id="2650" class="lineNum"><a href="#2650">2650</a></span><span class="counterCov">4</span><span class="lineCov">}</span></div>
<div class="line"><span id="2651" class="lineNum"><a href="#2651">2651</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="2652" class="lineNum"><a href="#2652">2652</a></span><span class="counterUnCov"></span><span class="lineUnCov">// A receiver listens to 2 universes. A sender then sends a packet on the multicast address for the first universe but with the packet</span></div>
<div class="line"><span id="2653" class="lineNum"><a href="#2653">2653</a></span><span class="counterUnCov"></span><span class="lineUnCov">// being for the second universe.</span></div>
<div class="line"><span id="2654" class="lineNum"><a href="#2654">2654</a></span><span class="counterUnCov"></span><span class="lineUnCov">// The receiver should process the packet for the second universe as normal because the multicast address used shouldn&#39;t be used to decide</span></div>
<div class="line"><span id="2655" class="lineNum"><a href="#2655">2655</a></span><span class="counterUnCov"></span><span class="lineUnCov">// the universe of the packet.</span></div>
<div class="line"><span id="2656" class="lineNum"><a href="#2656">2656</a></span><span class="counterUnCov"></span><span class="lineUnCov">#[test]</span></div>
<div class="line"><span id="2657" class="lineNum"><a href="#2657">2657</a></span><span class="counterCov">4</span><span class="lineCov">fn test_send_recv_wrong_multicast_universe(){</span></div>
<div class="line"><span id="2658" class="lineNum"><a href="#2658">2658</a></span><span class="counterUnCov"></span><span class="lineUnCov">    const TIMEOUT: Option&lt;Duration&gt; = Some(Duration::from_secs(3));</span></div>
<div class="line"><span id="2659" class="lineNum"><a href="#2659">2659</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="2660" class="lineNum"><a href="#2660">2660</a></span><span class="counterCov">2</span><span class="lineCov">    let (tx, rx): (SyncSender&lt;()&gt;, Receiver&lt;()&gt;) = mpsc::sync_channel(0);</span></div>
<div class="line"><span id="2661" class="lineNum"><a href="#2661">2661</a></span><span class="counterUnCov"></span><span class="lineUnCov">    </span></div>
<div class="line"><span id="2662" class="lineNum"><a href="#2662">2662</a></span><span class="counterCov">2</span><span class="lineCov">    let thread_tx = tx.clone();</span></div>
<div class="line"><span id="2663" class="lineNum"><a href="#2663">2663</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="2664" class="lineNum"><a href="#2664">2664</a></span><span class="counterCov">2</span><span class="lineCov">    let multicast_universe = 1;</span></div>
<div class="line"><span id="2665" class="lineNum"><a href="#2665">2665</a></span><span class="counterCov">2</span><span class="lineCov">    let actual_universe = 2;</span></div>
<div class="line"><span id="2666" class="lineNum"><a href="#2666">2666</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="2667" class="lineNum"><a href="#2667">2667</a></span><span class="counterCov">4</span><span class="lineCov">    let snd_thread = thread::spawn(move || {</span></div>
<div class="line"><span id="2668" class="lineNum"><a href="#2668">2668</a></span><span class="counterCov">2</span><span class="lineCov">        let ip: SocketAddr = SocketAddr::new(TEST_NETWORK_INTERFACE_IPV4[0].parse().unwrap(), ACN_SDT_MULTICAST_PORT + 1);</span></div>
<div class="line"><span id="2669" class="lineNum"><a href="#2669">2669</a></span><span class="counterCov">2</span><span class="lineCov">        let mut src = SacnSource::with_ip(&quot;Source&quot;, ip).unwrap();</span></div>
<div class="line"><span id="2670" class="lineNum"><a href="#2670">2670</a></span><span class="counterCov">2</span><span class="lineCov">        let priority = 100;</span></div>
<div class="line"><span id="2671" class="lineNum"><a href="#2671">2671</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="2672" class="lineNum"><a href="#2672">2672</a></span><span class="counterCov">2</span><span class="lineCov">        src.register_universes(&amp;[multicast_universe, actual_universe]).unwrap();</span></div>
<div class="line"><span id="2673" class="lineNum"><a href="#2673">2673</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="2674" class="lineNum"><a href="#2674">2674</a></span><span class="counterUnCov"></span><span class="lineUnCov">        // The multicast address for the multicast universe as per ANSI E1.31-2018 Section 9.3.1 Table 9-10.</span></div>
<div class="line"><span id="2675" class="lineNum"><a href="#2675">2675</a></span><span class="counterCov">2</span><span class="lineCov">        let dst_ip: SocketAddr = SocketAddr::new(IpAddr::V4(Ipv4Addr::new(239, 255, 0, 1)), ACN_SDT_MULTICAST_PORT);</span></div>
<div class="line"><span id="2676" class="lineNum"><a href="#2676">2676</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="2677" class="lineNum"><a href="#2677">2677</a></span><span class="counterUnCov"></span><span class="lineUnCov">        // Sender waits till the receiver says it is ready.</span></div>
<div class="line"><span id="2678" class="lineNum"><a href="#2678">2678</a></span><span class="counterCov">2</span><span class="lineCov">        thread_tx.send(()).unwrap();</span></div>
<div class="line"><span id="2679" class="lineNum"><a href="#2679">2679</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="2680" class="lineNum"><a href="#2680">2680</a></span><span class="counterUnCov"></span><span class="lineUnCov">        // Send the second universe using the multicast address for the first universe.</span></div>
<div class="line"><span id="2681" class="lineNum"><a href="#2681">2681</a></span><span class="counterCov">2</span><span class="lineCov">        src.send(&amp;[actual_universe], &amp;TEST_DATA_SINGLE_UNIVERSE, Some(priority), Some(dst_ip), None).unwrap();</span></div>
<div class="line"><span id="2682" class="lineNum"><a href="#2682">2682</a></span><span class="counterCov">2</span><span class="lineCov">    });</span></div>
<div class="line"><span id="2683" class="lineNum"><a href="#2683">2683</a></span><span class="counterUnCov"></span><span class="lineUnCov">    </span></div>
<div class="line"><span id="2684" class="lineNum"><a href="#2684">2684</a></span><span class="counterCov">2</span><span class="lineCov">    let mut dmx_recv = SacnReceiver::with_ip(SocketAddr::new(TEST_NETWORK_INTERFACE_IPV4[1].parse().unwrap(), ACN_SDT_MULTICAST_PORT), None).unwrap();</span></div>
<div class="line"><span id="2685" class="lineNum"><a href="#2685">2685</a></span><span class="counterCov">2</span><span class="lineCov">    dmx_recv.listen_universes(&amp;[multicast_universe, actual_universe]).unwrap();</span></div>
<div class="line"><span id="2686" class="lineNum"><a href="#2686">2686</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="2687" class="lineNum"><a href="#2687">2687</a></span><span class="counterUnCov"></span><span class="lineUnCov">    // Receiver created successfully so allow the sender to progress.</span></div>
<div class="line"><span id="2688" class="lineNum"><a href="#2688">2688</a></span><span class="counterCov">2</span><span class="lineCov">    rx.recv().unwrap();</span></div>
<div class="line"><span id="2689" class="lineNum"><a href="#2689">2689</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="2690" class="lineNum"><a href="#2690">2690</a></span><span class="counterUnCov"></span><span class="lineUnCov">    // Get the packets of data and check that they are correct.</span></div>
<div class="line"><span id="2691" class="lineNum"><a href="#2691">2691</a></span><span class="counterCov">2</span><span class="lineCov">    let received_data: Vec&lt;DMXData&gt; = dmx_recv.recv(TIMEOUT).unwrap();</span></div>
<div class="line"><span id="2692" class="lineNum"><a href="#2692">2692</a></span><span class="counterCov">2</span><span class="lineCov">    assert_eq!(received_data.len(), 1, &quot;Data packet universe count doesn&#39;t match expected&quot;);</span></div>
<div class="line"><span id="2693" class="lineNum"><a href="#2693">2693</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="2694" class="lineNum"><a href="#2694">2694</a></span><span class="counterUnCov"></span><span class="lineUnCov">    // Particularly important that the universe is the actual universe of the data rather than the universe which corresponds to the multicast address.</span></div>
<div class="line"><span id="2695" class="lineNum"><a href="#2695">2695</a></span><span class="counterCov">2</span><span class="lineCov">    assert_eq!(received_data[0].universe, actual_universe, &quot;Packet universe doesn&#39;t match expected&quot;);</span></div>
<div class="line"><span id="2696" class="lineNum"><a href="#2696">2696</a></span><span class="counterCov">2</span><span class="lineCov">    assert_eq!(received_data[0].values, TEST_DATA_SINGLE_UNIVERSE.to_vec(), &quot;Data packet values don&#39;t match expected&quot;);</span></div>
<div class="line"><span id="2697" class="lineNum"><a href="#2697">2697</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="2698" class="lineNum"><a href="#2698">2698</a></span><span class="counterCov">2</span><span class="lineCov">    snd_thread.join().unwrap();</span></div>
<div class="line"><span id="2699" class="lineNum"><a href="#2699">2699</a></span><span class="counterCov">4</span><span class="lineCov">}</span></div>
<div class="line"><span id="2700" class="lineNum"><a href="#2700">2700</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="2701" class="lineNum"><a href="#2701">2701</a></span><span class="counterUnCov"></span><span class="lineUnCov">/// A receiver and a sender are created which both listen/register to multiple universes.</span></div>
<div class="line"><span id="2702" class="lineNum"><a href="#2702">2702</a></span><span class="counterUnCov"></span><span class="lineUnCov">/// The sender then sends multiple data packets with different sync addresses and then follows up with the various sync packets.</span></div>
<div class="line"><span id="2703" class="lineNum"><a href="#2703">2703</a></span><span class="counterUnCov"></span><span class="lineUnCov">/// The receiver checks that the right data packets are received in the right order based on the sync packets sent. </span></div>
<div class="line"><span id="2704" class="lineNum"><a href="#2704">2704</a></span><span class="counterUnCov"></span><span class="lineUnCov">/// </span></div>
<div class="line"><span id="2705" class="lineNum"><a href="#2705">2705</a></span><span class="counterUnCov"></span><span class="lineUnCov">/// This shows that multiple synchronisation addresses can be used simultaneously.</span></div>
<div class="line"><span id="2706" class="lineNum"><a href="#2706">2706</a></span><span class="counterUnCov"></span><span class="lineUnCov">/// </span></div>
<div class="line"><span id="2707" class="lineNum"><a href="#2707">2707</a></span><span class="counterUnCov"></span><span class="lineUnCov">#[test]</span></div>
<div class="line"><span id="2708" class="lineNum"><a href="#2708">2708</a></span><span class="counterCov">4</span><span class="lineCov">fn test_send_recv_multiple_sync_universes(){</span></div>
<div class="line"><span id="2709" class="lineNum"><a href="#2709">2709</a></span><span class="counterUnCov"></span><span class="lineUnCov">    const TIMEOUT: Option&lt;Duration&gt; = Some(Duration::from_secs(3));</span></div>
<div class="line"><span id="2710" class="lineNum"><a href="#2710">2710</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="2711" class="lineNum"><a href="#2711">2711</a></span><span class="counterCov">2</span><span class="lineCov">    let (tx, rx): (SyncSender&lt;()&gt;, Receiver&lt;()&gt;) = mpsc::sync_channel(0);</span></div>
<div class="line"><span id="2712" class="lineNum"><a href="#2712">2712</a></span><span class="counterUnCov"></span><span class="lineUnCov">    </span></div>
<div class="line"><span id="2713" class="lineNum"><a href="#2713">2713</a></span><span class="counterCov">2</span><span class="lineCov">    let thread_tx = tx.clone();</span></div>
<div class="line"><span id="2714" class="lineNum"><a href="#2714">2714</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="2715" class="lineNum"><a href="#2715">2715</a></span><span class="counterCov">2</span><span class="lineCov">    let universes = [1, 2, 3];</span></div>
<div class="line"><span id="2716" class="lineNum"><a href="#2716">2716</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="2717" class="lineNum"><a href="#2717">2717</a></span><span class="counterCov">4</span><span class="lineCov">    let snd_thread = thread::spawn(move || {</span></div>
<div class="line"><span id="2718" class="lineNum"><a href="#2718">2718</a></span><span class="counterCov">2</span><span class="lineCov">        let ip: SocketAddr = SocketAddr::new(TEST_NETWORK_INTERFACE_IPV4[0].parse().unwrap(), ACN_SDT_MULTICAST_PORT + 1);</span></div>
<div class="line"><span id="2719" class="lineNum"><a href="#2719">2719</a></span><span class="counterCov">2</span><span class="lineCov">        let mut src = SacnSource::with_ip(&quot;Source&quot;, ip).unwrap();</span></div>
<div class="line"><span id="2720" class="lineNum"><a href="#2720">2720</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="2721" class="lineNum"><a href="#2721">2721</a></span><span class="counterCov">2</span><span class="lineCov">        src.register_universes(&amp;universes).unwrap();</span></div>
<div class="line"><span id="2722" class="lineNum"><a href="#2722">2722</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="2723" class="lineNum"><a href="#2723">2723</a></span><span class="counterUnCov"></span><span class="lineUnCov">        // Sender waits till the receiver says it is ready.</span></div>
<div class="line"><span id="2724" class="lineNum"><a href="#2724">2724</a></span><span class="counterCov">2</span><span class="lineCov">        thread_tx.send(()).unwrap();</span></div>
<div class="line"><span id="2725" class="lineNum"><a href="#2725">2725</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="2726" class="lineNum"><a href="#2726">2726</a></span><span class="counterUnCov"></span><span class="lineUnCov">        // Send on all 3 universes, the first universe waits for a sync packet on the second, the second on the third and the third</span></div>
<div class="line"><span id="2727" class="lineNum"><a href="#2727">2727</a></span><span class="counterUnCov"></span><span class="lineUnCov">        // universe waits for a sync packet on its own universe.</span></div>
<div class="line"><span id="2728" class="lineNum"><a href="#2728">2728</a></span><span class="counterCov">2</span><span class="lineCov">        src.send(&amp;[universes[0]], &amp;TEST_DATA_SINGLE_UNIVERSE, None, None, Some(universes[1])).unwrap();</span></div>
<div class="line"><span id="2729" class="lineNum"><a href="#2729">2729</a></span><span class="counterCov">2</span><span class="lineCov">        src.send(&amp;[universes[1]], &amp;TEST_DATA_SINGLE_ALTERNATIVE_STARTCODE_UNIVERSE, None, None, Some(universes[2])).unwrap();</span></div>
<div class="line"><span id="2730" class="lineNum"><a href="#2730">2730</a></span><span class="counterCov">2</span><span class="lineCov">        src.send(&amp;[universes[2]], &amp;TEST_DATA_PARTIAL_CAPACITY_UNIVERSE, None, None, Some(universes[2])).unwrap();</span></div>
<div class="line"><span id="2731" class="lineNum"><a href="#2731">2731</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="2732" class="lineNum"><a href="#2732">2732</a></span><span class="counterCov">2</span><span class="lineCov">        src.send_sync_packet(universes[1], None).unwrap(); // Should trigger the first universe to be received.</span></div>
<div class="line"><span id="2733" class="lineNum"><a href="#2733">2733</a></span><span class="counterCov">2</span><span class="lineCov">        src.send_sync_packet(universes[2], None).unwrap(); // Should trigger the second and third universe to be received together.</span></div>
<div class="line"><span id="2734" class="lineNum"><a href="#2734">2734</a></span><span class="counterCov">2</span><span class="lineCov">    });</span></div>
<div class="line"><span id="2735" class="lineNum"><a href="#2735">2735</a></span><span class="counterUnCov"></span><span class="lineUnCov">    </span></div>
<div class="line"><span id="2736" class="lineNum"><a href="#2736">2736</a></span><span class="counterCov">2</span><span class="lineCov">    let mut dmx_recv = SacnReceiver::with_ip(SocketAddr::new(TEST_NETWORK_INTERFACE_IPV4[1].parse().unwrap(), ACN_SDT_MULTICAST_PORT), None).unwrap();</span></div>
<div class="line"><span id="2737" class="lineNum"><a href="#2737">2737</a></span><span class="counterCov">2</span><span class="lineCov">    dmx_recv.listen_universes(&amp;universes).unwrap();</span></div>
<div class="line"><span id="2738" class="lineNum"><a href="#2738">2738</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="2739" class="lineNum"><a href="#2739">2739</a></span><span class="counterUnCov"></span><span class="lineUnCov">    // Receiver created successfully so allow the sender to progress.</span></div>
<div class="line"><span id="2740" class="lineNum"><a href="#2740">2740</a></span><span class="counterCov">2</span><span class="lineCov">    rx.recv().unwrap();</span></div>
<div class="line"><span id="2741" class="lineNum"><a href="#2741">2741</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="2742" class="lineNum"><a href="#2742">2742</a></span><span class="counterUnCov"></span><span class="lineUnCov">    // Get the packets of data and check that they are correct.</span></div>
<div class="line"><span id="2743" class="lineNum"><a href="#2743">2743</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="2744" class="lineNum"><a href="#2744">2744</a></span><span class="counterUnCov"></span><span class="lineUnCov">    // First set of data should be the first universe.</span></div>
<div class="line"><span id="2745" class="lineNum"><a href="#2745">2745</a></span><span class="counterCov">2</span><span class="lineCov">    let received_data: Vec&lt;DMXData&gt; = dmx_recv.recv(TIMEOUT).unwrap();</span></div>
<div class="line"><span id="2746" class="lineNum"><a href="#2746">2746</a></span><span class="counterCov">2</span><span class="lineCov">    assert_eq!(received_data.len(), 1, &quot;First set of data universe count doesn&#39;t match expected&quot;);</span></div>
<div class="line"><span id="2747" class="lineNum"><a href="#2747">2747</a></span><span class="counterCov">2</span><span class="lineCov">    assert_eq!(received_data[0].universe, universes[0], &quot;Packet universe doesn&#39;t match expected&quot;);</span></div>
<div class="line"><span id="2748" class="lineNum"><a href="#2748">2748</a></span><span class="counterCov">2</span><span class="lineCov">    assert_eq!(received_data[0].values, TEST_DATA_SINGLE_UNIVERSE.to_vec(), &quot;Data packet values don&#39;t match expected&quot;);</span></div>
<div class="line"><span id="2749" class="lineNum"><a href="#2749">2749</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="2750" class="lineNum"><a href="#2750">2750</a></span><span class="counterUnCov"></span><span class="lineUnCov">    // Second set of data should be the second and third universe.</span></div>
<div class="line"><span id="2751" class="lineNum"><a href="#2751">2751</a></span><span class="counterCov">2</span><span class="lineCov">    let received_data2: Vec&lt;DMXData&gt; = dmx_recv.recv(TIMEOUT).unwrap();</span></div>
<div class="line"><span id="2752" class="lineNum"><a href="#2752">2752</a></span><span class="counterCov">2</span><span class="lineCov">    assert_eq!(received_data2.len(), 2, &quot;Second set of data universe count doesn&#39;t match expected&quot;);</span></div>
<div class="line"><span id="2753" class="lineNum"><a href="#2753">2753</a></span><span class="counterCov">4</span><span class="lineCov">    if received_data2[0].universe == universes[1] { // Allow the data to be in any order as no ordering enforced within a set of data.</span></div>
<div class="line"><span id="2754" class="lineNum"><a href="#2754">2754</a></span><span class="counterCov">1</span><span class="lineCov">        assert_eq!(received_data2[0].values, TEST_DATA_SINGLE_ALTERNATIVE_STARTCODE_UNIVERSE.to_vec(), &quot;Second set of data part 1 packet values don&#39;t match expected&quot;);</span></div>
<div class="line"><span id="2755" class="lineNum"><a href="#2755">2755</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="2756" class="lineNum"><a href="#2756">2756</a></span><span class="counterCov">1</span><span class="lineCov">        assert_eq!(received_data2[1].universe, universes[2], &quot;Second set of data universes don&#39;t match expected&quot;);</span></div>
<div class="line"><span id="2757" class="lineNum"><a href="#2757">2757</a></span><span class="counterCov">1</span><span class="lineCov">        assert_eq!(received_data2[1].values, TEST_DATA_PARTIAL_CAPACITY_UNIVERSE.to_vec(), &quot;Second set of data part 2 packet values don&#39;t match expected&quot;);</span></div>
<div class="line"><span id="2758" class="lineNum"><a href="#2758">2758</a></span><span class="counterCov">1</span><span class="lineCov">    } else if received_data2[0].universe == universes[2] {</span></div>
<div class="line"><span id="2759" class="lineNum"><a href="#2759">2759</a></span><span class="counterCov">1</span><span class="lineCov">        assert_eq!(received_data2[0].values, TEST_DATA_PARTIAL_CAPACITY_UNIVERSE.to_vec(), &quot;Second set of data part 1 packet values don&#39;t match expected&quot;);</span></div>
<div class="line"><span id="2760" class="lineNum"><a href="#2760">2760</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="2761" class="lineNum"><a href="#2761">2761</a></span><span class="counterCov">1</span><span class="lineCov">        assert_eq!(received_data2[1].universe, universes[1], &quot;Second set of data universes don&#39;t match expected&quot;);</span></div>
<div class="line"><span id="2762" class="lineNum"><a href="#2762">2762</a></span><span class="counterCov">1</span><span class="lineCov">        assert_eq!(received_data2[1].values, TEST_DATA_SINGLE_ALTERNATIVE_STARTCODE_UNIVERSE.to_vec(), &quot;Second set of data part 2 packet values don&#39;t match expected&quot;);</span></div>
<div class="line"><span id="2763" class="lineNum"><a href="#2763">2763</a></span><span class="counterUnCov"></span><span class="lineUnCov">    } else {</span></div>
<div class="line"><span id="2764" class="lineNum"><a href="#2764">2764</a></span><span class="counterNoCov">0</span><span class="lineNoCov">        assert!(false, &quot;Unexpected universe of data received&quot;);</span></div>
<div class="line"><span id="2765" class="lineNum"><a href="#2765">2765</a></span><span class="counterUnCov"></span><span class="lineUnCov">    }</span></div>
<div class="line"><span id="2766" class="lineNum"><a href="#2766">2766</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="2767" class="lineNum"><a href="#2767">2767</a></span><span class="counterCov">2</span><span class="lineCov">    snd_thread.join().unwrap();</span></div>
<div class="line"><span id="2768" class="lineNum"><a href="#2768">2768</a></span><span class="counterCov">4</span><span class="lineCov">}</span></div>
<div class="line"><span id="2769" class="lineNum"><a href="#2769">2769</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="2770" class="lineNum"><a href="#2770">2770</a></span><span class="counterUnCov"></span><span class="lineUnCov">/// A receiver and a sender are created which both listen to a data universe and a sync universe.</span></div>
<div class="line"><span id="2771" class="lineNum"><a href="#2771">2771</a></span><span class="counterUnCov"></span><span class="lineUnCov">/// The sender then sends a synchronised data packet, the sender then waits for slightly longer than the E131_NETWORK_DATA_LOSS_TIMEOUT before sending</span></div>
<div class="line"><span id="2772" class="lineNum"><a href="#2772">2772</a></span><span class="counterUnCov"></span><span class="lineUnCov">/// the corresponding sync packet. As per ANSI E1.31-2018 Section 11.1.2 this data should be discarded as universe synchronisation should stop if the</span></div>
<div class="line"><span id="2773" class="lineNum"><a href="#2773">2773</a></span><span class="counterUnCov"></span><span class="lineUnCov">/// sync packet isn&#39;t received within the E131_NETWORK_DATA_LOSS_TIMEOUT.</span></div>
<div class="line"><span id="2774" class="lineNum"><a href="#2774">2774</a></span><span class="counterUnCov"></span><span class="lineUnCov">/// </span></div>
<div class="line"><span id="2775" class="lineNum"><a href="#2775">2775</a></span><span class="counterUnCov"></span><span class="lineUnCov">/// This shows that this timeout mechanism to stop universe synchronisation works.</span></div>
<div class="line"><span id="2776" class="lineNum"><a href="#2776">2776</a></span><span class="counterUnCov"></span><span class="lineUnCov">/// </span></div>
<div class="line"><span id="2777" class="lineNum"><a href="#2777">2777</a></span><span class="counterUnCov"></span><span class="lineUnCov">/// Note that this library does not attempt to implement the force_synchronisation bit behaviour and so therefore always stops universe synchronisation if the</span></div>
<div class="line"><span id="2778" class="lineNum"><a href="#2778">2778</a></span><span class="counterUnCov"></span><span class="lineUnCov">/// sync packet is not received within the timeout.</span></div>
<div class="line"><span id="2779" class="lineNum"><a href="#2779">2779</a></span><span class="counterUnCov"></span><span class="lineUnCov">/// </span></div>
<div class="line"><span id="2780" class="lineNum"><a href="#2780">2780</a></span><span class="counterUnCov"></span><span class="lineUnCov">#[test]</span></div>
<div class="line"><span id="2781" class="lineNum"><a href="#2781">2781</a></span><span class="counterCov">4</span><span class="lineCov">fn test_send_sync_timeout(){</span></div>
<div class="line"><span id="2782" class="lineNum"><a href="#2782">2782</a></span><span class="counterUnCov"></span><span class="lineUnCov">    const TIMEOUT: Option&lt;Duration&gt; = Some(Duration::from_secs(5));</span></div>
<div class="line"><span id="2783" class="lineNum"><a href="#2783">2783</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="2784" class="lineNum"><a href="#2784">2784</a></span><span class="counterUnCov"></span><span class="lineUnCov">    // Need to wait slightly longer than the E131_NETWORK_DATA_LOSS_TIMEOUT so that the synchronised data packet should timeout.</span></div>
<div class="line"><span id="2785" class="lineNum"><a href="#2785">2785</a></span><span class="counterCov">2</span><span class="lineCov">    let sender_wait_period: Duration = E131_NETWORK_DATA_LOSS_TIMEOUT + Duration::from_millis(100);</span></div>
<div class="line"><span id="2786" class="lineNum"><a href="#2786">2786</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="2787" class="lineNum"><a href="#2787">2787</a></span><span class="counterCov">2</span><span class="lineCov">    let (tx, rx): (SyncSender&lt;()&gt;, Receiver&lt;()&gt;) = mpsc::sync_channel(0);</span></div>
<div class="line"><span id="2788" class="lineNum"><a href="#2788">2788</a></span><span class="counterUnCov"></span><span class="lineUnCov">    </span></div>
<div class="line"><span id="2789" class="lineNum"><a href="#2789">2789</a></span><span class="counterCov">2</span><span class="lineCov">    let thread_tx = tx.clone();</span></div>
<div class="line"><span id="2790" class="lineNum"><a href="#2790">2790</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="2791" class="lineNum"><a href="#2791">2791</a></span><span class="counterCov">2</span><span class="lineCov">    let data_universe = 1;</span></div>
<div class="line"><span id="2792" class="lineNum"><a href="#2792">2792</a></span><span class="counterCov">2</span><span class="lineCov">    let sync_universe = 2;</span></div>
<div class="line"><span id="2793" class="lineNum"><a href="#2793">2793</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="2794" class="lineNum"><a href="#2794">2794</a></span><span class="counterCov">4</span><span class="lineCov">    let snd_thread = thread::spawn(move || {</span></div>
<div class="line"><span id="2795" class="lineNum"><a href="#2795">2795</a></span><span class="counterCov">2</span><span class="lineCov">        let ip: SocketAddr = SocketAddr::new(TEST_NETWORK_INTERFACE_IPV4[0].parse().unwrap(), ACN_SDT_MULTICAST_PORT + 1);</span></div>
<div class="line"><span id="2796" class="lineNum"><a href="#2796">2796</a></span><span class="counterCov">2</span><span class="lineCov">        let mut src = SacnSource::with_ip(&quot;Source&quot;, ip).unwrap();</span></div>
<div class="line"><span id="2797" class="lineNum"><a href="#2797">2797</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="2798" class="lineNum"><a href="#2798">2798</a></span><span class="counterCov">2</span><span class="lineCov">        src.register_universes(&amp;[data_universe, sync_universe]).unwrap();</span></div>
<div class="line"><span id="2799" class="lineNum"><a href="#2799">2799</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="2800" class="lineNum"><a href="#2800">2800</a></span><span class="counterUnCov"></span><span class="lineUnCov">        // Sender waits till the receiver says it is ready.</span></div>
<div class="line"><span id="2801" class="lineNum"><a href="#2801">2801</a></span><span class="counterCov">2</span><span class="lineCov">        thread_tx.send(()).unwrap();</span></div>
<div class="line"><span id="2802" class="lineNum"><a href="#2802">2802</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="2803" class="lineNum"><a href="#2803">2803</a></span><span class="counterUnCov"></span><span class="lineUnCov">        // Sender sends a data packet synchronised to the synchronisation universe.</span></div>
<div class="line"><span id="2804" class="lineNum"><a href="#2804">2804</a></span><span class="counterCov">2</span><span class="lineCov">        src.send(&amp;[data_universe], &amp;TEST_DATA_SINGLE_UNIVERSE, None, None, Some(sync_universe)).unwrap();</span></div>
<div class="line"><span id="2805" class="lineNum"><a href="#2805">2805</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="2806" class="lineNum"><a href="#2806">2806</a></span><span class="counterUnCov"></span><span class="lineUnCov">        // Sender waits too long to send the sync packet meaning that the synchronisation should have timed out.</span></div>
<div class="line"><span id="2807" class="lineNum"><a href="#2807">2807</a></span><span class="counterCov">2</span><span class="lineCov">        sleep(sender_wait_period);</span></div>
<div class="line"><span id="2808" class="lineNum"><a href="#2808">2808</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="2809" class="lineNum"><a href="#2809">2809</a></span><span class="counterUnCov"></span><span class="lineUnCov">        // Since the data packet should have timed out this should have no effect on the receiver.</span></div>
<div class="line"><span id="2810" class="lineNum"><a href="#2810">2810</a></span><span class="counterCov">2</span><span class="lineCov">        src.send_sync_packet(sync_universe, None).unwrap();</span></div>
<div class="line"><span id="2811" class="lineNum"><a href="#2811">2811</a></span><span class="counterCov">2</span><span class="lineCov">    });</span></div>
<div class="line"><span id="2812" class="lineNum"><a href="#2812">2812</a></span><span class="counterUnCov"></span><span class="lineUnCov">    </span></div>
<div class="line"><span id="2813" class="lineNum"><a href="#2813">2813</a></span><span class="counterCov">2</span><span class="lineCov">    let mut dmx_recv = SacnReceiver::with_ip(SocketAddr::new(TEST_NETWORK_INTERFACE_IPV4[1].parse().unwrap(), ACN_SDT_MULTICAST_PORT), None).unwrap();</span></div>
<div class="line"><span id="2814" class="lineNum"><a href="#2814">2814</a></span><span class="counterCov">2</span><span class="lineCov">    dmx_recv.listen_universes(&amp;[data_universe, sync_universe]).unwrap();</span></div>
<div class="line"><span id="2815" class="lineNum"><a href="#2815">2815</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="2816" class="lineNum"><a href="#2816">2816</a></span><span class="counterUnCov"></span><span class="lineUnCov">    // Receiver created successfully so allow the sender to progress.</span></div>
<div class="line"><span id="2817" class="lineNum"><a href="#2817">2817</a></span><span class="counterCov">2</span><span class="lineCov">    rx.recv().unwrap();</span></div>
<div class="line"><span id="2818" class="lineNum"><a href="#2818">2818</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="2819" class="lineNum"><a href="#2819">2819</a></span><span class="counterUnCov"></span><span class="lineUnCov">    // Data should never be passed up because the data packet should have timed-out before the sync packet is processed.</span></div>
<div class="line"><span id="2820" class="lineNum"><a href="#2820">2820</a></span><span class="counterCov">2</span><span class="lineCov">    match dmx_recv.recv(TIMEOUT) {</span></div>
<div class="line"><span id="2821" class="lineNum"><a href="#2821">2821</a></span><span class="counterCov">2</span><span class="lineCov">        Err(e) =&gt; {</span></div>
<div class="line"><span id="2822" class="lineNum"><a href="#2822">2822</a></span><span class="counterCov">2</span><span class="lineCov">            match e.kind() {</span></div>
<div class="line"><span id="2823" class="lineNum"><a href="#2823">2823</a></span><span class="counterCov">2</span><span class="lineCov">                ErrorKind::Io(ref s) =&gt; {</span></div>
<div class="line"><span id="2824" class="lineNum"><a href="#2824">2824</a></span><span class="counterCov">2</span><span class="lineCov">                    match s.kind() {</span></div>
<div class="line"><span id="2825" class="lineNum"><a href="#2825">2825</a></span><span class="counterCov">2</span><span class="lineCov">                        std::io::ErrorKind::WouldBlock | std::io::ErrorKind::TimedOut =&gt; {</span></div>
<div class="line"><span id="2826" class="lineNum"><a href="#2826">2826</a></span><span class="counterUnCov"></span><span class="lineUnCov">                            // Timeout as expected because the data packet that is awaiting a sync packet has timed out.</span></div>
<div class="line"><span id="2827" class="lineNum"><a href="#2827">2827</a></span><span class="counterUnCov"></span><span class="lineUnCov">                            // The different errors are due to windows and unix returning different errors for the same thing.</span></div>
<div class="line"><span id="2828" class="lineNum"><a href="#2828">2828</a></span><span class="counterUnCov"></span><span class="lineUnCov">                            assert!(true, &quot;Timed out as expected meaning synchronised data packet timed out as expected&quot;);</span></div>
<div class="line"><span id="2829" class="lineNum"><a href="#2829">2829</a></span><span class="counterUnCov"></span><span class="lineUnCov">                        },</span></div>
<div class="line"><span id="2830" class="lineNum"><a href="#2830">2830</a></span><span class="counterUnCov"></span><span class="lineUnCov">                        _ =&gt; {</span></div>
<div class="line"><span id="2831" class="lineNum"><a href="#2831">2831</a></span><span class="counterNoCov">0</span><span class="lineNoCov">                            assert!(false, &quot;Unexpected error returned&quot;);</span></div>
<div class="line"><span id="2832" class="lineNum"><a href="#2832">2832</a></span><span class="counterUnCov"></span><span class="lineUnCov">                        }</span></div>
<div class="line"><span id="2833" class="lineNum"><a href="#2833">2833</a></span><span class="counterUnCov"></span><span class="lineUnCov">                    }</span></div>
<div class="line"><span id="2834" class="lineNum"><a href="#2834">2834</a></span><span class="counterUnCov"></span><span class="lineUnCov">                },</span></div>
<div class="line"><span id="2835" class="lineNum"><a href="#2835">2835</a></span><span class="counterUnCov"></span><span class="lineUnCov">                _ =&gt; {</span></div>
<div class="line"><span id="2836" class="lineNum"><a href="#2836">2836</a></span><span class="counterNoCov">0</span><span class="lineNoCov">                    assert!(false, &quot;Unexpected error returned&quot;);</span></div>
<div class="line"><span id="2837" class="lineNum"><a href="#2837">2837</a></span><span class="counterUnCov"></span><span class="lineUnCov">                }</span></div>
<div class="line"><span id="2838" class="lineNum"><a href="#2838">2838</a></span><span class="counterUnCov"></span><span class="lineUnCov">            }</span></div>
<div class="line"><span id="2839" class="lineNum"><a href="#2839">2839</a></span><span class="counterUnCov"></span><span class="lineUnCov">        }</span></div>
<div class="line"><span id="2840" class="lineNum"><a href="#2840">2840</a></span><span class="counterCov">2</span><span class="lineCov">        Ok(p) =&gt; {</span></div>
<div class="line"><span id="2841" class="lineNum"><a href="#2841">2841</a></span><span class="counterUnCov"></span><span class="lineUnCov">            // println!(&quot;Elapsed {:?}&quot;, p[0].recv_timestamp.elapsed());</span></div>
<div class="line"><span id="2842" class="lineNum"><a href="#2842">2842</a></span><span class="counterNoCov">0</span><span class="lineNoCov">            assert!(false, format!(&quot;Received data unexpectedly: {:?}&quot;, p));</span></div>
<div class="line"><span id="2843" class="lineNum"><a href="#2843">2843</a></span><span class="counterUnCov"></span><span class="lineUnCov">        }</span></div>
<div class="line"><span id="2844" class="lineNum"><a href="#2844">2844</a></span><span class="counterUnCov"></span><span class="lineUnCov">    }</span></div>
<div class="line"><span id="2845" class="lineNum"><a href="#2845">2845</a></span><span class="counterCov">2</span><span class="lineCov">    snd_thread.join().unwrap();</span></div>
<div class="line"><span id="2846" class="lineNum"><a href="#2846">2846</a></span><span class="counterCov">4</span><span class="lineCov">}</span></div>
<div class="line"><span id="2847" class="lineNum"><a href="#2847">2847</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="2848" class="lineNum"><a href="#2848">2848</a></span><span class="counterUnCov"></span><span class="lineUnCov">/// Setups and runs through the scenario as described in ANSI E1.31-2018 Appendix B.</span></div>
<div class="line"><span id="2849" class="lineNum"><a href="#2849">2849</a></span><span class="counterUnCov"></span><span class="lineUnCov">/// This asserts that the behaviour of this implementation is exactly as outlined within that section.</span></div>
<div class="line"><span id="2850" class="lineNum"><a href="#2850">2850</a></span><span class="counterUnCov"></span><span class="lineUnCov">/// This shows that the implementation handles universe synchronisation in the way specified by the protocol document. </span></div>
<div class="line"><span id="2851" class="lineNum"><a href="#2851">2851</a></span><span class="counterUnCov"></span><span class="lineUnCov">/// As the force synchronisation option is not implemented as part of this library that section is ignored.</span></div>
<div class="line"><span id="2852" class="lineNum"><a href="#2852">2852</a></span><span class="counterUnCov"></span><span class="lineUnCov">#[test]</span></div>
<div class="line"><span id="2853" class="lineNum"><a href="#2853">2853</a></span><span class="counterCov">4</span><span class="lineCov">fn test_ansi_e131_appendix_b_runthrough_ipv4() {</span></div>
<div class="line"><span id="2854" class="lineNum"><a href="#2854">2854</a></span><span class="counterUnCov"></span><span class="lineUnCov">    // The number of set of (data packets + sync packet) to send.</span></div>
<div class="line"><span id="2855" class="lineNum"><a href="#2855">2855</a></span><span class="counterUnCov"></span><span class="lineUnCov">    const SYNC_PACKET_COUNT: usize = 5;</span></div>
<div class="line"><span id="2856" class="lineNum"><a href="#2856">2856</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="2857" class="lineNum"><a href="#2857">2857</a></span><span class="counterUnCov"></span><span class="lineUnCov">    // The number of data packets sent before each sync packet.</span></div>
<div class="line"><span id="2858" class="lineNum"><a href="#2858">2858</a></span><span class="counterUnCov"></span><span class="lineUnCov">    const DATA_PACKETS_PER_SYNC_PACKET: usize = 2;</span></div>
<div class="line"><span id="2859" class="lineNum"><a href="#2859">2859</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="2860" class="lineNum"><a href="#2860">2860</a></span><span class="counterUnCov"></span><span class="lineUnCov">    // The &#39;slight pause&#39; as specified by ANSI E1.31-2018 Section 11.2.2 between data and sync packets.</span></div>
<div class="line"><span id="2861" class="lineNum"><a href="#2861">2861</a></span><span class="counterUnCov"></span><span class="lineUnCov">    const PAUSE_PERIOD: Duration = Duration::from_millis(100);</span></div>
<div class="line"><span id="2862" class="lineNum"><a href="#2862">2862</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="2863" class="lineNum"><a href="#2863">2863</a></span><span class="counterCov">2</span><span class="lineCov">    let (tx, rx): (SyncSender&lt;()&gt;, Receiver&lt;()&gt;) = mpsc::sync_channel(0);</span></div>
<div class="line"><span id="2864" class="lineNum"><a href="#2864">2864</a></span><span class="counterUnCov"></span><span class="lineUnCov">    </span></div>
<div class="line"><span id="2865" class="lineNum"><a href="#2865">2865</a></span><span class="counterCov">2</span><span class="lineCov">    let thread_tx = tx.clone();</span></div>
<div class="line"><span id="2866" class="lineNum"><a href="#2866">2866</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="2867" class="lineNum"><a href="#2867">2867</a></span><span class="counterCov">2</span><span class="lineCov">    let data_universes = [1, 2];</span></div>
<div class="line"><span id="2868" class="lineNum"><a href="#2868">2868</a></span><span class="counterCov">2</span><span class="lineCov">    let sync_universe = 7962;</span></div>
<div class="line"><span id="2869" class="lineNum"><a href="#2869">2869</a></span><span class="counterCov">2</span><span class="lineCov">    let priority = 100;</span></div>
<div class="line"><span id="2870" class="lineNum"><a href="#2870">2870</a></span><span class="counterCov">2</span><span class="lineCov">    let source_name = &quot;Source_A&quot;;</span></div>
<div class="line"><span id="2871" class="lineNum"><a href="#2871">2871</a></span><span class="counterCov">2</span><span class="lineCov">    let data = [0x00, 0xe, 0x0, 0xc, 0x1, 0x7, 0x1, 0x4, 0x8, 0x0, 0xd, 0xa, 0x7, 0xa];</span></div>
<div class="line"><span id="2872" class="lineNum"><a href="#2872">2872</a></span><span class="counterCov">2</span><span class="lineCov">    let data2 = [0x00, 0xa, 0xb, 0xc, 0xd, 0xe, 0xf, 0xa, 0xb, 0xc, 0xd, 0xe, 0xf, 0xa];</span></div>
<div class="line"><span id="2873" class="lineNum"><a href="#2873">2873</a></span><span class="counterCov">2</span><span class="lineCov">    let src_cid: Uuid = Uuid::from_bytes(&amp;[0xef, 0x07, 0xc8, 0xdd, 0x00, 0x64, 0x44, 0x01, 0xa3, 0xa2, 0x45, 0x9e, 0xf8, 0xe6, 0x14, 0x3e]).unwrap();</span></div>
<div class="line"><span id="2874" class="lineNum"><a href="#2874">2874</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="2875" class="lineNum"><a href="#2875">2875</a></span><span class="counterCov">4</span><span class="lineCov">    let snd_thread = thread::spawn(move || {</span></div>
<div class="line"><span id="2876" class="lineNum"><a href="#2876">2876</a></span><span class="counterCov">2</span><span class="lineCov">        let ip: SocketAddr = SocketAddr::new(TEST_NETWORK_INTERFACE_IPV4[0].parse().unwrap(), ACN_SDT_MULTICAST_PORT + 1);</span></div>
<div class="line"><span id="2877" class="lineNum"><a href="#2877">2877</a></span><span class="counterCov">2</span><span class="lineCov">        let mut src = SacnSource::with_cid_ip(source_name, src_cid, ip).unwrap();</span></div>
<div class="line"><span id="2878" class="lineNum"><a href="#2878">2878</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="2879" class="lineNum"><a href="#2879">2879</a></span><span class="counterCov">2</span><span class="lineCov">        src.register_universes(&amp;data_universes).unwrap();</span></div>
<div class="line"><span id="2880" class="lineNum"><a href="#2880">2880</a></span><span class="counterCov">2</span><span class="lineCov">        src.register_universe(sync_universe).unwrap();</span></div>
<div class="line"><span id="2881" class="lineNum"><a href="#2881">2881</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="2882" class="lineNum"><a href="#2882">2882</a></span><span class="counterUnCov"></span><span class="lineUnCov">        // Sender waits till the receiver says it is ready.</span></div>
<div class="line"><span id="2883" class="lineNum"><a href="#2883">2883</a></span><span class="counterCov">2</span><span class="lineCov">        thread_tx.send(()).unwrap();</span></div>
<div class="line"><span id="2884" class="lineNum"><a href="#2884">2884</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="2885" class="lineNum"><a href="#2885">2885</a></span><span class="counterCov">12</span><span class="lineCov">        for _ in 0 .. SYNC_PACKET_COUNT {</span></div>
<div class="line"><span id="2886" class="lineNum"><a href="#2886">2886</a></span><span class="counterUnCov"></span><span class="lineUnCov">            // Sender sends data packets to the 2 data universes using the same synchronisation address.</span></div>
<div class="line"><span id="2887" class="lineNum"><a href="#2887">2887</a></span><span class="counterCov">10</span><span class="lineCov">            src.send(&amp;[data_universes[0]], &amp;data, Some(priority), None, Some(sync_universe)).unwrap();</span></div>
<div class="line"><span id="2888" class="lineNum"><a href="#2888">2888</a></span><span class="counterCov">10</span><span class="lineCov">            src.send(&amp;[data_universes[1]], &amp;data2, Some(priority), None, Some(sync_universe)).unwrap();</span></div>
<div class="line"><span id="2889" class="lineNum"><a href="#2889">2889</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="2890" class="lineNum"><a href="#2890">2890</a></span><span class="counterUnCov"></span><span class="lineUnCov">            // Sender observes a slight pause to allow for processing delays (ANSI E1.31-2018 Section 11.2.2).</span></div>
<div class="line"><span id="2891" class="lineNum"><a href="#2891">2891</a></span><span class="counterCov">10</span><span class="lineCov">            sleep(PAUSE_PERIOD);</span></div>
<div class="line"><span id="2892" class="lineNum"><a href="#2892">2892</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="2893" class="lineNum"><a href="#2893">2893</a></span><span class="counterUnCov"></span><span class="lineUnCov">            // Sender sends a synchronisation packet to the sync universe.</span></div>
<div class="line"><span id="2894" class="lineNum"><a href="#2894">2894</a></span><span class="counterCov">10</span><span class="lineCov">            src.send_sync_packet(sync_universe, None).unwrap();</span></div>
<div class="line"><span id="2895" class="lineNum"><a href="#2895">2895</a></span><span class="counterUnCov"></span><span class="lineUnCov">        }</span></div>
<div class="line"><span id="2896" class="lineNum"><a href="#2896">2896</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="2897" class="lineNum"><a href="#2897">2897</a></span><span class="counterUnCov"></span><span class="lineUnCov">        // Sender sends a data packet to the data universe using a zero synchronisation address indicating synchronisation is now over.</span></div>
<div class="line"><span id="2898" class="lineNum"><a href="#2898">2898</a></span><span class="counterCov">2</span><span class="lineCov">        src.send(&amp;[data_universes[0]], &amp;data, Some(priority), None, None).unwrap();</span></div>
<div class="line"><span id="2899" class="lineNum"><a href="#2899">2899</a></span><span class="counterCov">2</span><span class="lineCov">        src.send(&amp;[data_universes[1]], &amp;data2, Some(priority), None, None).unwrap();</span></div>
<div class="line"><span id="2900" class="lineNum"><a href="#2900">2900</a></span><span class="counterCov">2</span><span class="lineCov">    });</span></div>
<div class="line"><span id="2901" class="lineNum"><a href="#2901">2901</a></span><span class="counterUnCov"></span><span class="lineUnCov">    </span></div>
<div class="line"><span id="2902" class="lineNum"><a href="#2902">2902</a></span><span class="counterCov">2</span><span class="lineCov">    let mut dmx_recv = SacnReceiver::with_ip(SocketAddr::new(TEST_NETWORK_INTERFACE_IPV4[1].parse().unwrap(), ACN_SDT_MULTICAST_PORT), None).unwrap();</span></div>
<div class="line"><span id="2903" class="lineNum"><a href="#2903">2903</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="2904" class="lineNum"><a href="#2904">2904</a></span><span class="counterUnCov"></span><span class="lineUnCov">    // Receiver only listening to the data universe, the sync universe should be joined automatically when a data packet that requires it arrives.</span></div>
<div class="line"><span id="2905" class="lineNum"><a href="#2905">2905</a></span><span class="counterCov">2</span><span class="lineCov">    dmx_recv.listen_universes(&amp;data_universes).unwrap();</span></div>
<div class="line"><span id="2906" class="lineNum"><a href="#2906">2906</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="2907" class="lineNum"><a href="#2907">2907</a></span><span class="counterUnCov"></span><span class="lineUnCov">    // Receiver created successfully so allow the sender to progress.</span></div>
<div class="line"><span id="2908" class="lineNum"><a href="#2908">2908</a></span><span class="counterCov">2</span><span class="lineCov">    rx.recv().unwrap();</span></div>
<div class="line"><span id="2909" class="lineNum"><a href="#2909">2909</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="2910" class="lineNum"><a href="#2910">2910</a></span><span class="counterCov">12</span><span class="lineCov">    for _ in 0 .. SYNC_PACKET_COUNT {</span></div>
<div class="line"><span id="2911" class="lineNum"><a href="#2911">2911</a></span><span class="counterUnCov"></span><span class="lineUnCov">        // &quot;When the E1.31 Synchronization Packet arrives from Source A, Receiver B acts on the data.&quot;</span></div>
<div class="line"><span id="2912" class="lineNum"><a href="#2912">2912</a></span><span class="counterCov">10</span><span class="lineCov">        match dmx_recv.recv(None) {</span></div>
<div class="line"><span id="2913" class="lineNum"><a href="#2913">2913</a></span><span class="counterCov">10</span><span class="lineCov">            Ok(p) =&gt; { </span></div>
<div class="line"><span id="2914" class="lineNum"><a href="#2914">2914</a></span><span class="counterCov">10</span><span class="lineCov">                assert_eq!(p.len(), DATA_PACKETS_PER_SYNC_PACKET);</span></div>
<div class="line"><span id="2915" class="lineNum"><a href="#2915">2915</a></span><span class="counterCov">20</span><span class="lineCov">                if p[0].universe == data_universes[0] {</span></div>
<div class="line"><span id="2916" class="lineNum"><a href="#2916">2916</a></span><span class="counterNoCov">0</span><span class="lineNoCov">                    assert_eq!(p[0].values, data, &quot;Unexpected data within first data packet of a set of synchronised packets&quot;);</span></div>
<div class="line"><span id="2917" class="lineNum"><a href="#2917">2917</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="2918" class="lineNum"><a href="#2918">2918</a></span><span class="counterNoCov">0</span><span class="lineNoCov">                    assert_eq!(p[1].universe, data_universes[1], &quot;Unrecognised universe as second data packet in set of synchronised packets&quot;);</span></div>
<div class="line"><span id="2919" class="lineNum"><a href="#2919">2919</a></span><span class="counterNoCov">0</span><span class="lineNoCov">                    assert_eq!(p[1].values, data2, &quot;Unexpected data within second data packet of a set of synchronised packets&quot;);</span></div>
<div class="line"><span id="2920" class="lineNum"><a href="#2920">2920</a></span><span class="counterCov">10</span><span class="lineCov">                } else if p[0].universe == data_universes[1] {</span></div>
<div class="line"><span id="2921" class="lineNum"><a href="#2921">2921</a></span><span class="counterCov">10</span><span class="lineCov">                    assert_eq!(p[0].values, data2, &quot;Unexpected data within first data packet of a set of synchronised packets&quot;);</span></div>
<div class="line"><span id="2922" class="lineNum"><a href="#2922">2922</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="2923" class="lineNum"><a href="#2923">2923</a></span><span class="counterCov">10</span><span class="lineCov">                    assert_eq!(p[1].universe, data_universes[0], &quot;Unrecognised universe as second data packet in set of synchronised packets&quot;);</span></div>
<div class="line"><span id="2924" class="lineNum"><a href="#2924">2924</a></span><span class="counterCov">10</span><span class="lineCov">                    assert_eq!(p[1].values, data, &quot;Unexpected data within second data packet of a set of synchronised packets&quot;);</span></div>
<div class="line"><span id="2925" class="lineNum"><a href="#2925">2925</a></span><span class="counterUnCov"></span><span class="lineUnCov">                } else {</span></div>
<div class="line"><span id="2926" class="lineNum"><a href="#2926">2926</a></span><span class="counterNoCov">0</span><span class="lineNoCov">                    assert!(false, &quot;Unrecognised universe within data packet&quot;);</span></div>
<div class="line"><span id="2927" class="lineNum"><a href="#2927">2927</a></span><span class="counterUnCov"></span><span class="lineUnCov">                }</span></div>
<div class="line"><span id="2928" class="lineNum"><a href="#2928">2928</a></span><span class="counterUnCov"></span><span class="lineUnCov">            }</span></div>
<div class="line"><span id="2929" class="lineNum"><a href="#2929">2929</a></span><span class="counterCov">10</span><span class="lineCov">            Err(e) =&gt; {</span></div>
<div class="line"><span id="2930" class="lineNum"><a href="#2930">2930</a></span><span class="counterNoCov">0</span><span class="lineNoCov">                assert!(false, format!(&quot;Unexpected error returned: {:?}&quot;, e));</span></div>
<div class="line"><span id="2931" class="lineNum"><a href="#2931">2931</a></span><span class="counterUnCov"></span><span class="lineUnCov">            }</span></div>
<div class="line"><span id="2932" class="lineNum"><a href="#2932">2932</a></span><span class="counterUnCov"></span><span class="lineUnCov">        }</span></div>
<div class="line"><span id="2933" class="lineNum"><a href="#2933">2933</a></span><span class="counterUnCov"></span><span class="lineUnCov">    }</span></div>
<div class="line"><span id="2934" class="lineNum"><a href="#2934">2934</a></span><span class="counterUnCov"></span><span class="lineUnCov">    // &quot;This process continues until Receiver B receives an E1.31 Data Packet with a Synchronization Address of 0.&quot;</span></div>
<div class="line"><span id="2935" class="lineNum"><a href="#2935">2935</a></span><span class="counterUnCov"></span><span class="lineUnCov">    // &quot;Receiver B may then unsubscribe from the synchronization multicast address&quot; - This implementation does not automatically unsubscribe</span></div>
<div class="line"><span id="2936" class="lineNum"><a href="#2936">2936</a></span><span class="counterUnCov"></span><span class="lineUnCov">    //        This is based on the reasoning that a synchronisation universe will be used multiple times and subscribing/un-subscribing is unneeded overhead.</span></div>
<div class="line"><span id="2937" class="lineNum"><a href="#2937">2937</a></span><span class="counterUnCov"></span><span class="lineUnCov">    // Synchronisation is now over so should receive 2 packets individually.</span></div>
<div class="line"><span id="2938" class="lineNum"><a href="#2938">2938</a></span><span class="counterCov">2</span><span class="lineCov">    let rcv_data = dmx_recv.recv(None).unwrap();</span></div>
<div class="line"><span id="2939" class="lineNum"><a href="#2939">2939</a></span><span class="counterCov">2</span><span class="lineCov">    assert_eq!(rcv_data.len(), 1);</span></div>
<div class="line"><span id="2940" class="lineNum"><a href="#2940">2940</a></span><span class="counterCov">2</span><span class="lineCov">    assert_eq!(rcv_data[0].universe, data_universes[0]);</span></div>
<div class="line"><span id="2941" class="lineNum"><a href="#2941">2941</a></span><span class="counterCov">2</span><span class="lineCov">    assert_eq!(rcv_data[0].values, data);</span></div>
<div class="line"><span id="2942" class="lineNum"><a href="#2942">2942</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="2943" class="lineNum"><a href="#2943">2943</a></span><span class="counterCov">2</span><span class="lineCov">    let rcv_data2 = dmx_recv.recv(None).unwrap();</span></div>
<div class="line"><span id="2944" class="lineNum"><a href="#2944">2944</a></span><span class="counterCov">2</span><span class="lineCov">    assert_eq!(rcv_data2.len(), 1);</span></div>
<div class="line"><span id="2945" class="lineNum"><a href="#2945">2945</a></span><span class="counterCov">2</span><span class="lineCov">    assert_eq!(rcv_data2[0].universe, data_universes[1]);</span></div>
<div class="line"><span id="2946" class="lineNum"><a href="#2946">2946</a></span><span class="counterCov">2</span><span class="lineCov">    assert_eq!(rcv_data2[0].values, data2);</span></div>
<div class="line"><span id="2947" class="lineNum"><a href="#2947">2947</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="2948" class="lineNum"><a href="#2948">2948</a></span><span class="counterUnCov"></span><span class="lineUnCov">    // &quot;If, at any time, Receiver B receives more than one E1.31 Data Packet with the same Synchronization</span></div>
<div class="line"><span id="2949" class="lineNum"><a href="#2949">2949</a></span><span class="counterUnCov"></span><span class="lineUnCov">    // Address in it, before receiving an E1.31 Universe Synchronization Packet, it will discard all but the most</span></div>
<div class="line"><span id="2950" class="lineNum"><a href="#2950">2950</a></span><span class="counterUnCov"></span><span class="lineUnCov">    // recent E1.31 Data Packet. Those packets are only acted upon when the synchronization command</span></div>
<div class="line"><span id="2951" class="lineNum"><a href="#2951">2951</a></span><span class="counterUnCov"></span><span class="lineUnCov">    // arrives.&quot;</span></div>
<div class="line"><span id="2952" class="lineNum"><a href="#2952">2952</a></span><span class="counterUnCov"></span><span class="lineUnCov">    // This is taken to refer to a data packet within the same universe and synchronisation address not a packet with any universe</span></div>
<div class="line"><span id="2953" class="lineNum"><a href="#2953">2953</a></span><span class="counterUnCov"></span><span class="lineUnCov">    // this assumption is based on the wording &quot;Universe synchronization is required for applications where receivers require more than one universe to</span></div>
<div class="line"><span id="2954" class="lineNum"><a href="#2954">2954</a></span><span class="counterUnCov"></span><span class="lineUnCov">    // be controlled, multiple receivers produce synchronized output, or unsynchronized control of receivers may</span></div>
<div class="line"><span id="2955" class="lineNum"><a href="#2955">2955</a></span><span class="counterUnCov"></span><span class="lineUnCov">    // result in undesired visual effects.&quot; from ANSI E1.31-2018 Section 11. This wording indicates that one use case of synchronisation is to allow</span></div>
<div class="line"><span id="2956" class="lineNum"><a href="#2956">2956</a></span><span class="counterUnCov"></span><span class="lineUnCov">    // receivers with more than one universe to be controlled however this would be impossible if the statement above (from ANSI E1.31-2018 Appendix B) </span></div>
<div class="line"><span id="2957" class="lineNum"><a href="#2957">2957</a></span><span class="counterUnCov"></span><span class="lineUnCov">    // indicated that data packets for all but one universe should be discarded.</span></div>
<div class="line"><span id="2958" class="lineNum"><a href="#2958">2958</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="2959" class="lineNum"><a href="#2959">2959</a></span><span class="counterUnCov"></span><span class="lineUnCov">    // &quot;Since the the Force_Synchronization bit in the Options field of the E1.31 Data Packet has been set to 0,</span></div>
<div class="line"><span id="2960" class="lineNum"><a href="#2960">2960</a></span><span class="counterUnCov"></span><span class="lineUnCov">    // even if Source A times out the E131_NETWORK_DATA_LOSS_TIMEOUT, Receiver B will stay in its last</span></div>
<div class="line"><span id="2961" class="lineNum"><a href="#2961">2961</a></span><span class="counterUnCov"></span><span class="lineUnCov">    // look until a new E1.31 Synchronization Packet arrives.&quot;</span></div>
<div class="line"><span id="2962" class="lineNum"><a href="#2962">2962</a></span><span class="counterUnCov"></span><span class="lineUnCov">    // The implementation does not support the force synchronisation bit so always acts as if is set to 1 and times out.</span></div>
<div class="line"><span id="2963" class="lineNum"><a href="#2963">2963</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="2964" class="lineNum"><a href="#2964">2964</a></span><span class="counterCov">2</span><span class="lineCov">    snd_thread.join().unwrap();</span></div>
<div class="line"><span id="2965" class="lineNum"><a href="#2965">2965</a></span><span class="counterCov">4</span><span class="lineCov">}</span></div>
<div class="line"><span id="2966" class="lineNum"><a href="#2966">2966</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="2967" class="lineNum"><a href="#2967">2967</a></span><span class="counterUnCov"></span><span class="lineUnCov">/// Sets up a single source and receiver. Like in a real-world scenario the source sends data continuously on 2 universes synchronised </span></div>
<div class="line"><span id="2968" class="lineNum"><a href="#2968">2968</a></span><span class="counterUnCov"></span><span class="lineUnCov">/// on a third universe with a small interval between data sends.</span></div>
<div class="line"><span id="2969" class="lineNum"><a href="#2969">2969</a></span><span class="counterUnCov"></span><span class="lineUnCov">/// The receiver starts with no knowledge of what universe the source is sending on so starts by using Universe Discovery to discover the universes</span></div>
<div class="line"><span id="2970" class="lineNum"><a href="#2970">2970</a></span><span class="counterUnCov"></span><span class="lineUnCov">/// it then joins these universes and receives the data. The sender eventually stops sending data and terminates by sending stream termination packets.</span></div>
<div class="line"><span id="2971" class="lineNum"><a href="#2971">2971</a></span><span class="counterUnCov"></span><span class="lineUnCov">/// The receiver receives these packets and also terminates.</span></div>
<div class="line"><span id="2972" class="lineNum"><a href="#2972">2972</a></span><span class="counterUnCov"></span><span class="lineUnCov">/// This shows that the implementation works in a simulated scenario that makes use of multiple features / parts.</span></div>
<div class="line"><span id="2973" class="lineNum"><a href="#2973">2973</a></span><span class="counterUnCov"></span><span class="lineUnCov">/// It also shows the receiver &#39;jumping into&#39; a stream of data that has already started (meaning sequence numbers are already &gt; 0).</span></div>
<div class="line"><span id="2974" class="lineNum"><a href="#2974">2974</a></span><span class="counterUnCov"></span><span class="lineUnCov">#[test]</span></div>
<div class="line"><span id="2975" class="lineNum"><a href="#2975">2975</a></span><span class="counterCov">4</span><span class="lineCov">fn test_discover_recv_sync_runthrough_ipv4() {</span></div>
<div class="line"><span id="2976" class="lineNum"><a href="#2976">2976</a></span><span class="counterUnCov"></span><span class="lineUnCov">    // The number of set of (data packets + sync packet) to send.</span></div>
<div class="line"><span id="2977" class="lineNum"><a href="#2977">2977</a></span><span class="counterUnCov"></span><span class="lineUnCov">    const SYNC_PACKET_COUNT: usize = 250;</span></div>
<div class="line"><span id="2978" class="lineNum"><a href="#2978">2978</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="2979" class="lineNum"><a href="#2979">2979</a></span><span class="counterUnCov"></span><span class="lineUnCov">    // The number of data packets sent before each sync packet.</span></div>
<div class="line"><span id="2980" class="lineNum"><a href="#2980">2980</a></span><span class="counterUnCov"></span><span class="lineUnCov">    const DATA_PACKETS_PER_SYNC_PACKET: usize = 2;</span></div>
<div class="line"><span id="2981" class="lineNum"><a href="#2981">2981</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="2982" class="lineNum"><a href="#2982">2982</a></span><span class="counterUnCov"></span><span class="lineUnCov">    // The &#39;slight pause&#39; as specified by ANSI E1.31-2018 Section 11.2.2 between data and sync packets.</span></div>
<div class="line"><span id="2983" class="lineNum"><a href="#2983">2983</a></span><span class="counterUnCov"></span><span class="lineUnCov">    const PAUSE_PERIOD: Duration = Duration::from_millis(50);</span></div>
<div class="line"><span id="2984" class="lineNum"><a href="#2984">2984</a></span><span class="counterUnCov"></span><span class="lineUnCov">    </span></div>
<div class="line"><span id="2985" class="lineNum"><a href="#2985">2985</a></span><span class="counterUnCov"></span><span class="lineUnCov">    // The interval between sets of sync/data packets.</span></div>
<div class="line"><span id="2986" class="lineNum"><a href="#2986">2986</a></span><span class="counterUnCov"></span><span class="lineUnCov">    const INTERVAL: Duration = Duration::from_millis(100);</span></div>
<div class="line"><span id="2987" class="lineNum"><a href="#2987">2987</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="2988" class="lineNum"><a href="#2988">2988</a></span><span class="counterUnCov"></span><span class="lineUnCov">    // The universes used for data.</span></div>
<div class="line"><span id="2989" class="lineNum"><a href="#2989">2989</a></span><span class="counterUnCov"></span><span class="lineUnCov">    const DATA_UNIVERSES: [u16; 2] = [1, 2];</span></div>
<div class="line"><span id="2990" class="lineNum"><a href="#2990">2990</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="2991" class="lineNum"><a href="#2991">2991</a></span><span class="counterUnCov"></span><span class="lineUnCov">    // The universe used for synchronisation packets.</span></div>
<div class="line"><span id="2992" class="lineNum"><a href="#2992">2992</a></span><span class="counterUnCov"></span><span class="lineUnCov">    const SYNC_UNIVERSE: u16 = 4;</span></div>
<div class="line"><span id="2993" class="lineNum"><a href="#2993">2993</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="2994" class="lineNum"><a href="#2994">2994</a></span><span class="counterUnCov"></span><span class="lineUnCov">    // The source name</span></div>
<div class="line"><span id="2995" class="lineNum"><a href="#2995">2995</a></span><span class="counterUnCov"></span><span class="lineUnCov">    const SOURCE_NAME: &amp;str = &quot;Test Source&quot;;</span></div>
<div class="line"><span id="2996" class="lineNum"><a href="#2996">2996</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="2997" class="lineNum"><a href="#2997">2997</a></span><span class="counterUnCov"></span><span class="lineUnCov">    // The data send on the first and second universes.</span></div>
<div class="line"><span id="2998" class="lineNum"><a href="#2998">2998</a></span><span class="counterUnCov"></span><span class="lineUnCov">    const DATA: [u8; 16] = [0x00, 0xe, 0x0, 0xc, 0x1, 0x7, 0x1, 0x4, 0x8, 0x0, 0xd, 0xa, 0x7, 0xa, 0x9, 0x8];</span></div>
<div class="line"><span id="2999" class="lineNum"><a href="#2999">2999</a></span><span class="counterUnCov"></span><span class="lineUnCov">    const DATA2: [u8; 16] =[0x00, 0xa, 0xb, 0xc, 0xd, 0xe, 0xf, 0xa, 0xb, 0xc, 0xd, 0xe, 0xf, 0xa, 0x9, 0x8];</span></div>
<div class="line"><span id="3000" class="lineNum"><a href="#3000">3000</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="3001" class="lineNum"><a href="#3001">3001</a></span><span class="counterUnCov"></span><span class="lineUnCov">    // The source CID.</span></div>
<div class="line"><span id="3002" class="lineNum"><a href="#3002">3002</a></span><span class="counterCov">2</span><span class="lineCov">    let src_cid: Uuid = Uuid::from_bytes(&amp;[0xef, 0x07, 0xc8, 0xdd, 0x00, 0x64, 0x44, 0x01, 0xa3, 0xa2, 0x45, 0x9e, 0xf8, 0xe6, 0x14, 0x3e]).unwrap();</span></div>
<div class="line"><span id="3003" class="lineNum"><a href="#3003">3003</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="3004" class="lineNum"><a href="#3004">3004</a></span><span class="counterCov">4</span><span class="lineCov">    let snd_thread = thread::spawn(move || {</span></div>
<div class="line"><span id="3005" class="lineNum"><a href="#3005">3005</a></span><span class="counterCov">2</span><span class="lineCov">        let ip: SocketAddr = SocketAddr::new(TEST_NETWORK_INTERFACE_IPV4[0].parse().unwrap(), ACN_SDT_MULTICAST_PORT + 1);</span></div>
<div class="line"><span id="3006" class="lineNum"><a href="#3006">3006</a></span><span class="counterCov">2</span><span class="lineCov">        let mut src = SacnSource::with_cid_ip(SOURCE_NAME, src_cid, ip).unwrap();</span></div>
<div class="line"><span id="3007" class="lineNum"><a href="#3007">3007</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="3008" class="lineNum"><a href="#3008">3008</a></span><span class="counterCov">2</span><span class="lineCov">        src.register_universes(&amp;DATA_UNIVERSES).unwrap();</span></div>
<div class="line"><span id="3009" class="lineNum"><a href="#3009">3009</a></span><span class="counterCov">2</span><span class="lineCov">        src.register_universe(SYNC_UNIVERSE).unwrap();</span></div>
<div class="line"><span id="3010" class="lineNum"><a href="#3010">3010</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="3011" class="lineNum"><a href="#3011">3011</a></span><span class="counterCov">502</span><span class="lineCov">        for _ in 0 .. SYNC_PACKET_COUNT {</span></div>
<div class="line"><span id="3012" class="lineNum"><a href="#3012">3012</a></span><span class="counterUnCov"></span><span class="lineUnCov">            // Sender sends data packets to the 2 data universes using the same synchronisation address.</span></div>
<div class="line"><span id="3013" class="lineNum"><a href="#3013">3013</a></span><span class="counterCov">500</span><span class="lineCov">            src.send(&amp;[DATA_UNIVERSES[0]], &amp;DATA, None, None, Some(SYNC_UNIVERSE)).unwrap();</span></div>
<div class="line"><span id="3014" class="lineNum"><a href="#3014">3014</a></span><span class="counterCov">500</span><span class="lineCov">            src.send(&amp;[DATA_UNIVERSES[1]], &amp;DATA2, None, None, Some(SYNC_UNIVERSE)).unwrap();</span></div>
<div class="line"><span id="3015" class="lineNum"><a href="#3015">3015</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="3016" class="lineNum"><a href="#3016">3016</a></span><span class="counterUnCov"></span><span class="lineUnCov">            // Sender observes a slight pause to allow for processing delays (ANSI E1.31-2018 Section 11.2.2).</span></div>
<div class="line"><span id="3017" class="lineNum"><a href="#3017">3017</a></span><span class="counterCov">500</span><span class="lineCov">            sleep(PAUSE_PERIOD);</span></div>
<div class="line"><span id="3018" class="lineNum"><a href="#3018">3018</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="3019" class="lineNum"><a href="#3019">3019</a></span><span class="counterUnCov"></span><span class="lineUnCov">            // Sender sends a synchronisation packet to the sync universe.</span></div>
<div class="line"><span id="3020" class="lineNum"><a href="#3020">3020</a></span><span class="counterCov">500</span><span class="lineCov">            src.send_sync_packet(SYNC_UNIVERSE, None).unwrap();</span></div>
<div class="line"><span id="3021" class="lineNum"><a href="#3021">3021</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="3022" class="lineNum"><a href="#3022">3022</a></span><span class="counterCov">500</span><span class="lineCov">            sleep(INTERVAL);</span></div>
<div class="line"><span id="3023" class="lineNum"><a href="#3023">3023</a></span><span class="counterUnCov"></span><span class="lineUnCov">        }</span></div>
<div class="line"><span id="3024" class="lineNum"><a href="#3024">3024</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="3025" class="lineNum"><a href="#3025">3025</a></span><span class="counterUnCov"></span><span class="lineUnCov">        // Sender goes out of scope so will automatically send termination packets.</span></div>
<div class="line"><span id="3026" class="lineNum"><a href="#3026">3026</a></span><span class="counterCov">2</span><span class="lineCov">    });</span></div>
<div class="line"><span id="3027" class="lineNum"><a href="#3027">3027</a></span><span class="counterUnCov"></span><span class="lineUnCov">    </span></div>
<div class="line"><span id="3028" class="lineNum"><a href="#3028">3028</a></span><span class="counterCov">2</span><span class="lineCov">    let mut dmx_recv = SacnReceiver::with_ip(SocketAddr::new(TEST_NETWORK_INTERFACE_IPV4[1].parse().unwrap(), ACN_SDT_MULTICAST_PORT), None).unwrap();</span></div>
<div class="line"><span id="3029" class="lineNum"><a href="#3029">3029</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="3030" class="lineNum"><a href="#3030">3030</a></span><span class="counterUnCov"></span><span class="lineUnCov">    // Receiver starts by not listening to any data universes (automatically listens to discovery universe).</span></div>
<div class="line"><span id="3031" class="lineNum"><a href="#3031">3031</a></span><span class="counterUnCov"></span><span class="lineUnCov">    </span></div>
<div class="line"><span id="3032" class="lineNum"><a href="#3032">3032</a></span><span class="counterCov">2</span><span class="lineCov">    dmx_recv.set_announce_source_discovery(true);</span></div>
<div class="line"><span id="3033" class="lineNum"><a href="#3033">3033</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="3034" class="lineNum"><a href="#3034">3034</a></span><span class="counterCov">2</span><span class="lineCov">    let universes: Vec&lt;u16&gt; = match dmx_recv.recv(None) {</span></div>
<div class="line"><span id="3035" class="lineNum"><a href="#3035">3035</a></span><span class="counterCov">2</span><span class="lineCov">        Err(e) =&gt; {</span></div>
<div class="line"><span id="3036" class="lineNum"><a href="#3036">3036</a></span><span class="counterCov">2</span><span class="lineCov">            match e.kind() {</span></div>
<div class="line"><span id="3037" class="lineNum"><a href="#3037">3037</a></span><span class="counterCov">2</span><span class="lineCov">                ErrorKind::SourceDiscovered(_name) =&gt; {</span></div>
<div class="line"><span id="3038" class="lineNum"><a href="#3038">3038</a></span><span class="counterCov">2</span><span class="lineCov">                    let discovered_sources = dmx_recv.get_discovered_sources();</span></div>
<div class="line"><span id="3039" class="lineNum"><a href="#3039">3039</a></span><span class="counterCov">2</span><span class="lineCov">                    assert_eq!(discovered_sources.len(), 1);</span></div>
<div class="line"><span id="3040" class="lineNum"><a href="#3040">3040</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="3041" class="lineNum"><a href="#3041">3041</a></span><span class="counterUnCov"></span><span class="lineUnCov">                    // Found the source so don&#39;t want to be notified about other sources.</span></div>
<div class="line"><span id="3042" class="lineNum"><a href="#3042">3042</a></span><span class="counterCov">2</span><span class="lineCov">                    dmx_recv.set_announce_source_discovery(false);</span></div>
<div class="line"><span id="3043" class="lineNum"><a href="#3043">3043</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="3044" class="lineNum"><a href="#3044">3044</a></span><span class="counterUnCov"></span><span class="lineUnCov">                    // Do want to be notified about stream termination in this case.</span></div>
<div class="line"><span id="3045" class="lineNum"><a href="#3045">3045</a></span><span class="counterCov">2</span><span class="lineCov">                    dmx_recv.set_announce_stream_termination(true);</span></div>
<div class="line"><span id="3046" class="lineNum"><a href="#3046">3046</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="3047" class="lineNum"><a href="#3047">3047</a></span><span class="counterCov">2</span><span class="lineCov">                    discovered_sources[0].get_all_universes()</span></div>
<div class="line"><span id="3048" class="lineNum"><a href="#3048">3048</a></span><span class="counterCov">2</span><span class="lineCov">                }</span></div>
<div class="line"><span id="3049" class="lineNum"><a href="#3049">3049</a></span><span class="counterUnCov"></span><span class="lineUnCov">                _ =&gt; {</span></div>
<div class="line"><span id="3050" class="lineNum"><a href="#3050">3050</a></span><span class="counterUnCov"></span><span class="lineUnCov">                    // A real-user would want to look at using more detailed error handling as appropriate to their use case but for this test panic </span></div>
<div class="line"><span id="3051" class="lineNum"><a href="#3051">3051</a></span><span class="counterUnCov"></span><span class="lineUnCov">                    // (which will fail the test) is suitable.</span></div>
<div class="line"><span id="3052" class="lineNum"><a href="#3052">3052</a></span><span class="counterNoCov">0</span><span class="lineNoCov">                    panic!(&quot;Unexpected error&quot;);</span></div>
<div class="line"><span id="3053" class="lineNum"><a href="#3053">3053</a></span><span class="counterUnCov"></span><span class="lineUnCov">                }</span></div>
<div class="line"><span id="3054" class="lineNum"><a href="#3054">3054</a></span><span class="counterUnCov"></span><span class="lineUnCov">            }</span></div>
<div class="line"><span id="3055" class="lineNum"><a href="#3055">3055</a></span><span class="counterUnCov"></span><span class="lineUnCov">        }</span></div>
<div class="line"><span id="3056" class="lineNum"><a href="#3056">3056</a></span><span class="counterCov">2</span><span class="lineCov">        Ok(_) =&gt; {</span></div>
<div class="line"><span id="3057" class="lineNum"><a href="#3057">3057</a></span><span class="counterNoCov">0</span><span class="lineNoCov">            panic!(&quot;Unexpected data packet before any data universes registered&quot;);</span></div>
<div class="line"><span id="3058" class="lineNum"><a href="#3058">3058</a></span><span class="counterUnCov"></span><span class="lineUnCov">        }</span></div>
<div class="line"><span id="3059" class="lineNum"><a href="#3059">3059</a></span><span class="counterCov">2</span><span class="lineCov">    };</span></div>
<div class="line"><span id="3060" class="lineNum"><a href="#3060">3060</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="3061" class="lineNum"><a href="#3061">3061</a></span><span class="counterCov">2</span><span class="lineCov">    dmx_recv.listen_universes(&amp;universes).unwrap(); // Assert Successful</span></div>
<div class="line"><span id="3062" class="lineNum"><a href="#3062">3062</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="3063" class="lineNum"><a href="#3063">3063</a></span><span class="counterCov">368</span><span class="lineCov">    loop {</span></div>
<div class="line"><span id="3064" class="lineNum"><a href="#3064">3064</a></span><span class="counterCov">368</span><span class="lineCov">        match dmx_recv.recv(None) {</span></div>
<div class="line"><span id="3065" class="lineNum"><a href="#3065">3065</a></span><span class="counterCov">368</span><span class="lineCov">            Err(e) =&gt; {</span></div>
<div class="line"><span id="3066" class="lineNum"><a href="#3066">3066</a></span><span class="counterCov">2</span><span class="lineCov">                match e.kind() {</span></div>
<div class="line"><span id="3067" class="lineNum"><a href="#3067">3067</a></span><span class="counterCov">2</span><span class="lineCov">                    ErrorKind::UniverseTerminated(_src_cid, _universe) =&gt; {</span></div>
<div class="line"><span id="3068" class="lineNum"><a href="#3068">3068</a></span><span class="counterUnCov"></span><span class="lineUnCov">                        // A real use-case may also want to not terminate when the source does and instead remain waiting but in this</span></div>
<div class="line"><span id="3069" class="lineNum"><a href="#3069">3069</a></span><span class="counterUnCov"></span><span class="lineUnCov">                        // case the for the test the receiver terminates with the source.</span></div>
<div class="line"><span id="3070" class="lineNum"><a href="#3070">3070</a></span><span class="counterUnCov"></span><span class="lineUnCov">                        break;</span></div>
<div class="line"><span id="3071" class="lineNum"><a href="#3071">3071</a></span><span class="counterUnCov"></span><span class="lineUnCov">                    }</span></div>
<div class="line"><span id="3072" class="lineNum"><a href="#3072">3072</a></span><span class="counterUnCov"></span><span class="lineUnCov">                    _ =&gt; {</span></div>
<div class="line"><span id="3073" class="lineNum"><a href="#3073">3073</a></span><span class="counterNoCov">0</span><span class="lineNoCov">                        assert!(false, &quot;Unexpected error returned&quot;);</span></div>
<div class="line"><span id="3074" class="lineNum"><a href="#3074">3074</a></span><span class="counterUnCov"></span><span class="lineUnCov">                    }</span></div>
<div class="line"><span id="3075" class="lineNum"><a href="#3075">3075</a></span><span class="counterUnCov"></span><span class="lineUnCov">                }</span></div>
<div class="line"><span id="3076" class="lineNum"><a href="#3076">3076</a></span><span class="counterUnCov"></span><span class="lineUnCov">            }</span></div>
<div class="line"><span id="3077" class="lineNum"><a href="#3077">3077</a></span><span class="counterCov">368</span><span class="lineCov">            Ok(rcv_data) =&gt; {</span></div>
<div class="line"><span id="3078" class="lineNum"><a href="#3078">3078</a></span><span class="counterCov">366</span><span class="lineCov">                assert_eq!(rcv_data.len(), DATA_PACKETS_PER_SYNC_PACKET);</span></div>
<div class="line"><span id="3079" class="lineNum"><a href="#3079">3079</a></span><span class="counterCov">732</span><span class="lineCov">                if rcv_data[0].universe == DATA_UNIVERSES[0] {</span></div>
<div class="line"><span id="3080" class="lineNum"><a href="#3080">3080</a></span><span class="counterCov">366</span><span class="lineCov">                    assert_eq!(rcv_data[0].values, DATA, &quot;Unexpected data within first data packet of a set of synchronised packets&quot;);</span></div>
<div class="line"><span id="3081" class="lineNum"><a href="#3081">3081</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="3082" class="lineNum"><a href="#3082">3082</a></span><span class="counterCov">366</span><span class="lineCov">                    assert_eq!(rcv_data[1].universe, DATA_UNIVERSES[1], &quot;Unrecognised universe as second data packet in set of synchronised packets&quot;);</span></div>
<div class="line"><span id="3083" class="lineNum"><a href="#3083">3083</a></span><span class="counterCov">366</span><span class="lineCov">                    assert_eq!(rcv_data[1].values, DATA2, &quot;Unexpected data within second data packet of a set of synchronised packets&quot;);</span></div>
<div class="line"><span id="3084" class="lineNum"><a href="#3084">3084</a></span><span class="counterNoCov">0</span><span class="lineNoCov">                } else if rcv_data[0].universe == DATA_UNIVERSES[1] {</span></div>
<div class="line"><span id="3085" class="lineNum"><a href="#3085">3085</a></span><span class="counterNoCov">0</span><span class="lineNoCov">                    assert_eq!(rcv_data[0].values, DATA2, &quot;Unexpected data within first data packet of a set of synchronised packets&quot;);</span></div>
<div class="line"><span id="3086" class="lineNum"><a href="#3086">3086</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="3087" class="lineNum"><a href="#3087">3087</a></span><span class="counterNoCov">0</span><span class="lineNoCov">                    assert_eq!(rcv_data[1].universe, DATA_UNIVERSES[0], &quot;Unrecognised universe as second data packet in set of synchronised packets&quot;);</span></div>
<div class="line"><span id="3088" class="lineNum"><a href="#3088">3088</a></span><span class="counterNoCov">0</span><span class="lineNoCov">                    assert_eq!(rcv_data[1].values, DATA, &quot;Unexpected data within second data packet of a set of synchronised packets&quot;);</span></div>
<div class="line"><span id="3089" class="lineNum"><a href="#3089">3089</a></span><span class="counterUnCov"></span><span class="lineUnCov">                } else {</span></div>
<div class="line"><span id="3090" class="lineNum"><a href="#3090">3090</a></span><span class="counterNoCov">0</span><span class="lineNoCov">                    assert!(false, &quot;Unrecognised universe within data packet&quot;);</span></div>
<div class="line"><span id="3091" class="lineNum"><a href="#3091">3091</a></span><span class="counterUnCov"></span><span class="lineUnCov">                }</span></div>
<div class="line"><span id="3092" class="lineNum"><a href="#3092">3092</a></span><span class="counterUnCov"></span><span class="lineUnCov">            } </span></div>
<div class="line"><span id="3093" class="lineNum"><a href="#3093">3093</a></span><span class="counterCov">366</span><span class="lineCov">        }</span></div>
<div class="line"><span id="3094" class="lineNum"><a href="#3094">3094</a></span><span class="counterUnCov"></span><span class="lineUnCov">    }</span></div>
<div class="line"><span id="3095" class="lineNum"><a href="#3095">3095</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="3096" class="lineNum"><a href="#3096">3096</a></span><span class="counterUnCov"></span><span class="lineUnCov">    // Finished receiving from the sender.</span></div>
<div class="line"><span id="3097" class="lineNum"><a href="#3097">3097</a></span><span class="counterCov">2</span><span class="lineCov">    snd_thread.join().unwrap();</span></div>
<div class="line"><span id="3098" class="lineNum"><a href="#3098">3098</a></span><span class="counterCov">4</span><span class="lineCov">}</span></div>
<div class="line"><span id="3099" class="lineNum"><a href="#3099">3099</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="3100" class="lineNum"><a href="#3100">3100</a></span><span class="counterUnCov"></span><span class="lineUnCov">/// Generates a data packet as raw bytes with the given parameters.</span></div>
<div class="line"><span id="3101" class="lineNum"><a href="#3101">3101</a></span><span class="counterUnCov"></span><span class="lineUnCov">/// Assert parameters are correct sizes / in-range as appropriate.</span></div>
<div class="line"><span id="3102" class="lineNum"><a href="#3102">3102</a></span><span class="counterCov">3002</span><span class="lineCov">fn generate_data_packet_raw(cid: [u8; 16], universe: u16, source_name: String, priority: u8, seq_num: u8, options: u8, dmx_data: Vec&lt;u8&gt;) -&gt; Vec&lt;u8&gt; {</span></div>
<div class="line"><span id="3103" class="lineNum"><a href="#3103">3103</a></span><span class="counterCov">3002</span><span class="lineCov">    assert!(universe &gt;= E131_MIN_MULTICAST_UNIVERSE &amp;&amp; universe &lt;= E131_MAX_MULTICAST_UNIVERSE, &quot;Generated data packet universe out of range&quot;);</span></div>
<div class="line"><span id="3104" class="lineNum"><a href="#3104">3104</a></span><span class="counterCov">3002</span><span class="lineCov">    assert!(priority &lt;= E131_MAX_PRIORITY, &quot;Generated data packet priority too high&quot;);</span></div>
<div class="line"><span id="3105" class="lineNum"><a href="#3105">3105</a></span><span class="counterCov">3002</span><span class="lineCov">    assert!(dmx_data.len() &lt;= UNIVERSE_CHANNEL_CAPACITY);</span></div>
<div class="line"><span id="3106" class="lineNum"><a href="#3106">3106</a></span><span class="counterCov">3002</span><span class="lineCov">    assert_eq!(source_name.len(), 64);</span></div>
<div class="line"><span id="3107" class="lineNum"><a href="#3107">3107</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="3108" class="lineNum"><a href="#3108">3108</a></span><span class="counterUnCov"></span><span class="lineUnCov">    // Root ACN Layer</span></div>
<div class="line"><span id="3109" class="lineNum"><a href="#3109">3109</a></span><span class="counterCov">3002</span><span class="lineCov">    let mut packet = Vec::new();</span></div>
<div class="line"><span id="3110" class="lineNum"><a href="#3110">3110</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="3111" class="lineNum"><a href="#3111">3111</a></span><span class="counterUnCov"></span><span class="lineUnCov">    // Preamble Size</span></div>
<div class="line"><span id="3112" class="lineNum"><a href="#3112">3112</a></span><span class="counterCov">3002</span><span class="lineCov">    packet.extend(&quot;\x00\x10&quot;.bytes());</span></div>
<div class="line"><span id="3113" class="lineNum"><a href="#3113">3113</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="3114" class="lineNum"><a href="#3114">3114</a></span><span class="counterUnCov"></span><span class="lineUnCov">    // Post-amble Size</span></div>
<div class="line"><span id="3115" class="lineNum"><a href="#3115">3115</a></span><span class="counterCov">3002</span><span class="lineCov">    packet.extend(&quot;\x00\x00&quot;.bytes());</span></div>
<div class="line"><span id="3116" class="lineNum"><a href="#3116">3116</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="3117" class="lineNum"><a href="#3117">3117</a></span><span class="counterUnCov"></span><span class="lineUnCov">    // ACN Packet Identifier</span></div>
<div class="line"><span id="3118" class="lineNum"><a href="#3118">3118</a></span><span class="counterCov">3002</span><span class="lineCov">    packet.extend(&quot;\x41\x53\x43\x2d\x45\x31\x2e\x31\x37\x00\x00\x00&quot;.bytes());</span></div>
<div class="line"><span id="3119" class="lineNum"><a href="#3119">3119</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="3120" class="lineNum"><a href="#3120">3120</a></span><span class="counterUnCov"></span><span class="lineUnCov">    // Flags and Length (22 + 343)</span></div>
<div class="line"><span id="3121" class="lineNum"><a href="#3121">3121</a></span><span class="counterCov">3002</span><span class="lineCov">    packet.push(0b01110001);</span></div>
<div class="line"><span id="3122" class="lineNum"><a href="#3122">3122</a></span><span class="counterCov">3002</span><span class="lineCov">    packet.push(0b01101101);</span></div>
<div class="line"><span id="3123" class="lineNum"><a href="#3123">3123</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="3124" class="lineNum"><a href="#3124">3124</a></span><span class="counterUnCov"></span><span class="lineUnCov">    // Vector</span></div>
<div class="line"><span id="3125" class="lineNum"><a href="#3125">3125</a></span><span class="counterCov">3002</span><span class="lineCov">    packet.extend(&quot;\x00\x00\x00\x04&quot;.bytes());</span></div>
<div class="line"><span id="3126" class="lineNum"><a href="#3126">3126</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="3127" class="lineNum"><a href="#3127">3127</a></span><span class="counterUnCov"></span><span class="lineUnCov">    // CID</span></div>
<div class="line"><span id="3128" class="lineNum"><a href="#3128">3128</a></span><span class="counterCov">3002</span><span class="lineCov">    packet.extend(&amp;cid);</span></div>
<div class="line"><span id="3129" class="lineNum"><a href="#3129">3129</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="3130" class="lineNum"><a href="#3130">3130</a></span><span class="counterUnCov"></span><span class="lineUnCov">    // E1.31 Framing Layer</span></div>
<div class="line"><span id="3131" class="lineNum"><a href="#3131">3131</a></span><span class="counterUnCov"></span><span class="lineUnCov">    // Flags and Length (77 + 266)</span></div>
<div class="line"><span id="3132" class="lineNum"><a href="#3132">3132</a></span><span class="counterCov">3002</span><span class="lineCov">    packet.push(0b01110001);</span></div>
<div class="line"><span id="3133" class="lineNum"><a href="#3133">3133</a></span><span class="counterCov">3002</span><span class="lineCov">    packet.push(0b01010111);</span></div>
<div class="line"><span id="3134" class="lineNum"><a href="#3134">3134</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="3135" class="lineNum"><a href="#3135">3135</a></span><span class="counterUnCov"></span><span class="lineUnCov">    // Vector</span></div>
<div class="line"><span id="3136" class="lineNum"><a href="#3136">3136</a></span><span class="counterCov">3002</span><span class="lineCov">    packet.extend(&quot;\x00\x00\x00\x02&quot;.bytes());</span></div>
<div class="line"><span id="3137" class="lineNum"><a href="#3137">3137</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="3138" class="lineNum"><a href="#3138">3138</a></span><span class="counterUnCov"></span><span class="lineUnCov">    // Source Name</span></div>
<div class="line"><span id="3139" class="lineNum"><a href="#3139">3139</a></span><span class="counterCov">3002</span><span class="lineCov">    packet.extend(source_name.bytes());</span></div>
<div class="line"><span id="3140" class="lineNum"><a href="#3140">3140</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="3141" class="lineNum"><a href="#3141">3141</a></span><span class="counterUnCov"></span><span class="lineUnCov">    // Priority</span></div>
<div class="line"><span id="3142" class="lineNum"><a href="#3142">3142</a></span><span class="counterCov">3002</span><span class="lineCov">    packet.push(priority);</span></div>
<div class="line"><span id="3143" class="lineNum"><a href="#3143">3143</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="3144" class="lineNum"><a href="#3144">3144</a></span><span class="counterUnCov"></span><span class="lineUnCov">    // Reserved</span></div>
<div class="line"><span id="3145" class="lineNum"><a href="#3145">3145</a></span><span class="counterCov">3002</span><span class="lineCov">    packet.extend(&quot;\x00\x00&quot;.bytes());</span></div>
<div class="line"><span id="3146" class="lineNum"><a href="#3146">3146</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="3147" class="lineNum"><a href="#3147">3147</a></span><span class="counterUnCov"></span><span class="lineUnCov">    // Sequence Number</span></div>
<div class="line"><span id="3148" class="lineNum"><a href="#3148">3148</a></span><span class="counterCov">3002</span><span class="lineCov">    packet.push(seq_num);</span></div>
<div class="line"><span id="3149" class="lineNum"><a href="#3149">3149</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="3150" class="lineNum"><a href="#3150">3150</a></span><span class="counterUnCov"></span><span class="lineUnCov">    // Options</span></div>
<div class="line"><span id="3151" class="lineNum"><a href="#3151">3151</a></span><span class="counterCov">3002</span><span class="lineCov">    packet.push(options);</span></div>
<div class="line"><span id="3152" class="lineNum"><a href="#3152">3152</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="3153" class="lineNum"><a href="#3153">3153</a></span><span class="counterUnCov"></span><span class="lineUnCov">    // Universe, conversion to BigEndian bytes as Network Byte Order is BigEndian.</span></div>
<div class="line"><span id="3154" class="lineNum"><a href="#3154">3154</a></span><span class="counterCov">3002</span><span class="lineCov">    let universe_bytes = universe.to_be_bytes();</span></div>
<div class="line"><span id="3155" class="lineNum"><a href="#3155">3155</a></span><span class="counterCov">3002</span><span class="lineCov">    packet.push(universe_bytes[0]);</span></div>
<div class="line"><span id="3156" class="lineNum"><a href="#3156">3156</a></span><span class="counterCov">3002</span><span class="lineCov">    packet.push(universe_bytes[1]);</span></div>
<div class="line"><span id="3157" class="lineNum"><a href="#3157">3157</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="3158" class="lineNum"><a href="#3158">3158</a></span><span class="counterUnCov"></span><span class="lineUnCov">    // DMP Layer</span></div>
<div class="line"><span id="3159" class="lineNum"><a href="#3159">3159</a></span><span class="counterUnCov"></span><span class="lineUnCov">    // Flags and Length (266)</span></div>
<div class="line"><span id="3160" class="lineNum"><a href="#3160">3160</a></span><span class="counterCov">3002</span><span class="lineCov">    packet.push(0b01110001);</span></div>
<div class="line"><span id="3161" class="lineNum"><a href="#3161">3161</a></span><span class="counterCov">3002</span><span class="lineCov">    packet.push(0b00001010);</span></div>
<div class="line"><span id="3162" class="lineNum"><a href="#3162">3162</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="3163" class="lineNum"><a href="#3163">3163</a></span><span class="counterUnCov"></span><span class="lineUnCov">    // Vector</span></div>
<div class="line"><span id="3164" class="lineNum"><a href="#3164">3164</a></span><span class="counterCov">3002</span><span class="lineCov">    packet.push(0x02);</span></div>
<div class="line"><span id="3165" class="lineNum"><a href="#3165">3165</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="3166" class="lineNum"><a href="#3166">3166</a></span><span class="counterUnCov"></span><span class="lineUnCov">    // Address Type &amp; Data Type</span></div>
<div class="line"><span id="3167" class="lineNum"><a href="#3167">3167</a></span><span class="counterCov">3002</span><span class="lineCov">    packet.push(0xa1);</span></div>
<div class="line"><span id="3168" class="lineNum"><a href="#3168">3168</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="3169" class="lineNum"><a href="#3169">3169</a></span><span class="counterUnCov"></span><span class="lineUnCov">    // First Property Address</span></div>
<div class="line"><span id="3170" class="lineNum"><a href="#3170">3170</a></span><span class="counterCov">3002</span><span class="lineCov">    packet.extend(&quot;\x00\x00&quot;.bytes());</span></div>
<div class="line"><span id="3171" class="lineNum"><a href="#3171">3171</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="3172" class="lineNum"><a href="#3172">3172</a></span><span class="counterUnCov"></span><span class="lineUnCov">    // Address Increment</span></div>
<div class="line"><span id="3173" class="lineNum"><a href="#3173">3173</a></span><span class="counterCov">3002</span><span class="lineCov">    packet.extend(&quot;\x00\x01&quot;.bytes());</span></div>
<div class="line"><span id="3174" class="lineNum"><a href="#3174">3174</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="3175" class="lineNum"><a href="#3175">3175</a></span><span class="counterUnCov"></span><span class="lineUnCov">    // Property value count = 255.</span></div>
<div class="line"><span id="3176" class="lineNum"><a href="#3176">3176</a></span><span class="counterCov">3002</span><span class="lineCov">    packet.push(0b1);</span></div>
<div class="line"><span id="3177" class="lineNum"><a href="#3177">3177</a></span><span class="counterCov">3002</span><span class="lineCov">    packet.push(0b00000000);</span></div>
<div class="line"><span id="3178" class="lineNum"><a href="#3178">3178</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="3179" class="lineNum"><a href="#3179">3179</a></span><span class="counterUnCov"></span><span class="lineUnCov">    // Property values</span></div>
<div class="line"><span id="3180" class="lineNum"><a href="#3180">3180</a></span><span class="counterCov">3002</span><span class="lineCov">    packet.extend(&amp;dmx_data);</span></div>
<div class="line"><span id="3181" class="lineNum"><a href="#3181">3181</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="3182" class="lineNum"><a href="#3182">3182</a></span><span class="counterCov">3002</span><span class="lineCov">    packet</span></div>
<div class="line"><span id="3183" class="lineNum"><a href="#3183">3183</a></span><span class="counterCov">3002</span><span class="lineCov">}</span></div>
<div class="line"><span id="3184" class="lineNum"><a href="#3184">3184</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="3185" class="lineNum"><a href="#3185">3185</a></span><span class="counterUnCov"></span><span class="lineUnCov">/// Generates a sync packet as raw bytes with the given parameters.</span></div>
<div class="line"><span id="3186" class="lineNum"><a href="#3186">3186</a></span><span class="counterCov">4502</span><span class="lineCov">fn generate_sync_packet_raw(cid: [u8; 16], sync_addr: u16, seq_num: u8) -&gt; Vec&lt;u8&gt; {</span></div>
<div class="line"><span id="3187" class="lineNum"><a href="#3187">3187</a></span><span class="counterUnCov"></span><span class="lineUnCov">    // Root ACN Layer</span></div>
<div class="line"><span id="3188" class="lineNum"><a href="#3188">3188</a></span><span class="counterCov">4502</span><span class="lineCov">    let mut sync_packet = Vec::new();</span></div>
<div class="line"><span id="3189" class="lineNum"><a href="#3189">3189</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="3190" class="lineNum"><a href="#3190">3190</a></span><span class="counterUnCov"></span><span class="lineUnCov">    // Preamble Size</span></div>
<div class="line"><span id="3191" class="lineNum"><a href="#3191">3191</a></span><span class="counterCov">4502</span><span class="lineCov">    sync_packet.extend(&quot;\x00\x10&quot;.bytes());</span></div>
<div class="line"><span id="3192" class="lineNum"><a href="#3192">3192</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="3193" class="lineNum"><a href="#3193">3193</a></span><span class="counterUnCov"></span><span class="lineUnCov">    // Post-amble Size</span></div>
<div class="line"><span id="3194" class="lineNum"><a href="#3194">3194</a></span><span class="counterCov">4502</span><span class="lineCov">    sync_packet.extend(&quot;\x00\x00&quot;.bytes());</span></div>
<div class="line"><span id="3195" class="lineNum"><a href="#3195">3195</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="3196" class="lineNum"><a href="#3196">3196</a></span><span class="counterUnCov"></span><span class="lineUnCov">    // ACN Packet Identifier</span></div>
<div class="line"><span id="3197" class="lineNum"><a href="#3197">3197</a></span><span class="counterCov">4502</span><span class="lineCov">    sync_packet.extend(&quot;\x41\x53\x43\x2d\x45\x31\x2e\x31\x37\x00\x00\x00&quot;.bytes());</span></div>
<div class="line"><span id="3198" class="lineNum"><a href="#3198">3198</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="3199" class="lineNum"><a href="#3199">3199</a></span><span class="counterUnCov"></span><span class="lineUnCov">    // Flags and Length (0x70, 33)</span></div>
<div class="line"><span id="3200" class="lineNum"><a href="#3200">3200</a></span><span class="counterCov">4502</span><span class="lineCov">    sync_packet.push(0b01110000);</span></div>
<div class="line"><span id="3201" class="lineNum"><a href="#3201">3201</a></span><span class="counterCov">4502</span><span class="lineCov">    sync_packet.push(0b00100001);</span></div>
<div class="line"><span id="3202" class="lineNum"><a href="#3202">3202</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="3203" class="lineNum"><a href="#3203">3203</a></span><span class="counterUnCov"></span><span class="lineUnCov">    // Vector, VECTOR_ROOT_E131_EXTENDED as per ANSI E1.31-2018 Section 4.2 Table 4-2.</span></div>
<div class="line"><span id="3204" class="lineNum"><a href="#3204">3204</a></span><span class="counterCov">4502</span><span class="lineCov">    sync_packet.extend(&quot;\x00\x00\x00\x08&quot;.bytes());</span></div>
<div class="line"><span id="3205" class="lineNum"><a href="#3205">3205</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="3206" class="lineNum"><a href="#3206">3206</a></span><span class="counterUnCov"></span><span class="lineUnCov">    // CID</span></div>
<div class="line"><span id="3207" class="lineNum"><a href="#3207">3207</a></span><span class="counterCov">4502</span><span class="lineCov">    sync_packet.extend(&amp;cid);</span></div>
<div class="line"><span id="3208" class="lineNum"><a href="#3208">3208</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="3209" class="lineNum"><a href="#3209">3209</a></span><span class="counterUnCov"></span><span class="lineUnCov">    // E1.31 Framing Layer</span></div>
<div class="line"><span id="3210" class="lineNum"><a href="#3210">3210</a></span><span class="counterUnCov"></span><span class="lineUnCov">    // Flags and Length (0x70, 11)</span></div>
<div class="line"><span id="3211" class="lineNum"><a href="#3211">3211</a></span><span class="counterCov">4502</span><span class="lineCov">    sync_packet.push(0b01110000);</span></div>
<div class="line"><span id="3212" class="lineNum"><a href="#3212">3212</a></span><span class="counterCov">4502</span><span class="lineCov">    sync_packet.push(0b00001011);</span></div>
<div class="line"><span id="3213" class="lineNum"><a href="#3213">3213</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="3214" class="lineNum"><a href="#3214">3214</a></span><span class="counterUnCov"></span><span class="lineUnCov">    // Vector, VECTOR_E131_EXTENDED_SYNCHRONISATION as per ANSI E1.31-2018 Appendix A.</span></div>
<div class="line"><span id="3215" class="lineNum"><a href="#3215">3215</a></span><span class="counterCov">4502</span><span class="lineCov">    sync_packet.extend(&quot;\x00\x00\x00\x01&quot;.bytes());</span></div>
<div class="line"><span id="3216" class="lineNum"><a href="#3216">3216</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="3217" class="lineNum"><a href="#3217">3217</a></span><span class="counterUnCov"></span><span class="lineUnCov">    // Sequence Number</span></div>
<div class="line"><span id="3218" class="lineNum"><a href="#3218">3218</a></span><span class="counterCov">4502</span><span class="lineCov">    sync_packet.push(seq_num);</span></div>
<div class="line"><span id="3219" class="lineNum"><a href="#3219">3219</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="3220" class="lineNum"><a href="#3220">3220</a></span><span class="counterUnCov"></span><span class="lineUnCov">    // Synchronisation Address, conversion to BigEndian bytes as Network Byte Order is BigEndian.</span></div>
<div class="line"><span id="3221" class="lineNum"><a href="#3221">3221</a></span><span class="counterCov">4502</span><span class="lineCov">    let sync_addr_bytes = sync_addr.to_be_bytes();</span></div>
<div class="line"><span id="3222" class="lineNum"><a href="#3222">3222</a></span><span class="counterCov">4502</span><span class="lineCov">    sync_packet.push(sync_addr_bytes[0]);</span></div>
<div class="line"><span id="3223" class="lineNum"><a href="#3223">3223</a></span><span class="counterCov">4502</span><span class="lineCov">    sync_packet.push(sync_addr_bytes[1]);</span></div>
<div class="line"><span id="3224" class="lineNum"><a href="#3224">3224</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="3225" class="lineNum"><a href="#3225">3225</a></span><span class="counterUnCov"></span><span class="lineUnCov">    // Reserve bytes as 0 as per ANSI E1.31-2018 Section 6.3.4.</span></div>
<div class="line"><span id="3226" class="lineNum"><a href="#3226">3226</a></span><span class="counterCov">4502</span><span class="lineCov">    sync_packet.push(0);</span></div>
<div class="line"><span id="3227" class="lineNum"><a href="#3227">3227</a></span><span class="counterCov">4502</span><span class="lineCov">    sync_packet.push(0);</span></div>
<div class="line"><span id="3228" class="lineNum"><a href="#3228">3228</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="3229" class="lineNum"><a href="#3229">3229</a></span><span class="counterCov">4502</span><span class="lineCov">    sync_packet</span></div>
<div class="line"><span id="3230" class="lineNum"><a href="#3230">3230</a></span><span class="counterCov">4502</span><span class="lineCov">}</span></div>
<div class="line"><span id="3231" class="lineNum"><a href="#3231">3231</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="3232" class="lineNum"><a href="#3232">3232</a></span><span class="counterUnCov"></span><span class="lineUnCov">/// Creates a test data packet and tests sending it to a udp socket and then checking that the output bytes match expected.</span></div>
<div class="line"><span id="3233" class="lineNum"><a href="#3233">3233</a></span><span class="counterUnCov"></span><span class="lineUnCov">/// This shows that the SacnSource sends a data packet in the correct format.</span></div>
<div class="line"><span id="3234" class="lineNum"><a href="#3234">3234</a></span><span class="counterUnCov"></span><span class="lineUnCov">/// </span></div>
<div class="line"><span id="3235" class="lineNum"><a href="#3235">3235</a></span><span class="counterUnCov"></span><span class="lineUnCov">/// The use of a UDP socket also shows that the protocol uses UDP at the transport layer.</span></div>
<div class="line"><span id="3236" class="lineNum"><a href="#3236">3236</a></span><span class="counterUnCov"></span><span class="lineUnCov">/// </span></div>
<div class="line"><span id="3237" class="lineNum"><a href="#3237">3237</a></span><span class="counterUnCov"></span><span class="lineUnCov">#[test]</span></div>
<div class="line"><span id="3238" class="lineNum"><a href="#3238">3238</a></span><span class="counterUnCov"></span><span class="lineUnCov">#[cfg_attr(rustfmt, rustfmt_skip)]</span></div>
<div class="line"><span id="3239" class="lineNum"><a href="#3239">3239</a></span><span class="counterCov">4</span><span class="lineCov">fn test_data_packet_transmit_format() {</span></div>
<div class="line"><span id="3240" class="lineNum"><a href="#3240">3240</a></span><span class="counterUnCov"></span><span class="lineUnCov">    const CID: [u8; 16] = [0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15];</span></div>
<div class="line"><span id="3241" class="lineNum"><a href="#3241">3241</a></span><span class="counterUnCov"></span><span class="lineUnCov">    const OPTIONS: u8 = 0; // Checks that the options field is transmitted as 0&#39;s.</span></div>
<div class="line"><span id="3242" class="lineNum"><a href="#3242">3242</a></span><span class="counterUnCov"></span><span class="lineUnCov">    const PRIORITY: u8 = 150;</span></div>
<div class="line"><span id="3243" class="lineNum"><a href="#3243">3243</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="3244" class="lineNum"><a href="#3244">3244</a></span><span class="counterCov">2</span><span class="lineCov">    let universe: u16 = 1;</span></div>
<div class="line"><span id="3245" class="lineNum"><a href="#3245">3245</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="3246" class="lineNum"><a href="#3246">3246</a></span><span class="counterCov">2</span><span class="lineCov">    let source_name = &quot;SourceName&quot;.to_string() +</span></div>
<div class="line"><span id="3247" class="lineNum"><a href="#3247">3247</a></span><span class="counterUnCov"></span><span class="lineUnCov">                        &quot;\0\0\0\0\0\0\0\0\0\0&quot; +</span></div>
<div class="line"><span id="3248" class="lineNum"><a href="#3248">3248</a></span><span class="counterUnCov"></span><span class="lineUnCov">                        &quot;\0\0\0\0\0\0\0\0\0\0&quot; +</span></div>
<div class="line"><span id="3249" class="lineNum"><a href="#3249">3249</a></span><span class="counterUnCov"></span><span class="lineUnCov">                        &quot;\0\0\0\0\0\0\0\0\0\0&quot; +</span></div>
<div class="line"><span id="3250" class="lineNum"><a href="#3250">3250</a></span><span class="counterUnCov"></span><span class="lineUnCov">                        &quot;\0\0\0\0\0\0\0\0\0\0&quot; +</span></div>
<div class="line"><span id="3251" class="lineNum"><a href="#3251">3251</a></span><span class="counterUnCov"></span><span class="lineUnCov">                        &quot;\0\0\0\0\0\0\0\0\0\0&quot; +</span></div>
<div class="line"><span id="3252" class="lineNum"><a href="#3252">3252</a></span><span class="counterUnCov"></span><span class="lineUnCov">                        &quot;\0\0\0\0&quot;;</span></div>
<div class="line"><span id="3253" class="lineNum"><a href="#3253">3253</a></span><span class="counterUnCov"></span><span class="lineUnCov">    </span></div>
<div class="line"><span id="3254" class="lineNum"><a href="#3254">3254</a></span><span class="counterCov">2</span><span class="lineCov">    let sequence = 0;</span></div>
<div class="line"><span id="3255" class="lineNum"><a href="#3255">3255</a></span><span class="counterCov">2</span><span class="lineCov">    let mut dmx_data: Vec&lt;u8&gt; = Vec::new();</span></div>
<div class="line"><span id="3256" class="lineNum"><a href="#3256">3256</a></span><span class="counterCov">2</span><span class="lineCov">    dmx_data.push(0); // Start code</span></div>
<div class="line"><span id="3257" class="lineNum"><a href="#3257">3257</a></span><span class="counterCov">2</span><span class="lineCov">    dmx_data.extend(iter::repeat(100).take(255));</span></div>
<div class="line"><span id="3258" class="lineNum"><a href="#3258">3258</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="3259" class="lineNum"><a href="#3259">3259</a></span><span class="counterCov">2</span><span class="lineCov">    let packet = generate_data_packet_raw(CID, universe, source_name.clone(), PRIORITY, sequence, OPTIONS, dmx_data.clone());</span></div>
<div class="line"><span id="3260" class="lineNum"><a href="#3260">3260</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="3261" class="lineNum"><a href="#3261">3261</a></span><span class="counterCov">2</span><span class="lineCov">    let ip: SocketAddr = SocketAddr::new(IpAddr::V4(Ipv4Addr::new(0, 0, 0, 0)), ACN_SDT_MULTICAST_PORT + 1);</span></div>
<div class="line"><span id="3262" class="lineNum"><a href="#3262">3262</a></span><span class="counterCov">2</span><span class="lineCov">    let mut source = SacnSource::with_cid_ip(&amp;source_name.clone(), Uuid::from_bytes(&amp;CID).unwrap(), ip).unwrap();</span></div>
<div class="line"><span id="3263" class="lineNum"><a href="#3263">3263</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="3264" class="lineNum"><a href="#3264">3264</a></span><span class="counterCov">2</span><span class="lineCov">    source.set_preview_mode(false).unwrap();</span></div>
<div class="line"><span id="3265" class="lineNum"><a href="#3265">3265</a></span><span class="counterCov">2</span><span class="lineCov">    source.set_multicast_loop_v4(true).unwrap();</span></div>
<div class="line"><span id="3266" class="lineNum"><a href="#3266">3266</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="3267" class="lineNum"><a href="#3267">3267</a></span><span class="counterCov">2</span><span class="lineCov">    let recv_socket = Socket::new(Domain::ipv4(), Type::dgram(), None).unwrap();</span></div>
<div class="line"><span id="3268" class="lineNum"><a href="#3268">3268</a></span><span class="counterUnCov"></span><span class="lineUnCov">    </span></div>
<div class="line"><span id="3269" class="lineNum"><a href="#3269">3269</a></span><span class="counterCov">2</span><span class="lineCov">    let addr: SocketAddr = SocketAddr::new(IpAddr::V4(Ipv4Addr::UNSPECIFIED), ACN_SDT_MULTICAST_PORT);</span></div>
<div class="line"><span id="3270" class="lineNum"><a href="#3270">3270</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="3271" class="lineNum"><a href="#3271">3271</a></span><span class="counterCov">2</span><span class="lineCov">    recv_socket.bind(&amp;addr.into()).unwrap();</span></div>
<div class="line"><span id="3272" class="lineNum"><a href="#3272">3272</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="3273" class="lineNum"><a href="#3273">3273</a></span><span class="counterCov">2</span><span class="lineCov">    recv_socket.join_multicast_v4(&amp;Ipv4Addr::new(239, 255, 0, 1), &amp;Ipv4Addr::new(0, 0, 0, 0))</span></div>
<div class="line"><span id="3274" class="lineNum"><a href="#3274">3274</a></span><span class="counterUnCov"></span><span class="lineUnCov">                .unwrap();</span></div>
<div class="line"><span id="3275" class="lineNum"><a href="#3275">3275</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="3276" class="lineNum"><a href="#3276">3276</a></span><span class="counterCov">2</span><span class="lineCov">    let mut recv_buf = [0; 1024];</span></div>
<div class="line"><span id="3277" class="lineNum"><a href="#3277">3277</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="3278" class="lineNum"><a href="#3278">3278</a></span><span class="counterCov">2</span><span class="lineCov">    source.register_universes(&amp;[universe]).unwrap();</span></div>
<div class="line"><span id="3279" class="lineNum"><a href="#3279">3279</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="3280" class="lineNum"><a href="#3280">3280</a></span><span class="counterCov">2</span><span class="lineCov">    source.send(&amp;[universe], &amp;dmx_data, Some(PRIORITY), None, None).unwrap();</span></div>
<div class="line"><span id="3281" class="lineNum"><a href="#3281">3281</a></span><span class="counterCov">2</span><span class="lineCov">    let (amt, _) = recv_socket.recv_from(&amp;mut recv_buf).unwrap();</span></div>
<div class="line"><span id="3282" class="lineNum"><a href="#3282">3282</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="3283" class="lineNum"><a href="#3283">3283</a></span><span class="counterCov">2</span><span class="lineCov">    assert_eq!(&amp;packet[..], &amp;recv_buf[0..amt]);</span></div>
<div class="line"><span id="3284" class="lineNum"><a href="#3284">3284</a></span><span class="counterCov">4</span><span class="lineCov">}</span></div>
<div class="line"><span id="3285" class="lineNum"><a href="#3285">3285</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="3286" class="lineNum"><a href="#3286">3286</a></span><span class="counterUnCov"></span><span class="lineUnCov">/// Follows a similar process to test_data_packet_transmit_format by creating a SacnSender and then a receiving socket. The sender </span></div>
<div class="line"><span id="3287" class="lineNum"><a href="#3287">3287</a></span><span class="counterUnCov"></span><span class="lineUnCov">/// then terminates a stream and the receive socket receives and checks that the sender sent the correct number (3) of termination packets.</span></div>
<div class="line"><span id="3288" class="lineNum"><a href="#3288">3288</a></span><span class="counterUnCov"></span><span class="lineUnCov">#[test]</span></div>
<div class="line"><span id="3289" class="lineNum"><a href="#3289">3289</a></span><span class="counterCov">4</span><span class="lineCov">fn test_terminate_packet_transmit_format() {</span></div>
<div class="line"><span id="3290" class="lineNum"><a href="#3290">3290</a></span><span class="counterCov">2</span><span class="lineCov">    let cid = [0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15];</span></div>
<div class="line"><span id="3291" class="lineNum"><a href="#3291">3291</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="3292" class="lineNum"><a href="#3292">3292</a></span><span class="counterCov">2</span><span class="lineCov">    let ip: SocketAddr = SocketAddr::new(IpAddr::V4(Ipv4Addr::UNSPECIFIED), ACN_SDT_MULTICAST_PORT + 1);</span></div>
<div class="line"><span id="3293" class="lineNum"><a href="#3293">3293</a></span><span class="counterCov">2</span><span class="lineCov">    let mut source = SacnSource::with_cid_ip(&amp;&quot;Source&quot;, Uuid::from_bytes(&amp;cid).unwrap(), ip).unwrap();</span></div>
<div class="line"><span id="3294" class="lineNum"><a href="#3294">3294</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="3295" class="lineNum"><a href="#3295">3295</a></span><span class="counterCov">2</span><span class="lineCov">    source.set_multicast_loop_v4(true).unwrap();</span></div>
<div class="line"><span id="3296" class="lineNum"><a href="#3296">3296</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="3297" class="lineNum"><a href="#3297">3297</a></span><span class="counterCov">2</span><span class="lineCov">    let recv_socket = Socket::new(Domain::ipv4(), Type::dgram(), None).unwrap();</span></div>
<div class="line"><span id="3298" class="lineNum"><a href="#3298">3298</a></span><span class="counterUnCov"></span><span class="lineUnCov">    </span></div>
<div class="line"><span id="3299" class="lineNum"><a href="#3299">3299</a></span><span class="counterCov">2</span><span class="lineCov">    let addr: SocketAddr = SocketAddr::new(IpAddr::V4(Ipv4Addr::UNSPECIFIED), ACN_SDT_MULTICAST_PORT);</span></div>
<div class="line"><span id="3300" class="lineNum"><a href="#3300">3300</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="3301" class="lineNum"><a href="#3301">3301</a></span><span class="counterCov">2</span><span class="lineCov">    recv_socket.bind(&amp;addr.into()).unwrap();</span></div>
<div class="line"><span id="3302" class="lineNum"><a href="#3302">3302</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="3303" class="lineNum"><a href="#3303">3303</a></span><span class="counterCov">2</span><span class="lineCov">    recv_socket</span></div>
<div class="line"><span id="3304" class="lineNum"><a href="#3304">3304</a></span><span class="counterCov">2</span><span class="lineCov">        .join_multicast_v4(&amp;Ipv4Addr::new(239, 255, 0, 1), &amp;Ipv4Addr::new(0, 0, 0, 0))</span></div>
<div class="line"><span id="3305" class="lineNum"><a href="#3305">3305</a></span><span class="counterUnCov"></span><span class="lineUnCov">        .unwrap();</span></div>
<div class="line"><span id="3306" class="lineNum"><a href="#3306">3306</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="3307" class="lineNum"><a href="#3307">3307</a></span><span class="counterCov">2</span><span class="lineCov">    let mut recv_buf = [0; 1024];</span></div>
<div class="line"><span id="3308" class="lineNum"><a href="#3308">3308</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="3309" class="lineNum"><a href="#3309">3309</a></span><span class="counterCov">2</span><span class="lineCov">    let start_code: u8 = 0;</span></div>
<div class="line"><span id="3310" class="lineNum"><a href="#3310">3310</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="3311" class="lineNum"><a href="#3311">3311</a></span><span class="counterCov">2</span><span class="lineCov">    source.register_universes(&amp;[1]).unwrap();</span></div>
<div class="line"><span id="3312" class="lineNum"><a href="#3312">3312</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="3313" class="lineNum"><a href="#3313">3313</a></span><span class="counterCov">2</span><span class="lineCov">    source.terminate_stream(1, start_code).unwrap();</span></div>
<div class="line"><span id="3314" class="lineNum"><a href="#3314">3314</a></span><span class="counterCov">6</span><span class="lineCov">    for _ in 0..2 {</span></div>
<div class="line"><span id="3315" class="lineNum"><a href="#3315">3315</a></span><span class="counterCov">4</span><span class="lineCov">        recv_socket.recv_from(&amp;mut recv_buf).unwrap();</span></div>
<div class="line"><span id="3316" class="lineNum"><a href="#3316">3316</a></span><span class="counterCov">4</span><span class="lineCov">        assert_eq!(</span></div>
<div class="line"><span id="3317" class="lineNum"><a href="#3317">3317</a></span><span class="counterCov">4</span><span class="lineCov">            match AcnRootLayerProtocol::parse(&amp;recv_buf).unwrap().pdu.data {</span></div>
<div class="line"><span id="3318" class="lineNum"><a href="#3318">3318</a></span><span class="counterCov">4</span><span class="lineCov">                E131RootLayerData::DataPacket(data) =&gt; data.stream_terminated,</span></div>
<div class="line"><span id="3319" class="lineNum"><a href="#3319">3319</a></span><span class="counterNoCov">0</span><span class="lineNoCov">                _ =&gt; panic!(),</span></div>
<div class="line"><span id="3320" class="lineNum"><a href="#3320">3320</a></span><span class="counterUnCov"></span><span class="lineUnCov">            },</span></div>
<div class="line"><span id="3321" class="lineNum"><a href="#3321">3321</a></span><span class="counterUnCov"></span><span class="lineUnCov">            true</span></div>
<div class="line"><span id="3322" class="lineNum"><a href="#3322">3322</a></span><span class="counterUnCov"></span><span class="lineUnCov">        )</span></div>
<div class="line"><span id="3323" class="lineNum"><a href="#3323">3323</a></span><span class="counterCov">4</span><span class="lineCov">    }</span></div>
<div class="line"><span id="3324" class="lineNum"><a href="#3324">3324</a></span><span class="counterCov">4</span><span class="lineCov">}</span></div>
<div class="line"><span id="3325" class="lineNum"><a href="#3325">3325</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="3326" class="lineNum"><a href="#3326">3326</a></span><span class="counterUnCov"></span><span class="lineUnCov">/// Similar to test_data_packet_transmit_format, creates a SacnSender and then a receiver socket. The sender then sends</span></div>
<div class="line"><span id="3327" class="lineNum"><a href="#3327">3327</a></span><span class="counterUnCov"></span><span class="lineUnCov">/// a synchronisation packet and the receive socket receives the packet and checks that the format of the packet is as expected.</span></div>
<div class="line"><span id="3328" class="lineNum"><a href="#3328">3328</a></span><span class="counterUnCov"></span><span class="lineUnCov">/// </span></div>
<div class="line"><span id="3329" class="lineNum"><a href="#3329">3329</a></span><span class="counterUnCov"></span><span class="lineUnCov">/// The use of a UDP socket also shows that the protocol uses UDP at the transport layer.</span></div>
<div class="line"><span id="3330" class="lineNum"><a href="#3330">3330</a></span><span class="counterUnCov"></span><span class="lineUnCov">/// </span></div>
<div class="line"><span id="3331" class="lineNum"><a href="#3331">3331</a></span><span class="counterUnCov"></span><span class="lineUnCov">#[test]</span></div>
<div class="line"><span id="3332" class="lineNum"><a href="#3332">3332</a></span><span class="counterCov">4</span><span class="lineCov">fn test_sync_packet_transmit_format() {</span></div>
<div class="line"><span id="3333" class="lineNum"><a href="#3333">3333</a></span><span class="counterUnCov"></span><span class="lineUnCov">    const CID: [u8; 16] = [0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15];</span></div>
<div class="line"><span id="3334" class="lineNum"><a href="#3334">3334</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="3335" class="lineNum"><a href="#3335">3335</a></span><span class="counterUnCov"></span><span class="lineUnCov">    const SYNC_ADDR: u16 = 1;</span></div>
<div class="line"><span id="3336" class="lineNum"><a href="#3336">3336</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="3337" class="lineNum"><a href="#3337">3337</a></span><span class="counterUnCov"></span><span class="lineUnCov">    // Sync packet length 49 bytes as per ANSI E1.31-2018 Section 4.2 Table 4-2.</span></div>
<div class="line"><span id="3338" class="lineNum"><a href="#3338">3338</a></span><span class="counterUnCov"></span><span class="lineUnCov">    const E131_SYNC_PACKET_LENGTH: usize = 49;</span></div>
<div class="line"><span id="3339" class="lineNum"><a href="#3339">3339</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="3340" class="lineNum"><a href="#3340">3340</a></span><span class="counterUnCov"></span><span class="lineUnCov">    // Sequence number of initial synchronisation packet is expected to be 0.</span></div>
<div class="line"><span id="3341" class="lineNum"><a href="#3341">3341</a></span><span class="counterUnCov"></span><span class="lineUnCov">    const SEQUENCE_NUM: u8 = 0;</span></div>
<div class="line"><span id="3342" class="lineNum"><a href="#3342">3342</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="3343" class="lineNum"><a href="#3343">3343</a></span><span class="counterCov">2</span><span class="lineCov">    let sync_packet = generate_sync_packet_raw(CID, SYNC_ADDR, SEQUENCE_NUM);</span></div>
<div class="line"><span id="3344" class="lineNum"><a href="#3344">3344</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="3345" class="lineNum"><a href="#3345">3345</a></span><span class="counterCov">2</span><span class="lineCov">    let ip: SocketAddr = SocketAddr::new(IpAddr::V4(Ipv4Addr::UNSPECIFIED), ACN_SDT_MULTICAST_PORT + 1);</span></div>
<div class="line"><span id="3346" class="lineNum"><a href="#3346">3346</a></span><span class="counterCov">2</span><span class="lineCov">    let mut source = SacnSource::with_cid_ip(&amp;&quot;Source&quot;, Uuid::from_bytes(&amp;CID).unwrap(), ip).unwrap();</span></div>
<div class="line"><span id="3347" class="lineNum"><a href="#3347">3347</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="3348" class="lineNum"><a href="#3348">3348</a></span><span class="counterCov">2</span><span class="lineCov">    source.set_multicast_loop_v4(true).unwrap();</span></div>
<div class="line"><span id="3349" class="lineNum"><a href="#3349">3349</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="3350" class="lineNum"><a href="#3350">3350</a></span><span class="counterUnCov"></span><span class="lineUnCov">    // Create a standard udp receive socket to receive the packet sent by the source.</span></div>
<div class="line"><span id="3351" class="lineNum"><a href="#3351">3351</a></span><span class="counterCov">2</span><span class="lineCov">    let recv_socket = Socket::new(Domain::ipv4(), Type::dgram(), None).unwrap();</span></div>
<div class="line"><span id="3352" class="lineNum"><a href="#3352">3352</a></span><span class="counterUnCov"></span><span class="lineUnCov">    </span></div>
<div class="line"><span id="3353" class="lineNum"><a href="#3353">3353</a></span><span class="counterCov">2</span><span class="lineCov">    let addr: SocketAddr = SocketAddr::new(IpAddr::V4(Ipv4Addr::UNSPECIFIED), ACN_SDT_MULTICAST_PORT);</span></div>
<div class="line"><span id="3354" class="lineNum"><a href="#3354">3354</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="3355" class="lineNum"><a href="#3355">3355</a></span><span class="counterCov">2</span><span class="lineCov">    recv_socket.bind(&amp;addr.into()).unwrap();</span></div>
<div class="line"><span id="3356" class="lineNum"><a href="#3356">3356</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="3357" class="lineNum"><a href="#3357">3357</a></span><span class="counterCov">2</span><span class="lineCov">    recv_socket</span></div>
<div class="line"><span id="3358" class="lineNum"><a href="#3358">3358</a></span><span class="counterCov">2</span><span class="lineCov">        .join_multicast_v4(&amp;Ipv4Addr::new(239, 255, 0, 1), &amp;Ipv4Addr::new(0, 0, 0, 0))</span></div>
<div class="line"><span id="3359" class="lineNum"><a href="#3359">3359</a></span><span class="counterUnCov"></span><span class="lineUnCov">        .unwrap();</span></div>
<div class="line"><span id="3360" class="lineNum"><a href="#3360">3360</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="3361" class="lineNum"><a href="#3361">3361</a></span><span class="counterCov">2</span><span class="lineCov">    let mut recv_buf = [0; E131_SYNC_PACKET_LENGTH];</span></div>
<div class="line"><span id="3362" class="lineNum"><a href="#3362">3362</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="3363" class="lineNum"><a href="#3363">3363</a></span><span class="counterUnCov"></span><span class="lineUnCov">    // Send the synchronisation packet.</span></div>
<div class="line"><span id="3364" class="lineNum"><a href="#3364">3364</a></span><span class="counterCov">2</span><span class="lineCov">    source.register_universes(&amp;[SYNC_ADDR]).unwrap();</span></div>
<div class="line"><span id="3365" class="lineNum"><a href="#3365">3365</a></span><span class="counterCov">2</span><span class="lineCov">    source.send_sync_packet(SYNC_ADDR, None).unwrap();</span></div>
<div class="line"><span id="3366" class="lineNum"><a href="#3366">3366</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="3367" class="lineNum"><a href="#3367">3367</a></span><span class="counterUnCov"></span><span class="lineUnCov">    // Receive the packet and compare its content to the expected.</span></div>
<div class="line"><span id="3368" class="lineNum"><a href="#3368">3368</a></span><span class="counterCov">2</span><span class="lineCov">    recv_socket.recv_from(&amp;mut recv_buf).unwrap();</span></div>
<div class="line"><span id="3369" class="lineNum"><a href="#3369">3369</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="3370" class="lineNum"><a href="#3370">3370</a></span><span class="counterCov">2</span><span class="lineCov">    assert_eq!(recv_buf[..], sync_packet[..], &quot;Sync packet sent by source doesn&#39;t match expected format&quot;);</span></div>
<div class="line"><span id="3371" class="lineNum"><a href="#3371">3371</a></span><span class="counterCov">4</span><span class="lineCov">}</span></div>
<div class="line"><span id="3372" class="lineNum"><a href="#3372">3372</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="3373" class="lineNum"><a href="#3373">3373</a></span><span class="counterUnCov"></span><span class="lineUnCov">/// Similar to test_data_packet_transmit_format, creates a SacnSender and then a receiver socket. The sender then sends</span></div>
<div class="line"><span id="3374" class="lineNum"><a href="#3374">3374</a></span><span class="counterUnCov"></span><span class="lineUnCov">/// a discovery packet and the receive socket receives the packet and checks that the format of the packet is as expected.</span></div>
<div class="line"><span id="3375" class="lineNum"><a href="#3375">3375</a></span><span class="counterUnCov"></span><span class="lineUnCov">/// </span></div>
<div class="line"><span id="3376" class="lineNum"><a href="#3376">3376</a></span><span class="counterUnCov"></span><span class="lineUnCov">/// The use of a UDP socket also shows that the protocol uses UDP at the transport layer.</span></div>
<div class="line"><span id="3377" class="lineNum"><a href="#3377">3377</a></span><span class="counterUnCov"></span><span class="lineUnCov">/// </span></div>
<div class="line"><span id="3378" class="lineNum"><a href="#3378">3378</a></span><span class="counterUnCov"></span><span class="lineUnCov">#[test]</span></div>
<div class="line"><span id="3379" class="lineNum"><a href="#3379">3379</a></span><span class="counterCov">4</span><span class="lineCov">fn test_discovery_packet_transmit_format() {</span></div>
<div class="line"><span id="3380" class="lineNum"><a href="#3380">3380</a></span><span class="counterUnCov"></span><span class="lineUnCov">    const CID: [u8; 16] = [0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15];</span></div>
<div class="line"><span id="3381" class="lineNum"><a href="#3381">3381</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="3382" class="lineNum"><a href="#3382">3382</a></span><span class="counterUnCov"></span><span class="lineUnCov">    // Source name = &quot;Controller&quot;</span></div>
<div class="line"><span id="3383" class="lineNum"><a href="#3383">3383</a></span><span class="counterUnCov"></span><span class="lineUnCov">    const SOURCE_NAME: [u8; 64] = [b&#39;C&#39;, b&#39;o&#39;, b&#39;n&#39;, b&#39;t&#39;, b&#39;r&#39;, b&#39;o&#39;, b&#39;l&#39;, b&#39;l&#39;, b&#39;e&#39;, b&#39;r&#39;, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,</span></div>
<div class="line"><span id="3384" class="lineNum"><a href="#3384">3384</a></span><span class="counterUnCov"></span><span class="lineUnCov">                                    0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,</span></div>
<div class="line"><span id="3385" class="lineNum"><a href="#3385">3385</a></span><span class="counterUnCov"></span><span class="lineUnCov">                                    0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,</span></div>
<div class="line"><span id="3386" class="lineNum"><a href="#3386">3386</a></span><span class="counterUnCov"></span><span class="lineUnCov">                                    0, 0, 0, 0];</span></div>
<div class="line"><span id="3387" class="lineNum"><a href="#3387">3387</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="3388" class="lineNum"><a href="#3388">3388</a></span><span class="counterUnCov"></span><span class="lineUnCov">    // Represents 3 16 bit universes.</span></div>
<div class="line"><span id="3389" class="lineNum"><a href="#3389">3389</a></span><span class="counterUnCov"></span><span class="lineUnCov">    const UNIVERSES: [u8; 6] = [0x0, 0x1 , 0x0, 0x2, 0x0, 0x3];</span></div>
<div class="line"><span id="3390" class="lineNum"><a href="#3390">3390</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="3391" class="lineNum"><a href="#3391">3391</a></span><span class="counterUnCov"></span><span class="lineUnCov">    // Discovery packet length 49 bytes as per ANSI E1.31-2018 Section 8 Table 8-9.</span></div>
<div class="line"><span id="3392" class="lineNum"><a href="#3392">3392</a></span><span class="counterUnCov"></span><span class="lineUnCov">    const DISCOVERY_PACKET_LENGTH_EXPECTED: usize = 120 + UNIVERSES.len();</span></div>
<div class="line"><span id="3393" class="lineNum"><a href="#3393">3393</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="3394" class="lineNum"><a href="#3394">3394</a></span><span class="counterUnCov"></span><span class="lineUnCov">    // As the number of universes will fit on one page expect the page number and last page number to both be 0.</span></div>
<div class="line"><span id="3395" class="lineNum"><a href="#3395">3395</a></span><span class="counterUnCov"></span><span class="lineUnCov">    const PAGE: u8 = 0;</span></div>
<div class="line"><span id="3396" class="lineNum"><a href="#3396">3396</a></span><span class="counterUnCov"></span><span class="lineUnCov">    const LAST_PAGE: u8 = 0;</span></div>
<div class="line"><span id="3397" class="lineNum"><a href="#3397">3397</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="3398" class="lineNum"><a href="#3398">3398</a></span><span class="counterUnCov"></span><span class="lineUnCov">    // Root ACN Layer</span></div>
<div class="line"><span id="3399" class="lineNum"><a href="#3399">3399</a></span><span class="counterCov">2</span><span class="lineCov">    let mut discovery_packet = Vec::new();</span></div>
<div class="line"><span id="3400" class="lineNum"><a href="#3400">3400</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="3401" class="lineNum"><a href="#3401">3401</a></span><span class="counterUnCov"></span><span class="lineUnCov">    // Preamble Size</span></div>
<div class="line"><span id="3402" class="lineNum"><a href="#3402">3402</a></span><span class="counterCov">2</span><span class="lineCov">    discovery_packet.extend(&quot;\x00\x10&quot;.bytes());</span></div>
<div class="line"><span id="3403" class="lineNum"><a href="#3403">3403</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="3404" class="lineNum"><a href="#3404">3404</a></span><span class="counterUnCov"></span><span class="lineUnCov">    // Post-amble Size</span></div>
<div class="line"><span id="3405" class="lineNum"><a href="#3405">3405</a></span><span class="counterCov">2</span><span class="lineCov">    discovery_packet.extend(&quot;\x00\x00&quot;.bytes());</span></div>
<div class="line"><span id="3406" class="lineNum"><a href="#3406">3406</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="3407" class="lineNum"><a href="#3407">3407</a></span><span class="counterUnCov"></span><span class="lineUnCov">    // ACN Packet Identifier</span></div>
<div class="line"><span id="3408" class="lineNum"><a href="#3408">3408</a></span><span class="counterCov">2</span><span class="lineCov">    discovery_packet.extend(&quot;\x41\x53\x43\x2d\x45\x31\x2e\x31\x37\x00\x00\x00&quot;.bytes());</span></div>
<div class="line"><span id="3409" class="lineNum"><a href="#3409">3409</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="3410" class="lineNum"><a href="#3410">3410</a></span><span class="counterUnCov"></span><span class="lineUnCov">    // Flags and Length (0x70, 110)</span></div>
<div class="line"><span id="3411" class="lineNum"><a href="#3411">3411</a></span><span class="counterCov">2</span><span class="lineCov">    discovery_packet.push(0b01110000);</span></div>
<div class="line"><span id="3412" class="lineNum"><a href="#3412">3412</a></span><span class="counterCov">2</span><span class="lineCov">    discovery_packet.push(0b01101110);</span></div>
<div class="line"><span id="3413" class="lineNum"><a href="#3413">3413</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="3414" class="lineNum"><a href="#3414">3414</a></span><span class="counterUnCov"></span><span class="lineUnCov">    // Vector, VECTOR_ROOT_E131_EXTENDED as per ANSI E1.31-2018 Section 4.3 Table 4-3 and Appendix A.</span></div>
<div class="line"><span id="3415" class="lineNum"><a href="#3415">3415</a></span><span class="counterCov">2</span><span class="lineCov">    discovery_packet.extend(&quot;\x00\x00\x00\x08&quot;.bytes());</span></div>
<div class="line"><span id="3416" class="lineNum"><a href="#3416">3416</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="3417" class="lineNum"><a href="#3417">3417</a></span><span class="counterUnCov"></span><span class="lineUnCov">    // CID</span></div>
<div class="line"><span id="3418" class="lineNum"><a href="#3418">3418</a></span><span class="counterCov">2</span><span class="lineCov">    discovery_packet.extend(&amp;CID);</span></div>
<div class="line"><span id="3419" class="lineNum"><a href="#3419">3419</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="3420" class="lineNum"><a href="#3420">3420</a></span><span class="counterUnCov"></span><span class="lineUnCov">    // E1.31 Framing Layer</span></div>
<div class="line"><span id="3421" class="lineNum"><a href="#3421">3421</a></span><span class="counterUnCov"></span><span class="lineUnCov">    // Flags and Length (0x70, 88)</span></div>
<div class="line"><span id="3422" class="lineNum"><a href="#3422">3422</a></span><span class="counterCov">2</span><span class="lineCov">    discovery_packet.push(0b01110000);</span></div>
<div class="line"><span id="3423" class="lineNum"><a href="#3423">3423</a></span><span class="counterCov">2</span><span class="lineCov">    discovery_packet.push(0b01011000);</span></div>
<div class="line"><span id="3424" class="lineNum"><a href="#3424">3424</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="3425" class="lineNum"><a href="#3425">3425</a></span><span class="counterUnCov"></span><span class="lineUnCov">    // Vector, VECTOR_E131_EXTENDED_DISCOVERY as per ANSI E1.31-2018 Section 4.3 Table 4-3 and Appendix A.</span></div>
<div class="line"><span id="3426" class="lineNum"><a href="#3426">3426</a></span><span class="counterCov">2</span><span class="lineCov">    discovery_packet.extend(&quot;\x00\x00\x00\x02&quot;.bytes());</span></div>
<div class="line"><span id="3427" class="lineNum"><a href="#3427">3427</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="3428" class="lineNum"><a href="#3428">3428</a></span><span class="counterUnCov"></span><span class="lineUnCov">    // Source Name</span></div>
<div class="line"><span id="3429" class="lineNum"><a href="#3429">3429</a></span><span class="counterCov">2</span><span class="lineCov">    discovery_packet.extend(SOURCE_NAME.iter());</span></div>
<div class="line"><span id="3430" class="lineNum"><a href="#3430">3430</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="3431" class="lineNum"><a href="#3431">3431</a></span><span class="counterUnCov"></span><span class="lineUnCov">    // Reserve bytes, should be transmitted as 0&#39;s as per ANSI E1.31-2018 Section 6.4.3.</span></div>
<div class="line"><span id="3432" class="lineNum"><a href="#3432">3432</a></span><span class="counterCov">2</span><span class="lineCov">    discovery_packet.push(0);</span></div>
<div class="line"><span id="3433" class="lineNum"><a href="#3433">3433</a></span><span class="counterCov">2</span><span class="lineCov">    discovery_packet.push(0);</span></div>
<div class="line"><span id="3434" class="lineNum"><a href="#3434">3434</a></span><span class="counterCov">2</span><span class="lineCov">    discovery_packet.push(0);</span></div>
<div class="line"><span id="3435" class="lineNum"><a href="#3435">3435</a></span><span class="counterCov">2</span><span class="lineCov">    discovery_packet.push(0);</span></div>
<div class="line"><span id="3436" class="lineNum"><a href="#3436">3436</a></span><span class="counterUnCov"></span><span class="lineUnCov">    </span></div>
<div class="line"><span id="3437" class="lineNum"><a href="#3437">3437</a></span><span class="counterUnCov"></span><span class="lineUnCov">    // Universe Discovery Layer</span></div>
<div class="line"><span id="3438" class="lineNum"><a href="#3438">3438</a></span><span class="counterUnCov"></span><span class="lineUnCov">    // Flags and Length (0x70, 14)</span></div>
<div class="line"><span id="3439" class="lineNum"><a href="#3439">3439</a></span><span class="counterCov">2</span><span class="lineCov">    discovery_packet.push(0b01110000);</span></div>
<div class="line"><span id="3440" class="lineNum"><a href="#3440">3440</a></span><span class="counterCov">2</span><span class="lineCov">    discovery_packet.push(0b00001110);</span></div>
<div class="line"><span id="3441" class="lineNum"><a href="#3441">3441</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="3442" class="lineNum"><a href="#3442">3442</a></span><span class="counterUnCov"></span><span class="lineUnCov">    // Vector, VECTOR_UNIVERSE_DISCOVERY_UNIVERSE_LIST as per ANSI E1.31-2018 Section 4.3 Table 4-3 and Appendix A.</span></div>
<div class="line"><span id="3443" class="lineNum"><a href="#3443">3443</a></span><span class="counterCov">2</span><span class="lineCov">    discovery_packet.extend(&quot;\x00\x00\x00\x01&quot;.bytes());</span></div>
<div class="line"><span id="3444" class="lineNum"><a href="#3444">3444</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="3445" class="lineNum"><a href="#3445">3445</a></span><span class="counterUnCov"></span><span class="lineUnCov">    // Page and last page</span></div>
<div class="line"><span id="3446" class="lineNum"><a href="#3446">3446</a></span><span class="counterCov">2</span><span class="lineCov">    discovery_packet.push(PAGE);</span></div>
<div class="line"><span id="3447" class="lineNum"><a href="#3447">3447</a></span><span class="counterCov">2</span><span class="lineCov">    discovery_packet.push(LAST_PAGE);</span></div>
<div class="line"><span id="3448" class="lineNum"><a href="#3448">3448</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="3449" class="lineNum"><a href="#3449">3449</a></span><span class="counterUnCov"></span><span class="lineUnCov">    // The list of universes that are being advertised by the discovery packet.</span></div>
<div class="line"><span id="3450" class="lineNum"><a href="#3450">3450</a></span><span class="counterCov">2</span><span class="lineCov">    discovery_packet.extend(UNIVERSES.iter());</span></div>
<div class="line"><span id="3451" class="lineNum"><a href="#3451">3451</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="3452" class="lineNum"><a href="#3452">3452</a></span><span class="counterCov">2</span><span class="lineCov">    assert_eq!(discovery_packet.len(), DISCOVERY_PACKET_LENGTH_EXPECTED, &quot;Example discovery packet length doesn&#39;t match expected&quot;);</span></div>
<div class="line"><span id="3453" class="lineNum"><a href="#3453">3453</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="3454" class="lineNum"><a href="#3454">3454</a></span><span class="counterCov">2</span><span class="lineCov">    let ip: SocketAddr = SocketAddr::new(IpAddr::V4(Ipv4Addr::UNSPECIFIED), ACN_SDT_MULTICAST_PORT + 1);</span></div>
<div class="line"><span id="3455" class="lineNum"><a href="#3455">3455</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="3456" class="lineNum"><a href="#3456">3456</a></span><span class="counterUnCov"></span><span class="lineUnCov">    // Creates the source.</span></div>
<div class="line"><span id="3457" class="lineNum"><a href="#3457">3457</a></span><span class="counterCov">2</span><span class="lineCov">    let mut source = SacnSource::with_cid_ip(&amp;str::from_utf8(&amp;SOURCE_NAME).unwrap(), Uuid::from_bytes(&amp;CID).unwrap(), ip).unwrap();</span></div>
<div class="line"><span id="3458" class="lineNum"><a href="#3458">3458</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="3459" class="lineNum"><a href="#3459">3459</a></span><span class="counterCov">2</span><span class="lineCov">    source.set_multicast_loop_v4(true).unwrap();</span></div>
<div class="line"><span id="3460" class="lineNum"><a href="#3460">3460</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="3461" class="lineNum"><a href="#3461">3461</a></span><span class="counterUnCov"></span><span class="lineUnCov">    // Create a standard udp receive socket to receive the packet sent by the source.</span></div>
<div class="line"><span id="3462" class="lineNum"><a href="#3462">3462</a></span><span class="counterCov">2</span><span class="lineCov">    let recv_socket = Socket::new(Domain::ipv4(), Type::dgram(), None).unwrap();</span></div>
<div class="line"><span id="3463" class="lineNum"><a href="#3463">3463</a></span><span class="counterUnCov"></span><span class="lineUnCov">    </span></div>
<div class="line"><span id="3464" class="lineNum"><a href="#3464">3464</a></span><span class="counterCov">2</span><span class="lineCov">    let addr: SocketAddr = SocketAddr::new(IpAddr::V4(Ipv4Addr::UNSPECIFIED), ACN_SDT_MULTICAST_PORT);</span></div>
<div class="line"><span id="3465" class="lineNum"><a href="#3465">3465</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="3466" class="lineNum"><a href="#3466">3466</a></span><span class="counterCov">2</span><span class="lineCov">    recv_socket.bind(&amp;addr.into()).unwrap();</span></div>
<div class="line"><span id="3467" class="lineNum"><a href="#3467">3467</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="3468" class="lineNum"><a href="#3468">3468</a></span><span class="counterUnCov"></span><span class="lineUnCov">    // Receiving on the discovery universe shows that the discovery universe is correctly used for discovery packets as per ANSI E1.31-2018 Section 6.2.7.</span></div>
<div class="line"><span id="3469" class="lineNum"><a href="#3469">3469</a></span><span class="counterCov">2</span><span class="lineCov">    let address = universe_to_ipv4_multicast_addr(E131_DISCOVERY_UNIVERSE).unwrap().as_inet();</span></div>
<div class="line"><span id="3470" class="lineNum"><a href="#3470">3470</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="3471" class="lineNum"><a href="#3471">3471</a></span><span class="counterCov">2</span><span class="lineCov">    recv_socket</span></div>
<div class="line"><span id="3472" class="lineNum"><a href="#3472">3472</a></span><span class="counterCov">2</span><span class="lineCov">        .join_multicast_v4(&amp;address.unwrap().ip(), &amp;Ipv4Addr::new(0, 0, 0, 0))</span></div>
<div class="line"><span id="3473" class="lineNum"><a href="#3473">3473</a></span><span class="counterUnCov"></span><span class="lineUnCov">        .unwrap();</span></div>
<div class="line"><span id="3474" class="lineNum"><a href="#3474">3474</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="3475" class="lineNum"><a href="#3475">3475</a></span><span class="counterCov">2</span><span class="lineCov">    let mut recv_buf = [0; DISCOVERY_PACKET_LENGTH_EXPECTED];</span></div>
<div class="line"><span id="3476" class="lineNum"><a href="#3476">3476</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="3477" class="lineNum"><a href="#3477">3477</a></span><span class="counterUnCov"></span><span class="lineUnCov">    // Register the universes, note be = BigEndian which is used as network byte order is BigEndian.</span></div>
<div class="line"><span id="3478" class="lineNum"><a href="#3478">3478</a></span><span class="counterCov">2</span><span class="lineCov">    source.register_universes(&amp;[</span></div>
<div class="line"><span id="3479" class="lineNum"><a href="#3479">3479</a></span><span class="counterCov">2</span><span class="lineCov">        u16::from_be_bytes(UNIVERSES[0..2].try_into().unwrap()), </span></div>
<div class="line"><span id="3480" class="lineNum"><a href="#3480">3480</a></span><span class="counterCov">2</span><span class="lineCov">        u16::from_be_bytes(UNIVERSES[2..4].try_into().unwrap()), </span></div>
<div class="line"><span id="3481" class="lineNum"><a href="#3481">3481</a></span><span class="counterCov">2</span><span class="lineCov">        u16::from_be_bytes(UNIVERSES[4..6].try_into().unwrap())</span></div>
<div class="line"><span id="3482" class="lineNum"><a href="#3482">3482</a></span><span class="counterUnCov"></span><span class="lineUnCov">        ]).unwrap();</span></div>
<div class="line"><span id="3483" class="lineNum"><a href="#3483">3483</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="3484" class="lineNum"><a href="#3484">3484</a></span><span class="counterUnCov"></span><span class="lineUnCov">    // The source is expected to eventually send a universe discovery packet. </span></div>
<div class="line"><span id="3485" class="lineNum"><a href="#3485">3485</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="3486" class="lineNum"><a href="#3486">3486</a></span><span class="counterUnCov"></span><span class="lineUnCov">    // Receive the packet and compare its content to the expected.</span></div>
<div class="line"><span id="3487" class="lineNum"><a href="#3487">3487</a></span><span class="counterCov">2</span><span class="lineCov">    recv_socket.recv_from(&amp;mut recv_buf).unwrap();</span></div>
<div class="line"><span id="3488" class="lineNum"><a href="#3488">3488</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="3489" class="lineNum"><a href="#3489">3489</a></span><span class="counterCov">2</span><span class="lineCov">    assert_eq!(recv_buf[..], discovery_packet[..], &quot;Discovery packet sent by source doesn&#39;t match expected format&quot;);</span></div>
<div class="line"><span id="3490" class="lineNum"><a href="#3490">3490</a></span><span class="counterCov">4</span><span class="lineCov">}</span></div>
<div class="line"><span id="3491" class="lineNum"><a href="#3491">3491</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="3492" class="lineNum"><a href="#3492">3492</a></span><span class="counterUnCov"></span><span class="lineUnCov">/// Similar to test_data_packet_transmit_format, creates a SacnSender and then a receiver socket. The sender then sends</span></div>
<div class="line"><span id="3493" class="lineNum"><a href="#3493">3493</a></span><span class="counterUnCov"></span><span class="lineUnCov">/// a synchronisation packet and the receive socket receives the packet and checks that the format of the packet is as expected.</span></div>
<div class="line"><span id="3494" class="lineNum"><a href="#3494">3494</a></span><span class="counterUnCov"></span><span class="lineUnCov">/// </span></div>
<div class="line"><span id="3495" class="lineNum"><a href="#3495">3495</a></span><span class="counterUnCov"></span><span class="lineUnCov">/// The use of a UDP socket also shows that the protocol uses UDP at the transport layer.</span></div>
<div class="line"><span id="3496" class="lineNum"><a href="#3496">3496</a></span><span class="counterUnCov"></span><span class="lineUnCov">/// </span></div>
<div class="line"><span id="3497" class="lineNum"><a href="#3497">3497</a></span><span class="counterUnCov"></span><span class="lineUnCov">#[test]</span></div>
<div class="line"><span id="3498" class="lineNum"><a href="#3498">3498</a></span><span class="counterCov">4</span><span class="lineCov">fn test_sync_packet_transmit_seq_numbers() {</span></div>
<div class="line"><span id="3499" class="lineNum"><a href="#3499">3499</a></span><span class="counterUnCov"></span><span class="lineUnCov">    const CID: [u8; 16] = [0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15];</span></div>
<div class="line"><span id="3500" class="lineNum"><a href="#3500">3500</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="3501" class="lineNum"><a href="#3501">3501</a></span><span class="counterUnCov"></span><span class="lineUnCov">    const UNIVERSE: u16 = 1;</span></div>
<div class="line"><span id="3502" class="lineNum"><a href="#3502">3502</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="3503" class="lineNum"><a href="#3503">3503</a></span><span class="counterUnCov"></span><span class="lineUnCov">    // Sync packet length 49 bytes as per ANSI E1.31-2018 Section 4.2 Table 4-2.</span></div>
<div class="line"><span id="3504" class="lineNum"><a href="#3504">3504</a></span><span class="counterUnCov"></span><span class="lineUnCov">    const E131_SYNC_PACKET_LENGTH: usize = 49;</span></div>
<div class="line"><span id="3505" class="lineNum"><a href="#3505">3505</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="3506" class="lineNum"><a href="#3506">3506</a></span><span class="counterUnCov"></span><span class="lineUnCov">    // Sequence number of initial synchronisation packet is expected to be 0.</span></div>
<div class="line"><span id="3507" class="lineNum"><a href="#3507">3507</a></span><span class="counterUnCov"></span><span class="lineUnCov">    const SEQUENCE_NUM: u8 = 0;</span></div>
<div class="line"><span id="3508" class="lineNum"><a href="#3508">3508</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="3509" class="lineNum"><a href="#3509">3509</a></span><span class="counterUnCov"></span><span class="lineUnCov">    // Root Layer</span></div>
<div class="line"><span id="3510" class="lineNum"><a href="#3510">3510</a></span><span class="counterCov">2</span><span class="lineCov">    let mut sync_packet = Vec::new();</span></div>
<div class="line"><span id="3511" class="lineNum"><a href="#3511">3511</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="3512" class="lineNum"><a href="#3512">3512</a></span><span class="counterUnCov"></span><span class="lineUnCov">    // Preamble Size</span></div>
<div class="line"><span id="3513" class="lineNum"><a href="#3513">3513</a></span><span class="counterCov">2</span><span class="lineCov">    sync_packet.extend(&quot;\x00\x10&quot;.bytes());</span></div>
<div class="line"><span id="3514" class="lineNum"><a href="#3514">3514</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="3515" class="lineNum"><a href="#3515">3515</a></span><span class="counterUnCov"></span><span class="lineUnCov">    // Post-amble Size</span></div>
<div class="line"><span id="3516" class="lineNum"><a href="#3516">3516</a></span><span class="counterCov">2</span><span class="lineCov">    sync_packet.extend(&quot;\x00\x00&quot;.bytes());</span></div>
<div class="line"><span id="3517" class="lineNum"><a href="#3517">3517</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="3518" class="lineNum"><a href="#3518">3518</a></span><span class="counterUnCov"></span><span class="lineUnCov">    // ACN Packet Identifier</span></div>
<div class="line"><span id="3519" class="lineNum"><a href="#3519">3519</a></span><span class="counterCov">2</span><span class="lineCov">    sync_packet.extend(&quot;\x41\x53\x43\x2d\x45\x31\x2e\x31\x37\x00\x00\x00&quot;.bytes());</span></div>
<div class="line"><span id="3520" class="lineNum"><a href="#3520">3520</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="3521" class="lineNum"><a href="#3521">3521</a></span><span class="counterUnCov"></span><span class="lineUnCov">    // Flags and Length (0x70, 33)</span></div>
<div class="line"><span id="3522" class="lineNum"><a href="#3522">3522</a></span><span class="counterCov">2</span><span class="lineCov">    sync_packet.push(0b01110000);</span></div>
<div class="line"><span id="3523" class="lineNum"><a href="#3523">3523</a></span><span class="counterCov">2</span><span class="lineCov">    sync_packet.push(0b00100001);</span></div>
<div class="line"><span id="3524" class="lineNum"><a href="#3524">3524</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="3525" class="lineNum"><a href="#3525">3525</a></span><span class="counterUnCov"></span><span class="lineUnCov">    // Vector, VECTOR_ROOT_E131_EXTENDED as per ANSI E1.31-2018 Section 4.2 Table 4-2.</span></div>
<div class="line"><span id="3526" class="lineNum"><a href="#3526">3526</a></span><span class="counterCov">2</span><span class="lineCov">    sync_packet.extend(&quot;\x00\x00\x00\x08&quot;.bytes());</span></div>
<div class="line"><span id="3527" class="lineNum"><a href="#3527">3527</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="3528" class="lineNum"><a href="#3528">3528</a></span><span class="counterUnCov"></span><span class="lineUnCov">    // CID</span></div>
<div class="line"><span id="3529" class="lineNum"><a href="#3529">3529</a></span><span class="counterCov">2</span><span class="lineCov">    sync_packet.extend(&amp;CID);</span></div>
<div class="line"><span id="3530" class="lineNum"><a href="#3530">3530</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="3531" class="lineNum"><a href="#3531">3531</a></span><span class="counterUnCov"></span><span class="lineUnCov">    // E1.31 Framing Layer</span></div>
<div class="line"><span id="3532" class="lineNum"><a href="#3532">3532</a></span><span class="counterUnCov"></span><span class="lineUnCov">    // Flags and Length (0x70, 11)</span></div>
<div class="line"><span id="3533" class="lineNum"><a href="#3533">3533</a></span><span class="counterCov">2</span><span class="lineCov">    sync_packet.push(0b01110000);</span></div>
<div class="line"><span id="3534" class="lineNum"><a href="#3534">3534</a></span><span class="counterCov">2</span><span class="lineCov">    sync_packet.push(0b00001011);</span></div>
<div class="line"><span id="3535" class="lineNum"><a href="#3535">3535</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="3536" class="lineNum"><a href="#3536">3536</a></span><span class="counterUnCov"></span><span class="lineUnCov">    // Vector, VECTOR_E131_EXTENDED_SYNCHRONISATION as per ANSI E1.31-2018 Appendix A.</span></div>
<div class="line"><span id="3537" class="lineNum"><a href="#3537">3537</a></span><span class="counterCov">2</span><span class="lineCov">    sync_packet.extend(&quot;\x00\x00\x00\x01&quot;.bytes());</span></div>
<div class="line"><span id="3538" class="lineNum"><a href="#3538">3538</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="3539" class="lineNum"><a href="#3539">3539</a></span><span class="counterUnCov"></span><span class="lineUnCov">    // Sequence Number</span></div>
<div class="line"><span id="3540" class="lineNum"><a href="#3540">3540</a></span><span class="counterCov">2</span><span class="lineCov">    sync_packet.push(SEQUENCE_NUM);</span></div>
<div class="line"><span id="3541" class="lineNum"><a href="#3541">3541</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="3542" class="lineNum"><a href="#3542">3542</a></span><span class="counterUnCov"></span><span class="lineUnCov">    // Synchronisation Address, 1</span></div>
<div class="line"><span id="3543" class="lineNum"><a href="#3543">3543</a></span><span class="counterCov">2</span><span class="lineCov">    sync_packet.push(0);</span></div>
<div class="line"><span id="3544" class="lineNum"><a href="#3544">3544</a></span><span class="counterCov">2</span><span class="lineCov">    sync_packet.push(1);</span></div>
<div class="line"><span id="3545" class="lineNum"><a href="#3545">3545</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="3546" class="lineNum"><a href="#3546">3546</a></span><span class="counterUnCov"></span><span class="lineUnCov">    // Reserve bytes as 0 as per ANSI E1.31-2018 Section 6.3.4.</span></div>
<div class="line"><span id="3547" class="lineNum"><a href="#3547">3547</a></span><span class="counterCov">2</span><span class="lineCov">    sync_packet.push(0);</span></div>
<div class="line"><span id="3548" class="lineNum"><a href="#3548">3548</a></span><span class="counterCov">2</span><span class="lineCov">    sync_packet.push(0);</span></div>
<div class="line"><span id="3549" class="lineNum"><a href="#3549">3549</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="3550" class="lineNum"><a href="#3550">3550</a></span><span class="counterCov">2</span><span class="lineCov">    let ip: SocketAddr = SocketAddr::new(IpAddr::V4(Ipv4Addr::UNSPECIFIED), ACN_SDT_MULTICAST_PORT + 1);</span></div>
<div class="line"><span id="3551" class="lineNum"><a href="#3551">3551</a></span><span class="counterCov">2</span><span class="lineCov">    let mut source = SacnSource::with_cid_ip(&amp;&quot;Source&quot;, Uuid::from_bytes(&amp;CID).unwrap(), ip).unwrap();</span></div>
<div class="line"><span id="3552" class="lineNum"><a href="#3552">3552</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="3553" class="lineNum"><a href="#3553">3553</a></span><span class="counterCov">2</span><span class="lineCov">    source.set_multicast_loop_v4(true).unwrap();</span></div>
<div class="line"><span id="3554" class="lineNum"><a href="#3554">3554</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="3555" class="lineNum"><a href="#3555">3555</a></span><span class="counterUnCov"></span><span class="lineUnCov">    // Create a standard udp receive socket to receive the packet sent by the source.</span></div>
<div class="line"><span id="3556" class="lineNum"><a href="#3556">3556</a></span><span class="counterCov">2</span><span class="lineCov">    let recv_socket = Socket::new(Domain::ipv4(), Type::dgram(), None).unwrap();</span></div>
<div class="line"><span id="3557" class="lineNum"><a href="#3557">3557</a></span><span class="counterUnCov"></span><span class="lineUnCov">    </span></div>
<div class="line"><span id="3558" class="lineNum"><a href="#3558">3558</a></span><span class="counterCov">2</span><span class="lineCov">    let addr: SocketAddr = SocketAddr::new(IpAddr::V4(Ipv4Addr::UNSPECIFIED), ACN_SDT_MULTICAST_PORT);</span></div>
<div class="line"><span id="3559" class="lineNum"><a href="#3559">3559</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="3560" class="lineNum"><a href="#3560">3560</a></span><span class="counterCov">2</span><span class="lineCov">    recv_socket.bind(&amp;addr.into()).unwrap();</span></div>
<div class="line"><span id="3561" class="lineNum"><a href="#3561">3561</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="3562" class="lineNum"><a href="#3562">3562</a></span><span class="counterCov">2</span><span class="lineCov">    recv_socket</span></div>
<div class="line"><span id="3563" class="lineNum"><a href="#3563">3563</a></span><span class="counterCov">2</span><span class="lineCov">        .join_multicast_v4(&amp;Ipv4Addr::new(239, 255, 0, 1), &amp;Ipv4Addr::new(0, 0, 0, 0))</span></div>
<div class="line"><span id="3564" class="lineNum"><a href="#3564">3564</a></span><span class="counterUnCov"></span><span class="lineUnCov">        .unwrap();</span></div>
<div class="line"><span id="3565" class="lineNum"><a href="#3565">3565</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="3566" class="lineNum"><a href="#3566">3566</a></span><span class="counterCov">2</span><span class="lineCov">    let mut recv_buf = [0; E131_SYNC_PACKET_LENGTH];</span></div>
<div class="line"><span id="3567" class="lineNum"><a href="#3567">3567</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="3568" class="lineNum"><a href="#3568">3568</a></span><span class="counterUnCov"></span><span class="lineUnCov">    // Send the synchronisation packet.</span></div>
<div class="line"><span id="3569" class="lineNum"><a href="#3569">3569</a></span><span class="counterCov">2</span><span class="lineCov">    source.register_universes(&amp;[UNIVERSE]).unwrap();</span></div>
<div class="line"><span id="3570" class="lineNum"><a href="#3570">3570</a></span><span class="counterCov">2</span><span class="lineCov">    source.send_sync_packet(UNIVERSE, None).unwrap();</span></div>
<div class="line"><span id="3571" class="lineNum"><a href="#3571">3571</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="3572" class="lineNum"><a href="#3572">3572</a></span><span class="counterUnCov"></span><span class="lineUnCov">    // Receive the packet and compare its content to the expected.</span></div>
<div class="line"><span id="3573" class="lineNum"><a href="#3573">3573</a></span><span class="counterCov">2</span><span class="lineCov">    recv_socket.recv_from(&amp;mut recv_buf).unwrap();</span></div>
<div class="line"><span id="3574" class="lineNum"><a href="#3574">3574</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="3575" class="lineNum"><a href="#3575">3575</a></span><span class="counterCov">2</span><span class="lineCov">    assert_eq!(recv_buf[..], sync_packet[..], &quot;Sync packet sent by source doesn&#39;t match expected format&quot;);</span></div>
<div class="line"><span id="3576" class="lineNum"><a href="#3576">3576</a></span><span class="counterCov">4</span><span class="lineCov">}</span></div>
<div class="line"><span id="3577" class="lineNum"><a href="#3577">3577</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="3578" class="lineNum"><a href="#3578">3578</a></span><span class="counterUnCov"></span><span class="lineUnCov">/// Creates a source and a receiver socket. The source then sends data packets meant for different universes and the receiver checks</span></div>
<div class="line"><span id="3579" class="lineNum"><a href="#3579">3579</a></span><span class="counterUnCov"></span><span class="lineUnCov">/// that the sequence numbers are incremented by 1 for each packet and are incremented independently for each universe.SockAddr</span></div>
<div class="line"><span id="3580" class="lineNum"><a href="#3580">3580</a></span><span class="counterUnCov"></span><span class="lineUnCov">/// </span></div>
<div class="line"><span id="3581" class="lineNum"><a href="#3581">3581</a></span><span class="counterUnCov"></span><span class="lineUnCov">/// This shows the source complies with ANSI E1.31-2018 Section 6.2.5 &quot;E1.31 Data Packet: Sequence Number&quot;. </span></div>
<div class="line"><span id="3582" class="lineNum"><a href="#3582">3582</a></span><span class="counterUnCov"></span><span class="lineUnCov">/// </span></div>
<div class="line"><span id="3583" class="lineNum"><a href="#3583">3583</a></span><span class="counterUnCov"></span><span class="lineUnCov">#[test]</span></div>
<div class="line"><span id="3584" class="lineNum"><a href="#3584">3584</a></span><span class="counterUnCov"></span><span class="lineUnCov">#[cfg_attr(rustfmt, rustfmt_skip)]</span></div>
<div class="line"><span id="3585" class="lineNum"><a href="#3585">3585</a></span><span class="counterCov">4</span><span class="lineCov">fn test_track_data_packet_seq_numbers() {</span></div>
<div class="line"><span id="3586" class="lineNum"><a href="#3586">3586</a></span><span class="counterUnCov"></span><span class="lineUnCov">    /* Packet parameters */</span></div>
<div class="line"><span id="3587" class="lineNum"><a href="#3587">3587</a></span><span class="counterUnCov"></span><span class="lineUnCov">    const CID: [u8; 16] = [0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15];</span></div>
<div class="line"><span id="3588" class="lineNum"><a href="#3588">3588</a></span><span class="counterUnCov"></span><span class="lineUnCov">    const OPTIONS: u8 = 0; // Checks that the options field is transmitted as 0&#39;s.</span></div>
<div class="line"><span id="3589" class="lineNum"><a href="#3589">3589</a></span><span class="counterUnCov"></span><span class="lineUnCov">    const PRIORITY: u8 = 150;</span></div>
<div class="line"><span id="3590" class="lineNum"><a href="#3590">3590</a></span><span class="counterCov">2</span><span class="lineCov">    let source_name = &quot;SourceName&quot;.to_string() +</span></div>
<div class="line"><span id="3591" class="lineNum"><a href="#3591">3591</a></span><span class="counterUnCov"></span><span class="lineUnCov">                        &quot;\0\0\0\0\0\0\0\0\0\0&quot; +</span></div>
<div class="line"><span id="3592" class="lineNum"><a href="#3592">3592</a></span><span class="counterUnCov"></span><span class="lineUnCov">                        &quot;\0\0\0\0\0\0\0\0\0\0&quot; +</span></div>
<div class="line"><span id="3593" class="lineNum"><a href="#3593">3593</a></span><span class="counterUnCov"></span><span class="lineUnCov">                        &quot;\0\0\0\0\0\0\0\0\0\0&quot; +</span></div>
<div class="line"><span id="3594" class="lineNum"><a href="#3594">3594</a></span><span class="counterUnCov"></span><span class="lineUnCov">                        &quot;\0\0\0\0\0\0\0\0\0\0&quot; +</span></div>
<div class="line"><span id="3595" class="lineNum"><a href="#3595">3595</a></span><span class="counterUnCov"></span><span class="lineUnCov">                        &quot;\0\0\0\0\0\0\0\0\0\0&quot; +</span></div>
<div class="line"><span id="3596" class="lineNum"><a href="#3596">3596</a></span><span class="counterUnCov"></span><span class="lineUnCov">                        &quot;\0\0\0\0&quot;;</span></div>
<div class="line"><span id="3597" class="lineNum"><a href="#3597">3597</a></span><span class="counterCov">2</span><span class="lineCov">    let mut dmx_data: Vec&lt;u8&gt; = Vec::new();</span></div>
<div class="line"><span id="3598" class="lineNum"><a href="#3598">3598</a></span><span class="counterCov">2</span><span class="lineCov">    dmx_data.push(0); // Start code</span></div>
<div class="line"><span id="3599" class="lineNum"><a href="#3599">3599</a></span><span class="counterCov">2</span><span class="lineCov">    dmx_data.extend(iter::repeat(100).take(255));</span></div>
<div class="line"><span id="3600" class="lineNum"><a href="#3600">3600</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="3601" class="lineNum"><a href="#3601">3601</a></span><span class="counterUnCov"></span><span class="lineUnCov">    /* The parameters above are set to arbitrary values as they aren&#39;t the focus of the test*/</span></div>
<div class="line"><span id="3602" class="lineNum"><a href="#3602">3602</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="3603" class="lineNum"><a href="#3603">3603</a></span><span class="counterUnCov"></span><span class="lineUnCov">    // The expected starting sequence number of data packets from the source.</span></div>
<div class="line"><span id="3604" class="lineNum"><a href="#3604">3604</a></span><span class="counterUnCov"></span><span class="lineUnCov">    const START_SEQ_NUM: usize = 0;</span></div>
<div class="line"><span id="3605" class="lineNum"><a href="#3605">3605</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="3606" class="lineNum"><a href="#3606">3606</a></span><span class="counterUnCov"></span><span class="lineUnCov">    // The number of data packets to send per universe.</span></div>
<div class="line"><span id="3607" class="lineNum"><a href="#3607">3607</a></span><span class="counterUnCov"></span><span class="lineUnCov">    const DATA_PACKETS_TO_SEND: usize = 300;</span></div>
<div class="line"><span id="3608" class="lineNum"><a href="#3608">3608</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="3609" class="lineNum"><a href="#3609">3609</a></span><span class="counterUnCov"></span><span class="lineUnCov">    // The universes that the data packets are sent on.</span></div>
<div class="line"><span id="3610" class="lineNum"><a href="#3610">3610</a></span><span class="counterUnCov"></span><span class="lineUnCov">    const UNIVERSES: [u16; 5] = [1, 3, 5, 7, 9];</span></div>
<div class="line"><span id="3611" class="lineNum"><a href="#3611">3611</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="3612" class="lineNum"><a href="#3612">3612</a></span><span class="counterUnCov"></span><span class="lineUnCov">    // Create a source.</span></div>
<div class="line"><span id="3613" class="lineNum"><a href="#3613">3613</a></span><span class="counterCov">2</span><span class="lineCov">    let ip: SocketAddr = SocketAddr::new(IpAddr::V4(Ipv4Addr::new(0, 0, 0, 0)), ACN_SDT_MULTICAST_PORT + 1);</span></div>
<div class="line"><span id="3614" class="lineNum"><a href="#3614">3614</a></span><span class="counterCov">2</span><span class="lineCov">    let mut source = SacnSource::with_cid_ip(&amp;source_name.clone(), Uuid::from_bytes(&amp;CID).unwrap(), ip).unwrap();</span></div>
<div class="line"><span id="3615" class="lineNum"><a href="#3615">3615</a></span><span class="counterCov">2</span><span class="lineCov">    source.set_multicast_loop_v4(true).unwrap();</span></div>
<div class="line"><span id="3616" class="lineNum"><a href="#3616">3616</a></span><span class="counterCov">2</span><span class="lineCov">    source.register_universes(&amp;UNIVERSES).unwrap();</span></div>
<div class="line"><span id="3617" class="lineNum"><a href="#3617">3617</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="3618" class="lineNum"><a href="#3618">3618</a></span><span class="counterUnCov"></span><span class="lineUnCov">    // Don&#39;t want universe discovery packets to be sent which might interfer with checking data packets.</span></div>
<div class="line"><span id="3619" class="lineNum"><a href="#3619">3619</a></span><span class="counterCov">2</span><span class="lineCov">    source.set_is_sending_discovery(false);</span></div>
<div class="line"><span id="3620" class="lineNum"><a href="#3620">3620</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="3621" class="lineNum"><a href="#3621">3621</a></span><span class="counterUnCov"></span><span class="lineUnCov">    // Create receiver socket.</span></div>
<div class="line"><span id="3622" class="lineNum"><a href="#3622">3622</a></span><span class="counterCov">2</span><span class="lineCov">    let recv_socket = Socket::new(Domain::ipv4(), Type::dgram(), None).unwrap();</span></div>
<div class="line"><span id="3623" class="lineNum"><a href="#3623">3623</a></span><span class="counterCov">2</span><span class="lineCov">    let addr: SocketAddr = SocketAddr::new(IpAddr::V4(Ipv4Addr::UNSPECIFIED), ACN_SDT_MULTICAST_PORT);</span></div>
<div class="line"><span id="3624" class="lineNum"><a href="#3624">3624</a></span><span class="counterCov">2</span><span class="lineCov">    recv_socket.bind(&amp;addr.into()).unwrap();</span></div>
<div class="line"><span id="3625" class="lineNum"><a href="#3625">3625</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="3626" class="lineNum"><a href="#3626">3626</a></span><span class="counterUnCov"></span><span class="lineUnCov">    // Join the multicast groups for each of the universes.</span></div>
<div class="line"><span id="3627" class="lineNum"><a href="#3627">3627</a></span><span class="counterCov">12</span><span class="lineCov">    for u in UNIVERSES.iter() {</span></div>
<div class="line"><span id="3628" class="lineNum"><a href="#3628">3628</a></span><span class="counterCov">10</span><span class="lineCov">        let address = universe_to_ipv4_multicast_addr(*u).unwrap().as_inet();</span></div>
<div class="line"><span id="3629" class="lineNum"><a href="#3629">3629</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="3630" class="lineNum"><a href="#3630">3630</a></span><span class="counterCov">10</span><span class="lineCov">        recv_socket</span></div>
<div class="line"><span id="3631" class="lineNum"><a href="#3631">3631</a></span><span class="counterCov">10</span><span class="lineCov">            .join_multicast_v4(&amp;address.unwrap().ip(), &amp;Ipv4Addr::new(0, 0, 0, 0))</span></div>
<div class="line"><span id="3632" class="lineNum"><a href="#3632">3632</a></span><span class="counterUnCov"></span><span class="lineUnCov">            .unwrap();</span></div>
<div class="line"><span id="3633" class="lineNum"><a href="#3633">3633</a></span><span class="counterUnCov"></span><span class="lineUnCov">    }</span></div>
<div class="line"><span id="3634" class="lineNum"><a href="#3634">3634</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="3635" class="lineNum"><a href="#3635">3635</a></span><span class="counterCov">602</span><span class="lineCov">    for s in START_SEQ_NUM .. START_SEQ_NUM + DATA_PACKETS_TO_SEND {</span></div>
<div class="line"><span id="3636" class="lineNum"><a href="#3636">3636</a></span><span class="counterCov">600</span><span class="lineCov">        let expected_seq_num: u8 = (s % 256).try_into().unwrap();</span></div>
<div class="line"><span id="3637" class="lineNum"><a href="#3637">3637</a></span><span class="counterCov">3600</span><span class="lineCov">        for u in UNIVERSES.iter() {</span></div>
<div class="line"><span id="3638" class="lineNum"><a href="#3638">3638</a></span><span class="counterCov">3000</span><span class="lineCov">            let expected_packet = generate_data_packet_raw(CID, *u, source_name.clone(), PRIORITY, expected_seq_num, OPTIONS, dmx_data.clone());</span></div>
<div class="line"><span id="3639" class="lineNum"><a href="#3639">3639</a></span><span class="counterCov">3000</span><span class="lineCov">            source.send(&amp;[*u], &amp;dmx_data, Some(PRIORITY), None, None).unwrap();</span></div>
<div class="line"><span id="3640" class="lineNum"><a href="#3640">3640</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="3641" class="lineNum"><a href="#3641">3641</a></span><span class="counterCov">3000</span><span class="lineCov">            let mut recv_buf = [0; 1024];</span></div>
<div class="line"><span id="3642" class="lineNum"><a href="#3642">3642</a></span><span class="counterCov">3000</span><span class="lineCov">            let (amt, _) = recv_socket.recv_from(&amp;mut recv_buf).unwrap();</span></div>
<div class="line"><span id="3643" class="lineNum"><a href="#3643">3643</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="3644" class="lineNum"><a href="#3644">3644</a></span><span class="counterCov">3000</span><span class="lineCov">            assert_eq!(&amp;recv_buf[0..amt], &amp;expected_packet[..]);</span></div>
<div class="line"><span id="3645" class="lineNum"><a href="#3645">3645</a></span><span class="counterCov">3000</span><span class="lineCov">        }</span></div>
<div class="line"><span id="3646" class="lineNum"><a href="#3646">3646</a></span><span class="counterUnCov"></span><span class="lineUnCov">    }</span></div>
<div class="line"><span id="3647" class="lineNum"><a href="#3647">3647</a></span><span class="counterCov">4</span><span class="lineCov">}</span></div>
<div class="line"><span id="3648" class="lineNum"><a href="#3648">3648</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="3649" class="lineNum"><a href="#3649">3649</a></span><span class="counterUnCov"></span><span class="lineUnCov">/// Creates a source and a receiver socket. The source then sends data packets meant for different universes and the receiver checks</span></div>
<div class="line"><span id="3650" class="lineNum"><a href="#3650">3650</a></span><span class="counterUnCov"></span><span class="lineUnCov">/// that the sequence numbers are incremented by 1 for each packet and are incremented independently for each universe.SockAddr</span></div>
<div class="line"><span id="3651" class="lineNum"><a href="#3651">3651</a></span><span class="counterUnCov"></span><span class="lineUnCov">/// </span></div>
<div class="line"><span id="3652" class="lineNum"><a href="#3652">3652</a></span><span class="counterUnCov"></span><span class="lineUnCov">/// This shows the source complies with ANSI E1.31-2018 Section 6.2.5 &quot;E1.31 Data Packet: Sequence Number&quot;. </span></div>
<div class="line"><span id="3653" class="lineNum"><a href="#3653">3653</a></span><span class="counterUnCov"></span><span class="lineUnCov">/// </span></div>
<div class="line"><span id="3654" class="lineNum"><a href="#3654">3654</a></span><span class="counterUnCov"></span><span class="lineUnCov">#[test]</span></div>
<div class="line"><span id="3655" class="lineNum"><a href="#3655">3655</a></span><span class="counterUnCov"></span><span class="lineUnCov">#[cfg_attr(rustfmt, rustfmt_skip)]</span></div>
<div class="line"><span id="3656" class="lineNum"><a href="#3656">3656</a></span><span class="counterCov">4</span><span class="lineCov">fn test_track_sync_packet_seq_numbers() {</span></div>
<div class="line"><span id="3657" class="lineNum"><a href="#3657">3657</a></span><span class="counterUnCov"></span><span class="lineUnCov">    // Source CID and name, set to arbitrary values as not the focus of the test.</span></div>
<div class="line"><span id="3658" class="lineNum"><a href="#3658">3658</a></span><span class="counterUnCov"></span><span class="lineUnCov">    const CID: [u8; 16] = [0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15];</span></div>
<div class="line"><span id="3659" class="lineNum"><a href="#3659">3659</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="3660" class="lineNum"><a href="#3660">3660</a></span><span class="counterCov">2</span><span class="lineCov">    let source_name = &quot;SourceName&quot;.to_string() +</span></div>
<div class="line"><span id="3661" class="lineNum"><a href="#3661">3661</a></span><span class="counterUnCov"></span><span class="lineUnCov">                        &quot;\0\0\0\0\0\0\0\0\0\0&quot; +</span></div>
<div class="line"><span id="3662" class="lineNum"><a href="#3662">3662</a></span><span class="counterUnCov"></span><span class="lineUnCov">                        &quot;\0\0\0\0\0\0\0\0\0\0&quot; +</span></div>
<div class="line"><span id="3663" class="lineNum"><a href="#3663">3663</a></span><span class="counterUnCov"></span><span class="lineUnCov">                        &quot;\0\0\0\0\0\0\0\0\0\0&quot; +</span></div>
<div class="line"><span id="3664" class="lineNum"><a href="#3664">3664</a></span><span class="counterUnCov"></span><span class="lineUnCov">                        &quot;\0\0\0\0\0\0\0\0\0\0&quot; +</span></div>
<div class="line"><span id="3665" class="lineNum"><a href="#3665">3665</a></span><span class="counterUnCov"></span><span class="lineUnCov">                        &quot;\0\0\0\0\0\0\0\0\0\0&quot; +</span></div>
<div class="line"><span id="3666" class="lineNum"><a href="#3666">3666</a></span><span class="counterUnCov"></span><span class="lineUnCov">                        &quot;\0\0\0\0&quot;;</span></div>
<div class="line"><span id="3667" class="lineNum"><a href="#3667">3667</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="3668" class="lineNum"><a href="#3668">3668</a></span><span class="counterUnCov"></span><span class="lineUnCov">    // The expected starting sequence number of sync packets from the source.</span></div>
<div class="line"><span id="3669" class="lineNum"><a href="#3669">3669</a></span><span class="counterUnCov"></span><span class="lineUnCov">    const START_SEQ_NUM: usize = 0;</span></div>
<div class="line"><span id="3670" class="lineNum"><a href="#3670">3670</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="3671" class="lineNum"><a href="#3671">3671</a></span><span class="counterUnCov"></span><span class="lineUnCov">    // The number of sync packets to send per universe. Chosen to be high enough that a sequence number wrap around due to the maximum possible value in a u8 is required. </span></div>
<div class="line"><span id="3672" class="lineNum"><a href="#3672">3672</a></span><span class="counterUnCov"></span><span class="lineUnCov">    // This checks that the sequence numbers wrap around correctly.</span></div>
<div class="line"><span id="3673" class="lineNum"><a href="#3673">3673</a></span><span class="counterUnCov"></span><span class="lineUnCov">    const SYNC_PACKETS_TO_SEND: usize = 300;</span></div>
<div class="line"><span id="3674" class="lineNum"><a href="#3674">3674</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="3675" class="lineNum"><a href="#3675">3675</a></span><span class="counterUnCov"></span><span class="lineUnCov">    // The universes that the sync packets are sent on.</span></div>
<div class="line"><span id="3676" class="lineNum"><a href="#3676">3676</a></span><span class="counterUnCov"></span><span class="lineUnCov">    const SYNC_ADDRESSES: [u16; 5] = [1, 3, 5, 7, 9];</span></div>
<div class="line"><span id="3677" class="lineNum"><a href="#3677">3677</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="3678" class="lineNum"><a href="#3678">3678</a></span><span class="counterUnCov"></span><span class="lineUnCov">    // Create a source.</span></div>
<div class="line"><span id="3679" class="lineNum"><a href="#3679">3679</a></span><span class="counterCov">2</span><span class="lineCov">    let ip: SocketAddr = SocketAddr::new(IpAddr::V4(Ipv4Addr::new(0, 0, 0, 0)), ACN_SDT_MULTICAST_PORT + 1);</span></div>
<div class="line"><span id="3680" class="lineNum"><a href="#3680">3680</a></span><span class="counterCov">2</span><span class="lineCov">    let mut source = SacnSource::with_cid_ip(&amp;source_name.clone(), Uuid::from_bytes(&amp;CID).unwrap(), ip).unwrap();</span></div>
<div class="line"><span id="3681" class="lineNum"><a href="#3681">3681</a></span><span class="counterCov">2</span><span class="lineCov">    source.set_multicast_loop_v4(true).unwrap();</span></div>
<div class="line"><span id="3682" class="lineNum"><a href="#3682">3682</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="3683" class="lineNum"><a href="#3683">3683</a></span><span class="counterUnCov"></span><span class="lineUnCov">    // Register the synchronisation addresses.</span></div>
<div class="line"><span id="3684" class="lineNum"><a href="#3684">3684</a></span><span class="counterCov">2</span><span class="lineCov">    source.register_universes(&amp;SYNC_ADDRESSES).unwrap();</span></div>
<div class="line"><span id="3685" class="lineNum"><a href="#3685">3685</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="3686" class="lineNum"><a href="#3686">3686</a></span><span class="counterUnCov"></span><span class="lineUnCov">    // Don&#39;t want universe discovery packets to be sent which might interfer with checking sync packets.</span></div>
<div class="line"><span id="3687" class="lineNum"><a href="#3687">3687</a></span><span class="counterCov">2</span><span class="lineCov">    source.set_is_sending_discovery(false);</span></div>
<div class="line"><span id="3688" class="lineNum"><a href="#3688">3688</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="3689" class="lineNum"><a href="#3689">3689</a></span><span class="counterUnCov"></span><span class="lineUnCov">    // Create receiver socket.</span></div>
<div class="line"><span id="3690" class="lineNum"><a href="#3690">3690</a></span><span class="counterCov">2</span><span class="lineCov">    let recv_socket = Socket::new(Domain::ipv4(), Type::dgram(), None).unwrap();</span></div>
<div class="line"><span id="3691" class="lineNum"><a href="#3691">3691</a></span><span class="counterCov">2</span><span class="lineCov">    let addr: SocketAddr = SocketAddr::new(IpAddr::V4(Ipv4Addr::UNSPECIFIED), ACN_SDT_MULTICAST_PORT);</span></div>
<div class="line"><span id="3692" class="lineNum"><a href="#3692">3692</a></span><span class="counterCov">2</span><span class="lineCov">    recv_socket.bind(&amp;addr.into()).unwrap();</span></div>
<div class="line"><span id="3693" class="lineNum"><a href="#3693">3693</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="3694" class="lineNum"><a href="#3694">3694</a></span><span class="counterUnCov"></span><span class="lineUnCov">    // Join the multicast groups for each of the synchronisation addresses.</span></div>
<div class="line"><span id="3695" class="lineNum"><a href="#3695">3695</a></span><span class="counterCov">12</span><span class="lineCov">    for u in SYNC_ADDRESSES.iter() {</span></div>
<div class="line"><span id="3696" class="lineNum"><a href="#3696">3696</a></span><span class="counterCov">10</span><span class="lineCov">        let address = universe_to_ipv4_multicast_addr(*u).unwrap().as_inet();</span></div>
<div class="line"><span id="3697" class="lineNum"><a href="#3697">3697</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="3698" class="lineNum"><a href="#3698">3698</a></span><span class="counterCov">10</span><span class="lineCov">        recv_socket</span></div>
<div class="line"><span id="3699" class="lineNum"><a href="#3699">3699</a></span><span class="counterCov">10</span><span class="lineCov">            .join_multicast_v4(&amp;address.unwrap().ip(), &amp;Ipv4Addr::new(0, 0, 0, 0))</span></div>
<div class="line"><span id="3700" class="lineNum"><a href="#3700">3700</a></span><span class="counterUnCov"></span><span class="lineUnCov">            .unwrap();</span></div>
<div class="line"><span id="3701" class="lineNum"><a href="#3701">3701</a></span><span class="counterUnCov"></span><span class="lineUnCov">    }</span></div>
<div class="line"><span id="3702" class="lineNum"><a href="#3702">3702</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="3703" class="lineNum"><a href="#3703">3703</a></span><span class="counterCov">602</span><span class="lineCov">    for s in START_SEQ_NUM .. START_SEQ_NUM + SYNC_PACKETS_TO_SEND {</span></div>
<div class="line"><span id="3704" class="lineNum"><a href="#3704">3704</a></span><span class="counterCov">600</span><span class="lineCov">        let expected_seq_num: u8 = (s % 256).try_into().unwrap();</span></div>
<div class="line"><span id="3705" class="lineNum"><a href="#3705">3705</a></span><span class="counterCov">3600</span><span class="lineCov">        for a in SYNC_ADDRESSES.iter() {</span></div>
<div class="line"><span id="3706" class="lineNum"><a href="#3706">3706</a></span><span class="counterCov">3000</span><span class="lineCov">            let expected_packet = generate_sync_packet_raw(CID, *a, expected_seq_num);</span></div>
<div class="line"><span id="3707" class="lineNum"><a href="#3707">3707</a></span><span class="counterCov">3000</span><span class="lineCov">            source.send_sync_packet(*a, None).unwrap();</span></div>
<div class="line"><span id="3708" class="lineNum"><a href="#3708">3708</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="3709" class="lineNum"><a href="#3709">3709</a></span><span class="counterCov">3000</span><span class="lineCov">            let mut recv_buf = [0; 1024];</span></div>
<div class="line"><span id="3710" class="lineNum"><a href="#3710">3710</a></span><span class="counterCov">3000</span><span class="lineCov">            let (amt, _) = recv_socket.recv_from(&amp;mut recv_buf).unwrap();</span></div>
<div class="line"><span id="3711" class="lineNum"><a href="#3711">3711</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="3712" class="lineNum"><a href="#3712">3712</a></span><span class="counterCov">3000</span><span class="lineCov">            assert_eq!(&amp;recv_buf[0..amt], &amp;expected_packet[..]);</span></div>
<div class="line"><span id="3713" class="lineNum"><a href="#3713">3713</a></span><span class="counterCov">3000</span><span class="lineCov">        }</span></div>
<div class="line"><span id="3714" class="lineNum"><a href="#3714">3714</a></span><span class="counterUnCov"></span><span class="lineUnCov">    }</span></div>
<div class="line"><span id="3715" class="lineNum"><a href="#3715">3715</a></span><span class="counterCov">4</span><span class="lineCov">}</span></div>
<div class="line"><span id="3716" class="lineNum"><a href="#3716">3716</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="3717" class="lineNum"><a href="#3717">3717</a></span><span class="counterUnCov"></span><span class="lineUnCov">/// Creates 5 receiver sockets each listening to a different multicast address for a specific synchronisation address.</span></div>
<div class="line"><span id="3718" class="lineNum"><a href="#3718">3718</a></span><span class="counterUnCov"></span><span class="lineUnCov">/// Then creates a source which sends synchronisation packets meant for different synchronisation addresses.</span></div>
<div class="line"><span id="3719" class="lineNum"><a href="#3719">3719</a></span><span class="counterUnCov"></span><span class="lineUnCov">/// The receiver sockets check that they only receive synchronisation packets meant for their synchronisation address / multicast address.</span></div>
<div class="line"><span id="3720" class="lineNum"><a href="#3720">3720</a></span><span class="counterUnCov"></span><span class="lineUnCov">/// </span></div>
<div class="line"><span id="3721" class="lineNum"><a href="#3721">3721</a></span><span class="counterUnCov"></span><span class="lineUnCov">/// This shows that synchronisation packets are only sent to the multicast address which corresponds to the synchronisation address as per</span></div>
<div class="line"><span id="3722" class="lineNum"><a href="#3722">3722</a></span><span class="counterUnCov"></span><span class="lineUnCov">/// ANSI E1.31-2018 Section 6.3.3.1.</span></div>
<div class="line"><span id="3723" class="lineNum"><a href="#3723">3723</a></span><span class="counterUnCov"></span><span class="lineUnCov">/// </span></div>
<div class="line"><span id="3724" class="lineNum"><a href="#3724">3724</a></span><span class="counterUnCov"></span><span class="lineUnCov">#[test]</span></div>
<div class="line"><span id="3725" class="lineNum"><a href="#3725">3725</a></span><span class="counterUnCov"></span><span class="lineUnCov">#[cfg_attr(rustfmt, rustfmt_skip)]</span></div>
<div class="line"><span id="3726" class="lineNum"><a href="#3726">3726</a></span><span class="counterCov">4</span><span class="lineCov">fn test_sync_packet_multicast_address() {</span></div>
<div class="line"><span id="3727" class="lineNum"><a href="#3727">3727</a></span><span class="counterUnCov"></span><span class="lineUnCov">    // Source CID and name, set to arbitrary values as not the focus of the test.</span></div>
<div class="line"><span id="3728" class="lineNum"><a href="#3728">3728</a></span><span class="counterUnCov"></span><span class="lineUnCov">    const CID: [u8; 16] = [0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15];</span></div>
<div class="line"><span id="3729" class="lineNum"><a href="#3729">3729</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="3730" class="lineNum"><a href="#3730">3730</a></span><span class="counterCov">2</span><span class="lineCov">    let source_name = &quot;SourceName&quot;.to_string() +</span></div>
<div class="line"><span id="3731" class="lineNum"><a href="#3731">3731</a></span><span class="counterUnCov"></span><span class="lineUnCov">                        &quot;\0\0\0\0\0\0\0\0\0\0&quot; +</span></div>
<div class="line"><span id="3732" class="lineNum"><a href="#3732">3732</a></span><span class="counterUnCov"></span><span class="lineUnCov">                        &quot;\0\0\0\0\0\0\0\0\0\0&quot; +</span></div>
<div class="line"><span id="3733" class="lineNum"><a href="#3733">3733</a></span><span class="counterUnCov"></span><span class="lineUnCov">                        &quot;\0\0\0\0\0\0\0\0\0\0&quot; +</span></div>
<div class="line"><span id="3734" class="lineNum"><a href="#3734">3734</a></span><span class="counterUnCov"></span><span class="lineUnCov">                        &quot;\0\0\0\0\0\0\0\0\0\0&quot; +</span></div>
<div class="line"><span id="3735" class="lineNum"><a href="#3735">3735</a></span><span class="counterUnCov"></span><span class="lineUnCov">                        &quot;\0\0\0\0\0\0\0\0\0\0&quot; +</span></div>
<div class="line"><span id="3736" class="lineNum"><a href="#3736">3736</a></span><span class="counterUnCov"></span><span class="lineUnCov">                        &quot;\0\0\0\0&quot;;</span></div>
<div class="line"><span id="3737" class="lineNum"><a href="#3737">3737</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="3738" class="lineNum"><a href="#3738">3738</a></span><span class="counterUnCov"></span><span class="lineUnCov">    // The expected starting sequence number of sync packets from the source.</span></div>
<div class="line"><span id="3739" class="lineNum"><a href="#3739">3739</a></span><span class="counterUnCov"></span><span class="lineUnCov">    const START_SEQ_NUM: usize = 0;</span></div>
<div class="line"><span id="3740" class="lineNum"><a href="#3740">3740</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="3741" class="lineNum"><a href="#3741">3741</a></span><span class="counterUnCov"></span><span class="lineUnCov">    // The number of sync packets to send per sync_address. Chosen arbitrarily to be high enough that if there was going to be a mix up in the addressing there would be a</span></div>
<div class="line"><span id="3742" class="lineNum"><a href="#3742">3742</a></span><span class="counterUnCov"></span><span class="lineUnCov">    // sufficient chance of it being seen.</span></div>
<div class="line"><span id="3743" class="lineNum"><a href="#3743">3743</a></span><span class="counterUnCov"></span><span class="lineUnCov">    const SYNC_PACKETS_TO_SEND: usize = 250;</span></div>
<div class="line"><span id="3744" class="lineNum"><a href="#3744">3744</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="3745" class="lineNum"><a href="#3745">3745</a></span><span class="counterUnCov"></span><span class="lineUnCov">    // The universes that the sync packets are sent on.</span></div>
<div class="line"><span id="3746" class="lineNum"><a href="#3746">3746</a></span><span class="counterUnCov"></span><span class="lineUnCov">    // Chosen to contain adjacent universes and a separate universe to check that this doesn&#39;t effect the address sending.</span></div>
<div class="line"><span id="3747" class="lineNum"><a href="#3747">3747</a></span><span class="counterUnCov"></span><span class="lineUnCov">    const SYNC_ADDRESSES: [u16; 3] = [1, 2, 63999];</span></div>
<div class="line"><span id="3748" class="lineNum"><a href="#3748">3748</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="3749" class="lineNum"><a href="#3749">3749</a></span><span class="counterUnCov"></span><span class="lineUnCov">    // Create a source.</span></div>
<div class="line"><span id="3750" class="lineNum"><a href="#3750">3750</a></span><span class="counterCov">2</span><span class="lineCov">    let ip: SocketAddr = SocketAddr::new(IpAddr::V4(TEST_NETWORK_INTERFACE_IPV4[0].parse().unwrap()), ACN_SDT_MULTICAST_PORT + 1);</span></div>
<div class="line"><span id="3751" class="lineNum"><a href="#3751">3751</a></span><span class="counterCov">2</span><span class="lineCov">    let mut source = SacnSource::with_cid_ip(&amp;source_name.clone(), Uuid::from_bytes(&amp;CID).unwrap(), ip).unwrap();</span></div>
<div class="line"><span id="3752" class="lineNum"><a href="#3752">3752</a></span><span class="counterCov">2</span><span class="lineCov">    source.set_multicast_loop_v4(true).unwrap();</span></div>
<div class="line"><span id="3753" class="lineNum"><a href="#3753">3753</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="3754" class="lineNum"><a href="#3754">3754</a></span><span class="counterUnCov"></span><span class="lineUnCov">    // Register the synchronisation addresses.</span></div>
<div class="line"><span id="3755" class="lineNum"><a href="#3755">3755</a></span><span class="counterCov">2</span><span class="lineCov">    source.register_universes(&amp;SYNC_ADDRESSES).unwrap();</span></div>
<div class="line"><span id="3756" class="lineNum"><a href="#3756">3756</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="3757" class="lineNum"><a href="#3757">3757</a></span><span class="counterUnCov"></span><span class="lineUnCov">    // Don&#39;t want universe discovery packets to be sent which might interfer with checking sync packets.</span></div>
<div class="line"><span id="3758" class="lineNum"><a href="#3758">3758</a></span><span class="counterCov">2</span><span class="lineCov">    source.set_is_sending_discovery(false);</span></div>
<div class="line"><span id="3759" class="lineNum"><a href="#3759">3759</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="3760" class="lineNum"><a href="#3760">3760</a></span><span class="counterUnCov"></span><span class="lineUnCov">    // Create receiver sockets.</span></div>
<div class="line"><span id="3761" class="lineNum"><a href="#3761">3761</a></span><span class="counterCov">2</span><span class="lineCov">    let mut recv_sockets: Vec&lt;Socket&gt; = Vec::new();</span></div>
<div class="line"><span id="3762" class="lineNum"><a href="#3762">3762</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="3763" class="lineNum"><a href="#3763">3763</a></span><span class="counterCov">2</span><span class="lineCov">    let mut i = 0;</span></div>
<div class="line"><span id="3764" class="lineNum"><a href="#3764">3764</a></span><span class="counterCov">8</span><span class="lineCov">    for sync_addr in SYNC_ADDRESSES.iter() {</span></div>
<div class="line"><span id="3765" class="lineNum"><a href="#3765">3765</a></span><span class="counterCov">6</span><span class="lineCov">        recv_sockets.push(Socket::new(Domain::ipv4(), Type::dgram(), None).unwrap());</span></div>
<div class="line"><span id="3766" class="lineNum"><a href="#3766">3766</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="3767" class="lineNum"><a href="#3767">3767</a></span><span class="counterUnCov"></span><span class="lineUnCov">        // Join only the multicast address corresponding to the synchronisation address.</span></div>
<div class="line"><span id="3768" class="lineNum"><a href="#3768">3768</a></span><span class="counterCov">6</span><span class="lineCov">        let multicast_addr = universe_to_ipv4_multicast_addr(*sync_addr).unwrap();</span></div>
<div class="line"><span id="3769" class="lineNum"><a href="#3769">3769</a></span><span class="counterCov">6</span><span class="lineCov">        recv_sockets[i].bind(&amp;multicast_addr).unwrap();</span></div>
<div class="line"><span id="3770" class="lineNum"><a href="#3770">3770</a></span><span class="counterCov">12</span><span class="lineCov">        recv_sockets[i]</span></div>
<div class="line"><span id="3771" class="lineNum"><a href="#3771">3771</a></span><span class="counterCov">6</span><span class="lineCov">            .join_multicast_v4(&amp;multicast_addr.as_inet().unwrap().ip(), &amp;TEST_NETWORK_INTERFACE_IPV4[i].parse().unwrap())</span></div>
<div class="line"><span id="3772" class="lineNum"><a href="#3772">3772</a></span><span class="counterUnCov"></span><span class="lineUnCov">            .unwrap();</span></div>
<div class="line"><span id="3773" class="lineNum"><a href="#3773">3773</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="3774" class="lineNum"><a href="#3774">3774</a></span><span class="counterCov">6</span><span class="lineCov">        i = i + 1;</span></div>
<div class="line"><span id="3775" class="lineNum"><a href="#3775">3775</a></span><span class="counterUnCov"></span><span class="lineUnCov">    }</span></div>
<div class="line"><span id="3776" class="lineNum"><a href="#3776">3776</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="3777" class="lineNum"><a href="#3777">3777</a></span><span class="counterCov">502</span><span class="lineCov">    for s in START_SEQ_NUM .. START_SEQ_NUM + SYNC_PACKETS_TO_SEND {</span></div>
<div class="line"><span id="3778" class="lineNum"><a href="#3778">3778</a></span><span class="counterCov">500</span><span class="lineCov">        let expected_seq_num: u8 = (s % 256).try_into().unwrap();</span></div>
<div class="line"><span id="3779" class="lineNum"><a href="#3779">3779</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="3780" class="lineNum"><a href="#3780">3780</a></span><span class="counterCov">500</span><span class="lineCov">        let mut i = 0;</span></div>
<div class="line"><span id="3781" class="lineNum"><a href="#3781">3781</a></span><span class="counterCov">2000</span><span class="lineCov">        for sync_addr in SYNC_ADDRESSES.iter() {</span></div>
<div class="line"><span id="3782" class="lineNum"><a href="#3782">3782</a></span><span class="counterCov">1500</span><span class="lineCov">            let expected_packet = generate_sync_packet_raw(CID, *sync_addr, expected_seq_num);</span></div>
<div class="line"><span id="3783" class="lineNum"><a href="#3783">3783</a></span><span class="counterCov">1500</span><span class="lineCov">            source.send_sync_packet(*sync_addr, None).unwrap();</span></div>
<div class="line"><span id="3784" class="lineNum"><a href="#3784">3784</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="3785" class="lineNum"><a href="#3785">3785</a></span><span class="counterCov">1500</span><span class="lineCov">            let mut recv_buf = [0; 1024];</span></div>
<div class="line"><span id="3786" class="lineNum"><a href="#3786">3786</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="3787" class="lineNum"><a href="#3787">3787</a></span><span class="counterUnCov"></span><span class="lineUnCov">            // Receive only from the corresponding socket for that sync address.</span></div>
<div class="line"><span id="3788" class="lineNum"><a href="#3788">3788</a></span><span class="counterUnCov"></span><span class="lineUnCov">            // This means that the sync address must have been sent to the correct multicast address.</span></div>
<div class="line"><span id="3789" class="lineNum"><a href="#3789">3789</a></span><span class="counterUnCov"></span><span class="lineUnCov">            // If it was also sent to other addresses then this will be caught the next time the other sockets</span></div>
<div class="line"><span id="3790" class="lineNum"><a href="#3790">3790</a></span><span class="counterUnCov"></span><span class="lineUnCov">            // receive as they will receive the wrong packet.</span></div>
<div class="line"><span id="3791" class="lineNum"><a href="#3791">3791</a></span><span class="counterCov">1500</span><span class="lineCov">            let (amt, _) = recv_sockets[i].recv_from(&amp;mut recv_buf).unwrap();</span></div>
<div class="line"><span id="3792" class="lineNum"><a href="#3792">3792</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="3793" class="lineNum"><a href="#3793">3793</a></span><span class="counterCov">1500</span><span class="lineCov">            assert_eq!(&amp;recv_buf[0..amt], &amp;expected_packet[..]);</span></div>
<div class="line"><span id="3794" class="lineNum"><a href="#3794">3794</a></span><span class="counterUnCov"></span><span class="lineUnCov"></span></div>
<div class="line"><span id="3795" class="lineNum"><a href="#3795">3795</a></span><span class="counterCov">1500</span><span class="lineCov">            i = i + 1;</span></div>
<div class="line"><span id="3796" class="lineNum"><a href="#3796">3796</a></span><span class="counterCov">1500</span><span class="lineCov">        }</span></div>
<div class="line"><span id="3797" class="lineNum"><a href="#3797">3797</a></span><span class="counterUnCov"></span><span class="lineUnCov">    }</span></div>
<div class="line"><span id="3798" class="lineNum"><a href="#3798">3798</a></span><span class="counterCov">4</span><span class="lineCov">}</span></div>
</div>
</body>
</html>
